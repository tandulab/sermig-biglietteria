import{l as Se,m as xe,o as Z,p as O,a as ee,c as A,_ as Q,r as w,q as Ce,b as u,e as b,g as i,f as l,n as J,t as k,w as D,s as V,F as $,h as F,v as me,x as Re,B as Ue,C as fe,Z as Oe,D as ae,y as dt,O as ut,z as mt,A as ft,E as _t,G as pt,H as W,I as ge,J as se,K as Ae,L as Pe,T as vt,M as ht,i as oe,N as be,P as yt,Q as Ne,R as gt,S as bt,u as kt}from"../index12246.js";import{u as ne,a as pe,f as Ie,b as Le,c as wt,d as xt,e as Te,g as ke,h as Be,i as Ct,D as re,j as je}from"./location12246.js";import{u as ve,s as te,e as N,p as ze,a as Dt,b as Ve,c as we,d as qe}from"./helpers12246.js";import{F as Ot}from"./vee-validate.esm12246.js";class Me{static async fetchAll(t){const n=t.location_permalink;return delete t.location_permalink,(await Se(`/ticket_office/${n}/search/tickets`,t)).data}static async fetchAllOpenTickets(t){const n=t.location_permalink;return delete t.location_permalink,(await Se(`/ticket_office/${n}/orders/search_codes`,t)).data}}const De=xe({id:"ticket",state:()=>({ticket:{},tickets:[],response_tickets:{},open_tickets_codes:{}}),getters:{allTickets:o=>o.response_tickets.available_ticket_types,allOpenTickets:o=>o.open_tickets_codes.open_tickets,responseTickets:o=>o.response_tickets,getTotalTickets:o=>o.response_tickets?o.response_tickets.total:0,getCurrentTicket:o=>o.ticket},actions:{async fetchAllTickets(o){await Me.fetchAll(o).then(t=>this.response_tickets=t)},async fetchAllOpenTickets(o){await Me.fetchAllOpenTickets(o).then(t=>this.open_tickets_codes=t)}}}),St={computed:{Code(){return Code}},props:["location_permalink","time_slot"],setup(o,t){Z(()=>{n.value=Object.assign({},o.time_slot)});const n=O({}),e=De(),y=ne(),{showLoader:g,hideLoader:a}=ve(),m=ee(),x=O(),f=O(),c=A(()=>e.allOpenTickets),h=A(()=>y.paymentStatus),C=A(()=>y.paymentModeList),v=A(()=>{const r=y.getPaymentMethods;return Object.entries(r).map(([_,M])=>({id:_,label:M}))}),s=A(()=>y.getCurrentOrder),S=async function(r){const _={code:r.query.toUpperCase(),location_permalink:o.location_permalink};await e.fetchAllOpenTickets(_)},I=async function(){var _,M;const r={id:o.location_permalink,order_id:n.value.id,status:(_=n.value)==null?void 0:_.status,payment_method:n.value.payment_method,open_ticket_codes:[],api_version:"v2",notes:(M=n.value)==null?void 0:M.notes};if(n.value.status&&n.value.status=="payed"&&!n.value.payment_method){x.value="Seleziona un metodo di pagamento";return}for(const E of n.value.open_tickets_used)if(E.expired){f.value="Uno o più codici biglietto risultano scaduti";return}if(n.value.open_tickets_used&&n.value.open_tickets_used.length>0){let E=[];n.value.open_tickets_used.forEach(G=>{E.push(G.code)}),r.open_ticket_codes=E}P(r)},P=async function(r){g(),await y.updateOrder(r).then(()=>{a(),te(m,{message:"Stato aggiornato correttamente",error:!1}),t.emit("closeDialog",s.value)}).catch(_=>{a(),N(m,_)})};return{form:n,open_tickets:c,paymentList:h,paymentModeList:C,changeStatus:I,errorMessage:x,errorMessageVoucher:f,dynamicPaymentMethods:v,fetchAllOpenTickets:S,onChangeStatus:function(){(n.value.status=="free"||n.value.status=="to_pay")&&(n.value.payment_method=null)}}}},Vt={key:0,class:"formgrid grid flex-column mt-3"},Lt={class:"field col-12"},Tt=i("label",{for:"status"},"Stato pagamento",-1),At={class:"field col-12"},Pt=i("label",{for:"payment_method"},"Modalità pagamento",-1),jt={class:"p-error",id:"dd-error"},Mt={key:0,class:"field col-12 flex flex-column"},Ft=i("label",{for:"user_zip"},"Codice biglietto",-1),Et={key:0,class:"pi pi-exclamation-triangle",style:{color:"#ff6767"}},Rt={class:"p-error",id:"dd-error"},Ut={class:"flex align-items-center justify-content-end mt-3"};function Nt(o,t,n,e,y,g){const a=w("Dropdown"),m=w("AutoComplete"),x=w("Button"),f=Ce("tooltip");return u(),b($,null,[e.form?(u(),b("div",Vt,[i("div",Lt,[Tt,l(a,{modelValue:e.form.status,"onUpdate:modelValue":t[0]||(t[0]=c=>e.form.status=c),options:e.paymentList,optionLabel:"name",optionValue:"id",class:"w-full",onChange:t[1]||(t[1]=c=>e.onChangeStatus())},null,8,["modelValue","options"])]),i("div",At,[Pt,l(a,{modelValue:e.form.payment_method,"onUpdate:modelValue":t[2]||(t[2]=c=>e.form.payment_method=c),options:e.dynamicPaymentMethods,optionLabel:"label",optionValue:"id",class:J(["w-full",{"p-invalid":e.errorMessage}]),disabled:e.form.status!="payed",onChange:t[3]||(t[3]=c=>e.errorMessage=null)},null,8,["modelValue","options","disabled","class"]),i("small",jt,k(e.errorMessage||" "),1)]),e.form.payment_method=="voucher"&&e.form.status=="payed"?(u(),b("div",Mt,[Ft,l(m,{modelValue:e.form.open_tickets_used,"onUpdate:modelValue":t[4]||(t[4]=c=>e.form.open_tickets_used=c),suggestions:e.open_tickets,class:J(["uppercase w-full",{"p-invalid":e.errorMessageVoucher}]),onComplete:t[5]||(t[5]=c=>e.fetchAllOpenTickets(c)),emptySearchMessage:"Nessun risultato",emptySelectionMessage:"Nessun risultato",optionLabel:"code",optionValue:"code",multiple:"",onChange:t[6]||(t[6]=c=>e.errorMessageVoucher=null)},{option:D(({option:c})=>[i("span",{class:"flex flex-row justify-content-between",style:Re({color:c.expired?"#ff6767":null})},[F(k(c.code)+" ",1),c.expired?me((u(),b("i",Et,null,512)),[[f,"Scaduto"]]):V("",!0)],4)]),_:1},8,["modelValue","suggestions","class"]),i("small",Rt,k(e.errorMessageVoucher||" "),1)])):V("",!0)])):V("",!0),i("div",Ut,[l(x,{label:"Annulla",text:"",onClick:t[7]||(t[7]=c=>o.$emit("closeDialog",null))}),l(x,{label:"Conferma",onClick:t[8]||(t[8]=c=>e.changeStatus())})])],64)}const It=Q(St,[["render",Nt]]);var Bt=`
@layer primevue {
    .p-confirm-popup {
        position: absolute;
        margin-top: 10px;
        top: 0;
        left: 0;
    }

    .p-confirm-popup-flipped {
        margin-top: 0;
        margin-bottom: 10px;
    }

    /* Animation */
    .p-confirm-popup-enter-from {
        opacity: 0;
        transform: scaleY(0.8);
    }

    .p-confirm-popup-leave-to {
        opacity: 0;
    }

    .p-confirm-popup-enter-active {
        transition: transform 0.12s cubic-bezier(0, 0, 0.2, 1), opacity 0.12s cubic-bezier(0, 0, 0.2, 1);
    }

    .p-confirm-popup-leave-active {
        transition: opacity 0.1s linear;
    }

    .p-confirm-popup:after,
    .p-confirm-popup:before {
        bottom: 100%;
        left: calc(var(--overlayArrowLeft, 0) + 1.25rem);
        content: ' ';
        height: 0;
        width: 0;
        position: absolute;
        pointer-events: none;
    }

    .p-confirm-popup:after {
        border-width: 8px;
        margin-left: -8px;
    }

    .p-confirm-popup:before {
        border-width: 10px;
        margin-left: -10px;
    }

    .p-confirm-popup-flipped:after,
    .p-confirm-popup-flipped:before {
        bottom: auto;
        top: 100%;
    }

    .p-confirm-popup.p-confirm-popup-flipped:after {
        border-bottom-color: transparent;
    }

    .p-confirm-popup.p-confirm-popup-flipped:before {
        border-bottom-color: transparent;
    }

    .p-confirm-popup .p-confirm-popup-content {
        display: flex;
        align-items: center;
    }
}
`,zt={root:function(t){var n=t.instance;return["p-confirm-popup p-component",{"p-input-filled":n.$primevue.config.inputStyle==="filled","p-ripple-disabled":n.$primevue.config.ripple===!1}]},content:"p-confirm-popup-content",icon:function(t){var n=t.instance;return["p-confirm-popup-icon",n.confirmation?n.confirmation.icon:null]},message:"p-confirm-popup-message",footer:"p-confirm-popup-footer",rejectButton:function(t){var n=t.instance;return["p-confirm-popup-reject",n.confirmation&&!n.confirmation.rejectClass?"p-button-text":null]},acceptButton:"p-confirm-popup-accept"},qt=Ue.extend({name:"confirmpopup",css:Bt,classes:zt}),Ht={name:"BaseConfirmPopup",extends:pt,props:{group:String},style:qt,provide:function(){return{$parentInstance:this}}},He={name:"ConfirmPopup",extends:Ht,inheritAttrs:!1,data:function(){return{visible:!1,confirmation:null,autoFocusAccept:null,autoFocusReject:null}},target:null,outsideClickListener:null,scrollHandler:null,resizeListener:null,container:null,confirmListener:null,closeListener:null,mounted:function(){var t=this;this.confirmListener=function(n){n&&n.group===t.group&&(t.confirmation=n,t.target=n.target,t.confirmation.onShow&&t.confirmation.onShow(),t.visible=!0)},this.closeListener=function(){t.visible=!1,t.confirmation=null},fe.on("confirm",this.confirmListener),fe.on("close",this.closeListener)},beforeUnmount:function(){fe.off("confirm",this.confirmListener),fe.off("close",this.closeListener),this.unbindOutsideClickListener(),this.scrollHandler&&(this.scrollHandler.destroy(),this.scrollHandler=null),this.unbindResizeListener(),this.container&&(Oe.clear(this.container),this.container=null),this.target=null,this.confirmation=null},methods:{accept:function(){this.confirmation.accept&&this.confirmation.accept(),this.visible=!1},reject:function(){this.confirmation.reject&&this.confirmation.reject(),this.visible=!1},onHide:function(){this.confirmation.onHide&&this.confirmation.onHide(),this.visible=!1},onAcceptKeydown:function(t){(t.code==="Space"||t.code==="Enter")&&(this.accept(),ae.focus(this.target),t.preventDefault())},onRejectKeydown:function(t){(t.code==="Space"||t.code==="Enter")&&(this.reject(),ae.focus(this.target),t.preventDefault())},onEnter:function(t){this.autoFocusAccept=this.confirmation.defaultFocus===void 0||this.confirmation.defaultFocus==="accept",this.autoFocusReject=this.confirmation.defaultFocus==="reject",this.bindOutsideClickListener(),this.bindScrollListener(),this.bindResizeListener(),Oe.set("overlay",t,this.$primevue.config.zIndex.overlay)},onAfterEnter:function(){this.focus()},onLeave:function(){this.autoFocusAccept=null,this.autoFocusReject=null,this.unbindOutsideClickListener(),this.unbindScrollListener(),this.unbindResizeListener()},onAfterLeave:function(t){Oe.clear(t)},alignOverlay:function(){ae.absolutePosition(this.container,this.target);var t=ae.getOffset(this.container),n=ae.getOffset(this.target),e=0;t.left<n.left&&(e=n.left-t.left),this.container.style.setProperty("--overlayArrowLeft","".concat(e,"px")),t.top<n.top&&(this.container.setAttribute("data-p-confirm-popup-flipped","true"),!this.isUnstyled&&ae.addClass(this.container,"p-confirm-popup-flipped"))},bindOutsideClickListener:function(){var t=this;this.outsideClickListener||(this.outsideClickListener=function(n){t.visible&&t.container&&!t.container.contains(n.target)&&!t.isTargetClicked(n)?(t.confirmation.onHide&&t.confirmation.onHide(),t.visible=!1):t.alignOverlay()},document.addEventListener("click",this.outsideClickListener))},unbindOutsideClickListener:function(){this.outsideClickListener&&(document.removeEventListener("click",this.outsideClickListener),this.outsideClickListener=null)},bindScrollListener:function(){var t=this;this.scrollHandler||(this.scrollHandler=new dt(this.target,function(){t.visible&&(t.visible=!1)})),this.scrollHandler.bindScrollListener()},unbindScrollListener:function(){this.scrollHandler&&this.scrollHandler.unbindScrollListener()},bindResizeListener:function(){var t=this;this.resizeListener||(this.resizeListener=function(){t.visible&&!ae.isTouchDevice()&&(t.visible=!1)},window.addEventListener("resize",this.resizeListener))},unbindResizeListener:function(){this.resizeListener&&(window.removeEventListener("resize",this.resizeListener),this.resizeListener=null)},focus:function(){var t=this.container.querySelector("[autofocus]");t&&t.focus({preventScroll:!0})},isTargetClicked:function(t){return this.target&&(this.target===t.target||this.target.contains(t.target))},containerRef:function(t){this.container=t},onOverlayClick:function(t){ut.emit("overlay-click",{originalEvent:t,target:this.target})},onOverlayKeydown:function(t){t.code==="Escape"&&(fe.emit("close",this.closeListener),ae.focus(this.target))},getCXOptions:function(t,n){return{contenxt:{icon:t,iconClass:n.class}}}},computed:{message:function(){return this.confirmation?this.confirmation.message:null},acceptLabel:function(){return this.confirmation?this.confirmation.acceptLabel||this.$primevue.config.locale.accept:null},rejectLabel:function(){return this.confirmation?this.confirmation.rejectLabel||this.$primevue.config.locale.reject:null},acceptIcon:function(){return this.confirmation?this.confirmation.acceptIcon:null},rejectIcon:function(){return this.confirmation?this.confirmation.rejectIcon:null}},components:{CPButton:mt,Portal:ft},directives:{focustrap:_t}};function _e(o){"@babel/helpers - typeof";return _e=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_e(o)}function Fe(o,t){var n=Object.keys(o);if(Object.getOwnPropertySymbols){var e=Object.getOwnPropertySymbols(o);t&&(e=e.filter(function(y){return Object.getOwnPropertyDescriptor(o,y).enumerable})),n.push.apply(n,e)}return n}function Ee(o){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?Fe(Object(n),!0).forEach(function(e){Kt(o,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(n)):Fe(Object(n)).forEach(function(e){Object.defineProperty(o,e,Object.getOwnPropertyDescriptor(n,e))})}return o}function Kt(o,t,n){return t=Jt(t),t in o?Object.defineProperty(o,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):o[t]=n,o}function Jt(o){var t=Gt(o,"string");return _e(t)==="symbol"?t:String(t)}function Gt(o,t){if(_e(o)!=="object"||o===null)return o;var n=o[Symbol.toPrimitive];if(n!==void 0){var e=n.call(o,t||"default");if(_e(e)!=="object")return e;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(o)}var Wt=["aria-modal"];function Qt(o,t,n,e,y,g){var a=w("CPButton"),m=w("Portal"),x=Ce("focustrap");return u(),W(m,null,{default:D(function(){return[l(vt,se({name:"p-confirm-popup",onEnter:g.onEnter,onAfterEnter:g.onAfterEnter,onLeave:g.onLeave,onAfterLeave:g.onAfterLeave},o.ptm("transition")),{default:D(function(){return[y.visible?me((u(),b("div",se({key:0,ref:g.containerRef,role:"alertdialog",class:o.cx("root"),"aria-modal":y.visible,onClick:t[2]||(t[2]=function(){return g.onOverlayClick&&g.onOverlayClick.apply(g,arguments)}),onKeydown:t[3]||(t[3]=function(){return g.onOverlayKeydown&&g.onOverlayKeydown.apply(g,arguments)})},Ee(Ee({},o.$attrs),o.ptm("root"))),[o.$slots.container?ge(o.$slots,"container",{key:0,message:y.confirmation,onAccept:g.accept,onReject:g.reject}):(u(),b($,{key:1},[o.$slots.message?(u(),W(Ae(o.$slots.message),{key:1,message:y.confirmation},null,8,["message"])):(u(),b("div",se({key:0,class:o.cx("content")},o.ptm("content")),[ge(o.$slots,"icon",{},function(){return[o.$slots.icon?(u(),W(Ae(o.$slots.icon),{key:0,class:J(o.cx("icon"))},null,8,["class"])):y.confirmation.icon?(u(),b("span",se({key:1,class:o.cx("icon")},o.ptm("icon")),null,16)):V("",!0)]}),i("span",se({class:o.cx("message")},o.ptm("message")),k(y.confirmation.message),17)],16)),i("div",se({class:o.cx("footer")},o.ptm("footer")),[l(a,{label:g.rejectLabel,onClick:t[0]||(t[0]=function(f){return g.reject()}),onKeydown:g.onRejectKeydown,autofocus:y.autoFocusReject,class:J([o.cx("rejectButton"),y.confirmation.rejectClass]),unstyled:o.unstyled,pt:o.ptm("rejectButton"),"data-pc-name":"rejectbutton"},Pe({_:2},[g.rejectIcon||o.$slots.rejecticon?{name:"icon",fn:D(function(f){return[ge(o.$slots,"rejecticon",{},function(){return[i("span",se({class:[g.rejectIcon,f.class]},o.ptm("rejectButton").icon,{"data-pc-name":"rejectbuttonicon"}),null,16)]})]}),key:"0"}:void 0]),1032,["label","onKeydown","autofocus","class","unstyled","pt"]),l(a,{label:g.acceptLabel,onClick:t[1]||(t[1]=function(f){return g.accept()}),onKeydown:g.onAcceptKeydown,autofocus:y.autoFocusAccept,class:J([o.cx("acceptButton"),y.confirmation.acceptClass]),unstyled:o.unstyled,pt:o.ptm("acceptButton"),"data-pc-name":"acceptbutton"},Pe({_:2},[g.acceptIcon||o.$slots.accepticon?{name:"icon",fn:D(function(f){return[ge(o.$slots,"accepticon",{},function(){return[i("span",se({class:[g.acceptIcon,f.class]},o.ptm("acceptButton").icon,{"data-pc-name":"acceptbuttonicon"}),null,16)]})]}),key:"0"}:void 0]),1032,["label","onKeydown","autofocus","class","unstyled","pt"])],16)],64))],16,Wt)),[[x]]):V("",!0)]}),_:3},16,["onEnter","onAfterEnter","onLeave","onAfterLeave"])]}),_:3})}He.render=Qt;const Xt={props:["order"],setup(o,{emit:t}){Z(()=>{_.value&&r.value&&_.value.forEach(R=>{R.permalink===r.value&&(a.value=R.name)})});const n=O(0),e=O([]),y=O(!1),g=O(!0),a=O(),m=ht(),x=O([]),f=O({}),c=O(null),h=O(!1),C=O({...o.order});oe(()=>o.order,R=>{Object.assign(C,R)});const v=De(),s=ne(),S=ee(),I=pe(),P=A(()=>v.allTickets),d=A(()=>s.getCurrentOrder),r=A(()=>I.getCurrentLocation),_=A(()=>I.allLocations),M=A(()=>{const R=o.order.payment_method,U=s.getPaymentMethods;return R?U[R]:"-"}),E=A(()=>{const R=s.getPaymentMethods;return Object.entries(R).map(([U,q])=>({id:U,label:q}))}),G=A(()=>s.paymentMethodAccountList),ce=[{label:"Acconto",value:"deposit"},{label:"Saldo",value:"balance"}],T=R=>R==="deposit"?"Acconto":R==="balance"?"Saldo":"-",B=(R,U)=>{c.value=R,m.require({target:U.currentTarget,message:"Sei sicuro di voler eliminare questo acconto?",icon:"pi pi-info-circle",rejectClass:"p-button-secondary p-button-outlined p-button-sm",acceptClass:"p-button-danger p-button-sm",rejectLabel:"Annulla",acceptLabel:"Elimina",accept:async()=>{var q;await s.deletePayment({location:((q=r.value)==null?void 0:q.permalink)??"",id:o.order.id,payment_id:c.value.id}),await le(),te(S,{message:"Acconto eliminato con successo",error:!1})}})},z=function(){let R={amount:"",payment_method:"",typology:"",id:"-1"};C.value.payments.push(R),x.value.push(R)},de=async function(R){var U,q;h.value=!0;try{let{newData:ie}=R;const he={amount:ie.amount,payment_method:ie.payment_method,typology:ie.typology};ie.id!=-1?await s.updatePayment({location:((U=r.value)==null?void 0:U.permalink)??"",id:o.order.id,payment_id:ie.id,payment:he}):await s.createPayment({location:((q=r.value)==null?void 0:q.permalink)??"",id:o.order.id,payment:he}),await le()}catch(ie){N(S,ie)}finally{h.value=!1}},ue=function(R,U){f.value.payments.splice(U,1)},le=async function(){var R;try{const U=await s.getPayment({location:((R=r.value)==null?void 0:R.permalink)??"",id:o.order.id});C.value.payments.splice(0,C.value.payments.length,...U.payments),C.value.paid_amount=U.paid_amount,C.value.remaining_amount=U.remaining_amount}catch{C.value.remaining_amount="0.0",C.value.paid_amount="0.0",C.value.payments=[]}};return{tickets:P,active:n,partialTotals:e,showOrderDetail:y,currentOrder:d,showSecondTab:g,currentLocation:r,selectedLocation:a,editingRows:x,localOrder:C,loadingPayments:h,formatExplicitDate:Ie,formatDate:Le,confirm1:B,addAmount:z,onRowEditSave:de,deleteSlot:ue,dynamicPaymentMethods:E,typologyOptions:ce,getPayments:le,paymentMethodAccountList:G,prettyPaymentStatus:ze,formatPrettyDate:wt,formatDataAndHourFromUnixTimestamps:xt,prettyPaymentMethod:Dt,methodLabel:M,prettyTypology:T}},components:{ConfirmPopup:He}};const Zt={class:"mt-3 line-height-3"},Yt={class:"flex gap-3"},$t=i("i",{class:"pi pi-user mt-1"},null,-1),eo={class:"m-0 mb-1"},to={class:"m-0 mb-1"},oo={class:"m-0 mb-1"},no={class:"m-0 mb-1"},io={key:0},lo={class:"flex gap-3 mt-4"},ao=i("i",{class:"pi pi-map-marker mt-1"},null,-1),so={class:"m-0 mb-1"},ro={class:"m-0 mb-1"},co={key:0,class:"m-0 mb-1"},uo={class:"flex gap-3 mt-4"},mo=i("i",{class:"pi pi-shopping-cart mt-1"},null,-1),fo={class:"m-0 mb-1"},_o={class:"m-0 mb-1"},po={class:"m-0 mb-1"},vo={key:0,class:"m-0 mb-1"},ho={key:1,class:"m-0 mb-1"},yo={key:2,class:"m-0 mb-1"},go={class:"m-0 mb-1"},bo={class:"m-0 mb-1"},ko={key:0},wo={key:1},xo={class:"m-0 mb-1"},Co={key:0},Do={key:1},Oo={class:"m-0 mb-1"},So={key:0},Vo={key:1},Lo={class:"ml-5"},To={class:"field flex justify-content-between align-items-end mt-4 mb-3"},Ao=i("label",null,"Pagamenti",-1),Po={key:1,class:"flex gap-3 mt-4"},jo=i("i",{class:"pi pi-comment mt-1"},null,-1);function Mo(o,t,n,e,y,g){const a=w("Badge"),m=w("Button"),x=w("InputNumber"),f=w("Column"),c=w("Dropdown"),h=w("DataTable"),C=w("ConfirmPopup");return u(),b("div",Zt,[i("div",Yt,[$t,i("div",null,[i("p",eo,k(n.order.user_name)+" "+k(n.order.user_surname||"-"),1),i("p",to,k(n.order.user_email),1),i("p",oo,k(n.order.user_phone),1),i("p",no,[F(k(n.order.country)+" ",1),n.order.user_zip?(u(),b("span",io," - "+k(n.order.user_zip),1)):V("",!0)])])]),i("div",lo,[ao,i("div",null,[i("p",so,k(e.selectedLocation),1),i("p",ro,k(n.order.course_name),1),n.order.date?(u(),b("p",co,k(e.formatPrettyDate(n.order.date))+" "+k(n.order.start_at),1)):V("",!0)])]),i("div",uo,[mo,i("div",null,[i("p",fo,k(n.order.reservation_number),1),i("p",_o,k(e.formatDataAndHourFromUnixTimestamps(n.order.created_at)),1),i("p",po,k(n.order.created_by),1),n.order.status?(u(),b("p",vo,[l(a,{value:e.prettyPaymentStatus(n.order.status),class:J([n.order.status,"px-3 border-round-lg"])},null,8,["value","class"])])):V("",!0),n.order.status=="payed"?(u(),b("p",ho,k(e.methodLabel),1)):V("",!0),n.order.open_tickets_used&&n.order.status=="payed"?(u(),b("p",yo,[(u(!0),b($,null,be(n.order.open_tickets_used,v=>(u(),b("span",{key:v},[l(a,{value:v.code,class:"mr-2 voucher"},null,8,["value"])]))),128))])):V("",!0),i("p",go,"Codice sconto utilizzato: "+k(e.localOrder.discount_code||"-"),1),i("p",bo,[F(" Totale ordine: "),e.localOrder.total?(u(),b("span",ko,"€ "+k((+e.localOrder.total).toFixed(2)),1)):(u(),b("span",wo,"-"))]),e.localOrder.multi_payment&&e.localOrder.paid_amount!="0.0"?(u(),b($,{key:3},[i("p",xo,[F(" Acconto versato: "),e.localOrder.paid_amount?(u(),b("span",Co,"€ "+k((+e.localOrder.paid_amount).toFixed(2)),1)):(u(),b("span",Do,"-"))]),i("p",Oo,[F(" Saldo rimanente: "),e.localOrder.remaining_amount?(u(),b("span",So,"€ "+k((+e.localOrder.remaining_amount).toFixed(2)),1)):(u(),b("span",Vo,"-"))])],64)):!e.localOrder.payments||e.localOrder.payments.length===0?(u(),W(m,{key:4,label:"Acconto / Saldo",icon:"pi pi-plus",rounded:"",outlined:"",onClick:t[0]||(t[0]=v=>e.addAmount()),class:"mt-2"})):V("",!0)])]),e.localOrder.payments&&e.localOrder.payments.length?(u(),b($,{key:0},[i("div",Lo,[i("div",To,[Ao,e.localOrder.remaining_amount!=="0.0"?(u(),W(m,{key:0,label:"Acconto / Saldo",icon:"pi pi-plus",rounded:"",outlined:"",onClick:t[1]||(t[1]=v=>e.addAmount())})):V("",!0)]),l(h,{value:e.localOrder.payments,dataKey:"id",size:"small",editingRows:e.editingRows,"onUpdate:editingRows":t[2]||(t[2]=v=>e.editingRows=v),editMode:"row",onRowEditSave:e.onRowEditSave,loading:e.loadingPayments},{default:D(()=>[l(f,{field:"amount",header:"Importo"},{editor:D(({data:v,field:s})=>[l(x,{modelValue:v[s],"onUpdate:modelValue":S=>v[s]=S,inputId:"currency-germany",mode:"currency",currency:"EUR",locale:"it-IT",class:"w-full"},null,8,["modelValue","onUpdate:modelValue"])]),body:D(v=>[F(k(v.data.amount?Number(v.data.amount).toFixed(2):"0.00")+" € ",1)]),_:1}),l(f,{field:"paid_at",header:"Data pagamento"},{body:D(v=>[F(k(v.data.paid_at),1)]),editor:D(({data:v,field:s})=>[F(k(v[s]),1)]),_:1}),l(f,{field:"payment_method",header:"Metodo"},{editor:D(({data:v,field:s})=>[l(c,{modelValue:v[s],"onUpdate:modelValue":S=>v[s]=S,options:e.paymentMethodAccountList,optionLabel:"label",optionValue:"id",class:"w-full",placeholder:"Seleziona metodo..."},null,8,["modelValue","onUpdate:modelValue","options"])]),body:D(v=>[F(k(e.prettyPaymentMethod(v.data.payment_method)),1)]),_:1}),l(f,{field:"typology",header:"Tipologia"},{editor:D(({data:v,field:s})=>[l(c,{modelValue:v[s],"onUpdate:modelValue":S=>v[s]=S,options:e.typologyOptions,optionLabel:"label",optionValue:"value",class:"w-full",placeholder:"Seleziona tipologia"},null,8,["modelValue","onUpdate:modelValue","options"])]),body:D(v=>[F(k(e.prettyTypology(v.data.typology)),1)]),_:1}),l(f,{rowEditor:!0,style:{width:"8rem"},bodyStyle:"text-align:right"}),l(f,{header:""},{body:D(v=>[v.data.id!=="-1"?(u(),W(m,{key:0,icon:"pi pi-trash",class:"p-button-text p-button-sm p-button-danger",onClick:s=>e.confirm1(v.data,s)},null,8,["onClick"])):V("",!0)]),_:1})]),_:1},8,["value","editingRows","onRowEditSave","loading"])]),l(C)],64)):V("",!0),n.order.notes?(u(),b("div",Po,[jo,i("div",null,k(n.order.notes),1)])):V("",!0)])}const Fo=Q(Xt,[["render",Mo]]),Eo={props:["order","location_permalink"],setup(o,t){Z(()=>{o.order&&o.order.notes&&(n.value=o.order.notes)});const n=O(),{showLoader:e,hideLoader:y}=ve(),g=ee(),a=ne(),m=A(()=>a.getCurrentOrder);return{notes:n,updateOrder:async function(){const f={id:o.location_permalink,order_id:o.order.id,notes:n.value,api_version:"v2"};e(),await a.updateOrder(f).then(()=>{y(),te(g,{message:"Nota aggiornata correttamente",error:!1}),t.emit("closeDialog",m.value)}).catch(c=>{y(),N(g,c)})}}}},Ro={class:"pt-5 px-2"},Uo={class:"flex align-items-center justify-content-end mt-3"};function No(o,t,n,e,y,g){const a=w("Textarea"),m=w("Button");return u(),b("div",Ro,[l(a,{modelValue:e.notes,"onUpdate:modelValue":t[0]||(t[0]=x=>e.notes=x),rows:"8",cols:"30",class:"w-full"},null,8,["modelValue"]),i("div",Uo,[l(m,{label:"Annulla",text:"",onClick:t[1]||(t[1]=x=>o.$emit("closeDialog",null))}),l(m,{label:"Conferma",onClick:t[2]||(t[2]=x=>e.updateOrder())})])])}const Io=Q(Eo,[["render",No]]),Bo={props:["filters"],setup(o,t){Z(()=>{d.value=!0,r.value={first:0,rows:v.value.rows,sortField:null,sortOrder:null},r.value.page=0,o.filters.location&&z()});const n=ne(),e=Te(),y=A(()=>n.responseOrders),g=A(()=>n.status),a=yt(),m=A(()=>a.submitDialog),x=A(()=>n.paymentStatus),f=A(()=>n.getDeleteResponse),{showLoader:c,hideLoader:h}=ve(),C=ee(),v=O(),s=O(),S=O(),I=O(),P=O(),d=O(!0),r=O(),_=O(0),M=O([]),E=O([]),G=O(!1),ce=O(!1),T=O(),B=O(!1);function z(){d.value=!0;let p=new Map;for(const L in o.filters)L=="date"?ke(o.filters.date)=="Invalid DateTime"?p.set("date",Be(o.filters.date)):p.set("date",ke(o.filters.date)):o.filters.location&&p.set("location_permalink",o.filters.location.permalink),L=="course"&&o.filters.course.id!="-1"&&p.set("course",o.filters.course.id),L=="hour"&&o.filters.hour!="Tutti gli orari"&&p.set("hour",o.filters.hour),L=="name"&&p.set("name",o.filters.name);setTimeout(()=>{de(p)},Math.random()*1e3+250)}const de=async function(p){await n.fetchAllOrders(p).then(()=>{d.value=!1}).catch(L=>{d.value=!1,N(C,L)})},ue=p=>{S.value.toggle(p),T.value.toggle(p)},le=(p,L)=>p>p+L?"red":"green",R=function(p,L){L&&(S.value.note=L,S.value.toggle(p))},U=function(p){p.order&&y.value.time_slots&&y.value.time_slots.forEach((L,j)=>{L.orders.forEach((H,K)=>{H.id==p.order.id&&(y.value.time_slots[j].orders[K]=p.order,p.check_in_done!=null&&(y.value.time_slots[j].check_in_done+=p.check_in_done))})})},q=async function(p,L){let j=[],H=!1;E.value.forEach(Y=>{if(Y.id==p.id){H=!0;return}});for(let Y of p.tickets)j.push(Y.order_item_id);const K={check_in:L,order_item_ids:j,location_permalink:o.filters.location};await n.checkInOrder(K).then(()=>{U(f.value),te(C,{message:"Check-in registrato correttamente",error:!1}),H&&ye(E.value,f.value.order)}).catch(Y=>{N(C,Y)})},ie=async function(p,L){let j=[],H=!1;E.value.forEach(Y=>{if(Y.id==p.id){H=!0;return}});for(let Y of p.tickets)j.push(Y.order_item_id);const K={order_item_ids:j,no_show:L,location_permalink:o.filters.location.permalink};await n.noShowOrder(K).then(()=>{U(f.value),te(C,{message:"No-show registrato correttamente",error:!1}),H&&ye(E.value,f.value.order)}).catch(Y=>{N(C,Y)})},he=async function(p,L,j){const H={id:p,check_in:L,location_permalink:o.filters.location.permalink};await n.checkInTicket(H).then(()=>{te(C,{message:"Check-in registrato correttamente",error:!1}),U(f.value),ye(E.value,f.value.order)}).catch(K=>{N(C,K)})},Je=async function(p,L,j){const H={id:p,no_show:L,location_permalink:o.filters.location.permalink};await n.noShowTicket(H).then(()=>{te(C,{message:"No-show registrato correttamente",error:!1}),U(f.value),ye(E.value,f.value.order)}).catch(K=>{N(C,K)})},ye=function(p,L){let j=Ge(E.value,f.value.order.id);j!=-1&&E.value.splice(j,1),E.value.push(f.value.order)},Ge=function(p,L){for(let j=0;j<p.length;j++)if(p[j].id===L)return j;return-1},We=function(p){const L={course_name:p.course_name,start_at:p.start_at,date:o.filters.date,hour:p.start_at,max_seats:p.is_free_slot?null:p.remaing_seats+""};t.emit("updateFilters",L)},Qe=function(p){G.value=!0,I.value=p},Xe=function(p){U({order:p}),G.value=!1,B.value=!1},Ze=function(p){return p!=null&&p.created_by&&(p==null?void 0:p.created_by)=="WEB"?"WEB":"KALATA"},Ye=function(p,L){let j=0;if(p&&p.tickets){p.tickets.forEach(K=>{L?K.no_show&&(j+=1):K.check_in&&(j+=1)});let H=p.tickets.length;if(j!=H&&j!=0)return j+"/"+H}},$e=function(p,L){T.value.data=L,T.value.toggle(p)},et=function(p,L){P.value=L.id;let j="Sei sicuro di voler eliminare questa prenotazione?";j+='<br><br> <i>N.B. Eventuali voucher presenti nella prenotazione vanno liberati manualmente dalla sezione "Data aperta"</i>',a.setDialog("Elimina prenotazione","Elimina","Annulla",j),a.setBtnSubmit(!1),a.setDynamicDialogVisibility(!0)},tt=function(){if(c(),P.value){const p={id:P.value,location_permalink:o.filters.location.permalink};n.deleteOrder(p).then(()=>{h(),te(C,{message:"La prenotazione è stata eliminata correttamente",error:!1}),y.value.time_slots&&y.value.time_slots.forEach((L,j)=>{L.orders.forEach((H,K)=>{H.id==P.value&&(y.value.time_slots[j].orders.splice(K,1),f.value,y.value.time_slots[j].check_in_done+=f.value.check_in_done,y.value.time_slots[j].confirmed_seats+=f.value.confirmed_seats,y.value.time_slots[j].remaing_seats-=f.value.confirmed_seats)})})}).catch(L=>{h(),N(C,L)})}},ot=function(p){M.value=p.data?[p.data]:[]},nt=function(p){E.value=p.data?[p.data]:[]},it=function(p){ce.value=!0,s.value=p},lt=function(p){B.value=!0,s.value=p},at=function(p){const L=new Map;L.set("id",p.id),L.set("location_permalink",o.filters.location.permalink),c(),n.downloadTicket(L).then(()=>{h()}).catch(j=>{h(),N(C,j)})},st=function(p,L){c(),we(p,L.location.permalink).then(()=>{h()}).catch(()=>{h()})},rt=function(p,L){c(),Ve(p,L.location.permalink).then(()=>{h()}).catch(()=>{h()})},ct=async()=>{await z(),s.value&&s.value.id&&(await n.fetchOrderDetail(s.value.id),s.value={...n.getCurrentOrder})};return oe(m,p=>{p&&tt()}),oe(o.filters,()=>{o.filters.location&&z()}),{dt:v,responseOrders:y,loading:d,totalRecords:_,lazyParams:r,currentOrder:s,status:g,expandedRows:M,expandedRows1:E,op:S,dialogStore:e,paymentList:x,visibleDialog:G,currentTimeSlot:I,visibleMenu:T,visibleDetailDialog:ce,visibleNotesDialog:B,toast:C,loadLazyData:z,toggle:ue,getProgressClass:le,showNotes:R,checkAll:q,noShowAll:ie,openDialog:We,checkInSingleTicket:he,noShowSingleTicket:Je,prettyPaymentStatus:ze,openPaymentStatusDialog:Qe,onClosePaymentStatusDialog:Xe,getRowClass:Ze,printPDF:Ve,showLabelCheckbox:Ye,confirmDeleteOrder:et,showMenu:$e,openOrderDetailDialog:it,openNotesDialog:lt,downloadPDF:at,handleRowToggle:ot,handleRowToggle1:nt,openPDFTab:st,openPDFTicketTab:rt,onRefreshOrder:ct,formatDataFromUnixTimestamps:Ct,printOrderPDF:we}},components:{PaymentStatusDialog:It,OrderDetailDialog:Fo,NotesDialog:Io}};const zo={class:"order-table"},qo={class:""},Ho={style:{width:"15rem"}},Ko={class:"m-0 text-right",style:{"font-size":"12px"}},Jo={key:0,class:"pi pi-exclamation-triangle cursor-pointer",style:{color:"var(--orange-400)"}},Go={style:{width:"15rem"}},Wo={class:"m-0 text-right",style:{"font-size":"12px"}},Qo={key:0},Xo={key:0},Zo=i("div",{class:"flex justify-content-center w-full"},"Check-in",-1),Yo={class:"flex justify-content-center"},$o={class:"flex flex-column",style:{"margin-top":"8px"}},en={class:"text-sm",style:{"min-height":"15px"}},tn=i("div",{class:"flex justify-content-center w-full"},"No-show",-1),on={class:"flex justify-content-center"},nn={class:"flex flex-column",style:{"margin-top":"8px"}},ln={class:"text-sm",style:{"min-height":"15px"}},an=["onClick"],sn={style:{"max-width":"50rem"},class:"p-3"},rn={class:"overlay-menu"},cn=["onClick"],dn=i("i",{class:"pi pi-eye mr-3"},null,-1),un=["onClick"],mn=i("i",{class:"pi pi-shopping-cart mr-3"},null,-1),fn=["onClick"],_n=i("i",{class:"pi pi-print mr-3"},null,-1),pn=["onClick"],vn=i("i",{class:"pi pi-download mr-3"},null,-1),hn=["onClick"],yn=i("i",{class:"pi pi-comment mr-3"},null,-1),gn=["disabled","onClick"],bn=i("i",{class:"pi pi-pencil mr-3"},null,-1),kn=["disabled","onClick"],wn=i("i",{class:"pi pi-trash mr-3"},null,-1),xn={key:0},Cn={key:1},Dn=i("div",{class:"flex justify-content-center w-full"},"Check-in",-1),On={class:"flex justify-content-center"},Sn=i("div",{class:"flex justify-content-center w-full"},"No-show",-1),Vn={class:"flex justify-content-center"},Ln=i("div",{class:"flex justify-content-center w-full"},null,-1),Tn={class:"flex justify-content-center"},An={key:0,class:"flex mx-4"},Pn=i("div",null,[i("div",{class:"p-0 m-0 flex align-items-center"},[i("p",{style:{width:"2rem",height:"5px"},class:"mr-2 web my-0"}),i("span",{class:"text-sm"},"WEB")]),i("div",{class:"p-0 m-0 flex align-items-center justify-content-between"},[i("p",{style:{width:"2rem",height:"5px"},class:"mr-2 kalata"}),i("span",{class:"text-sm"},"SUPERGA")])],-1),jn=[Pn];function Mn(o,t,n,e,y,g){const a=w("Column"),m=w("ProgressBar"),x=w("Button"),f=w("Badge"),c=w("Checkbox"),h=w("OverlayPanel"),C=w("DataTable"),v=w("PaymentStatusDialog"),s=w("Dialog"),S=w("OrderDetailDialog"),I=w("NotesDialog"),P=Ce("tooltip");return u(),b("div",zo,[l(C,{value:e.responseOrders.time_slots,totalRecords:e.responseOrders.total,lazy:!0,paginator:!1,ref:"dt",loading:e.loading,stripedRows:"",expandedRows:e.expandedRows,"onUpdate:expandedRows":t[1]||(t[1]=d=>e.expandedRows=d),onRowExpand:e.handleRowToggle},{empty:D(()=>[F(" Nessuna prenotazione trovata. ")]),expansion:D(d=>[l(C,{value:d.data.orders,class:"m-4 mx-4 table-order-detail",expandedRows:e.expandedRows1,"onUpdate:expandedRows":t[0]||(t[0]=r=>e.expandedRows1=r),rowClass:e.getRowClass,onRowExpand:e.handleRowToggle1},{empty:D(()=>[F(" Nessuna prenotazione trovata. ")]),expansion:D(r=>[l(C,{value:r.data.tickets,class:"m-4 mx-5"},{default:D(()=>[l(a,{header:"Codice biglietto",field:"code"}),l(a,{header:"Tipo biglietto",field:"type"},{body:D(({data:_})=>[l(f,{value:_.ticket_name,class:J([_.ticket_name,"px-3 border-round-lg"])},null,8,["value","class"])]),_:1}),l(a,{header:"Prezzo"},{body:D(({data:_})=>[_.ticket_price?(u(),b("span",xn," € "+k((+_.ticket_price).toFixed(2)),1)):(u(),b("span",Cn,"-"))]),_:1}),l(a,null,{header:D(()=>[Dn]),body:D(({data:_})=>[i("div",On,[l(c,{modelValue:_.check_in,"onUpdate:modelValue":M=>_.check_in=M,binary:!0,onChange:M=>e.checkInSingleTicket(_.id,_.check_in,r.data),class:"check_in"},null,8,["modelValue","onUpdate:modelValue","onChange"])])]),_:2},1024),l(a,null,{header:D(()=>[Sn]),body:D(({data:_})=>[i("div",Vn,[l(c,{modelValue:_.no_show,"onUpdate:modelValue":M=>_.no_show=M,binary:!0,onChange:M=>e.noShowSingleTicket(_.id,_.no_show,r.data),class:"no_show"},null,8,["modelValue","onUpdate:modelValue","onChange"])])]),_:2},1024),l(a,{field:"tickets_url"},{header:D(()=>[Ln]),body:D(({data:_})=>[i("div",Tn,[me(l(x,{link:"",icon:"pi pi-print",href:_.tickets_url,target:"_blank",style:{color:"var(--surface-400)"},text:"",rounded:"",onClick:M=>e.openPDFTicketTab(_.id,n.filters)},null,8,["href","onClick"]),[[P,"Stampa",void 0,{top:!0}]])])]),_:1})]),_:2},1032,["value"])]),default:D(()=>[l(a,{header:"Codice",field:"reservation_number"}),l(a,{header:"Acquirente"},{body:D(({data:r})=>[F(k(r.user_name)+" "+k(r.user_surname)+" ",1),!r.user_name&&!r.user_surname?(u(),b("span",Qo,"-")):V("",!0)]),_:1}),l(a,{header:"Pagamento"},{body:D(({data:r})=>[r.status?(u(),b("span",Xo,[l(f,{value:e.prettyPaymentStatus(r.status),class:J([r.status,"px-3 border-round-lg"])},null,8,["value","class"])])):V("",!0)]),_:1}),l(a,{header:"Q.ta",field:"tickets_number"}),l(a,null,{header:D(()=>[Zo]),body:D(({data:r})=>[i("div",Yo,[i("div",$o,[l(c,{modelValue:r.check_in,"onUpdate:modelValue":_=>r.check_in=_,binary:!0,onChange:_=>e.checkAll(r,r.check_in),class:"check_in"},null,8,["modelValue","onUpdate:modelValue","onChange"]),i("span",en,k(e.showLabelCheckbox(r,!1)),1)])])]),_:1}),l(a,null,{header:D(()=>[tn]),body:D(({data:r})=>[i("div",on,[i("div",nn,[l(c,{modelValue:r.no_show,"onUpdate:modelValue":_=>r.no_show=_,binary:!0,onChange:_=>e.noShowAll(r,r.no_show),class:"no_show"},null,8,["modelValue","onUpdate:modelValue","onChange"]),i("span",ln,k(e.showLabelCheckbox(r,!0)),1)])])]),_:1}),l(a,{header:"Note"},{body:D(({data:r})=>[i("div",{class:"notes cursor-pointer",onClick:_=>e.showNotes(_,r.notes)},k(r.notes||"-"),9,an),l(h,{ref:"op"},{default:D(()=>[i("div",sn,k(e.op.note),1)]),_:1},512)]),_:1}),l(a,{header:"",style:{"padding-right":"0",width:"6rem"}},{body:D(({data:r})=>[l(x,{type:"button","aria-haspopup":"true","aria-controls":"overlay_menu",icon:"pi pi-ellipsis-v",text:"",rounded:"",onClick:_=>e.showMenu(_,r)},null,8,["onClick"]),l(h,{ref:"visibleMenu"},{default:D(()=>[i("ul",rn,[i("li",{onClick:_=>e.openOrderDetailDialog(e.visibleMenu.data)},[dn,F("Dettaglio ordine ")],8,cn),i("li",{onClick:_=>e.openOrderDetailDialog(e.visibleMenu.data)},[mn,F("Dettaglio pagamento ")],8,un),i("li",{onClick:_=>e.openPDFTab(e.visibleMenu.data,n.filters)},[_n,F("Stampa ")],8,fn),i("li",{onClick:_=>e.downloadPDF(e.visibleMenu.data)},[vn,F("Scarica PDF ")],8,pn),i("li",{onClick:_=>e.openNotesDialog(e.visibleMenu.data)},[yn,F("Modifica nota ")],8,hn),i("li",{disabled:!e.visibleMenu.data.can_change_status,onClick:_=>e.openPaymentStatusDialog(e.visibleMenu.data)},[bn,F("Cambia stato ")],8,gn),i("li",{disabled:!e.visibleMenu.data.can_cancel,onClick:_=>e.confirmDeleteOrder(_,e.visibleMenu.data)},[wn,F("Elimina ")],8,kn)])]),_:2},1536)]),_:1}),l(a,{expander:"",class:"pl-0 ml-0"})]),_:2},1032,["value","expandedRows","rowClass","onRowExpand"]),d.data.orders&&d.data.orders.length>0?(u(),b("div",An,jn)):V("",!0)]),default:D(()=>[l(a,{header:"Percorso",field:"course_name",filterMatchMode:"contains",ref:"course_name"},null,512),l(a,{header:"Orario",field:"start_at",filterMatchMode:"contains",ref:"start_at"},{body:D(({data:d})=>[i("div",qo,[i("span",{class:J(d.is_free_slot?"free":"")},k(d.start_at),3)])]),_:1},512),l(a,{header:"Posti prenotati",ref:"availabe_tickets",field:"availabe_tickets"},{body:D(({data:d})=>[i("div",Ho,[i("p",Ko,[F(k(d.confirmed_seats)+"/"+k(d.remaing_seats+d.confirmed_seats)+" ",1),d.confirmed_seats>d.remaing_seats+d.confirmed_seats?me((u(),b("i",Jo,null,512)),[[P,d.confirmed_seats-(d.remaing_seats+d.confirmed_seats)+" posti in overbooking",void 0,{top:!0}]]):V("",!0)]),l(m,{value:d.confirmed_seats*100/(d.remaing_seats+d.confirmed_seats),showValue:!1,style:{height:"10px"},class:J(["available-progress",e.getProgressClass(d.confirmed_seats,d.remaing_seats)])},null,8,["value","class"])])]),_:1},512),l(a,{header:"Check-in",ref:"confirmed_tickets",field:"confirmed_tickets"},{body:D(({data:d})=>[i("div",Go,[i("p",Wo,k(d.check_in_done)+"/"+k(d.confirmed_seats),1),l(m,{value:d.check_in_done*100/(d.remaing_seats+d.confirmed_seats),showValue:!1,style:{height:"10px"},class:"check-in-progress"},null,8,["value"])])]),_:1},512),l(a,null,{body:D(({data:d})=>[me(l(x,{type:"button","aria-haspopup":"true","aria-controls":"overlay_menu",class:"mr-0 text-primary",icon:"pi pi-calendar",text:"",rounded:"",onClick:r=>e.openDialog(d)},null,8,["onClick"]),[[P,"Prenota",void 0,{top:!0}]])]),_:1}),l(a,{expander:"",style:{width:"5rem"}})]),_:1},8,["value","totalRecords","loading","expandedRows","onRowExpand"]),l(s,{visible:e.visibleDialog,"onUpdate:visible":t[3]||(t[3]=d=>e.visibleDialog=d),modal:"",header:"Stato pagamento",style:{width:"35rem"}},{default:D(()=>[l(v,{location_permalink:n.filters.location.permalink,time_slot:e.currentTimeSlot,onCloseDialog:t[2]||(t[2]=d=>e.onClosePaymentStatusDialog(d))},null,8,["location_permalink","time_slot"])]),_:1},8,["visible"]),l(s,{visible:e.visibleDetailDialog,"onUpdate:visible":t[4]||(t[4]=d=>e.visibleDetailDialog=d),modal:"",header:"Dettaglio ordine",style:{width:"70rem"},onAfterHide:e.loadLazyData},{default:D(()=>[l(S,{order:e.currentOrder},null,8,["order"])]),_:1},8,["visible","onAfterHide"]),l(s,{visible:e.visibleNotesDialog,"onUpdate:visible":t[6]||(t[6]=d=>e.visibleNotesDialog=d),modal:"",header:"Modifica nota",style:{width:"35rem"}},{default:D(()=>[l(I,{order:e.currentOrder,location_permalink:n.filters.location.permalink,onCloseDialog:t[5]||(t[5]=d=>e.onClosePaymentStatusDialog(d))},null,8,["order","location_permalink"])]),_:1},8,["visible"])])}const Fn=Q(Bo,[["render",Mn]]),En={props:["filters"],setup(o,t){Z(()=>{C(),n.value=o.filters,n.value.date=new Date,S()});const n=O({}),e=pe(),y=ne(),g=ee(),a=O([]),m=O(),x=re.now().plus({years:1}),f=A(()=>e.allLocations),c=A(()=>y.getCalendar),h=async function(d){await y.fetchCalendar(d).then(()=>{}).catch(r=>{N(g,r)})},C=async function(){await e.fetchAllLocations().then(()=>{}).catch(d=>{N(g,d)})},v=function(){if(o.filters.location){const d=f.value.find(r=>r.permalink===o.filters.location);a.value=d.courses}},s=function(d){let r={};r.month=re.fromJSDate(new Date(d)).month,r.year=re.fromJSDate(new Date(d)).year,r.location_permalink=o.filters.location.permalink?o.filters.location.permalink:o.filters.location,m.value={month:r.month,year:r.year},h(r)},S=function(){let d=re.now(),r={location_permalink:"",month:"",year:""};r.location_permalink=o.filters.location.permalink?o.filters.location.permalink:o.filters.location,r.month=d.month+"",r.year=d.year+"",h(r)},I=function(d){if(c.value.web_dates&&c.value.web_dates.length!=0){let r=d.month+1;r=r<10?"0"+r:r;let _=d.day<10?"0"+d.day:d.day,M=d.year+"-"+r+"-"+_;return c.value.web_dates.find(E=>E==M)}},P=function(d){let r={location_permalink:o.filters.location.permalink?o.filters.location.permalink:o.filters.location,month:d.month,year:d.year};h(r)};return oe(o.filters,()=>{if(m.value){let d={location_permalink:o.filters.location.permalink?o.filters.location.permalink:o.filters.location,month:m.value.month,year:m.value.year};h(d)}else S()}),{form:n,courses:a,maxAllowedDate:x,locations:f,calendar:c,getCourses:v,onDateChange:s,getDayFromDate:I,onMonthChange:P}}};const Rn={class:"flex calendar-filter"},Un={key:0,class:"special-day"};function Nn(o,t,n,e,y,g){const a=w("Calendar");return u(),b("div",Rn,[l(a,{modelValue:e.form.date,"onUpdate:modelValue":t[0]||(t[0]=m=>e.form.date=m),inline:"",onDateSelect:t[1]||(t[1]=m=>e.onDateChange(m)),onMonthChange:t[2]||(t[2]=m=>e.onMonthChange(m)),maxDate:e.maxAllowedDate.toJSDate()},{date:D(m=>[e.getDayFromDate(m.date)?(u(),b("div",Un,[i("span",null,k(m.date.day),1)])):(u(),b($,{key:1},[F(k(m.date.day),1)],64))]),_:1},8,["modelValue","maxDate"])])}const In=Q(En,[["render",Nn]]);class Bn{static async fetchAll(t){const n=t.location_permalink;return delete t.location_permalink,(await Se(`/ticket_office/${n}/search/courses`,t)).data}}const Ke=xe({id:"course",state:()=>({course:{},courses:[],response_courses:{}}),getters:{allCourses:o=>o.response_courses.tickets,responseCourses:o=>o.response_courses,getTotalCourses:o=>o.response_courses?o.response_courses.total:0,getCurrentCourse:o=>o.course},actions:{async fetchAllCourses(o){await Bn.fetchAll(o).then(t=>this.response_courses=t)}}}),zn={props:["filters"],setup(o,t){Z(()=>{n.value=Object.assign({},o.filters),n.value.date=re.now().toFormat("dd/MM/yyyy"),a.value=qe(8,20),a.value.unshift("Tutti gli orari"),n.value.hour="Tutti gli orari"});const n=O({}),e=O([]),y=pe(),g=ee(),a=O([]),m=ne(),x=Ke(),f=A(()=>y.allLocations),c=A(()=>m.responseOrders),h=A(()=>x.allCourses),C=function(){n.value.name=null,n.value.course=e.value[0].name,n.value.hour=a.value[0],t.emit("onSubmit",n.value)},v=async function(){const s={location_permalink:n.value.location.permalink,api_version:"v2"};await x.fetchAllCourses(s).then(()=>{}).catch(S=>{N(g,S)})};return oe(f,()=>{o.filters.location&&f.value&&(n.value=Object.assign({},o.filters),n.value.hour||(n.value.hour="Tutti gli orari"),v())}),oe(o.filters,()=>{o.filters.location&&f.value&&n.value.location&&n.value.location!=o.filters.location&&(n.value=Object.assign({},o.filters),n.value.hour||(n.value.hour="Tutti gli orari"))}),oe(h,()=>{var s;e.value=Object.assign([],h.value),e.value&&((s=e.value[0])==null?void 0:s.id)!="-1"&&e.value.unshift({id:"-1",name:"Tutti i percorsi"}),n.value.course=e.value[0].name}),{form:n,courses:e,hours:a,locations:f,responseOrders:c,resetField:C}}},qn={class:"formgrid grid px-0 align-items-center"},Hn={key:0,class:"field col-4 flex flex-column"},Kn=i("label",{for:"typology"},"Filtra per percorso",-1),Jn={key:1,class:"field col-3 flex flex-column"},Gn=i("label",{for:"typology"},"Filtra per orario (dalle)",-1),Wn=i("div",{class:"col-12"},null,-1),Qn={class:"field col-4 flex flex-column"},Xn=i("label",{for:"typology"},"Filtra per acquirente",-1),Zn={class:"flex col-12 justify-content-end pt-1"};function Yn(o,t,n,e,y,g){const a=w("Dropdown"),m=w("InputText"),x=w("Button"),f=w("AccordionTab"),c=w("Accordion");return u(),W(c,{activeIndex:0},{default:D(()=>[l(f,{header:"FILTRI"},{default:D(()=>[i("div",qn,[e.form.location&&e.courses?(u(),b("div",Hn,[Kn,l(a,{modelValue:e.form.course,"onUpdate:modelValue":t[0]||(t[0]=h=>e.form.course=h),options:e.courses,optionLabel:"name",optionValue:"name",placeholder:""},null,8,["modelValue","options"])])):V("",!0),e.responseOrders?(u(),b("div",Jn,[Gn,l(a,{modelValue:e.form.hour,"onUpdate:modelValue":t[1]||(t[1]=h=>e.form.hour=h),options:e.hours,placeholder:""},null,8,["modelValue","options"])])):V("",!0),Wn,i("div",Qn,[Xn,l(m,{modelValue:e.form.name,"onUpdate:modelValue":t[2]||(t[2]=h=>e.form.name=h),placeholder:""},null,8,["modelValue"])])]),i("div",Zn,[l(x,{label:"Ricerca",class:"mr-2",onClick:t[3]||(t[3]=h=>o.$emit("onSubmit",e.form))}),l(x,{label:"Annulla",class:"p-button-outlined",onClick:t[4]||(t[4]=h=>e.resetField())})])]),_:1})]),_:1})}const $n=Q(zn,[["render",Yn]]),ei={props:["form","price","index","ticket"],setup(o,t){const n=O(0),e=function(){n.value++,g()},y=function(){n.value>0&&n.value--,g()},g=function(){n.value==null&&(n.value=0);const a={counter:n.value,price:o.price,index:o.index,ticket:o.ticket};t.emit("changeCounter",a)};return{counter:n,decrement:y,increment:e,emitEvent:g}}};const ti={class:"btn-plus-min flex align-items-center"},oi={class:"counter"};function ni(o,t,n,e,y,g){const a=w("Button"),m=w("InputNumber");return u(),b("div",ti,[l(a,{icon:"pi pi-minus",rounded:"",outlined:"",severity:"secondary",onClick:e.decrement,disabled:e.counter===0},null,8,["onClick","disabled"]),i("div",oi,[l(m,{modelValue:e.counter,"onUpdate:modelValue":[t[0]||(t[0]=x=>e.counter=x),t[1]||(t[1]=x=>e.emitEvent())],min:0},null,8,["modelValue"])]),l(a,{icon:"pi pi-plus",rounded:"",outlined:"",severity:"secondary",onClick:e.increment},null,8,["onClick"])])}const ii=Q(ei,[["render",ni]]),li={props:["tickets","form"],setup(o,t){Z(()=>{y.value=!1,a.discount={},g.value=null,o.form.max_seats&&o.form.max_seats<0?(f.value=!0,c.value=-o.form.max_seats):f.value=!1});const n=O(0),e=O([]),y=O(!1),g=O(),a=ne(),m=ee(),x=O(!1),f=O(!1),c=O(),h=A(()=>a.getDiscount),C=function(P){e.value[P.index]={partial_total:P.price*P.counter,ticket:P.ticket,quantity:P.counter},n.value=0;let d=0;e.value.forEach(r=>{n.value+=r.partial_total,d+=r.quantity}),f.value||(o.form.max_seats&&d>+o.form.max_seats?(c.value=d-+o.form.max_seats,x.value=!0):(c.value=null,x.value=!1)),g.value&&s()},v=function(){s()},s=async function(){let P=[];e.value.forEach(r=>{P.push({id:r.ticket.id,quantity:r.quantity})});const d={discount_code:g.value,location_permalink:o.form.location_permalink,tickets:P};await a.cost(d).then(()=>{}).catch(r=>{N(m,r)})};return{total:n,partialTotals:e,showDiscount:y,discountCode:g,discount:h,showAlert:x,showAlert2:f,numOverbooking:c,onChangeCounter:C,applyDiscount:v,checkDisabled:function(){let P=!1;(!e.value||e.value.length==0)&&(P=!0);let d=0;return e.value.forEach(r=>{d+=r.quantity}),d==0&&(P=!0),t.emit("disableSecondoTab",!0),P},nextTab:function(){const P={discount_code:g.value,partial_total:e.value};t.emit("nextTab",P)}}},components:{PlusMinusButton:ii}};const ai={key:0},si={key:1},ri={key:0},ci={key:1},di={key:0,class:"flex justify-content-between align-items-center"},ui={class:"flex align-items-center col-9"},mi={class:"col-7 pl-0"},fi={class:"text-right col-2"},_i={class:"col-3 flex justify-content-end"},pi={key:2,class:"mt-3 mb-5"},vi=i("i",null,"Nessuna tipologia di biglietto trovata.",-1),hi=[vi],yi=i("hr",{class:"mt-3"},null,-1),gi={class:"flex align-items-center justify-content-between py-0"},bi={class:"col-9 flex"},ki=i("b",null,"Totale",-1),wi=[ki],xi={class:"col-2 text-right font-bold"},Ci={class:"col-3 flex justify-content-end"};function Di(o,t,n,e,y,g){const a=w("Message"),m=w("PlusMinusButton"),x=w("Button");return u(),b($,null,[e.showAlert?(u(),W(a,{key:0,severity:"warn",closable:!1},{default:D(()=>[F("Attenzione! Si sta andando in overbooking di "+k(e.numOverbooking)+" ",1),e.numOverbooking==1?(u(),b("span",ai,"posto")):(u(),b("span",si,"posti"))]),_:1})):V("",!0),e.showAlert2?(u(),W(a,{key:1,severity:"warn",closable:!1},{default:D(()=>[F("Attenzione! Lo slot orario è già in overbooking di "+k(e.numOverbooking)+" ",1),e.numOverbooking==1?(u(),b("span",ri,"posto")):(u(),b("span",ci,"posti"))]),_:1})):V("",!0),(u(!0),b($,null,be(n.tickets,(f,c)=>{var h,C,v;return u(),b("div",{key:f.id},[((h=f.course)==null?void 0:h.id)==((C=n.form.course)==null?void 0:C.id)?(u(),b("div",di,[i("div",ui,[i("b",mi,k(f.name),1),i("div",fi,"€ "+k((v=f.price)==null?void 0:v.toFixed(2)),1)]),i("div",_i,[l(m,{onChangeCounter:t[0]||(t[0]=s=>e.onChangeCounter(s)),price:f.price,index:c,ticket:f},null,8,["price","index","ticket"])])])):V("",!0)])}),128)),n.tickets&&n.tickets.length==0?(u(),b("div",pi,hi)):V("",!0),yi,i("div",gi,[i("div",bi,[i("div",{class:J(["pl-0",e.discount&&e.discount.total_amount?"col-2":"col-7"])},wi,2),i("div",xi,"€ "+k(e.total.toFixed(2)),1)]),i("div",Ci,[l(x,{label:"Prosegui",onClick:t[1]||(t[1]=f=>e.nextTab()),disabled:e.checkDisabled()},null,8,["disabled"])])])],64)}const Oi=Q(li,[["render",Di]]);class Si{static async fetchAll(){return(await Ne("/countries")).data.countries}}const Vi=xe({id:"country",state:()=>({country:{},countries:[]}),getters:{allCountries:o=>o.countries},actions:{async fetchAllCountries(){await Si.fetchAll().then(o=>this.countries=o)}}});class Li{static async fetchAll(){return(await Ne("/provinces")).data.provinces}}const Ti=xe({id:"province",state:()=>({province:{},provinces:[]}),getters:{allProvinces:o=>o.provinces,getCurrentProvince:o=>o.province},actions:{async fetchAllProvinces(){await Li.fetchAll().then(o=>this.provinces=o)}}}),Ai={computed:{Code(){return Code}},props:["location_permalink"],setup(o,t){Z(()=>{I(),P()});const n=De(),e=Vi(),y=ne(),g=Ti(),a=O({}),m=O(),x=O(),f=A(()=>e.allCountries),c=A(()=>n.allOpenTickets),h=A(()=>y.paymentStatus),C=A(()=>y.paymentModeList),v=A(()=>g.allProvinces),s=A(()=>{const M=y.getPaymentMethods;return Object.entries(M).map(([E,G])=>({id:E,label:G}))}),S=A(()=>y.paymentMethodAccountList),I=async function(){await e.fetchAllCountries().then(()=>{a.value.country_id=88,a.value.status={id:"payed",name:"Pagato"}})},P=async function(){await g.fetchAllProvinces()},d=async function(M){const E={code:M.query.toUpperCase(),location_permalink:o.location_permalink};await n.fetchAllOpenTickets(E)},r=function(){a.value.status.id&&(a.value.status.id=="free"||a.value.status.id=="to_pay")&&(a.value.payment_method=null)},_=function(){if(a.value.status&&a.value.status.id=="payed"){if(!a.value.payment_method){m.value="Seleziona un metodo di pagamento";return}if(a.value.open_ticket_codes){for(const M of a.value.open_ticket_codes)if(M.expired){x.value="Uno o più codici biglietto risultano scaduti";return}}}t.emit("nextTab",a.value)};return oe(()=>a.value.multi_payment,M=>{M&&(a.value.status={id:"to_pay",name:"Da pagare"})}),{form:a,countries:f,paymentList:h,paymentModeList:C,errorMessage:m,errorMessageVoucher:x,open_tickets:c,provinces:v,dynamicPaymentMethods:s,paymentMethodAccountList:S,fetchAllOpenTickets:d,onChangeStatus:r,onConfirm:_}}};const X=o=>(gt("data-v-8e12661c"),o=o(),bt(),o),Pi={key:0,class:"formgrid grid"},ji={class:"field col-6"},Mi=X(()=>i("label",{for:"user_name"},"Nome",-1)),Fi={class:"field col-6"},Ei=X(()=>i("label",{for:"user_surname"},"Cognome",-1)),Ri={class:"field col-6"},Ui=X(()=>i("label",{for:"user_email"},"Email",-1)),Ni={class:"field col-6"},Ii=X(()=>i("label",{for:"user_phone"},"Telefono",-1)),Bi={class:"field col-6"},zi=X(()=>i("label",{for:"country_id"},"Nazione",-1)),qi={class:"field col-6"},Hi=X(()=>i("label",{for:"province"},"Provincia",-1)),Ki={class:"field col-6"},Ji=X(()=>i("label",{for:"status"},"Stato pagamento",-1)),Gi={key:0,class:"field col-6"},Wi={for:"payment_method"},Qi={key:0},Xi={class:"p-float-label mb-0"},Zi={class:"p-error",id:"dd-error"},Yi={key:1,class:"field col-6 flex flex-column"},$i=X(()=>i("label",{for:"user_zip"},"Codice biglietto",-1)),el={key:0,class:"pi pi-exclamation-triangle",style:{color:"#ff6767"}},tl={class:"p-error",id:"dd-error"},ol={class:"field col-12"},nl=X(()=>i("label",{for:"payment_method",class:"text-sm ml-2"},"Acconto",-1)),il=X(()=>i("div",{class:"field col-6"},null,-1)),ll={key:2,class:"col-12 pl-0 flex"},al={class:"field col-6"},sl=X(()=>i("label",{for:"deposit"},"Importo acconto*",-1)),rl={class:"field col-6"},cl=X(()=>i("label",{for:"payment_method_deposit"},"Modalità pagamento*",-1)),dl={class:"p-float-label mb-0"},ul={class:"p-error",id:"dd-error"},ml={class:"field col-12"},fl={class:"field flex flex-column"},_l=X(()=>i("label",{for:"notes"},"Note",-1)),pl={class:"col-12 flex justify-content-end"};function vl(o,t,n,e,y,g){const a=w("InputText"),m=w("Dropdown"),x=w("AutoComplete"),f=w("Checkbox"),c=w("InputNumber"),h=w("Textarea"),C=w("Button"),v=Ce("tooltip");return e.form?(u(),b("div",Pi,[i("div",ji,[Mi,l(a,{type:"text",modelValue:e.form.user_name,"onUpdate:modelValue":t[0]||(t[0]=s=>e.form.user_name=s),class:"w-full"},null,8,["modelValue"])]),i("div",Fi,[Ei,l(a,{type:"text",modelValue:e.form.user_surname,"onUpdate:modelValue":t[1]||(t[1]=s=>e.form.user_surname=s),class:"w-full"},null,8,["modelValue"])]),i("div",Ri,[Ui,l(a,{type:"text",modelValue:e.form.user_email,"onUpdate:modelValue":t[2]||(t[2]=s=>e.form.user_email=s),class:"w-full"},null,8,["modelValue"])]),i("div",Ni,[Ii,l(a,{type:"text",modelValue:e.form.user_phone,"onUpdate:modelValue":t[3]||(t[3]=s=>e.form.user_phone=s),class:"w-full"},null,8,["modelValue"])]),i("div",Bi,[zi,l(m,{modelValue:e.form.country_id,"onUpdate:modelValue":t[4]||(t[4]=s=>e.form.country_id=s),options:e.countries,optionLabel:"name",optionValue:"id",class:"w-full"},null,8,["modelValue","options"])]),i("div",qi,[Hi,l(m,{modelValue:e.form.user_zip,"onUpdate:modelValue":t[5]||(t[5]=s=>e.form.user_zip=s),options:e.provinces,optionLabel:"name",optionValue:"name",class:"w-full"},null,8,["modelValue","options"])]),i("div",Ki,[Ji,l(m,{modelValue:e.form.status,"onUpdate:modelValue":t[6]||(t[6]=s=>e.form.status=s),options:e.paymentList,optionLabel:"name",class:"w-full mb-0",onChange:t[7]||(t[7]=s=>e.onChangeStatus())},null,8,["modelValue","options"])]),e.form.status&&e.form.status.id=="payed"?(u(),b("div",Gi,[i("label",Wi,[F("Modalità pagamento"),e.form.status&&e.form.status.id=="payed"?(u(),b("span",Qi,"*")):V("",!0)]),i("span",Xi,[l(m,{modelValue:e.form.payment_method,"onUpdate:modelValue":t[8]||(t[8]=s=>e.form.payment_method=s),options:e.dynamicPaymentMethods,optionLabel:"label",class:J(["w-full",{"p-invalid":e.errorMessage}]),disabled:e.form.status&&e.form.status.id!="payed",onChange:t[9]||(t[9]=s=>e.errorMessage=null)},null,8,["modelValue","options","disabled","class"])]),i("small",Zi,k(e.errorMessage||" "),1)])):V("",!0),e.form.payment_method&&e.form.payment_method.id=="voucher"?(u(),b("div",Yi,[$i,l(x,{modelValue:e.form.open_ticket_codes,"onUpdate:modelValue":t[10]||(t[10]=s=>e.form.open_ticket_codes=s),suggestions:e.open_tickets,class:J(["uppercase w-full",{"p-invalid":e.errorMessageVoucher}]),onComplete:t[11]||(t[11]=s=>e.fetchAllOpenTickets(s)),emptySearchMessage:"Nessun risultato",emptySelectionMessage:"Nessun risultato",optionLabel:"code",optionValue:"code",multiple:"",onChange:t[12]||(t[12]=s=>e.errorMessageVoucher=null)},{option:D(({option:s})=>[i("span",{class:"flex flex-row justify-content-between",style:Re({color:s.expired?"#ff6767":null})},[F(k(s.code)+" ",1),s.expired?me((u(),b("i",el,null,512)),[[v,"Scaduto"]]):V("",!0)],4)]),_:1},8,["modelValue","suggestions","class"]),i("small",tl,k(e.errorMessageVoucher||" "),1)])):V("",!0),i("div",ol,[l(f,{modelValue:e.form.multi_payment,"onUpdate:modelValue":t[13]||(t[13]=s=>e.form.multi_payment=s),binary:!0,class:"deposit"},null,8,["modelValue"]),nl]),il,e.form.multi_payment?(u(),b("div",ll,[i("div",al,[sl,l(c,{modelValue:e.form.amount,"onUpdate:modelValue":t[14]||(t[14]=s=>e.form.amount=s),inputId:"currency-germany",mode:"currency",currency:"EUR",locale:"it-IT",class:"w-full"},null,8,["modelValue"])]),i("div",rl,[cl,i("span",dl,[l(m,{modelValue:e.form.payment_method_deposit,"onUpdate:modelValue":t[15]||(t[15]=s=>e.form.payment_method_deposit=s),options:e.paymentMethodAccountList,optionLabel:"label",class:J(["w-full",{"p-invalid":e.errorMessage}]),onChange:t[16]||(t[16]=s=>e.errorMessage=null)},null,8,["modelValue","options","class"])]),i("small",ul,k(e.errorMessage||" "),1)])])):V("",!0),i("div",ml,[i("div",fl,[_l,l(h,{modelValue:e.form.notes,"onUpdate:modelValue":t[17]||(t[17]=s=>e.form.notes=s),rows:"5",cols:"30"},null,8,["modelValue"])])]),i("div",pl,[l(C,{label:"Conferma",onClick:t[18]||(t[18]=s=>e.onConfirm())})])])):V("",!0)}const hl=Q(Ai,[["render",vl],["__scopeId","data-v-8e12661c"]]);var yl=`
@layer primevue {
    .p-contextmenu ul {
        margin: 0;
        padding: 0;
        list-style: none;
    }

    .p-contextmenu .p-submenu-list {
        position: absolute;
        min-width: 100%;
        z-index: 1;
    }

    .p-contextmenu .p-menuitem-link {
        cursor: pointer;
        display: flex;
        align-items: center;
        text-decoration: none;
        overflow: hidden;
        position: relative;
    }

    .p-contextmenu .p-menuitem-text {
        line-height: 1;
    }

    .p-contextmenu .p-menuitem {
        position: relative;
    }

    .p-contextmenu .p-menuitem-link .p-submenu-icon {
        margin-left: auto;
    }

    .p-contextmenu-enter-from {
        opacity: 0;
    }

    .p-contextmenu-enter-active {
        transition: opacity 250ms;
    }
}
`,gl={root:function(t){var n=t.instance;return["p-contextmenu p-component",{"p-input-filled":n.$primevue.config.inputStyle==="filled","p-ripple-disabled":n.$primevue.config.ripple===!1}]},menu:"p-contextmenu-root-list",menuitem:function(t){var n=t.instance,e=t.processedItem;return["p-menuitem",{"p-menuitem-active p-highlight":n.isItemActive(e),"p-focus":n.isItemFocused(e),"p-disabled":n.isItemDisabled(e)}]},content:"p-menuitem-content",action:function(t){var n=t.props,e=t.isActive,y=t.isExactActive;return["p-menuitem-link",{"router-link-active":e,"router-link-active-exact":n.exact&&y}]},icon:"p-menuitem-icon",label:"p-menuitem-text",submenuIcon:"p-submenu-icon",submenu:"p-submenu-list",separator:"p-menuitem-separator"};Ue.extend({name:"contextmenu",css:yl,classes:gl});const bl={props:["form"],setup(o,t){Z(()=>{S()});const n=O(0),e=O([]),y=O(!1),g=O(!0),a=O(),m=O([]),{showLoader:x,hideLoader:f}=ve(),c=De(),h=ne(),C=ee(),v=A(()=>c.allTickets),s=A(()=>h.getCurrentOrder),S=async function(){const T={location_permalink:o.form.location_permalink,api_version:"v2",date:P(o.form.date),course_id:o.form.course.id};await c.fetchAllTickets(T).then(()=>{}).catch(B=>{N(C,B)})},I=function(T){n.value+=1,a.value=T.discount_code,e.value=Object.assign([],T.partial_total),g.value=!1},P=function(T){return ke(T).includes("Invalid")?Be(T):ke(T)},d=function(T){r(T)},r=async function(T){var ue,le,R,U;const B=[{start_at:o.form.hour,tickets:[]}];e.value.forEach(q=>{q.quantity!=0&&B[0].tickets.push({id:q.ticket.id,quantity:q.quantity})});let z=[];T.open_ticket_codes&&T.open_ticket_codes.forEach(q=>{z.push(q.code)});const de={location_permalink:o.form.location_permalink,country_id:T.country_id,status:T.status.id,user_email:T.user_email,user_name:T.user_name,user_phone:T.user_phone,user_surname:T.user_surname,user_zip:T.user_zip,api_version:"v2",date:o.form.date?P(o.form.date):"",notes:T.notes,time_slots:B,payment_method:(ue=T.payment_method)==null?void 0:ue.id,course_id:(R=(le=o.form)==null?void 0:le.course)==null?void 0:R.id,open_ticket_codes:z,multi_payment:T.multi_payment,payments:[{amount:T.amount,typology:"deposit",payment_method:(U=T.payment_method_deposit)==null?void 0:U.id}]};a.value&&(de.discount_code=a.value),await h.createOrder(de).then(()=>{n.value+=1,g.value=!0,y.value=!0}).catch(q=>{N(C,q)})},_=function(){we(s==null?void 0:s.value,o.form.location_permalink),t.emit("closeDialog",!0)},M=function(T){g.value=T},E=function(){we(s==null?void 0:s.value,o.form.location_permalink),G()},G=async function(){let T=[];if(!s.value&&!o.form.location_permalink)return;for(let z of s.value.tickets)T.push(z.order_item_id);const B={check_in:!0,order_item_ids:T,location_permalink:o.form.location_permalink};await h.checkInOrder(B).then(()=>{te(C,{message:"Check-in registrato correttamente",error:!1}),t.emit("closeDialog",!0)}).catch(z=>{N(C,z)})},ce=function(){x();const T={location_permalink:o.form.location_permalink,order_id:s.value.id};h.sendEmail(T).then(()=>{te(C,{message:"Email inviata correttamente al cliente",error:!1}),f(),t.emit("closeDialog",!0)}).catch(B=>{f(),N(C,B)})};return oe(s,()=>{m.value=[],s.value.tickets.forEach(T=>{const B=m.value.find(z=>z.ticket_name===T.ticket_name);if(!B)T.quantity=1,m.value.push(T);else{let z=m.value.indexOf(B);m.value[z].quantity+=1}})}),{tickets:v,active:n,partialTotals:e,showOrderDetail:y,currentOrder:s,tmp_tickets:m,showSecondTab:g,formatExplicitDate:Ie,formatDate:Le,onNextTab:I,onConfirmPayment:d,printPDF:Ve,onPrintPDF:_,onDisableSecondoTab:M,printAndCheckIn:E,sendEmail:ce}},components:{NewOrderTicketTab:Oi,NewOrderFormTab:hl}};const kl={key:0,class:"info-box"},wl={class:"font-medium"},xl=i("i",{class:"pi pi-map-marker mr-3 font-medium"},null,-1),Cl={class:"font-medium"},Dl=i("i",{class:"pi pi-calendar mr-3 font-medium"},null,-1),Ol={key:0,class:"capitalize"},Sl={key:0,class:"flex pb-4"},Vl=i("i",{class:"pi pi-ticket mr-3 font-medium mt-1"},null,-1),Ll={class:"flex flex-column"},Tl={key:0,class:"pb-1 pr-1"},Al={key:1,class:"pb-1"},Pl={class:"py-5"},jl={class:"m-0 text-center line-height-3"},Ml=i("br",null,null,-1),Fl={key:0,class:"col-offset-3 col-6 flex justify-content-center flex-column align-items-center mt-4 order-summary"},El=i("p",{class:"my-2"},[i("b",null,"Riepilogo ordine:")],-1),Rl={class:"flex flex-column col-12"},Ul={key:0,class:"pb-1",style:{"min-width":"8rem"}},Nl={key:1,class:"pb-1"},Il={key:2},Bl={class:"flex flex-column col-12"},zl={key:0,class:"p-0 m-0 font-medium flex justify-content-between"},ql=i("span",{class:"pb-1 pr-1"},"Totale ordine ",-1),Hl={class:"pb-1"},Kl={class:"flex align-items-center justify-content-center mt-4"};function Jl(o,t,n,e,y,g){var h,C;const a=w("NewOrderTicketTab"),m=w("TabPanel"),x=w("NewOrderFormTab"),f=w("Button"),c=w("TabView");return u(),b($,null,[n.form?(u(),b("div",kl,[i("p",wl,[xl,F(k((h=n.form.course)==null?void 0:h.name),1)]),i("p",Cl,[Dl,n.form.date?(u(),b("span",Ol,k(e.formatDate((C=n.form)==null?void 0:C.date)),1)):V("",!0),F(" - "+k(n.form.hour),1)]),e.partialTotals&&e.partialTotals.length>0?(u(),b("div",Sl,[Vl,i("div",Ll,[(u(!0),b($,null,be(e.partialTotals,v=>{var s;return u(),b("p",{class:"p-0 m-0 font-medium flex justify-content-between",key:v},[v&&v.quantity!=0?(u(),b("span",Tl,k((s=v.ticket)==null?void 0:s.name),1)):V("",!0),v&&v.quantity!=0?(u(),b("span",Al," x "+k(v.quantity)+" "+k(v.price),1)):V("",!0)])}),128))])])):V("",!0)])):V("",!0),l(c,{activeIndex:e.active,"onUpdate:activeIndex":t[6]||(t[6]=v=>e.active=v)},{default:D(()=>[l(m,{header:"Seleziona i biglietti",disabled:e.showOrderDetail},{default:D(()=>[l(a,{tickets:e.tickets,form:n.form,onNextTab:t[0]||(t[0]=v=>e.onNextTab(v)),onDisableSecondoTab:t[1]||(t[1]=v=>e.onDisableSecondoTab(v))},null,8,["tickets","form"])]),_:1},8,["disabled"]),l(m,{header:"Inserisci i dati",disabled:e.showSecondTab},{default:D(()=>[l(x,{onNextTab:t[2]||(t[2]=v=>e.onConfirmPayment(v)),location_permalink:n.form.location_permalink},null,8,["location_permalink"])]),_:1},8,["disabled"]),e.showOrderDetail?(u(),W(m,{key:0,header:"Ordine completato"},{default:D(()=>{var v,s;return[i("div",Pl,[i("div",jl,[F(" Ordine "),i("b",null,k(e.currentOrder.reservation_number),1),F(" registrato correttamente!"),Ml]),e.currentOrder?(u(),b("div",Fl,[El,i("div",Rl,[(u(!0),b($,null,be(e.tmp_tickets,S=>(u(),b("p",{class:"p-0 m-0 font-medium flex justify-content-between flex-1",key:S},[S&&S.quantity!=0?(u(),b("span",Ul,k(S.ticket_name),1)):V("",!0),S&&S.quantity!=0?(u(),b("span",Nl," x "+k(S.quantity),1)):V("",!0),S.ticket_price?(u(),b("span",Il," € "+k((+S.ticket_price).toFixed(2)),1)):V("",!0)]))),128))]),i("div",Bl,[e.currentOrder.total?(u(),b("p",zl,[ql,i("span",Hl,[i("b",null,"€ "+k((+((v=e.currentOrder)==null?void 0:v.total)).toFixed(2)),1)])])):V("",!0)])])):V("",!0),i("div",Kl,[l(f,{icon:"pi pi-envelope",class:"mr-3",rounted:"",outlined:"",label:"Invia biglietti",onClick:t[3]||(t[3]=S=>e.sendEmail()),disable:!((s=e.currentOrder)!=null&&s.user_email)},null,8,["disable"]),l(f,{icon:"pi pi-print",onClick:t[4]||(t[4]=S=>e.onPrintPDF()),class:"mr-3",rounted:"",outlined:"",label:"Stampa"}),l(f,{icon:"pi print-check-icon",onClick:t[5]||(t[5]=S=>e.printAndCheckIn()),class:"mr-3",rounted:"",outlined:"",label:"Stampa e Check-in"})])])]}),_:1})):V("",!0)]),_:1},8,["activeIndex"])],64)}const Gl=Q(bl,[["render",Jl]]),Wl={props:["filters","date"],setup(o,t){Z(()=>{g.value=qe(8,21),n.value=Object.assign({},o.filters)});const n=O({}),e=Ke(),y=ee(),g=O(),a=O(!1),m=Te(),x=O(!1),f=A(()=>e.allCourses),c=A(()=>m.showNewOrderDialog),h=async function(){const S={location_permalink:o.filters.location_permalink,api_version:"v2"};await e.fetchAllCourses(S).catch(I=>{N(y,I)})},C=function(){m.setNewOrderDialogVisibility(!1),n.value.hour="",n.value.course=null,t.emit("onCloseDialog")},v=function(S){n.value.date=o.date,m.setNewOrderDialogVisibility(S)},s=function(){x.value=n.value.open_ticket};return oe(o.filters,()=>{if(h(),n.value=Object.assign({},o.filters),o.filters.course&&!o.filters.course.id){let S=f.value.find(I=>I.name===o.filters.course.name);S&&(n.value.course=S)}}),{courses:f,form:n,hours:g,disableForm:x,visible:a,onCloseDialog:C,updateDialog:v,onChecked:s,dialogVisible:c,dialogStore:m}},components:{NewOrderDialog:Gl}},Ql=i("h2",{class:"mt-1"},"Nuova prenotazione",-1),Xl={class:"formgrid grid px-0 align-items-center mt-4"},Zl={key:0,class:"field flex flex-column w-full col-12"},Yl=i("label",{for:"typology"},"Scegli il percorso",-1),$l={key:1,class:"field flex flex-column w-full col-12"},ea=i("label",{for:"typology"},"Seleziona l'orario",-1),ta={class:"flex justify-content-end align-items-center mt-2"},oa={class:"flex align-items-center justify-content-between w-full"},na=i("h2",null,"Nuova prenotazione",-1);function ia(o,t,n,e,y,g){const a=w("Dropdown"),m=w("Button"),x=w("NewOrderDialog"),f=w("Dialog"),c=w("Card");return u(),W(c,{class:"mt-4"},{content:D(()=>[Ql,i("div",Xl,[n.filters.location_permalink?(u(),b("div",Zl,[Yl,l(a,{modelValue:e.form.course,"onUpdate:modelValue":t[0]||(t[0]=h=>e.form.course=h),options:e.courses,optionLabel:"name",disabled:e.disableForm,placeholder:""},null,8,["modelValue","options","disabled"])])):V("",!0),n.filters.location_permalink?(u(),b("div",$l,[ea,l(a,{modelValue:e.form.hour,"onUpdate:modelValue":t[1]||(t[1]=h=>e.form.hour=h),options:e.hours,disabled:e.disableForm,placeholder:""},null,8,["modelValue","options","disabled"])])):V("",!0)]),i("div",ta,[l(m,{label:"Prenota",disabled:!e.form.course||!e.form.hour,onClick:t[2]||(t[2]=h=>e.updateDialog(!0))},null,8,["disabled"])]),l(f,{visible:e.dialogVisible,"onUpdate:visible":t[5]||(t[5]=h=>e.dialogVisible=h),modal:"",header:"Nuova prenotazione",style:{width:"60rem"},breakpoints:{"1199px":"75vw","575px":"90vw"},closable:!1,onHide:t[6]||(t[6]=h=>e.onCloseDialog())},{header:D(()=>[i("div",oa,[na,l(m,{icon:"pi pi-times",text:"",rounded:"",onClick:t[3]||(t[3]=h=>e.updateDialog(!1))})])]),default:D(()=>[l(x,{form:e.form,onCloseDialog:t[4]||(t[4]=h=>e.onCloseDialog())},null,8,["form"])]),_:1},8,["visible"])]),_:1})}const la=Q(Wl,[["render",ia]]),aa={props:["location_permalink"],setup(o,t){Z(()=>{e.value.start_date=re.local().startOf("day").toFormat("dd/MM/yyyy"),e.value.end_date=re.local().endOf("day").toFormat("dd/MM/yyyy"),e.value.created_at="false",e.value.start_hour="00:00",e.value.end_hour="23:59"});const n=ee(),e=O({}),y=pe(),{showLoader:g,hideLoader:a}=ve(),m=function(){let c=je(e.value.start_date)+" "+e.value.start_hour,h=je(e.value.end_date)+" "+e.value.end_hour;const C={from:c,to:h,location_permalink:o.location_permalink,created_at:"false"};x(C)},x=async function(c){g(),await y.downloadReport(c).then(()=>{a(),t.emit("onSubmit")}).catch(h=>{a(),N(n,h)})};return{form:e,onSubmit:m,setDefaultIfBlank:function(){(!e.value.start_hour||e.value.start_hour=="")&&(e.value.start_hour="00:00"),(!e.value.end_hour||e.value.end_hour=="")&&(e.value.end_hour="23:59")}}},components:{Form:Ot}},sa={class:"formgrid grid mt-3"},ra={class:"field col-6 flex flex-column"},ca=i("label",{from:"start_date"},"Dal",-1),da=i("label",{from:"start_hour",class:"mt-3"},"Dalle",-1),ua={class:"field col-6 flex flex-column"},ma=i("label",{from:"end_date"},"Al",-1),fa=i("label",{from:"end_hour",class:"mt-3"},"Alle",-1),_a={class:"flex align-items-center justify-content-end mt-6"};function pa(o,t,n,e,y,g){const a=w("Calendar"),m=w("InputMask"),x=w("Button"),f=w("Form");return u(),W(f,{onSubmit:e.onSubmit},{default:D(()=>[i("div",sa,[i("div",ra,[ca,l(a,{inputId:"start_date",modelValue:e.form.start_date,"onUpdate:modelValue":t[0]||(t[0]=c=>e.form.start_date=c),dateFormat:"dd/mm/yy",manualInput:!0},null,8,["modelValue"]),da,l(m,{id:"start_hour",modelValue:e.form.start_hour,"onUpdate:modelValue":t[1]||(t[1]=c=>e.form.start_hour=c),mask:"99:99",placeholder:"HH:mm",onBlur:t[2]||(t[2]=c=>e.setDefaultIfBlank())},null,8,["modelValue"])]),i("div",ua,[ma,l(a,{inputId:"end_date",modelValue:e.form.end_date,"onUpdate:modelValue":t[3]||(t[3]=c=>e.form.end_date=c),dateFormat:"dd/mm/yy",manualInput:!0},null,8,["modelValue"]),fa,l(m,{id:"end_hour",modelValue:e.form.end_hour,"onUpdate:modelValue":t[4]||(t[4]=c=>e.form.end_hour=c),mask:"99:99",placeholder:"HH:mm",onBlur:t[5]||(t[5]=c=>e.setDefaultIfBlank())},null,8,["modelValue"])])]),i("div",_a,[l(x,{label:"Annulla",text:"",onClick:t[6]||(t[6]=c=>o.$emit("onSubmit"))}),l(x,{label:"Scarica",type:"submit"})])]),_:1},8,["onSubmit"])}const va=Q(aa,[["render",pa]]),ha={setup(){const o=O({}),t=O({}),n=O(),e=O(!1),y=ne(),g=kt(),a=pe(),m=ee(),x=Te(),f=A(()=>g.currentUser),c=A(()=>a.allLocations),h=A(()=>a.getCurrentLocation),C=A(()=>y.getPaymentMethods);Z(()=>{h.value&&(o.value.location=h.value,t.value.location_permalink=h.value.permalink),s().then(()=>{v()})});const v=async function(){var E;let _={};const M=((E=h==null?void 0:h.value)==null?void 0:E.permalink)??null;M?_.location_permalink=M:_.location_permalink=c.value[0].permalink,await y.fetchPaymentMethods(_).then(()=>{}).catch(G=>{N(m,G)})},s=async function(){await a.fetchAllLocations().then(()=>{h.value||(o.value.location=c.value[0],t.value.location_permalink=c.value[0].permalink,a.updateCurrenLocation(c.value[0]))}).catch(_=>{N(m,_)})};return{filters:o,orderTable:n,order_filters:t,visibleDialog:e,user:f,locations:c,newPaymentMethods:C,fetchAllLocations:s,formatDate:Le,onUpdateFilters:function(_){_.course?o.value.course={id:_.course}:o.value.course="",_.name?o.value.name=_.name:o.value.name="",_.hour&&(_.hour.start_at?o.value.hour=_.hour.start_at:o.value.hour=_.hour)},onUpdateNewOrderFilters:function(_){_.start_at&&(t.value.hour=_.start_at),_.course_name&&(t.value.course={name:_.course_name}),_.date&&(t.value.date=_.date),_.hour&&(t.value.hour=_.hour),_.max_seats?t.value.max_seats=_.max_seats:t.value.max_seats=null,x.setNewOrderDialogVisibility(!0)},onCloseDialog:function(){n.value.loadLazyData()},onChangeLocation:function(){t.value.location_permalink=o.value.location.permalink,a.updateCurrenLocation(o.value.location)},onCloseReportDialog:function(){e.value=!1}}},components:{CalendarFilter:In,OrderTable:Fn,OrderFilter:$n,NewOrderCard:la,SalesReportsDialog:va}};const ya={class:"flex justify-content-between align-items-center"},ga={class:"field flex flex-column mt-3"},ba={class:"text-xl font-medium pl-3 py-0"},ka={key:0,style:{color:"#495057"},class:"flex flex-column align-items-end"},wa=i("i",{class:"pi pi-calendar mr-2 text-xl"},null,-1),xa={class:"capitalize text-xl"},Ca={class:"flex gap-4"},Da={key:0,class:"col-3 mt-3"},Oa={class:"col-9 mt-3"};function Sa(o,t,n,e,y,g){var v,s;const a=w("Button"),m=w("SalesReportsDialog"),x=w("Dialog"),f=w("CalendarFilter"),c=w("NewOrderCard"),h=w("OrderFilter"),C=w("OrderTable");return u(),b("div",null,[i("div",ya,[i("div",ga,[i("p",ba,k((s=(v=e.filters)==null?void 0:v.location)==null?void 0:s.name),1)]),e.filters&&e.filters.date?(u(),b("div",ka,[i("div",null,[wa,i("span",xa,k(e.formatDate(e.filters.date)),1)]),l(a,{label:"Report visite",link:"",class:"m-0 p-0",onClick:t[0]||(t[0]=S=>e.visibleDialog=!0),icon:"pi pi-download"}),l(x,{visible:e.visibleDialog,"onUpdate:visible":t[2]||(t[2]=S=>e.visibleDialog=S),modal:"",header:"Report visite",style:{width:"35rem"}},{default:D(()=>[l(m,{onOnSubmit:t[1]||(t[1]=S=>e.onCloseReportDialog()),location_permalink:e.filters.location.permalink},null,8,["location_permalink"])]),_:1},8,["visible"])])):V("",!0)]),i("div",Ca,[e.filters.location?(u(),b("div",Da,[l(f,{filters:e.filters},null,8,["filters"]),l(c,{date:e.filters.date,filters:e.order_filters,onOnCloseDialog:t[3]||(t[3]=S=>e.onCloseDialog())},null,8,["date","filters"])])):V("",!0),i("div",Oa,[l(h,{filters:e.filters,onOnSubmit:t[4]||(t[4]=S=>e.onUpdateFilters(S))},null,8,["filters"]),e.filters.date?(u(),W(C,{key:0,filters:e.filters,ref:"orderTable",class:"mt-4",onUpdateFilters:t[5]||(t[5]=S=>e.onUpdateNewOrderFilters(S))},null,8,["filters"])):V("",!0)])])])}const Pa=Q(ha,[["render",Sa]]);export{Pa as default};
