import{l as ve,m as _e,o as J,p as x,a as W,c as M,_ as H,r as w,q as pe,b as h,e as p,g as s,f as a,n as G,t as b,w as O,s as T,F as Y,h as U,v as oe,x as xe,y as ue,z as Ge,i as Z,A as te,B as we,C as Ke,u as Qe}from"../index40609.js";import{u as K,a as ne,f as Ce,b as ye,c as Xe,d as Ye,e as ge,g as me,h as De,i as Ze,D as ee,j as ke}from"./location40609.js";import{u as se,s as X,e as B,p as Se,a as et,b as Oe,c as he,d as Ve}from"./helpers40609.js";import{F as tt}from"./vee-validate.esm40609.js";class be{static async fetchAll(t){const n=t.location_permalink;return delete t.location_permalink,(await ve(`/ticket_office/${n}/search/tickets`,t)).data}static async fetchAllOpenTickets(t){const n=t.location_permalink;return delete t.location_permalink,(await ve(`/ticket_office/${n}/orders/search_codes`,t)).data}}const fe=_e({id:"ticket",state:()=>({ticket:{},tickets:[],response_tickets:{},open_tickets_codes:{}}),getters:{allTickets:o=>o.response_tickets.available_ticket_types,allOpenTickets:o=>o.open_tickets_codes.open_tickets,responseTickets:o=>o.response_tickets,getTotalTickets:o=>o.response_tickets?o.response_tickets.total:0,getCurrentTicket:o=>o.ticket},actions:{async fetchAllTickets(o){await be.fetchAll(o).then(t=>this.response_tickets=t)},async fetchAllOpenTickets(o){await be.fetchAllOpenTickets(o).then(t=>this.open_tickets_codes=t)}}}),ot={computed:{Code(){return Code}},props:["location_permalink","time_slot"],setup(o,t){J(()=>{n.value=Object.assign({},o.time_slot)});const n=x({}),e=fe(),y=K(),{showLoader:C,hideLoader:l}=se(),d=W(),g=x(),f=x(),u=M(()=>e.allOpenTickets),v=M(()=>y.paymentStatus),r=M(()=>y.paymentModeList),S=M(()=>{const c=y.getPaymentMethods;return Object.entries(c).map(([m,N])=>({id:m,label:N}))}),k=M(()=>y.getCurrentOrder),D=async function(c){const m={code:c.query.toUpperCase(),location_permalink:o.location_permalink};await e.fetchAllOpenTickets(m)},j=async function(){var m,N;const c={id:o.location_permalink,order_id:n.value.id,status:(m=n.value)==null?void 0:m.status,payment_method:n.value.payment_method,open_ticket_codes:[],api_version:"v2",notes:(N=n.value)==null?void 0:N.notes};if(n.value.status&&n.value.status=="payed"&&!n.value.payment_method){g.value="Seleziona un metodo di pagamento";return}for(const L of n.value.open_tickets_used)if(L.expired){f.value="Uno o più codici biglietto risultano scaduti";return}if(n.value.open_tickets_used&&n.value.open_tickets_used.length>0){let L=[];n.value.open_tickets_used.forEach(Q=>{L.push(Q.code)}),c.open_ticket_codes=L}F(c)},F=async function(c){C(),await y.updateOrder(c).then(()=>{l(),X(d,{message:"Stato aggiornato correttamente",error:!1}),t.emit("closeDialog",k.value)}).catch(m=>{l(),B(d,m)})};return{form:n,open_tickets:u,paymentList:v,paymentModeList:r,changeStatus:j,errorMessage:g,errorMessageVoucher:f,dynamicPaymentMethods:S,fetchAllOpenTickets:D,onChangeStatus:function(){(n.value.status=="free"||n.value.status=="to_pay")&&(n.value.payment_method=null)}}}},nt={key:0,class:"formgrid grid flex-column mt-3"},st={class:"field col-12"},lt=s("label",{for:"status"},"Stato pagamento",-1),at={class:"field col-12"},it=s("label",{for:"payment_method"},"Modalità pagamento",-1),rt={class:"p-error",id:"dd-error"},ct={key:0,class:"field col-12 flex flex-column"},dt=s("label",{for:"user_zip"},"Codice biglietto",-1),ut={key:0,class:"pi pi-exclamation-triangle",style:{color:"#ff6767"}},mt={class:"p-error",id:"dd-error"},_t={class:"flex align-items-center justify-content-end mt-3"};function ft(o,t,n,e,y,C){const l=w("Dropdown"),d=w("AutoComplete"),g=w("Button"),f=pe("tooltip");return h(),p(Y,null,[e.form?(h(),p("div",nt,[s("div",st,[lt,a(l,{modelValue:e.form.status,"onUpdate:modelValue":t[0]||(t[0]=u=>e.form.status=u),options:e.paymentList,optionLabel:"name",optionValue:"id",class:"w-full",onChange:t[1]||(t[1]=u=>e.onChangeStatus())},null,8,["modelValue","options"])]),s("div",at,[it,a(l,{modelValue:e.form.payment_method,"onUpdate:modelValue":t[2]||(t[2]=u=>e.form.payment_method=u),options:e.dynamicPaymentMethods,optionLabel:"label",optionValue:"id",class:G(["w-full",{"p-invalid":e.errorMessage}]),disabled:e.form.status!="payed",onChange:t[3]||(t[3]=u=>e.errorMessage=null)},null,8,["modelValue","options","disabled","class"]),s("small",rt,b(e.errorMessage||" "),1)]),e.form.payment_method=="voucher"&&e.form.status=="payed"?(h(),p("div",ct,[dt,a(d,{modelValue:e.form.open_tickets_used,"onUpdate:modelValue":t[4]||(t[4]=u=>e.form.open_tickets_used=u),suggestions:e.open_tickets,class:G(["uppercase w-full",{"p-invalid":e.errorMessageVoucher}]),onComplete:t[5]||(t[5]=u=>e.fetchAllOpenTickets(u)),emptySearchMessage:"Nessun risultato",emptySelectionMessage:"Nessun risultato",optionLabel:"code",optionValue:"code",multiple:"",onChange:t[6]||(t[6]=u=>e.errorMessageVoucher=null)},{option:O(({option:u})=>[s("span",{class:"flex flex-row justify-content-between",style:xe({color:u.expired?"#ff6767":null})},[U(b(u.code)+" ",1),u.expired?oe((h(),p("i",ut,null,512)),[[f,"Scaduto"]]):T("",!0)],4)]),_:1},8,["modelValue","suggestions","class"]),s("small",mt,b(e.errorMessageVoucher||" "),1)])):T("",!0)])):T("",!0),s("div",_t,[a(g,{label:"Annulla",text:"",onClick:t[7]||(t[7]=u=>o.$emit("closeDialog",null))}),a(g,{label:"Conferma",onClick:t[8]||(t[8]=u=>e.changeStatus())})])],64)}const vt=H(ot,[["render",ft]]),ht={props:["order"],setup(o){J(()=>{r.value&&v.value&&r.value.forEach(k=>{k.permalink===v.value&&(C.value=k.name)})});const t=x(0),n=x([]),e=x(!1),y=x(!0),C=x(),l=fe(),d=K();W();const g=ne(),f=M(()=>l.allTickets),u=M(()=>d.getCurrentOrder),v=M(()=>g.getCurrentLocation),r=M(()=>g.allLocations),S=M(()=>{const k=o.order.payment_method,D=d.getPaymentMethods;return k?D[k]:"-"});return{tickets:f,active:t,partialTotals:n,showOrderDetail:e,currentOrder:u,showSecondTab:y,currentLocation:v,selectedLocation:C,formatExplicitDate:Ce,formatDate:ye,prettyPaymentStatus:Se,formatPrettyDate:Xe,formatDataAndHourFromUnixTimestamps:Ye,prettyPaymentMethod:et,methodLabel:S}},components:{}};const pt={class:"mt-3 line-height-3"},yt={class:"flex gap-3"},gt=s("i",{class:"pi pi-user mt-1"},null,-1),kt={class:"m-0 mb-1"},bt={class:"m-0 mb-1"},xt={class:"m-0 mb-1"},wt={class:"m-0 mb-1"},Ct={key:0},Dt={class:"flex gap-3 mt-4"},St=s("i",{class:"pi pi-map-marker mt-1"},null,-1),Ot={class:"m-0 mb-1"},Vt={class:"m-0 mb-1"},Tt={key:0,class:"m-0 mb-1"},At={class:"flex gap-3 mt-4"},Mt=s("i",{class:"pi pi-shopping-cart mt-1"},null,-1),Pt={class:"m-0 mb-1"},Ft={class:"m-0 mb-1"},Nt={class:"m-0 mb-1"},Lt={key:0,class:"m-0 mb-1"},Ut={key:1,class:"m-0 mb-1"},Bt={key:2,class:"m-0 mb-1"},jt={class:"m-0 mb-1"},Et={class:"m-0 mb-1"},It={key:0},Rt={key:1},zt={key:0,class:"flex gap-3 mt-4"},qt=s("i",{class:"pi pi-comment mt-1"},null,-1);function Ht(o,t,n,e,y,C){const l=w("Badge");return h(),p("div",pt,[s("div",yt,[gt,s("div",null,[s("p",kt,b(n.order.user_name)+" "+b(n.order.user_surname||"-"),1),s("p",bt,b(n.order.user_email),1),s("p",xt,b(n.order.user_phone),1),s("p",wt,[U(b(n.order.country)+" ",1),n.order.user_zip?(h(),p("span",Ct," - "+b(n.order.user_zip),1)):T("",!0)])])]),s("div",Dt,[St,s("div",null,[s("p",Ot,b(e.selectedLocation),1),s("p",Vt,b(n.order.course_name),1),n.order.date?(h(),p("p",Tt,b(e.formatPrettyDate(n.order.date))+" "+b(n.order.start_at),1)):T("",!0)])]),s("div",At,[Mt,s("div",null,[s("p",Pt,b(n.order.reservation_number),1),s("p",Ft,b(e.formatDataAndHourFromUnixTimestamps(n.order.created_at)),1),s("p",Nt,b(n.order.created_by),1),n.order.status?(h(),p("p",Lt,[a(l,{value:e.prettyPaymentStatus(n.order.status),class:G([n.order.status,"px-3 border-round-lg"])},null,8,["value","class"])])):T("",!0),n.order.status=="payed"?(h(),p("p",Ut,b(e.methodLabel),1)):T("",!0),n.order.open_tickets_used&&n.order.status=="payed"?(h(),p("p",Bt,[(h(!0),p(Y,null,ue(n.order.open_tickets_used,d=>(h(),p("span",{key:d},[a(l,{value:d.code,class:"mr-2 voucher"},null,8,["value"])]))),128))])):T("",!0),s("p",jt,"Codice sconto utilizzato: "+b(n.order.discount_code||"-"),1),s("p",Et,[U(" Totale ordine: "),n.order.total?(h(),p("span",It,"€ "+b((+n.order.total).toFixed(2)),1)):(h(),p("span",Rt,"-"))])])]),n.order.notes?(h(),p("div",zt,[qt,s("div",null,b(n.order.notes),1)])):T("",!0)])}const Jt=H(ht,[["render",Ht]]),$t={props:["order","location_permalink"],setup(o,t){J(()=>{o.order&&o.order.notes&&(n.value=o.order.notes)});const n=x(),{showLoader:e,hideLoader:y}=se(),C=W(),l=K(),d=M(()=>l.getCurrentOrder);return{notes:n,updateOrder:async function(){const f={id:o.location_permalink,order_id:o.order.id,notes:n.value,api_version:"v2"};e(),await l.updateOrder(f).then(()=>{y(),X(C,{message:"Nota aggiornata correttamente",error:!1}),t.emit("closeDialog",d.value)}).catch(u=>{y(),B(C,u)})}}}},Wt={class:"pt-5 px-2"},Gt={class:"flex align-items-center justify-content-end mt-3"};function Kt(o,t,n,e,y,C){const l=w("Textarea"),d=w("Button");return h(),p("div",Wt,[a(l,{modelValue:e.notes,"onUpdate:modelValue":t[0]||(t[0]=g=>e.notes=g),rows:"8",cols:"30",class:"w-full"},null,8,["modelValue"]),s("div",Gt,[a(d,{label:"Annulla",text:"",onClick:t[1]||(t[1]=g=>o.$emit("closeDialog",null))}),a(d,{label:"Conferma",onClick:t[2]||(t[2]=g=>e.updateOrder())})])])}const Qt=H($t,[["render",Kt]]),Xt={props:["filters"],setup(o,t){J(()=>{i.value=!0,c.value={first:0,rows:S.value.rows,sortField:null,sortOrder:null},c.value.page=0,o.filters.location&&R()});const n=K(),e=ge(),y=M(()=>n.responseOrders),C=M(()=>n.status),l=Ge(),d=M(()=>l.submitDialog),g=M(()=>n.paymentStatus),f=M(()=>n.getDeleteResponse),{showLoader:u,hideLoader:v}=se(),r=W(),S=x(),k=x(),D=x(),j=x(),F=x(),i=x(!0),c=x(),m=x(0),N=x([]),L=x([]),Q=x(!1),le=x(!1),A=x(),I=x(!1);function R(){i.value=!0;let _=new Map;for(const V in o.filters)V=="date"?me(o.filters.date)=="Invalid DateTime"?_.set("date",De(o.filters.date)):_.set("date",me(o.filters.date)):o.filters.location&&_.set("location_permalink",o.filters.location.permalink),V=="course"&&o.filters.course.id!="-1"&&_.set("course",o.filters.course.id),V=="hour"&&o.filters.hour!="Tutti gli orari"&&_.set("hour",o.filters.hour),V=="name"&&_.set("name",o.filters.name);setTimeout(()=>{ae(_)},Math.random()*1e3+250)}const ae=async function(_){await n.fetchAllOrders(_).then(()=>{i.value=!1}).catch(V=>{i.value=!1,B(r,V)})},ie=_=>{D.value.toggle(_),A.value.toggle(_)},re=(_,V)=>_>_+V?"red":"green",ce=function(_,V){V&&(D.value.note=V,D.value.toggle(_))},q=function(_){_.order&&y.value.time_slots&&y.value.time_slots.forEach((V,P)=>{V.orders.forEach((E,z)=>{E.id==_.order.id&&(y.value.time_slots[P].orders[z]=_.order,_.check_in_done!=null&&(y.value.time_slots[P].check_in_done+=_.check_in_done))})})},Ae=async function(_,V){let P=[],E=!1;L.value.forEach($=>{if($.id==_.id){E=!0;return}});for(let $ of _.tickets)P.push($.order_item_id);const z={check_in:V,order_item_ids:P,location_permalink:o.filters.location};await n.checkInOrder(z).then(()=>{q(f.value),X(r,{message:"Check-in registrato correttamente",error:!1}),E&&de(L.value,f.value.order)}).catch($=>{B(r,$)})},Me=async function(_,V){let P=[],E=!1;L.value.forEach($=>{if($.id==_.id){E=!0;return}});for(let $ of _.tickets)P.push($.order_item_id);const z={order_item_ids:P,no_show:V,location_permalink:o.filters.location.permalink};await n.noShowOrder(z).then(()=>{q(f.value),X(r,{message:"No-show registrato correttamente",error:!1}),E&&de(L.value,f.value.order)}).catch($=>{B(r,$)})},Pe=async function(_,V,P){const E={id:_,check_in:V,location_permalink:o.filters.location.permalink};await n.checkInTicket(E).then(()=>{X(r,{message:"Check-in registrato correttamente",error:!1}),q(f.value),de(L.value,f.value.order)}).catch(z=>{B(r,z)})},Fe=async function(_,V,P){const E={id:_,no_show:V,location_permalink:o.filters.location.permalink};await n.noShowTicket(E).then(()=>{X(r,{message:"No-show registrato correttamente",error:!1}),q(f.value),de(L.value,f.value.order)}).catch(z=>{B(r,z)})},de=function(_,V){let P=Ne(L.value,f.value.order.id);P!=-1&&L.value.splice(P,1),L.value.push(f.value.order)},Ne=function(_,V){for(let P=0;P<_.length;P++)if(_[P].id===V)return P;return-1},Le=function(_){const V={course_name:_.course_name,start_at:_.start_at,date:o.filters.date,hour:_.start_at,max_seats:_.is_free_slot?null:_.remaing_seats+""};t.emit("updateFilters",V)},Ue=function(_){Q.value=!0,j.value=_},Be=function(_){q({order:_}),Q.value=!1,I.value=!1},je=function(_){return _!=null&&_.created_by&&(_==null?void 0:_.created_by)=="WEB"?"WEB":"KALATA"},Ee=function(_,V){let P=0;if(_&&_.tickets){_.tickets.forEach(z=>{V?z.no_show&&(P+=1):z.check_in&&(P+=1)});let E=_.tickets.length;if(P!=E&&P!=0)return P+"/"+E}},Ie=function(_,V){A.value.data=V,A.value.toggle(_)},Re=function(_,V){F.value=V.id;let P="Sei sicuro di voler eliminare questa prenotazione?";P+='<br><br> <i>N.B. Eventuali voucher presenti nella prenotazione vanno liberati manualmente dalla sezione "Data aperta"</i>',l.setDialog("Elimina prenotazione","Elimina","Annulla",P),l.setBtnSubmit(!1),l.setDynamicDialogVisibility(!0)},ze=function(){if(u(),F.value){const _={id:F.value,location_permalink:o.filters.location.permalink};n.deleteOrder(_).then(()=>{v(),X(r,{message:"La prenotazione è stata eliminata correttamente",error:!1}),y.value.time_slots&&y.value.time_slots.forEach((V,P)=>{V.orders.forEach((E,z)=>{E.id==F.value&&(y.value.time_slots[P].orders.splice(z,1),f.value,y.value.time_slots[P].check_in_done+=f.value.check_in_done,y.value.time_slots[P].confirmed_seats+=f.value.confirmed_seats,y.value.time_slots[P].remaing_seats-=f.value.confirmed_seats)})})}).catch(V=>{v(),B(r,V)})}},qe=function(_){N.value=_.data?[_.data]:[]},He=function(_){L.value=_.data?[_.data]:[]},Je=function(_){le.value=!0,k.value=_},$e=function(_){I.value=!0,k.value=_},We=function(_){const V=new Map;V.set("id",_.id),V.set("location_permalink",o.filters.location.permalink),u(),n.downloadTicket(V).then(()=>{v()}).catch(P=>{v(),B(r,P)})};return Z(d,_=>{_&&ze()}),Z(o.filters,()=>{o.filters.location&&R()}),{dt:S,responseOrders:y,loading:i,totalRecords:m,lazyParams:c,currentOrder:k,status:C,expandedRows:N,expandedRows1:L,op:D,dialogStore:e,paymentList:g,visibleDialog:Q,currentTimeSlot:j,visibleMenu:A,visibleDetailDialog:le,visibleNotesDialog:I,toast:r,loadLazyData:R,toggle:ie,getProgressClass:re,showNotes:ce,checkAll:Ae,noShowAll:Me,openDialog:Le,checkInSingleTicket:Pe,noShowSingleTicket:Fe,prettyPaymentStatus:Se,openPaymentStatusDialog:Ue,onClosePaymentStatusDialog:Be,getRowClass:je,printPDF:Oe,showLabelCheckbox:Ee,confirmDeleteOrder:Re,showMenu:Ie,openOrderDetailDialog:Je,openNotesDialog:$e,downloadPDF:We,handleRowToggle:qe,handleRowToggle1:He,formatDataFromUnixTimestamps:Ze,printOrderPDF:he}},components:{PaymentStatusDialog:vt,OrderDetailDialog:Jt,NotesDialog:Qt}};const Yt={class:"order-table"},Zt={class:""},eo={style:{width:"15rem"}},to={class:"m-0 text-right",style:{"font-size":"12px"}},oo={key:0,class:"pi pi-exclamation-triangle cursor-pointer",style:{color:"var(--orange-400)"}},no={style:{width:"15rem"}},so={class:"m-0 text-right",style:{"font-size":"12px"}},lo={key:0},ao={key:0},io=s("div",{class:"flex justify-content-center w-full"},"Check-in",-1),ro={class:"flex justify-content-center"},co={class:"flex flex-column",style:{"margin-top":"8px"}},uo={class:"text-sm",style:{"min-height":"15px"}},mo=s("div",{class:"flex justify-content-center w-full"},"No-show",-1),_o={class:"flex justify-content-center"},fo={class:"flex flex-column",style:{"margin-top":"8px"}},vo={class:"text-sm",style:{"min-height":"15px"}},ho=["onClick"],po={style:{"max-width":"50rem"},class:"p-3"},yo={class:"overlay-menu"},go=["onClick"],ko=s("i",{class:"pi pi-eye mr-3"},null,-1),bo=["onClick"],xo=s("i",{class:"pi pi-print mr-3"},null,-1),wo=["onClick"],Co=s("i",{class:"pi pi-download mr-3"},null,-1),Do=["onClick"],So=s("i",{class:"pi pi-comment mr-3"},null,-1),Oo=["disabled","onClick"],Vo=s("i",{class:"pi pi-pencil mr-3"},null,-1),To=["disabled","onClick"],Ao=s("i",{class:"pi pi-trash mr-3"},null,-1),Mo={key:0},Po={key:1},Fo=s("div",{class:"flex justify-content-center w-full"},"Check-in",-1),No={class:"flex justify-content-center"},Lo=s("div",{class:"flex justify-content-center w-full"},"No-show",-1),Uo={class:"flex justify-content-center"},Bo=s("div",{class:"flex justify-content-center w-full"},null,-1),jo={class:"flex justify-content-center"},Eo={key:0,class:"flex mx-4"},Io=s("div",null,[s("div",{class:"p-0 m-0 flex align-items-center"},[s("p",{style:{width:"2rem",height:"5px"},class:"mr-2 web my-0"}),s("span",{class:"text-sm"},"WEB")]),s("div",{class:"p-0 m-0 flex align-items-center justify-content-between"},[s("p",{style:{width:"2rem",height:"5px"},class:"mr-2 kalata"}),s("span",{class:"text-sm"},"SUPERGA")])],-1),Ro=[Io];function zo(o,t,n,e,y,C){const l=w("Column"),d=w("ProgressBar"),g=w("Button"),f=w("Badge"),u=w("Checkbox"),v=w("OverlayPanel"),r=w("DataTable"),S=w("PaymentStatusDialog"),k=w("Dialog"),D=w("OrderDetailDialog"),j=w("NotesDialog"),F=pe("tooltip");return h(),p("div",Yt,[a(r,{value:e.responseOrders.time_slots,totalRecords:e.responseOrders.total,lazy:!0,paginator:!1,ref:"dt",loading:e.loading,stripedRows:"",expandedRows:e.expandedRows,"onUpdate:expandedRows":t[1]||(t[1]=i=>e.expandedRows=i),onRowExpand:e.handleRowToggle},{empty:O(()=>[U(" Nessuna prenotazione trovata. ")]),expansion:O(i=>[a(r,{value:i.data.orders,class:"m-4 mx-4 table-order-detail",expandedRows:e.expandedRows1,"onUpdate:expandedRows":t[0]||(t[0]=c=>e.expandedRows1=c),rowClass:e.getRowClass,onRowExpand:e.handleRowToggle1},{empty:O(()=>[U(" Nessuna prenotazione trovata. ")]),expansion:O(c=>[a(r,{value:c.data.tickets,class:"m-4 mx-5"},{default:O(()=>[a(l,{header:"Codice biglietto",field:"code"}),a(l,{header:"Tipo biglietto",field:"type"},{body:O(({data:m})=>[a(f,{value:m.ticket_name,class:G([m.ticket_name,"px-3 border-round-lg"])},null,8,["value","class"])]),_:1}),a(l,{header:"Prezzo"},{body:O(({data:m})=>[m.ticket_price?(h(),p("span",Mo," € "+b((+m.ticket_price).toFixed(2)),1)):(h(),p("span",Po,"-"))]),_:1}),a(l,null,{header:O(()=>[Fo]),body:O(({data:m})=>[s("div",No,[a(u,{modelValue:m.check_in,"onUpdate:modelValue":N=>m.check_in=N,binary:!0,onChange:N=>e.checkInSingleTicket(m.id,m.check_in,c.data),class:"check_in"},null,8,["modelValue","onUpdate:modelValue","onChange"])])]),_:2},1024),a(l,null,{header:O(()=>[Lo]),body:O(({data:m})=>[s("div",Uo,[a(u,{modelValue:m.no_show,"onUpdate:modelValue":N=>m.no_show=N,binary:!0,onChange:N=>e.noShowSingleTicket(m.id,m.no_show,c.data),class:"no_show"},null,8,["modelValue","onUpdate:modelValue","onChange"])])]),_:2},1024),a(l,{field:"tickets_url"},{header:O(()=>[Bo]),body:O(({data:m})=>[s("div",jo,[oe(a(g,{link:"",icon:"pi pi-print",href:m.tickets_url,target:"_blank",style:{color:"var(--surface-400)"},text:"",rounded:"",onClick:N=>e.printPDF(m.id,n.filters.location.permalink,e.toast)},null,8,["href","onClick"]),[[F,"Stampa",void 0,{top:!0}]])])]),_:1})]),_:2},1032,["value"])]),default:O(()=>[a(l,{header:"Codice",field:"reservation_number"}),a(l,{header:"Acquirente"},{body:O(({data:c})=>[U(b(c.user_name)+" "+b(c.user_surname)+" ",1),!c.user_name&&!c.user_surname?(h(),p("span",lo,"-")):T("",!0)]),_:1}),a(l,{header:"Pagamento"},{body:O(({data:c})=>[c.status?(h(),p("span",ao,[a(f,{value:e.prettyPaymentStatus(c.status),class:G([c.status,"px-3 border-round-lg"])},null,8,["value","class"])])):T("",!0)]),_:1}),a(l,{header:"Q.ta",field:"tickets_number"}),a(l,null,{header:O(()=>[io]),body:O(({data:c})=>[s("div",ro,[s("div",co,[a(u,{modelValue:c.check_in,"onUpdate:modelValue":m=>c.check_in=m,binary:!0,onChange:m=>e.checkAll(c,c.check_in),class:"check_in"},null,8,["modelValue","onUpdate:modelValue","onChange"]),s("span",uo,b(e.showLabelCheckbox(c,!1)),1)])])]),_:1}),a(l,null,{header:O(()=>[mo]),body:O(({data:c})=>[s("div",_o,[s("div",fo,[a(u,{modelValue:c.no_show,"onUpdate:modelValue":m=>c.no_show=m,binary:!0,onChange:m=>e.noShowAll(c,c.no_show),class:"no_show"},null,8,["modelValue","onUpdate:modelValue","onChange"]),s("span",vo,b(e.showLabelCheckbox(c,!0)),1)])])]),_:1}),a(l,{header:"Note"},{body:O(({data:c})=>[s("div",{class:"notes cursor-pointer",onClick:m=>e.showNotes(m,c.notes)},b(c.notes||"-"),9,ho),a(v,{ref:"op"},{default:O(()=>[s("div",po,b(e.op.note),1)]),_:1},512)]),_:1}),a(l,{header:"",style:{"padding-right":"0",width:"6rem"}},{body:O(({data:c})=>[a(g,{type:"button","aria-haspopup":"true","aria-controls":"overlay_menu",icon:"pi pi-ellipsis-v",text:"",rounded:"",onClick:m=>e.showMenu(m,c)},null,8,["onClick"]),a(v,{ref:"visibleMenu"},{default:O(()=>[s("ul",yo,[s("li",{onClick:m=>e.openOrderDetailDialog(e.visibleMenu.data)},[ko,U("Dettaglio ordine ")],8,go),s("li",{onClick:m=>e.printOrderPDF(e.visibleMenu.data,n.filters.location.permalink,e.toast)},[xo,U("Stampa ")],8,bo),s("li",{onClick:m=>e.downloadPDF(e.visibleMenu.data)},[Co,U("Scarica PDF ")],8,wo),s("li",{onClick:m=>e.openNotesDialog(e.visibleMenu.data)},[So,U("Modifica nota ")],8,Do),s("li",{disabled:!e.visibleMenu.data.can_change_status,onClick:m=>e.openPaymentStatusDialog(e.visibleMenu.data)},[Vo,U("Cambia stato ")],8,Oo),s("li",{disabled:!e.visibleMenu.data.can_cancel,onClick:m=>e.confirmDeleteOrder(m,e.visibleMenu.data)},[Ao,U("Elimina ")],8,To)])]),_:2},1536)]),_:1}),a(l,{expander:"",class:"pl-0 ml-0"})]),_:2},1032,["value","expandedRows","rowClass","onRowExpand"]),i.data.orders&&i.data.orders.length>0?(h(),p("div",Eo,Ro)):T("",!0)]),default:O(()=>[a(l,{header:"Percorso",field:"course_name",filterMatchMode:"contains",ref:"course_name"},null,512),a(l,{header:"Orario",field:"start_at",filterMatchMode:"contains",ref:"start_at"},{body:O(({data:i})=>[s("div",Zt,[s("span",{class:G(i.is_free_slot?"free":"")},b(i.start_at),3)])]),_:1},512),a(l,{header:"Posti prenotati",ref:"availabe_tickets",field:"availabe_tickets"},{body:O(({data:i})=>[s("div",eo,[s("p",to,[U(b(i.confirmed_seats)+"/"+b(i.remaing_seats+i.confirmed_seats)+" ",1),i.confirmed_seats>i.remaing_seats+i.confirmed_seats?oe((h(),p("i",oo,null,512)),[[F,i.confirmed_seats-(i.remaing_seats+i.confirmed_seats)+" posti in overbooking",void 0,{top:!0}]]):T("",!0)]),a(d,{value:i.confirmed_seats*100/(i.remaing_seats+i.confirmed_seats),showValue:!1,style:{height:"10px"},class:G(["available-progress",e.getProgressClass(i.confirmed_seats,i.remaing_seats)])},null,8,["value","class"])])]),_:1},512),a(l,{header:"Check-in",ref:"confirmed_tickets",field:"confirmed_tickets"},{body:O(({data:i})=>[s("div",no,[s("p",so,b(i.check_in_done)+"/"+b(i.confirmed_seats),1),a(d,{value:i.check_in_done*100/(i.remaing_seats+i.confirmed_seats),showValue:!1,style:{height:"10px"},class:"check-in-progress"},null,8,["value"])])]),_:1},512),a(l,null,{body:O(({data:i})=>[oe(a(g,{type:"button","aria-haspopup":"true","aria-controls":"overlay_menu",class:"mr-0 text-primary",icon:"pi pi-calendar",text:"",rounded:"",onClick:c=>e.openDialog(i)},null,8,["onClick"]),[[F,"Prenota",void 0,{top:!0}]])]),_:1}),a(l,{expander:"",style:{width:"5rem"}})]),_:1},8,["value","totalRecords","loading","expandedRows","onRowExpand"]),a(k,{visible:e.visibleDialog,"onUpdate:visible":t[3]||(t[3]=i=>e.visibleDialog=i),modal:"",header:"Stato pagamento",style:{width:"35rem"}},{default:O(()=>[a(S,{location_permalink:n.filters.location.permalink,time_slot:e.currentTimeSlot,onCloseDialog:t[2]||(t[2]=i=>e.onClosePaymentStatusDialog(i))},null,8,["location_permalink","time_slot"])]),_:1},8,["visible"]),a(k,{visible:e.visibleDetailDialog,"onUpdate:visible":t[4]||(t[4]=i=>e.visibleDetailDialog=i),modal:"",header:"Dettaglio ordine",style:{width:"35rem"}},{default:O(()=>[a(D,{order:e.currentOrder},null,8,["order"])]),_:1},8,["visible"]),a(k,{visible:e.visibleNotesDialog,"onUpdate:visible":t[6]||(t[6]=i=>e.visibleNotesDialog=i),modal:"",header:"Modifica nota",style:{width:"35rem"}},{default:O(()=>[a(j,{order:e.currentOrder,location_permalink:n.filters.location.permalink,onCloseDialog:t[5]||(t[5]=i=>e.onClosePaymentStatusDialog(i))},null,8,["order","location_permalink"])]),_:1},8,["visible"])])}const qo=H(Xt,[["render",zo]]),Ho={props:["filters"],setup(o,t){J(()=>{r(),n.value=o.filters,n.value.date=new Date,D()});const n=x({}),e=ne(),y=K(),C=W(),l=x([]),d=x(),g=ee.now().plus({years:1}),f=M(()=>e.allLocations),u=M(()=>y.getCalendar),v=async function(i){await y.fetchCalendar(i).then(()=>{}).catch(c=>{B(C,c)})},r=async function(){await e.fetchAllLocations().then(()=>{}).catch(i=>{B(C,i)})},S=function(){if(o.filters.location){const i=f.value.find(c=>c.permalink===o.filters.location);l.value=i.courses}},k=function(i){let c={};c.month=ee.fromJSDate(new Date(i)).month,c.year=ee.fromJSDate(new Date(i)).year,c.location_permalink=o.filters.location.permalink?o.filters.location.permalink:o.filters.location,d.value={month:c.month,year:c.year},v(c)},D=function(){let i=ee.now(),c={location_permalink:"",month:"",year:""};c.location_permalink=o.filters.location.permalink?o.filters.location.permalink:o.filters.location,c.month=i.month+"",c.year=i.year+"",v(c)},j=function(i){if(u.value.web_dates&&u.value.web_dates.length!=0){let c=i.month+1;c=c<10?"0"+c:c;let m=i.day<10?"0"+i.day:i.day,N=i.year+"-"+c+"-"+m;return u.value.web_dates.find(L=>L==N)}},F=function(i){let c={location_permalink:o.filters.location.permalink?o.filters.location.permalink:o.filters.location,month:i.month,year:i.year};v(c)};return Z(o.filters,()=>{if(d.value){let i={location_permalink:o.filters.location.permalink?o.filters.location.permalink:o.filters.location,month:d.value.month,year:d.value.year};v(i)}else D()}),{form:n,courses:l,maxAllowedDate:g,locations:f,calendar:u,getCourses:S,onDateChange:k,getDayFromDate:j,onMonthChange:F}}};const Jo={class:"flex calendar-filter"},$o={key:0,class:"special-day"};function Wo(o,t,n,e,y,C){const l=w("Calendar");return h(),p("div",Jo,[a(l,{modelValue:e.form.date,"onUpdate:modelValue":t[0]||(t[0]=d=>e.form.date=d),inline:"",onDateSelect:t[1]||(t[1]=d=>e.onDateChange(d)),onMonthChange:t[2]||(t[2]=d=>e.onMonthChange(d)),maxDate:e.maxAllowedDate.toJSDate()},{date:O(d=>[e.getDayFromDate(d.date)?(h(),p("div",$o,[s("span",null,b(d.date.day),1)])):(h(),p(Y,{key:1},[U(b(d.date.day),1)],64))]),_:1},8,["modelValue","maxDate"])])}const Go=H(Ho,[["render",Wo]]);class Ko{static async fetchAll(t){const n=t.location_permalink;return delete t.location_permalink,(await ve(`/ticket_office/${n}/search/courses`,t)).data}}const Te=_e({id:"course",state:()=>({course:{},courses:[],response_courses:{}}),getters:{allCourses:o=>o.response_courses.tickets,responseCourses:o=>o.response_courses,getTotalCourses:o=>o.response_courses?o.response_courses.total:0,getCurrentCourse:o=>o.course},actions:{async fetchAllCourses(o){await Ko.fetchAll(o).then(t=>this.response_courses=t)}}}),Qo={props:["filters"],setup(o,t){J(()=>{n.value=Object.assign({},o.filters),n.value.date=ee.now().toFormat("dd/MM/yyyy"),l.value=Ve(8,20),l.value.unshift("Tutti gli orari"),n.value.hour="Tutti gli orari"});const n=x({}),e=x([]),y=ne(),C=W(),l=x([]),d=K(),g=Te(),f=M(()=>y.allLocations),u=M(()=>d.responseOrders),v=M(()=>g.allCourses),r=function(){n.value.name=null,n.value.course=e.value[0].name,n.value.hour=l.value[0],t.emit("onSubmit",n.value)},S=async function(){const k={location_permalink:n.value.location.permalink,api_version:"v2"};await g.fetchAllCourses(k).then(()=>{}).catch(D=>{B(C,D)})};return Z(f,()=>{o.filters.location&&f.value&&(n.value=Object.assign({},o.filters),n.value.hour||(n.value.hour="Tutti gli orari"),S())}),Z(o.filters,()=>{o.filters.location&&f.value&&n.value.location&&n.value.location!=o.filters.location&&(n.value=Object.assign({},o.filters),n.value.hour||(n.value.hour="Tutti gli orari"))}),Z(v,()=>{var k;e.value=Object.assign([],v.value),e.value&&((k=e.value[0])==null?void 0:k.id)!="-1"&&e.value.unshift({id:"-1",name:"Tutti i percorsi"}),n.value.course=e.value[0].name}),{form:n,courses:e,hours:l,locations:f,responseOrders:u,resetField:r}}},Xo={class:"formgrid grid px-0 align-items-center"},Yo={key:0,class:"field col-4 flex flex-column"},Zo=s("label",{for:"typology"},"Filtra per percorso",-1),en={key:1,class:"field col-3 flex flex-column"},tn=s("label",{for:"typology"},"Filtra per orario (dalle)",-1),on=s("div",{class:"col-12"},null,-1),nn={class:"field col-4 flex flex-column"},sn=s("label",{for:"typology"},"Filtra per acquirente",-1),ln={class:"flex col-12 justify-content-end pt-1"};function an(o,t,n,e,y,C){const l=w("Dropdown"),d=w("InputText"),g=w("Button"),f=w("AccordionTab"),u=w("Accordion");return h(),te(u,{activeIndex:0},{default:O(()=>[a(f,{header:"FILTRI"},{default:O(()=>[s("div",Xo,[e.form.location&&e.courses?(h(),p("div",Yo,[Zo,a(l,{modelValue:e.form.course,"onUpdate:modelValue":t[0]||(t[0]=v=>e.form.course=v),options:e.courses,optionLabel:"name",optionValue:"name",placeholder:""},null,8,["modelValue","options"])])):T("",!0),e.responseOrders?(h(),p("div",en,[tn,a(l,{modelValue:e.form.hour,"onUpdate:modelValue":t[1]||(t[1]=v=>e.form.hour=v),options:e.hours,placeholder:""},null,8,["modelValue","options"])])):T("",!0),on,s("div",nn,[sn,a(d,{modelValue:e.form.name,"onUpdate:modelValue":t[2]||(t[2]=v=>e.form.name=v),placeholder:""},null,8,["modelValue"])])]),s("div",ln,[a(g,{label:"Ricerca",class:"mr-2",onClick:t[3]||(t[3]=v=>o.$emit("onSubmit",e.form))}),a(g,{label:"Annulla",class:"p-button-outlined",onClick:t[4]||(t[4]=v=>e.resetField())})])]),_:1})]),_:1})}const rn=H(Qo,[["render",an]]),cn={props:["form","price","index","ticket"],setup(o,t){const n=x(0),e=function(){n.value++,C()},y=function(){n.value>0&&n.value--,C()},C=function(){n.value==null&&(n.value=0);const l={counter:n.value,price:o.price,index:o.index,ticket:o.ticket};t.emit("changeCounter",l)};return{counter:n,decrement:y,increment:e,emitEvent:C}}};const dn={class:"btn-plus-min flex align-items-center"},un={class:"counter"};function mn(o,t,n,e,y,C){const l=w("Button"),d=w("InputNumber");return h(),p("div",dn,[a(l,{icon:"pi pi-minus",rounded:"",outlined:"",severity:"secondary",onClick:e.decrement,disabled:e.counter===0},null,8,["onClick","disabled"]),s("div",un,[a(d,{modelValue:e.counter,"onUpdate:modelValue":[t[0]||(t[0]=g=>e.counter=g),t[1]||(t[1]=g=>e.emitEvent())],min:0},null,8,["modelValue"])]),a(l,{icon:"pi pi-plus",rounded:"",outlined:"",severity:"secondary",onClick:e.increment},null,8,["onClick"])])}const _n=H(cn,[["render",mn]]),fn={props:["tickets","form"],setup(o,t){J(()=>{y.value=!1,l.discount={},C.value=null,o.form.max_seats&&o.form.max_seats<0?(f.value=!0,u.value=-o.form.max_seats):f.value=!1});const n=x(0),e=x([]),y=x(!1),C=x(),l=K(),d=W(),g=x(!1),f=x(!1),u=x(),v=M(()=>l.getDiscount),r=function(F){e.value[F.index]={partial_total:F.price*F.counter,ticket:F.ticket,quantity:F.counter},n.value=0;let i=0;e.value.forEach(c=>{n.value+=c.partial_total,i+=c.quantity}),f.value||(o.form.max_seats&&i>+o.form.max_seats?(u.value=i-+o.form.max_seats,g.value=!0):(u.value=null,g.value=!1)),C.value&&k()},S=function(){k()},k=async function(){let F=[];e.value.forEach(c=>{F.push({id:c.ticket.id,quantity:c.quantity})});const i={discount_code:C.value,location_permalink:o.form.location_permalink,tickets:F};await l.cost(i).then(()=>{}).catch(c=>{B(d,c)})};return{total:n,partialTotals:e,showDiscount:y,discountCode:C,discount:v,showAlert:g,showAlert2:f,numOverbooking:u,onChangeCounter:r,applyDiscount:S,checkDisabled:function(){let F=!1;(!e.value||e.value.length==0)&&(F=!0);let i=0;return e.value.forEach(c=>{i+=c.quantity}),i==0&&(F=!0),t.emit("disableSecondoTab",!0),F},nextTab:function(){const F={discount_code:C.value,partial_total:e.value};t.emit("nextTab",F)}}},components:{PlusMinusButton:_n}};const vn={key:0},hn={key:1},pn={key:0},yn={key:1},gn={key:0,class:"flex justify-content-between align-items-center"},kn={class:"flex align-items-center col-9"},bn={class:"col-7 pl-0"},xn={class:"text-right col-2"},wn={class:"col-3 flex justify-content-end"},Cn={key:2,class:"mt-3 mb-5"},Dn=s("i",null,"Nessuna tipologia di biglietto trovata.",-1),Sn=[Dn],On=s("hr",{class:"mt-3"},null,-1),Vn={class:"flex align-items-center justify-content-between py-0"},Tn={class:"col-9 flex"},An=s("b",null,"Totale",-1),Mn=[An],Pn={class:"col-2 text-right font-bold"},Fn={class:"col-3 flex justify-content-end"};function Nn(o,t,n,e,y,C){const l=w("Message"),d=w("PlusMinusButton"),g=w("Button");return h(),p(Y,null,[e.showAlert?(h(),te(l,{key:0,severity:"warn",closable:!1},{default:O(()=>[U("Attenzione! Si sta andando in overbooking di "+b(e.numOverbooking)+" ",1),e.numOverbooking==1?(h(),p("span",vn,"posto")):(h(),p("span",hn,"posti"))]),_:1})):T("",!0),e.showAlert2?(h(),te(l,{key:1,severity:"warn",closable:!1},{default:O(()=>[U("Attenzione! Lo slot orario è già in overbooking di "+b(e.numOverbooking)+" ",1),e.numOverbooking==1?(h(),p("span",pn,"posto")):(h(),p("span",yn,"posti"))]),_:1})):T("",!0),(h(!0),p(Y,null,ue(n.tickets,(f,u)=>{var v,r,S;return h(),p("div",{key:f.id},[((v=f.course)==null?void 0:v.id)==((r=n.form.course)==null?void 0:r.id)?(h(),p("div",gn,[s("div",kn,[s("b",bn,b(f.name),1),s("div",xn,"€ "+b((S=f.price)==null?void 0:S.toFixed(2)),1)]),s("div",wn,[a(d,{onChangeCounter:t[0]||(t[0]=k=>e.onChangeCounter(k)),price:f.price,index:u,ticket:f},null,8,["price","index","ticket"])])])):T("",!0)])}),128)),n.tickets&&n.tickets.length==0?(h(),p("div",Cn,Sn)):T("",!0),On,s("div",Vn,[s("div",Tn,[s("div",{class:G(["pl-0",e.discount&&e.discount.total_amount?"col-2":"col-7"])},Mn,2),s("div",Pn,"€ "+b(e.total.toFixed(2)),1)]),s("div",Fn,[a(g,{label:"Prosegui",onClick:t[1]||(t[1]=f=>e.nextTab()),disabled:e.checkDisabled()},null,8,["disabled"])])])],64)}const Ln=H(fn,[["render",Nn]]);class Un{static async fetchAll(){return(await we("/countries")).data.countries}}const Bn=_e({id:"country",state:()=>({country:{},countries:[]}),getters:{allCountries:o=>o.countries},actions:{async fetchAllCountries(){await Un.fetchAll().then(o=>this.countries=o)}}});class jn{static async fetchAll(){return(await we("/provinces")).data.provinces}}const En=_e({id:"province",state:()=>({province:{},provinces:[]}),getters:{allProvinces:o=>o.provinces,getCurrentProvince:o=>o.province},actions:{async fetchAllProvinces(){await jn.fetchAll().then(o=>this.provinces=o)}}}),In={computed:{Code(){return Code}},props:["location_permalink"],setup(o,t){J(()=>{D(),j()});const n=fe(),e=Bn(),y=K(),C=En(),l=x({}),d=x(),g=x(),f=M(()=>e.allCountries),u=M(()=>n.allOpenTickets),v=M(()=>y.paymentStatus),r=M(()=>y.paymentModeList),S=M(()=>C.allProvinces),k=M(()=>{const m=y.getPaymentMethods;return Object.entries(m).map(([N,L])=>({id:N,label:L}))}),D=async function(){await e.fetchAllCountries().then(()=>{l.value.country_id=88,l.value.status={id:"payed",name:"Pagato"}})},j=async function(){await C.fetchAllProvinces()};return{form:l,countries:f,paymentList:v,paymentModeList:r,errorMessage:d,errorMessageVoucher:g,open_tickets:u,provinces:S,dynamicPaymentMethods:k,fetchAllOpenTickets:async function(m){const N={code:m.query.toUpperCase(),location_permalink:o.location_permalink};await n.fetchAllOpenTickets(N)},onChangeStatus:function(){l.value.status.id&&(l.value.status.id=="free"||l.value.status.id=="to_pay")&&(l.value.payment_method=null)},onConfirm:function(){if(l.value.status&&l.value.status.id=="payed"){if(!l.value.payment_method){d.value="Seleziona un metodo di pagamento";return}if(l.value.open_ticket_codes){for(const m of l.value.open_ticket_codes)if(m.expired){g.value="Uno o più codici biglietto risultano scaduti";return}}}t.emit("nextTab",l.value)}}}},Rn={key:0,class:"formgrid grid"},zn={class:"field col-6"},qn=s("label",{for:"user_name"},"Nome",-1),Hn={class:"field col-6"},Jn=s("label",{for:"user_surname"},"Cognome",-1),$n={class:"field col-6"},Wn=s("label",{for:"user_email"},"Email",-1),Gn={class:"field col-6"},Kn=s("label",{for:"user_phone"},"Telefono",-1),Qn={class:"field col-6"},Xn=s("label",{for:"country_id"},"Nazione",-1),Yn={class:"field col-6"},Zn=s("label",{for:"province"},"Provincia",-1),es={class:"field col-6"},ts=s("label",{for:"status"},"Stato pagamento",-1),os={class:"field col-6"},ns={for:"payment_method"},ss={key:0},ls={class:"p-float-label"},as={class:"p-error",id:"dd-error"},is={key:0,class:"field col-6 flex flex-column"},rs=s("label",{for:"user_zip"},"Codice biglietto",-1),cs={key:0,class:"pi pi-exclamation-triangle",style:{color:"#ff6767"}},ds={class:"p-error",id:"dd-error"},us={class:"field col-12"},ms={class:"field flex flex-column"},_s=s("label",{for:"notes"},"Note",-1),fs={class:"col-12 flex justify-content-end"};function vs(o,t,n,e,y,C){const l=w("InputText"),d=w("Dropdown"),g=w("AutoComplete"),f=w("Textarea"),u=w("Button"),v=pe("tooltip");return e.form?(h(),p("div",Rn,[s("div",zn,[qn,a(l,{type:"text",modelValue:e.form.user_name,"onUpdate:modelValue":t[0]||(t[0]=r=>e.form.user_name=r),class:"w-full"},null,8,["modelValue"])]),s("div",Hn,[Jn,a(l,{type:"text",modelValue:e.form.user_surname,"onUpdate:modelValue":t[1]||(t[1]=r=>e.form.user_surname=r),class:"w-full"},null,8,["modelValue"])]),s("div",$n,[Wn,a(l,{type:"text",modelValue:e.form.user_email,"onUpdate:modelValue":t[2]||(t[2]=r=>e.form.user_email=r),class:"w-full"},null,8,["modelValue"])]),s("div",Gn,[Kn,a(l,{type:"text",modelValue:e.form.user_phone,"onUpdate:modelValue":t[3]||(t[3]=r=>e.form.user_phone=r),class:"w-full"},null,8,["modelValue"])]),s("div",Qn,[Xn,a(d,{modelValue:e.form.country_id,"onUpdate:modelValue":t[4]||(t[4]=r=>e.form.country_id=r),options:e.countries,optionLabel:"name",optionValue:"id",class:"w-full"},null,8,["modelValue","options"])]),s("div",Yn,[Zn,a(d,{modelValue:e.form.user_zip,"onUpdate:modelValue":t[5]||(t[5]=r=>e.form.user_zip=r),options:e.provinces,optionLabel:"name",optionValue:"name",class:"w-full"},null,8,["modelValue","options"])]),s("div",es,[ts,a(d,{modelValue:e.form.status,"onUpdate:modelValue":t[6]||(t[6]=r=>e.form.status=r),options:e.paymentList,optionLabel:"name",class:"w-full",onChange:t[7]||(t[7]=r=>e.onChangeStatus())},null,8,["modelValue","options"])]),s("div",os,[s("label",ns,[U("Modalità pagamento"),e.form.status&&e.form.status.id=="payed"?(h(),p("span",ss,"*")):T("",!0)]),s("span",ls,[a(d,{modelValue:e.form.payment_method,"onUpdate:modelValue":t[8]||(t[8]=r=>e.form.payment_method=r),options:e.dynamicPaymentMethods,optionLabel:"label",class:G(["w-full",{"p-invalid":e.errorMessage}]),disabled:e.form.status&&e.form.status.id!="payed",onChange:t[9]||(t[9]=r=>e.errorMessage=null)},null,8,["modelValue","options","disabled","class"])]),s("small",as,b(e.errorMessage||" "),1)]),e.form.payment_method&&e.form.payment_method.id=="voucher"?(h(),p("div",is,[rs,a(g,{modelValue:e.form.open_ticket_codes,"onUpdate:modelValue":t[10]||(t[10]=r=>e.form.open_ticket_codes=r),suggestions:e.open_tickets,class:G(["uppercase w-full",{"p-invalid":e.errorMessageVoucher}]),onComplete:t[11]||(t[11]=r=>e.fetchAllOpenTickets(r)),emptySearchMessage:"Nessun risultato",emptySelectionMessage:"Nessun risultato",optionLabel:"code",optionValue:"code",multiple:"",onChange:t[12]||(t[12]=r=>e.errorMessageVoucher=null)},{option:O(({option:r})=>[s("span",{class:"flex flex-row justify-content-between",style:xe({color:r.expired?"#ff6767":null})},[U(b(r.code)+" ",1),r.expired?oe((h(),p("i",cs,null,512)),[[v,"Scaduto"]]):T("",!0)],4)]),_:1},8,["modelValue","suggestions","class"]),s("small",ds,b(e.errorMessageVoucher||" "),1)])):T("",!0),s("div",us,[s("div",ms,[_s,a(f,{modelValue:e.form.notes,"onUpdate:modelValue":t[13]||(t[13]=r=>e.form.notes=r),rows:"5",cols:"30"},null,8,["modelValue"])])]),s("div",fs,[a(u,{label:"Conferma",onClick:t[14]||(t[14]=r=>e.onConfirm())})])])):T("",!0)}const hs=H(In,[["render",vs]]);var ps=`
@layer primevue {
    .p-contextmenu ul {
        margin: 0;
        padding: 0;
        list-style: none;
    }

    .p-contextmenu .p-submenu-list {
        position: absolute;
        min-width: 100%;
        z-index: 1;
    }

    .p-contextmenu .p-menuitem-link {
        cursor: pointer;
        display: flex;
        align-items: center;
        text-decoration: none;
        overflow: hidden;
        position: relative;
    }

    .p-contextmenu .p-menuitem-text {
        line-height: 1;
    }

    .p-contextmenu .p-menuitem {
        position: relative;
    }

    .p-contextmenu .p-menuitem-link .p-submenu-icon {
        margin-left: auto;
    }

    .p-contextmenu-enter-from {
        opacity: 0;
    }

    .p-contextmenu-enter-active {
        transition: opacity 250ms;
    }
}
`,ys={root:function(t){var n=t.instance;return["p-contextmenu p-component",{"p-input-filled":n.$primevue.config.inputStyle==="filled","p-ripple-disabled":n.$primevue.config.ripple===!1}]},menu:"p-contextmenu-root-list",menuitem:function(t){var n=t.instance,e=t.processedItem;return["p-menuitem",{"p-menuitem-active p-highlight":n.isItemActive(e),"p-focus":n.isItemFocused(e),"p-disabled":n.isItemDisabled(e)}]},content:"p-menuitem-content",action:function(t){var n=t.props,e=t.isActive,y=t.isExactActive;return["p-menuitem-link",{"router-link-active":e,"router-link-active-exact":n.exact&&y}]},icon:"p-menuitem-icon",label:"p-menuitem-text",submenuIcon:"p-submenu-icon",submenu:"p-submenu-list",separator:"p-menuitem-separator"};Ke.extend({name:"contextmenu",css:ps,classes:ys});const gs={props:["form"],setup(o,t){J(()=>{D()});const n=x(0),e=x([]),y=x(!1),C=x(!0),l=x(),d=x([]),{showLoader:g,hideLoader:f}=se(),u=fe(),v=K(),r=W(),S=M(()=>u.allTickets),k=M(()=>v.getCurrentOrder),D=async function(){const A={location_permalink:o.form.location_permalink,api_version:"v2",date:F(o.form.date),course_id:o.form.course.id};await u.fetchAllTickets(A).then(()=>{}).catch(I=>{B(r,I)})},j=function(A){n.value+=1,l.value=A.discount_code,e.value=Object.assign([],A.partial_total),C.value=!1},F=function(A){return me(A).includes("Invalid")?De(A):me(A)},i=function(A){c(A)},c=async function(A){var ie,re,ce;const I=[{start_at:o.form.hour,tickets:[]}];e.value.forEach(q=>{q.quantity!=0&&I[0].tickets.push({id:q.ticket.id,quantity:q.quantity})});let R=[];A.open_ticket_codes&&A.open_ticket_codes.forEach(q=>{R.push(q.code)});const ae={location_permalink:o.form.location_permalink,country_id:A.country_id,status:A.status.id,user_email:A.user_email,user_name:A.user_name,user_phone:A.user_phone,user_surname:A.user_surname,user_zip:A.user_zip,api_version:"v2",date:o.form.date?F(o.form.date):"",notes:A.notes,time_slots:I,payment_method:(ie=A.payment_method)==null?void 0:ie.id,course_id:(ce=(re=o.form)==null?void 0:re.course)==null?void 0:ce.id,open_ticket_codes:R};l.value&&(ae.discount_code=l.value),await v.createOrder(ae).then(()=>{n.value+=1,C.value=!0,y.value=!0}).catch(q=>{B(r,q)})},m=function(){he(k==null?void 0:k.value,o.form.location_permalink,r),t.emit("closeDialog",!0)},N=function(A){C.value=A},L=function(){he(k==null?void 0:k.value,o.form.location_permalink,r),Q()},Q=async function(){let A=[];if(!k.value&&!o.form.location_permalink)return;for(let R of k.value.tickets)A.push(R.order_item_id);const I={check_in:!0,order_item_ids:A,location_permalink:o.form.location_permalink};await v.checkInOrder(I).then(()=>{X(r,{message:"Check-in registrato correttamente",error:!1}),t.emit("closeDialog",!0)}).catch(R=>{B(r,R)})},le=function(){g();const A={location_permalink:o.form.location_permalink,order_id:k.value.id};v.sendEmail(A).then(()=>{X(r,{message:"Email inviata correttamente al cliente",error:!1}),f(),t.emit("closeDialog",!0)}).catch(I=>{f(),B(r,I)})};return Z(k,()=>{d.value=[],k.value.tickets.forEach(A=>{const I=d.value.find(R=>R.ticket_name===A.ticket_name);if(!I)A.quantity=1,d.value.push(A);else{let R=d.value.indexOf(I);d.value[R].quantity+=1}})}),{tickets:S,active:n,partialTotals:e,showOrderDetail:y,currentOrder:k,tmp_tickets:d,showSecondTab:C,formatExplicitDate:Ce,formatDate:ye,onNextTab:j,onConfirmPayment:i,printPDF:Oe,onPrintPDF:m,onDisableSecondoTab:N,printAndCheckIn:L,sendEmail:le}},components:{NewOrderTicketTab:Ln,NewOrderFormTab:hs}};const ks={key:0,class:"info-box"},bs={class:"font-medium"},xs=s("i",{class:"pi pi-map-marker mr-3 font-medium"},null,-1),ws={class:"font-medium"},Cs=s("i",{class:"pi pi-calendar mr-3 font-medium"},null,-1),Ds={key:0,class:"capitalize"},Ss={key:0,class:"flex pb-4"},Os=s("i",{class:"pi pi-ticket mr-3 font-medium mt-1"},null,-1),Vs={class:"flex flex-column"},Ts={key:0,class:"pb-1 pr-1"},As={key:1,class:"pb-1"},Ms={class:"py-5"},Ps={class:"m-0 text-center line-height-3"},Fs=s("br",null,null,-1),Ns={key:0,class:"col-offset-3 col-6 flex justify-content-center flex-column align-items-center mt-4 order-summary"},Ls=s("p",{class:"my-2"},[s("b",null,"Riepilogo ordine:")],-1),Us={class:"flex flex-column col-12"},Bs={key:0,class:"pb-1",style:{"min-width":"8rem"}},js={key:1,class:"pb-1"},Es={key:2},Is={class:"flex flex-column col-12"},Rs={key:0,class:"p-0 m-0 font-medium flex justify-content-between"},zs=s("span",{class:"pb-1 pr-1"},"Totale ordine ",-1),qs={class:"pb-1"},Hs={class:"flex align-items-center justify-content-center mt-4"};function Js(o,t,n,e,y,C){var v,r;const l=w("NewOrderTicketTab"),d=w("TabPanel"),g=w("NewOrderFormTab"),f=w("Button"),u=w("TabView");return h(),p(Y,null,[n.form?(h(),p("div",ks,[s("p",bs,[xs,U(b((v=n.form.course)==null?void 0:v.name),1)]),s("p",ws,[Cs,n.form.date?(h(),p("span",Ds,b(e.formatDate((r=n.form)==null?void 0:r.date)),1)):T("",!0),U(" - "+b(n.form.hour),1)]),e.partialTotals&&e.partialTotals.length>0?(h(),p("div",Ss,[Os,s("div",Vs,[(h(!0),p(Y,null,ue(e.partialTotals,S=>{var k;return h(),p("p",{class:"p-0 m-0 font-medium flex justify-content-between",key:S},[S&&S.quantity!=0?(h(),p("span",Ts,b((k=S.ticket)==null?void 0:k.name),1)):T("",!0),S&&S.quantity!=0?(h(),p("span",As," x "+b(S.quantity)+" "+b(S.price),1)):T("",!0)])}),128))])])):T("",!0)])):T("",!0),a(u,{activeIndex:e.active,"onUpdate:activeIndex":t[6]||(t[6]=S=>e.active=S)},{default:O(()=>[a(d,{header:"Seleziona i biglietti",disabled:e.showOrderDetail},{default:O(()=>[a(l,{tickets:e.tickets,form:n.form,onNextTab:t[0]||(t[0]=S=>e.onNextTab(S)),onDisableSecondoTab:t[1]||(t[1]=S=>e.onDisableSecondoTab(S))},null,8,["tickets","form"])]),_:1},8,["disabled"]),a(d,{header:"Inserisci i dati",disabled:e.showSecondTab},{default:O(()=>[a(g,{onNextTab:t[2]||(t[2]=S=>e.onConfirmPayment(S)),location_permalink:n.form.location_permalink},null,8,["location_permalink"])]),_:1},8,["disabled"]),e.showOrderDetail?(h(),te(d,{key:0,header:"Ordine completato"},{default:O(()=>{var S,k;return[s("div",Ms,[s("div",Ps,[U(" Ordine "),s("b",null,b(e.currentOrder.reservation_number),1),U(" registrato correttamente!"),Fs]),e.currentOrder?(h(),p("div",Ns,[Ls,s("div",Us,[(h(!0),p(Y,null,ue(e.tmp_tickets,D=>(h(),p("p",{class:"p-0 m-0 font-medium flex justify-content-between flex-1",key:D},[D&&D.quantity!=0?(h(),p("span",Bs,b(D.ticket_name),1)):T("",!0),D&&D.quantity!=0?(h(),p("span",js," x "+b(D.quantity),1)):T("",!0),D.ticket_price?(h(),p("span",Es," € "+b((+D.ticket_price).toFixed(2)),1)):T("",!0)]))),128))]),s("div",Is,[e.currentOrder.total?(h(),p("p",Rs,[zs,s("span",qs,[s("b",null,"€ "+b((+((S=e.currentOrder)==null?void 0:S.total)).toFixed(2)),1)])])):T("",!0)])])):T("",!0),s("div",Hs,[a(f,{icon:"pi pi-envelope",class:"mr-3",rounted:"",outlined:"",label:"Invia biglietti",onClick:t[3]||(t[3]=D=>e.sendEmail()),disable:!((k=e.currentOrder)!=null&&k.user_email)},null,8,["disable"]),a(f,{icon:"pi pi-print",onClick:t[4]||(t[4]=D=>e.onPrintPDF()),class:"mr-3",rounted:"",outlined:"",label:"Stampa"}),a(f,{icon:"pi print-check-icon",onClick:t[5]||(t[5]=D=>e.printAndCheckIn()),class:"mr-3",rounted:"",outlined:"",label:"Stampa e Check-in"})])])]}),_:1})):T("",!0)]),_:1},8,["activeIndex"])],64)}const $s=H(gs,[["render",Js]]),Ws={props:["filters","date"],setup(o,t){J(()=>{C.value=Ve(8,20),n.value=Object.assign({},o.filters)});const n=x({}),e=Te(),y=W(),C=x(),l=x(!1),d=ge(),g=x(!1),f=M(()=>e.allCourses),u=M(()=>d.showNewOrderDialog),v=async function(){const D={location_permalink:o.filters.location_permalink,api_version:"v2"};await e.fetchAllCourses(D).catch(j=>{B(y,j)})},r=function(){d.setNewOrderDialogVisibility(!1),n.value.hour="",n.value.course=null,t.emit("onCloseDialog")},S=function(D){n.value.date=o.date,d.setNewOrderDialogVisibility(D)},k=function(){g.value=n.value.open_ticket};return Z(o.filters,()=>{if(v(),n.value=Object.assign({},o.filters),o.filters.course&&!o.filters.course.id){let D=f.value.find(j=>j.name===o.filters.course.name);D&&(n.value.course=D)}}),{courses:f,form:n,hours:C,disableForm:g,visible:l,onCloseDialog:r,updateDialog:S,onChecked:k,dialogVisible:u,dialogStore:d}},components:{NewOrderDialog:$s}},Gs=s("h2",{class:"mt-1"},"Nuova prenotazione",-1),Ks={class:"formgrid grid px-0 align-items-center mt-4"},Qs={key:0,class:"field flex flex-column w-full col-12"},Xs=s("label",{for:"typology"},"Scegli il percorso",-1),Ys={key:1,class:"field flex flex-column w-full col-12"},Zs=s("label",{for:"typology"},"Seleziona l'orario",-1),el={class:"flex justify-content-end align-items-center mt-2"},tl={class:"flex align-items-center justify-content-between w-full"},ol=s("h2",null,"Nuova prenotazione",-1);function nl(o,t,n,e,y,C){const l=w("Dropdown"),d=w("Button"),g=w("NewOrderDialog"),f=w("Dialog"),u=w("Card");return h(),te(u,{class:"mt-4"},{content:O(()=>[Gs,s("div",Ks,[n.filters.location_permalink?(h(),p("div",Qs,[Xs,a(l,{modelValue:e.form.course,"onUpdate:modelValue":t[0]||(t[0]=v=>e.form.course=v),options:e.courses,optionLabel:"name",disabled:e.disableForm,placeholder:""},null,8,["modelValue","options","disabled"])])):T("",!0),n.filters.location_permalink?(h(),p("div",Ys,[Zs,a(l,{modelValue:e.form.hour,"onUpdate:modelValue":t[1]||(t[1]=v=>e.form.hour=v),options:e.hours,disabled:e.disableForm,placeholder:""},null,8,["modelValue","options","disabled"])])):T("",!0)]),s("div",el,[a(d,{label:"Prenota",disabled:!e.form.course||!e.form.hour,onClick:t[2]||(t[2]=v=>e.updateDialog(!0))},null,8,["disabled"])]),a(f,{visible:e.dialogVisible,"onUpdate:visible":t[5]||(t[5]=v=>e.dialogVisible=v),modal:"",header:"Nuova prenotazione",style:{width:"60rem"},breakpoints:{"1199px":"75vw","575px":"90vw"},closable:!1,onHide:t[6]||(t[6]=v=>e.onCloseDialog())},{header:O(()=>[s("div",tl,[ol,a(d,{icon:"pi pi-times",text:"",rounded:"",onClick:t[3]||(t[3]=v=>e.updateDialog(!1))})])]),default:O(()=>[a(g,{form:e.form,onCloseDialog:t[4]||(t[4]=v=>e.onCloseDialog())},null,8,["form"])]),_:1},8,["visible"])]),_:1})}const sl=H(Ws,[["render",nl]]),ll={props:["location_permalink"],setup(o,t){J(()=>{e.value.start_date=ee.local().startOf("day").toFormat("dd/MM/yyyy"),e.value.end_date=ee.local().endOf("day").toFormat("dd/MM/yyyy"),e.value.created_at="false",e.value.start_hour="00:00",e.value.end_hour="23:59"});const n=W(),e=x({}),y=ne(),{showLoader:C,hideLoader:l}=se(),d=function(){let u=ke(e.value.start_date)+" "+e.value.start_hour,v=ke(e.value.end_date)+" "+e.value.end_hour;const r={from:u,to:v,location_permalink:o.location_permalink,created_at:"false"};g(r)},g=async function(u){C(),await y.downloadReport(u).then(()=>{l(),t.emit("onSubmit")}).catch(v=>{l(),B(n,v)})};return{form:e,onSubmit:d,setDefaultIfBlank:function(){(!e.value.start_hour||e.value.start_hour=="")&&(e.value.start_hour="00:00"),(!e.value.end_hour||e.value.end_hour=="")&&(e.value.end_hour="23:59")}}},components:{Form:tt}},al={class:"formgrid grid mt-3"},il={class:"field col-6 flex flex-column"},rl=s("label",{from:"start_date"},"Dal",-1),cl=s("label",{from:"start_hour",class:"mt-3"},"Dalle",-1),dl={class:"field col-6 flex flex-column"},ul=s("label",{from:"end_date"},"Al",-1),ml=s("label",{from:"end_hour",class:"mt-3"},"Alle",-1),_l={class:"flex align-items-center justify-content-end mt-6"};function fl(o,t,n,e,y,C){const l=w("Calendar"),d=w("InputMask"),g=w("Button"),f=w("Form");return h(),te(f,{onSubmit:e.onSubmit},{default:O(()=>[s("div",al,[s("div",il,[rl,a(l,{inputId:"start_date",modelValue:e.form.start_date,"onUpdate:modelValue":t[0]||(t[0]=u=>e.form.start_date=u),dateFormat:"dd/mm/yy",manualInput:!0},null,8,["modelValue"]),cl,a(d,{id:"start_hour",modelValue:e.form.start_hour,"onUpdate:modelValue":t[1]||(t[1]=u=>e.form.start_hour=u),mask:"99:99",placeholder:"HH:mm",onBlur:t[2]||(t[2]=u=>e.setDefaultIfBlank())},null,8,["modelValue"])]),s("div",dl,[ul,a(l,{inputId:"end_date",modelValue:e.form.end_date,"onUpdate:modelValue":t[3]||(t[3]=u=>e.form.end_date=u),dateFormat:"dd/mm/yy",manualInput:!0},null,8,["modelValue"]),ml,a(d,{id:"end_hour",modelValue:e.form.end_hour,"onUpdate:modelValue":t[4]||(t[4]=u=>e.form.end_hour=u),mask:"99:99",placeholder:"HH:mm",onBlur:t[5]||(t[5]=u=>e.setDefaultIfBlank())},null,8,["modelValue"])])]),s("div",_l,[a(g,{label:"Annulla",text:"",onClick:t[6]||(t[6]=u=>o.$emit("onSubmit"))}),a(g,{label:"Scarica",type:"submit"})])]),_:1},8,["onSubmit"])}const vl=H(ll,[["render",fl]]),hl={setup(){const o=x({}),t=x({}),n=x(),e=x(!1),y=K(),C=Qe(),l=ne(),d=W(),g=ge(),f=M(()=>C.currentUser),u=M(()=>l.allLocations),v=M(()=>l.getCurrentLocation),r=M(()=>y.getPaymentMethods);J(()=>{v.value&&(o.value.location=v.value,t.value.location_permalink=v.value.permalink),k().then(()=>{S()})});const S=async function(){var L;let m={};const N=((L=v==null?void 0:v.value)==null?void 0:L.permalink)??null;N?m.location_permalink=N:m.location_permalink=u.value[0].permalink,await y.fetchPaymentMethods(m).then(()=>{}).catch(Q=>{B(d,Q)})},k=async function(){await l.fetchAllLocations().then(()=>{v.value||(o.value.location=u.value[0],t.value.location_permalink=u.value[0].permalink,l.updateCurrenLocation(u.value[0]))}).catch(m=>{B(d,m)})};return{filters:o,orderTable:n,order_filters:t,visibleDialog:e,user:f,locations:u,newPaymentMethods:r,fetchAllLocations:k,formatDate:ye,onUpdateFilters:function(m){m.course?o.value.course={id:m.course}:o.value.course="",m.name?o.value.name=m.name:o.value.name="",m.hour&&(m.hour.start_at?o.value.hour=m.hour.start_at:o.value.hour=m.hour)},onUpdateNewOrderFilters:function(m){m.start_at&&(t.value.hour=m.start_at),m.course_name&&(t.value.course={name:m.course_name}),m.date&&(t.value.date=m.date),m.hour&&(t.value.hour=m.hour),m.max_seats?t.value.max_seats=m.max_seats:t.value.max_seats=null,g.setNewOrderDialogVisibility(!0)},onCloseDialog:function(){n.value.loadLazyData()},onChangeLocation:function(){t.value.location_permalink=o.value.location.permalink,l.updateCurrenLocation(o.value.location)},onCloseReportDialog:function(){e.value=!1}}},components:{CalendarFilter:Go,OrderTable:qo,OrderFilter:rn,NewOrderCard:sl,SalesReportsDialog:vl}};const pl={class:"flex justify-content-between align-items-center"},yl={class:"field flex flex-column mt-3"},gl={class:"text-xl font-medium pl-3 py-0"},kl={key:0,style:{color:"#495057"},class:"flex flex-column align-items-end"},bl=s("i",{class:"pi pi-calendar mr-2 text-xl"},null,-1),xl={class:"capitalize text-xl"},wl={class:"flex gap-4"},Cl={key:0,class:"col-3 mt-3"},Dl={class:"col-9 mt-3"};function Sl(o,t,n,e,y,C){var S,k;const l=w("Button"),d=w("SalesReportsDialog"),g=w("Dialog"),f=w("CalendarFilter"),u=w("NewOrderCard"),v=w("OrderFilter"),r=w("OrderTable");return h(),p("div",null,[s("div",pl,[s("div",yl,[s("p",gl,b((k=(S=e.filters)==null?void 0:S.location)==null?void 0:k.name),1)]),e.filters&&e.filters.date?(h(),p("div",kl,[s("div",null,[bl,s("span",xl,b(e.formatDate(e.filters.date)),1)]),a(l,{label:"Report visite",link:"",class:"m-0 p-0",onClick:t[0]||(t[0]=D=>e.visibleDialog=!0),icon:"pi pi-download"}),a(g,{visible:e.visibleDialog,"onUpdate:visible":t[2]||(t[2]=D=>e.visibleDialog=D),modal:"",header:"Report visite",style:{width:"35rem"}},{default:O(()=>[a(d,{onOnSubmit:t[1]||(t[1]=D=>e.onCloseReportDialog()),location_permalink:e.filters.location.permalink},null,8,["location_permalink"])]),_:1},8,["visible"])])):T("",!0)]),s("div",wl,[e.filters.location?(h(),p("div",Cl,[a(f,{filters:e.filters},null,8,["filters"]),a(u,{date:e.filters.date,filters:e.order_filters,onOnCloseDialog:t[3]||(t[3]=D=>e.onCloseDialog())},null,8,["date","filters"])])):T("",!0),s("div",Dl,[a(v,{filters:e.filters,onOnSubmit:t[4]||(t[4]=D=>e.onUpdateFilters(D))},null,8,["filters"]),e.filters.date?(h(),te(r,{key:0,filters:e.filters,ref:"orderTable",class:"mt-4",onUpdateFilters:t[5]||(t[5]=D=>e.onUpdateNewOrderFilters(D))},null,8,["filters"])):T("",!0)])])])}const Ml=H(hl,[["render",Sl]]);export{Ml as default};
