import{k as ve,l as _e,o as J,m as b,a as K,c as M,_ as H,r as x,p as pe,b as h,e as y,g as l,f as a,n as G,t as w,w as D,q as T,F as Y,h as U,s as oe,v as xe,x as ue,y as Ge,i as Z,z as te,A as we,B as Qe,u as $e}from"../index25124.js";import{u as Q,a as ne,f as Ce,b as ye,c as Xe,d as Ye,e as ge,g as me,h as De,i as Ze,D as ee,j as ke}from"./location25124.js";import{u as le,s as X,e as B,p as Se,a as et,b as Ve,c as he,d as Oe}from"./helpers25124.js";import{F as tt}from"./vee-validate.esm25124.js";class be{static async fetchAll(t){const n=t.location_permalink;return delete t.location_permalink,(await ve(`/ticket_office/${n}/search/tickets`,t)).data}static async fetchAllOpenTickets(t){const n=t.location_permalink;return delete t.location_permalink,(await ve(`/ticket_office/${n}/orders/search_codes`,t)).data}}const fe=_e({id:"ticket",state:()=>({ticket:{},tickets:[],response_tickets:{},open_tickets_codes:{}}),getters:{allTickets:o=>o.response_tickets.available_ticket_types,allOpenTickets:o=>o.open_tickets_codes.open_tickets,responseTickets:o=>o.response_tickets,getTotalTickets:o=>o.response_tickets?o.response_tickets.total:0,getCurrentTicket:o=>o.ticket},actions:{async fetchAllTickets(o){await be.fetchAll(o).then(t=>this.response_tickets=t)},async fetchAllOpenTickets(o){await be.fetchAllOpenTickets(o).then(t=>this.open_tickets_codes=t)}}}),ot={computed:{Code(){return Code}},props:["location_permalink","time_slot"],setup(o,t){J(()=>{n.value=Object.assign({},o.time_slot)});const n=b({}),e=fe(),g=Q(),{showLoader:C,hideLoader:s}=le(),d=K(),k=b(),f=b(),u=M(()=>e.allOpenTickets),v=M(()=>g.paymentStatus),r=M(()=>g.paymentModeList),S=M(()=>{const c=g.getPaymentMethods;return Object.entries(c).map(([m,N])=>({id:m,label:N}))}),p=M(()=>g.getCurrentOrder),V=async function(c){const m={code:c.query.toUpperCase(),location_permalink:o.location_permalink};await e.fetchAllOpenTickets(m)},j=async function(){var m,N;const c={id:o.location_permalink,order_id:n.value.id,status:(m=n.value)==null?void 0:m.status,payment_method:n.value.payment_method,open_ticket_codes:[],api_version:"v2",notes:(N=n.value)==null?void 0:N.notes};if(n.value.status&&n.value.status=="payed"&&!n.value.payment_method){k.value="Seleziona un metodo di pagamento";return}for(const L of n.value.open_tickets_used)if(L.expired){f.value="Uno o più codici biglietto risultano scaduti";return}if(n.value.open_tickets_used&&n.value.open_tickets_used.length>0){let L=[];n.value.open_tickets_used.forEach($=>{L.push($.code)}),c.open_ticket_codes=L}F(c)},F=async function(c){C(),await g.updateOrder(c).then(()=>{s(),X(d,{message:"Stato aggiornato correttamente",error:!1}),t.emit("closeDialog",p.value)}).catch(m=>{s(),B(d,m)})};return{form:n,open_tickets:u,paymentList:v,paymentModeList:r,changeStatus:j,errorMessage:k,errorMessageVoucher:f,dynamicPaymentMethods:S,fetchAllOpenTickets:V,onChangeStatus:function(){(n.value.status=="free"||n.value.status=="to_pay")&&(n.value.payment_method=null)}}}},nt={key:0,class:"formgrid grid flex-column mt-3"},lt={class:"field col-12"},st=l("label",{for:"status"},"Stato pagamento",-1),at={class:"field col-12"},it=l("label",{for:"payment_method"},"Modalità pagamento",-1),rt={class:"p-error",id:"dd-error"},ct={key:0,class:"field col-12 flex flex-column"},dt=l("label",{for:"user_zip"},"Codice biglietto",-1),ut={key:0,class:"pi pi-exclamation-triangle",style:{color:"#ff6767"}},mt={class:"p-error",id:"dd-error"},_t={class:"flex align-items-center justify-content-end mt-3"};function ft(o,t,n,e,g,C){const s=x("Dropdown"),d=x("AutoComplete"),k=x("Button"),f=pe("tooltip");return h(),y(Y,null,[e.form?(h(),y("div",nt,[l("div",lt,[st,a(s,{modelValue:e.form.status,"onUpdate:modelValue":t[0]||(t[0]=u=>e.form.status=u),options:e.paymentList,optionLabel:"name",optionValue:"id",class:"w-full",onChange:t[1]||(t[1]=u=>e.onChangeStatus())},null,8,["modelValue","options"])]),l("div",at,[it,a(s,{modelValue:e.form.payment_method,"onUpdate:modelValue":t[2]||(t[2]=u=>e.form.payment_method=u),options:e.dynamicPaymentMethods,optionLabel:"label",optionValue:"id",class:G(["w-full",{"p-invalid":e.errorMessage}]),disabled:e.form.status!="payed",onChange:t[3]||(t[3]=u=>e.errorMessage=null)},null,8,["modelValue","options","disabled","class"]),l("small",rt,w(e.errorMessage||" "),1)]),e.form.payment_method=="voucher"&&e.form.status=="payed"?(h(),y("div",ct,[dt,a(d,{modelValue:e.form.open_tickets_used,"onUpdate:modelValue":t[4]||(t[4]=u=>e.form.open_tickets_used=u),suggestions:e.open_tickets,class:G(["uppercase w-full",{"p-invalid":e.errorMessageVoucher}]),onComplete:t[5]||(t[5]=u=>e.fetchAllOpenTickets(u)),emptySearchMessage:"Nessun risultato",emptySelectionMessage:"Nessun risultato",optionLabel:"code",optionValue:"code",multiple:"",onChange:t[6]||(t[6]=u=>e.errorMessageVoucher=null)},{option:D(({option:u})=>[l("span",{class:"flex flex-row justify-content-between",style:xe({color:u.expired?"#ff6767":null})},[U(w(u.code)+" ",1),u.expired?oe((h(),y("i",ut,null,512)),[[f,"Scaduto"]]):T("",!0)],4)]),_:1},8,["modelValue","suggestions","class"]),l("small",mt,w(e.errorMessageVoucher||" "),1)])):T("",!0)])):T("",!0),l("div",_t,[a(k,{label:"Annulla",text:"",onClick:t[7]||(t[7]=u=>o.$emit("closeDialog",null))}),a(k,{label:"Conferma",onClick:t[8]||(t[8]=u=>e.changeStatus())})])],64)}const vt=H(ot,[["render",ft]]),ht={props:["order"],setup(o){J(()=>{r.value&&v.value&&r.value.forEach(p=>{p.permalink===v.value&&(C.value=p.name)})});const t=b(0),n=b([]),e=b(!1),g=b(!0),C=b(),s=fe(),d=Q();K();const k=ne(),f=M(()=>s.allTickets),u=M(()=>d.getCurrentOrder),v=M(()=>k.getCurrentLocation),r=M(()=>k.allLocations),S=M(()=>{const p=o.order.payment_method,V=d.getPaymentMethods;return p?V[p]:"-"});return{tickets:f,active:t,partialTotals:n,showOrderDetail:e,currentOrder:u,showSecondTab:g,currentLocation:v,selectedLocation:C,formatExplicitDate:Ce,formatDate:ye,prettyPaymentStatus:Se,formatPrettyDate:Xe,formatDataAndHourFromUnixTimestamps:Ye,prettyPaymentMethod:et,methodLabel:S}},components:{}};const pt={class:"mt-3 line-height-3"},yt={class:"flex gap-3"},gt=l("i",{class:"pi pi-user mt-1"},null,-1),kt={class:"m-0 mb-1"},bt={class:"m-0 mb-1"},xt={class:"m-0 mb-1"},wt={class:"m-0 mb-1"},Ct={key:0},Dt={class:"flex gap-3 mt-4"},St=l("i",{class:"pi pi-map-marker mt-1"},null,-1),Vt={class:"m-0 mb-1"},Ot={class:"m-0 mb-1"},Tt={key:0,class:"m-0 mb-1"},At={class:"flex gap-3 mt-4"},Mt=l("i",{class:"pi pi-shopping-cart mt-1"},null,-1),Pt={class:"m-0 mb-1"},Ft={class:"m-0 mb-1"},Nt={class:"m-0 mb-1"},Lt={key:0,class:"m-0 mb-1"},Ut={key:1,class:"m-0 mb-1"},Bt={key:2,class:"m-0 mb-1"},jt={class:"m-0 mb-1"},It={class:"m-0 mb-1"},zt={key:0},Et={key:1},Rt={key:0,class:"flex gap-3 mt-4"},qt=l("i",{class:"pi pi-comment mt-1"},null,-1);function Ht(o,t,n,e,g,C){const s=x("Badge");return h(),y("div",pt,[l("div",yt,[gt,l("div",null,[l("p",kt,w(n.order.user_name)+" "+w(n.order.user_surname||"-"),1),l("p",bt,w(n.order.user_email),1),l("p",xt,w(n.order.user_phone),1),l("p",wt,[U(w(n.order.country)+" ",1),n.order.user_zip?(h(),y("span",Ct," - "+w(n.order.user_zip),1)):T("",!0)])])]),l("div",Dt,[St,l("div",null,[l("p",Vt,w(e.selectedLocation),1),l("p",Ot,w(n.order.course_name),1),n.order.date?(h(),y("p",Tt,w(e.formatPrettyDate(n.order.date))+" "+w(n.order.start_at),1)):T("",!0)])]),l("div",At,[Mt,l("div",null,[l("p",Pt,w(n.order.reservation_number),1),l("p",Ft,w(e.formatDataAndHourFromUnixTimestamps(n.order.created_at)),1),l("p",Nt,w(n.order.created_by),1),n.order.status?(h(),y("p",Lt,[a(s,{value:e.prettyPaymentStatus(n.order.status),class:G([n.order.status,"px-3 border-round-lg"])},null,8,["value","class"])])):T("",!0),n.order.status=="payed"?(h(),y("p",Ut,w(e.methodLabel),1)):T("",!0),n.order.open_tickets_used&&n.order.status=="payed"?(h(),y("p",Bt,[(h(!0),y(Y,null,ue(n.order.open_tickets_used,d=>(h(),y("span",{key:d},[a(s,{value:d.code,class:"mr-2 voucher"},null,8,["value"])]))),128))])):T("",!0),l("p",jt,"Codice sconto utilizzato: "+w(n.order.discount_code||"-"),1),l("p",It,[U(" Totale ordine: "),n.order.total?(h(),y("span",zt,"€ "+w((+n.order.total).toFixed(2)),1)):(h(),y("span",Et,"-"))])])]),n.order.notes?(h(),y("div",Rt,[qt,l("div",null,w(n.order.notes),1)])):T("",!0)])}const Jt=H(ht,[["render",Ht]]),Wt={props:["order","location_permalink"],setup(o,t){J(()=>{o.order&&o.order.notes&&(n.value=o.order.notes)});const n=b(),{showLoader:e,hideLoader:g}=le(),C=K(),s=Q(),d=M(()=>s.getCurrentOrder);return{notes:n,updateOrder:async function(){const f={id:o.location_permalink,order_id:o.order.id,notes:n.value,api_version:"v2"};e(),await s.updateOrder(f).then(()=>{g(),X(C,{message:"Nota aggiornata correttamente",error:!1}),t.emit("closeDialog",d.value)}).catch(u=>{g(),B(C,u)})}}}},Kt={class:"pt-5 px-2"},Gt={class:"flex align-items-center justify-content-end mt-3"};function Qt(o,t,n,e,g,C){const s=x("Textarea"),d=x("Button");return h(),y("div",Kt,[a(s,{modelValue:e.notes,"onUpdate:modelValue":t[0]||(t[0]=k=>e.notes=k),rows:"8",cols:"30",class:"w-full"},null,8,["modelValue"]),l("div",Gt,[a(d,{label:"Annulla",text:"",onClick:t[1]||(t[1]=k=>o.$emit("closeDialog",null))}),a(d,{label:"Conferma",onClick:t[2]||(t[2]=k=>e.updateOrder())})])])}const $t=H(Wt,[["render",Qt]]),Xt={props:["filters"],setup(o,t){J(()=>{i.value=!0,c.value={first:0,rows:S.value.rows,sortField:null,sortOrder:null},c.value.page=0,o.filters.location&&E()});const n=Q(),e=ge(),g=M(()=>n.responseOrders),C=M(()=>n.status),s=Ge(),d=M(()=>s.submitDialog),k=M(()=>n.paymentStatus),f=M(()=>n.getDeleteResponse),{showLoader:u,hideLoader:v}=le(),r=K(),S=b(),p=b(),V=b(),j=b(),F=b(),i=b(!0),c=b(),m=b(0),N=b([]),L=b([]),$=b(!1),se=b(!1),A=b(),z=b(!1);function E(){i.value=!0;let _=new Map;for(const O in o.filters)O=="date"?me(o.filters.date)=="Invalid DateTime"?_.set("date",De(o.filters.date)):_.set("date",me(o.filters.date)):o.filters.location&&_.set("location_permalink",o.filters.location.permalink),O=="course"&&o.filters.course.id!="-1"&&_.set("course",o.filters.course.id),O=="hour"&&o.filters.hour!="Tutti gli orari"&&_.set("hour",o.filters.hour),O=="name"&&_.set("name",o.filters.name);setTimeout(()=>{ae(_)},Math.random()*1e3+250)}const ae=async function(_){await n.fetchAllOrders(_).then(()=>{i.value=!1}).catch(O=>{i.value=!1,B(r,O)})},ie=_=>{V.value.toggle(_),A.value.toggle(_)},re=(_,O)=>_>_+O?"red":"green",ce=function(_,O){O&&(V.value.note=O,V.value.toggle(_))},q=function(_){_.order&&g.value.time_slots&&g.value.time_slots.forEach((O,P)=>{O.orders.forEach((I,R)=>{I.id==_.order.id&&(g.value.time_slots[P].orders[R]=_.order,_.check_in_done!=null&&(g.value.time_slots[P].check_in_done+=_.check_in_done))})})},Ae=async function(_,O){let P=[],I=!1;L.value.forEach(W=>{if(W.id==_.id){I=!0;return}});for(let W of _.tickets)P.push(W.order_item_id);const R={check_in:O,order_item_ids:P,location_permalink:o.filters.location};await n.checkInOrder(R).then(()=>{q(f.value),X(r,{message:"Check-in registrato correttamente",error:!1}),I&&de(L.value,f.value.order)}).catch(W=>{B(r,W)})},Me=async function(_,O){let P=[],I=!1;L.value.forEach(W=>{if(W.id==_.id){I=!0;return}});for(let W of _.tickets)P.push(W.order_item_id);const R={order_item_ids:P,no_show:O,location_permalink:o.filters.location.permalink};await n.noShowOrder(R).then(()=>{q(f.value),X(r,{message:"No-show registrato correttamente",error:!1}),I&&de(L.value,f.value.order)}).catch(W=>{B(r,W)})},Pe=async function(_,O,P){const I={id:_,check_in:O,location_permalink:o.filters.location.permalink};await n.checkInTicket(I).then(()=>{X(r,{message:"Check-in registrato correttamente",error:!1}),q(f.value),de(L.value,f.value.order)}).catch(R=>{B(r,R)})},Fe=async function(_,O,P){const I={id:_,no_show:O,location_permalink:o.filters.location.permalink};await n.noShowTicket(I).then(()=>{X(r,{message:"No-show registrato correttamente",error:!1}),q(f.value),de(L.value,f.value.order)}).catch(R=>{B(r,R)})},de=function(_,O){let P=Ne(L.value,f.value.order.id);P!=-1&&L.value.splice(P,1),L.value.push(f.value.order)},Ne=function(_,O){for(let P=0;P<_.length;P++)if(_[P].id===O)return P;return-1},Le=function(_){const O={course_name:_.course_name,start_at:_.start_at,date:o.filters.date,hour:_.start_at,max_seats:_.is_free_slot?null:_.remaing_seats+""};t.emit("updateFilters",O)},Ue=function(_){$.value=!0,j.value=_},Be=function(_){q({order:_}),$.value=!1,z.value=!1},je=function(_){return _!=null&&_.created_by&&(_==null?void 0:_.created_by)=="WEB"?"WEB":"KALATA"},Ie=function(_,O){let P=0;if(_&&_.tickets){_.tickets.forEach(R=>{O?R.no_show&&(P+=1):R.check_in&&(P+=1)});let I=_.tickets.length;if(P!=I&&P!=0)return P+"/"+I}},ze=function(_,O){A.value.data=O,A.value.toggle(_)},Ee=function(_,O){F.value=O.id;let P="Sei sicuro di voler eliminare questa prenotazione?";P+='<br><br> <i>N.B. Eventuali voucher presenti nella prenotazione vanno liberati manualmente dalla sezione "Data aperta"</i>',s.setDialog("Elimina prenotazione","Elimina","Annulla",P),s.setBtnSubmit(!1),s.setDynamicDialogVisibility(!0)},Re=function(){if(u(),F.value){const _={id:F.value,location_permalink:o.filters.location.permalink};n.deleteOrder(_).then(()=>{v(),X(r,{message:"La prenotazione è stata eliminata correttamente",error:!1}),g.value.time_slots&&g.value.time_slots.forEach((O,P)=>{O.orders.forEach((I,R)=>{I.id==F.value&&(g.value.time_slots[P].orders.splice(R,1),f.value,g.value.time_slots[P].check_in_done+=f.value.check_in_done,g.value.time_slots[P].confirmed_seats+=f.value.confirmed_seats,g.value.time_slots[P].remaing_seats-=f.value.confirmed_seats)})})}).catch(O=>{v(),B(r,O)})}},qe=function(_){N.value=_.data?[_.data]:[]},He=function(_){L.value=_.data?[_.data]:[]},Je=function(_){se.value=!0,p.value=_},We=function(_){z.value=!0,p.value=_},Ke=function(_){const O=new Map;O.set("id",_.id),O.set("location_permalink",o.filters.location.permalink),u(),n.downloadTicket(O).then(()=>{v()}).catch(P=>{v(),B(r,P)})};return Z(d,_=>{_&&Re()}),Z(o.filters,()=>{o.filters.location&&E()}),{dt:S,responseOrders:g,loading:i,totalRecords:m,lazyParams:c,currentOrder:p,status:C,expandedRows:N,expandedRows1:L,op:V,dialogStore:e,paymentList:k,visibleDialog:$,currentTimeSlot:j,visibleMenu:A,visibleDetailDialog:se,visibleNotesDialog:z,toast:r,loadLazyData:E,toggle:ie,getProgressClass:re,showNotes:ce,checkAll:Ae,noShowAll:Me,openDialog:Le,checkInSingleTicket:Pe,noShowSingleTicket:Fe,prettyPaymentStatus:Se,openPaymentStatusDialog:Ue,onClosePaymentStatusDialog:Be,getRowClass:je,printPDF:Ve,showLabelCheckbox:Ie,confirmDeleteOrder:Ee,showMenu:ze,openOrderDetailDialog:Je,openNotesDialog:We,downloadPDF:Ke,handleRowToggle:qe,handleRowToggle1:He,formatDataFromUnixTimestamps:Ze,printOrderPDF:he}},components:{PaymentStatusDialog:vt,OrderDetailDialog:Jt,NotesDialog:$t}};const Yt={class:"order-table"},Zt={class:""},eo={style:{width:"15rem"}},to={class:"m-0 text-right",style:{"font-size":"12px"}},oo={key:0,class:"pi pi-exclamation-triangle cursor-pointer",style:{color:"var(--orange-400)"}},no={style:{width:"15rem"}},lo={class:"m-0 text-right",style:{"font-size":"12px"}},so={key:0},ao={key:0},io=l("div",{class:"flex justify-content-center w-full"},"Check-in",-1),ro={class:"flex justify-content-center"},co={class:"flex flex-column",style:{"margin-top":"8px"}},uo={class:"text-sm",style:{"min-height":"15px"}},mo=l("div",{class:"flex justify-content-center w-full"},"No-show",-1),_o={class:"flex justify-content-center"},fo={class:"flex flex-column",style:{"margin-top":"8px"}},vo={class:"text-sm",style:{"min-height":"15px"}},ho=["onClick"],po={style:{"max-width":"50rem"},class:"p-3"},yo={class:"overlay-menu"},go=["onClick"],ko=l("i",{class:"pi pi-eye mr-3"},null,-1),bo=["onClick"],xo=l("i",{class:"pi pi-print mr-3"},null,-1),wo=["onClick"],Co=l("i",{class:"pi pi-download mr-3"},null,-1),Do=["onClick"],So=l("i",{class:"pi pi-comment mr-3"},null,-1),Vo=["disabled","onClick"],Oo=l("i",{class:"pi pi-pencil mr-3"},null,-1),To=["disabled","onClick"],Ao=l("i",{class:"pi pi-trash mr-3"},null,-1),Mo={key:0},Po={key:1},Fo=l("div",{class:"flex justify-content-center w-full"},"Check-in",-1),No={class:"flex justify-content-center"},Lo=l("div",{class:"flex justify-content-center w-full"},"No-show",-1),Uo={class:"flex justify-content-center"},Bo=l("div",{class:"flex justify-content-center w-full"},null,-1),jo={class:"flex justify-content-center"},Io={key:0,class:"flex mx-4"},zo=l("div",null,[l("div",{class:"p-0 m-0 flex align-items-center"},[l("p",{style:{width:"2rem",height:"5px"},class:"mr-2 web my-0"}),l("span",{class:"text-sm"},"WEB")]),l("div",{class:"p-0 m-0 flex align-items-center justify-content-between"},[l("p",{style:{width:"2rem",height:"5px"},class:"mr-2 kalata"}),l("span",{class:"text-sm"},"KALATA")])],-1),Eo=[zo];function Ro(o,t,n,e,g,C){const s=x("Column"),d=x("ProgressBar"),k=x("Button"),f=x("Badge"),u=x("Checkbox"),v=x("OverlayPanel"),r=x("DataTable"),S=x("PaymentStatusDialog"),p=x("Dialog"),V=x("OrderDetailDialog"),j=x("NotesDialog"),F=pe("tooltip");return h(),y("div",Yt,[a(r,{value:e.responseOrders.time_slots,totalRecords:e.responseOrders.total,lazy:!0,paginator:!1,ref:"dt",loading:e.loading,stripedRows:"",expandedRows:e.expandedRows,"onUpdate:expandedRows":t[1]||(t[1]=i=>e.expandedRows=i),onRowExpand:e.handleRowToggle},{empty:D(()=>[U(" Nessuna prenotazione trovata. ")]),expansion:D(i=>[a(r,{value:i.data.orders,class:"m-4 mx-4 table-order-detail",expandedRows:e.expandedRows1,"onUpdate:expandedRows":t[0]||(t[0]=c=>e.expandedRows1=c),rowClass:e.getRowClass,onRowExpand:e.handleRowToggle1},{empty:D(()=>[U(" Nessuna prenotazione trovata. ")]),expansion:D(c=>[a(r,{value:c.data.tickets,class:"m-4 mx-5"},{default:D(()=>[a(s,{header:"Codice biglietto",field:"code"}),a(s,{header:"Tipo biglietto",field:"type"},{body:D(({data:m})=>[a(f,{value:m.ticket_name,class:G([m.ticket_name,"px-3 border-round-lg"])},null,8,["value","class"])]),_:1}),a(s,{header:"Prezzo"},{body:D(({data:m})=>[m.ticket_price?(h(),y("span",Mo," € "+w((+m.ticket_price).toFixed(2)),1)):(h(),y("span",Po,"-"))]),_:1}),a(s,null,{header:D(()=>[Fo]),body:D(({data:m})=>[l("div",No,[a(u,{modelValue:m.check_in,"onUpdate:modelValue":N=>m.check_in=N,binary:!0,onChange:N=>e.checkInSingleTicket(m.id,m.check_in,c.data),class:"check_in"},null,8,["modelValue","onUpdate:modelValue","onChange"])])]),_:2},1024),a(s,null,{header:D(()=>[Lo]),body:D(({data:m})=>[l("div",Uo,[a(u,{modelValue:m.no_show,"onUpdate:modelValue":N=>m.no_show=N,binary:!0,onChange:N=>e.noShowSingleTicket(m.id,m.no_show,c.data),class:"no_show"},null,8,["modelValue","onUpdate:modelValue","onChange"])])]),_:2},1024),a(s,{field:"tickets_url"},{header:D(()=>[Bo]),body:D(({data:m})=>[l("div",jo,[oe(a(k,{link:"",icon:"pi pi-print",href:m.tickets_url,target:"_blank",style:{color:"var(--surface-400)"},text:"",rounded:"",onClick:N=>e.printPDF(m.id,n.filters.location.permalink,e.toast)},null,8,["href","onClick"]),[[F,"Stampa",void 0,{top:!0}]])])]),_:1})]),_:2},1032,["value"])]),default:D(()=>[a(s,{header:"Codice",field:"reservation_number"}),a(s,{header:"Acquirente"},{body:D(({data:c})=>[U(w(c.user_name)+" "+w(c.user_surname)+" ",1),!c.user_name&&!c.user_surname?(h(),y("span",so,"-")):T("",!0)]),_:1}),a(s,{header:"Pagamento"},{body:D(({data:c})=>[c.status?(h(),y("span",ao,[a(f,{value:e.prettyPaymentStatus(c.status),class:G([c.status,"px-3 border-round-lg"])},null,8,["value","class"])])):T("",!0)]),_:1}),a(s,{header:"Q.ta",field:"tickets_number"}),a(s,null,{header:D(()=>[io]),body:D(({data:c})=>[l("div",ro,[l("div",co,[a(u,{modelValue:c.check_in,"onUpdate:modelValue":m=>c.check_in=m,binary:!0,onChange:m=>e.checkAll(c,c.check_in),class:"check_in"},null,8,["modelValue","onUpdate:modelValue","onChange"]),l("span",uo,w(e.showLabelCheckbox(c,!1)),1)])])]),_:1}),a(s,null,{header:D(()=>[mo]),body:D(({data:c})=>[l("div",_o,[l("div",fo,[a(u,{modelValue:c.no_show,"onUpdate:modelValue":m=>c.no_show=m,binary:!0,onChange:m=>e.noShowAll(c,c.no_show),class:"no_show"},null,8,["modelValue","onUpdate:modelValue","onChange"]),l("span",vo,w(e.showLabelCheckbox(c,!0)),1)])])]),_:1}),a(s,{header:"Note"},{body:D(({data:c})=>[l("div",{class:"notes cursor-pointer",onClick:m=>e.showNotes(m,c.notes)},w(c.notes||"-"),9,ho),a(v,{ref:"op"},{default:D(()=>[l("div",po,w(e.op.note),1)]),_:1},512)]),_:1}),a(s,{header:"",style:{"padding-right":"0",width:"6rem"}},{body:D(({data:c})=>[a(k,{type:"button","aria-haspopup":"true","aria-controls":"overlay_menu",icon:"pi pi-ellipsis-v",text:"",rounded:"",onClick:m=>e.showMenu(m,c)},null,8,["onClick"]),a(v,{ref:"visibleMenu"},{default:D(()=>[l("ul",yo,[l("li",{onClick:m=>e.openOrderDetailDialog(e.visibleMenu.data)},[ko,U("Dettaglio ordine ")],8,go),l("li",{onClick:m=>e.printOrderPDF(e.visibleMenu.data,n.filters.location.permalink,e.toast)},[xo,U("Stampa ")],8,bo),l("li",{onClick:m=>e.downloadPDF(e.visibleMenu.data)},[Co,U("Scarica PDF ")],8,wo),l("li",{onClick:m=>e.openNotesDialog(e.visibleMenu.data)},[So,U("Modifica nota ")],8,Do),l("li",{disabled:!e.visibleMenu.data.can_change_status,onClick:m=>e.openPaymentStatusDialog(e.visibleMenu.data)},[Oo,U("Cambia stato ")],8,Vo),l("li",{disabled:!e.visibleMenu.data.can_cancel,onClick:m=>e.confirmDeleteOrder(m,e.visibleMenu.data)},[Ao,U("Elimina ")],8,To)])]),_:2},1536)]),_:1}),a(s,{expander:"",class:"pl-0 ml-0"})]),_:2},1032,["value","expandedRows","rowClass","onRowExpand"]),i.data.orders&&i.data.orders.length>0?(h(),y("div",Io,Eo)):T("",!0)]),default:D(()=>[a(s,{header:"Percorso",field:"course_name",filterMatchMode:"contains",ref:"course_name"},null,512),a(s,{header:"Orario",field:"start_at",filterMatchMode:"contains",ref:"start_at"},{body:D(({data:i})=>[l("div",Zt,[l("span",{class:G(i.is_free_slot?"free":"")},w(i.start_at),3)])]),_:1},512),a(s,{header:"Posti prenotati",ref:"availabe_tickets",field:"availabe_tickets"},{body:D(({data:i})=>[l("div",eo,[l("p",to,[U(w(i.confirmed_seats)+"/"+w(i.remaing_seats+i.confirmed_seats)+" ",1),i.confirmed_seats>i.remaing_seats+i.confirmed_seats?oe((h(),y("i",oo,null,512)),[[F,i.confirmed_seats-(i.remaing_seats+i.confirmed_seats)+" posti in overbooking",void 0,{top:!0}]]):T("",!0)]),a(d,{value:i.confirmed_seats*100/(i.remaing_seats+i.confirmed_seats),showValue:!1,style:{height:"10px"},class:G(["available-progress",e.getProgressClass(i.confirmed_seats,i.remaing_seats)])},null,8,["value","class"])])]),_:1},512),a(s,{header:"Check-in",ref:"confirmed_tickets",field:"confirmed_tickets"},{body:D(({data:i})=>[l("div",no,[l("p",lo,w(i.check_in_done)+"/"+w(i.confirmed_seats),1),a(d,{value:i.check_in_done*100/(i.remaing_seats+i.confirmed_seats),showValue:!1,style:{height:"10px"},class:"check-in-progress"},null,8,["value"])])]),_:1},512),a(s,null,{body:D(({data:i})=>[oe(a(k,{type:"button","aria-haspopup":"true","aria-controls":"overlay_menu",class:"mr-0 text-primary",icon:"pi pi-calendar",text:"",rounded:"",onClick:c=>e.openDialog(i)},null,8,["onClick"]),[[F,"Prenota",void 0,{top:!0}]])]),_:1}),a(s,{expander:"",style:{width:"5rem"}})]),_:1},8,["value","totalRecords","loading","expandedRows","onRowExpand"]),a(p,{visible:e.visibleDialog,"onUpdate:visible":t[3]||(t[3]=i=>e.visibleDialog=i),modal:"",header:"Stato pagamento",style:{width:"35rem"}},{default:D(()=>[a(S,{location_permalink:n.filters.location.permalink,time_slot:e.currentTimeSlot,onCloseDialog:t[2]||(t[2]=i=>e.onClosePaymentStatusDialog(i))},null,8,["location_permalink","time_slot"])]),_:1},8,["visible"]),a(p,{visible:e.visibleDetailDialog,"onUpdate:visible":t[4]||(t[4]=i=>e.visibleDetailDialog=i),modal:"",header:"Dettaglio ordine",style:{width:"35rem"}},{default:D(()=>[a(V,{order:e.currentOrder},null,8,["order"])]),_:1},8,["visible"]),a(p,{visible:e.visibleNotesDialog,"onUpdate:visible":t[6]||(t[6]=i=>e.visibleNotesDialog=i),modal:"",header:"Modifica nota",style:{width:"35rem"}},{default:D(()=>[a(j,{order:e.currentOrder,location_permalink:n.filters.location.permalink,onCloseDialog:t[5]||(t[5]=i=>e.onClosePaymentStatusDialog(i))},null,8,["order","location_permalink"])]),_:1},8,["visible"])])}const qo=H(Xt,[["render",Ro]]),Ho={props:["filters"],setup(o,t){J(()=>{r(),n.value=o.filters,n.value.date=new Date,V()});const n=b({}),e=ne(),g=Q(),C=K(),s=b([]),d=b(),k=ee.now().plus({years:1}),f=M(()=>e.allLocations),u=M(()=>g.getCalendar),v=async function(i){await g.fetchCalendar(i).then(()=>{}).catch(c=>{B(C,c)})},r=async function(){await e.fetchAllLocations().then(()=>{}).catch(i=>{B(C,i)})},S=function(){if(o.filters.location){const i=f.value.find(c=>c.permalink===o.filters.location);s.value=i.courses}},p=function(i){let c={};c.month=ee.fromJSDate(new Date(i)).month,c.year=ee.fromJSDate(new Date(i)).year,c.location_permalink=o.filters.location.permalink?o.filters.location.permalink:o.filters.location,d.value={month:c.month,year:c.year},v(c)},V=function(){let i=ee.now(),c={location_permalink:"",month:"",year:""};c.location_permalink=o.filters.location.permalink?o.filters.location.permalink:o.filters.location,c.month=i.month+"",c.year=i.year+"",v(c)},j=function(i){if(u.value.web_dates&&u.value.web_dates.length!=0){let c=i.month+1;c=c<10?"0"+c:c;let m=i.day<10?"0"+i.day:i.day,N=i.year+"-"+c+"-"+m;return u.value.web_dates.find(L=>L==N)}},F=function(i){let c={location_permalink:o.filters.location.permalink?o.filters.location.permalink:o.filters.location,month:i.month,year:i.year};v(c)};return Z(o.filters,()=>{if(d.value){let i={location_permalink:o.filters.location.permalink?o.filters.location.permalink:o.filters.location,month:d.value.month,year:d.value.year};v(i)}else V()}),{form:n,courses:s,maxAllowedDate:k,locations:f,calendar:u,getCourses:S,onDateChange:p,getDayFromDate:j,onMonthChange:F}}};const Jo={class:"flex calendar-filter"},Wo={key:0,class:"special-day"};function Ko(o,t,n,e,g,C){const s=x("Calendar");return h(),y("div",Jo,[a(s,{modelValue:e.form.date,"onUpdate:modelValue":t[0]||(t[0]=d=>e.form.date=d),inline:"",onDateSelect:t[1]||(t[1]=d=>e.onDateChange(d)),onMonthChange:t[2]||(t[2]=d=>e.onMonthChange(d)),maxDate:e.maxAllowedDate.toJSDate()},{date:D(d=>[e.getDayFromDate(d.date)?(h(),y("div",Wo,[l("span",null,w(d.date.day),1)])):(h(),y(Y,{key:1},[U(w(d.date.day),1)],64))]),_:1},8,["modelValue","maxDate"])])}const Go=H(Ho,[["render",Ko]]);class Qo{static async fetchAll(t){const n=t.location_permalink;return delete t.location_permalink,(await ve(`/ticket_office/${n}/search/courses`,t)).data}}const Te=_e({id:"course",state:()=>({course:{},courses:[],response_courses:{}}),getters:{allCourses:o=>o.response_courses.tickets,responseCourses:o=>o.response_courses,getTotalCourses:o=>o.response_courses?o.response_courses.total:0,getCurrentCourse:o=>o.course},actions:{async fetchAllCourses(o){await Qo.fetchAll(o).then(t=>this.response_courses=t)}}}),$o={props:["filters"],setup(o,t){J(()=>{n.value=Object.assign({},o.filters),n.value.date=ee.now().toFormat("dd/MM/yyyy"),s.value=Oe(8,20),s.value.unshift("Tutti gli orari"),n.value.hour="Tutti gli orari"});const n=b({}),e=b([]),g=ne(),C=K(),s=b([]),d=Q(),k=Te(),f=M(()=>g.allLocations),u=M(()=>d.responseOrders),v=M(()=>k.allCourses),r=function(){n.value.name=null,n.value.course=e.value[0].name,n.value.hour=s.value[0],t.emit("onSubmit",n.value)},S=async function(){const p={location_permalink:n.value.location.permalink,api_version:"v2"};await k.fetchAllCourses(p).then(()=>{}).catch(V=>{B(C,V)})};return Z(f,()=>{o.filters.location&&f.value&&(n.value=Object.assign({},o.filters),n.value.hour||(n.value.hour="Tutti gli orari"),S())}),Z(o.filters,()=>{o.filters.location&&f.value&&n.value.location&&n.value.location!=o.filters.location&&(n.value=Object.assign({},o.filters),n.value.hour||(n.value.hour="Tutti gli orari"))}),Z(v,()=>{var p;e.value=Object.assign([],v.value),e.value&&((p=e.value[0])==null?void 0:p.id)!="-1"&&e.value.unshift({id:"-1",name:"Tutti i percorsi"}),n.value.course=e.value[0].name}),{form:n,courses:e,hours:s,locations:f,responseOrders:u,resetField:r}}},Xo={class:"formgrid grid px-0 align-items-center"},Yo={key:0,class:"field col-4 flex flex-column"},Zo=l("label",{for:"typology"},"Filtra per percorso",-1),en={key:1,class:"field col-3 flex flex-column"},tn=l("label",{for:"typology"},"Filtra per orario (dalle)",-1),on=l("div",{class:"col-12"},null,-1),nn={class:"field col-4 flex flex-column"},ln=l("label",{for:"typology"},"Filtra per acquirente",-1),sn={class:"flex col-12 justify-content-end pt-1"};function an(o,t,n,e,g,C){const s=x("Dropdown"),d=x("InputText"),k=x("Button"),f=x("AccordionTab"),u=x("Accordion");return h(),te(u,{activeIndex:0},{default:D(()=>[a(f,{header:"FILTRI"},{default:D(()=>[l("div",Xo,[e.form.location&&e.courses?(h(),y("div",Yo,[Zo,a(s,{modelValue:e.form.course,"onUpdate:modelValue":t[0]||(t[0]=v=>e.form.course=v),options:e.courses,optionLabel:"name",optionValue:"name",placeholder:""},null,8,["modelValue","options"])])):T("",!0),e.responseOrders?(h(),y("div",en,[tn,a(s,{modelValue:e.form.hour,"onUpdate:modelValue":t[1]||(t[1]=v=>e.form.hour=v),options:e.hours,placeholder:""},null,8,["modelValue","options"])])):T("",!0),on,l("div",nn,[ln,a(d,{modelValue:e.form.name,"onUpdate:modelValue":t[2]||(t[2]=v=>e.form.name=v),placeholder:""},null,8,["modelValue"])])]),l("div",sn,[a(k,{label:"Ricerca",class:"mr-2",onClick:t[3]||(t[3]=v=>o.$emit("onSubmit",e.form))}),a(k,{label:"Annulla",class:"p-button-outlined",onClick:t[4]||(t[4]=v=>e.resetField())})])]),_:1})]),_:1})}const rn=H($o,[["render",an]]),cn={props:["form","price","index","ticket"],setup(o,t){const n=b(0),e=function(){n.value++,C()},g=function(){n.value>0&&n.value--,C()},C=function(){n.value==null&&(n.value=0);const s={counter:n.value,price:o.price,index:o.index,ticket:o.ticket};t.emit("changeCounter",s)};return{counter:n,decrement:g,increment:e,emitEvent:C}}};const dn={class:"btn-plus-min flex align-items-center"},un={class:"counter"};function mn(o,t,n,e,g,C){const s=x("Button"),d=x("InputNumber");return h(),y("div",dn,[a(s,{icon:"pi pi-minus",rounded:"",outlined:"",severity:"secondary",onClick:e.decrement,disabled:e.counter===0},null,8,["onClick","disabled"]),l("div",un,[a(d,{modelValue:e.counter,"onUpdate:modelValue":[t[0]||(t[0]=k=>e.counter=k),t[1]||(t[1]=k=>e.emitEvent())],min:0},null,8,["modelValue"])]),a(s,{icon:"pi pi-plus",rounded:"",outlined:"",severity:"secondary",onClick:e.increment},null,8,["onClick"])])}const _n=H(cn,[["render",mn]]),fn={props:["tickets","form"],setup(o,t){J(()=>{g.value=!1,s.discount={},C.value=null,o.form.max_seats&&o.form.max_seats<0?(f.value=!0,u.value=-o.form.max_seats):f.value=!1});const n=b(0),e=b([]),g=b(!1),C=b(),s=Q(),d=K(),k=b(!1),f=b(!1),u=b(),v=M(()=>s.getDiscount),r=function(F){e.value[F.index]={partial_total:F.price*F.counter,ticket:F.ticket,quantity:F.counter},n.value=0;let i=0;e.value.forEach(c=>{n.value+=c.partial_total,i+=c.quantity}),f.value||(o.form.max_seats&&i>+o.form.max_seats?(u.value=i-+o.form.max_seats,k.value=!0):(u.value=null,k.value=!1)),C.value&&p()},S=function(){p()},p=async function(){let F=[];e.value.forEach(c=>{F.push({id:c.ticket.id,quantity:c.quantity})});const i={discount_code:C.value,location_permalink:o.form.location_permalink,tickets:F};await s.cost(i).then(()=>{}).catch(c=>{B(d,c)})};return{total:n,partialTotals:e,showDiscount:g,discountCode:C,discount:v,showAlert:k,showAlert2:f,numOverbooking:u,onChangeCounter:r,applyDiscount:S,checkDisabled:function(){let F=!1;(!e.value||e.value.length==0)&&(F=!0);let i=0;return e.value.forEach(c=>{i+=c.quantity}),i==0&&(F=!0),t.emit("disableSecondoTab",!0),F},nextTab:function(){const F={discount_code:C.value,partial_total:e.value};t.emit("nextTab",F)}}},components:{PlusMinusButton:_n}};const vn={key:0},hn={key:1},pn={key:0},yn={key:1},gn={key:0,class:"flex justify-content-between align-items-center"},kn={class:"flex align-items-center col-9"},bn={class:"col-7 pl-0"},xn={class:"text-right col-2"},wn={class:"col-3 flex justify-content-end"},Cn={key:2,class:"mt-3 mb-5"},Dn=l("i",null,"Nessuna tipologia di biglietto trovata.",-1),Sn=[Dn],Vn=l("hr",{class:"mt-3"},null,-1),On={class:"flex align-items-center justify-content-between py-0"},Tn={class:"col-9 flex"},An=l("b",null,"Totale",-1),Mn=[An],Pn={class:"col-2 text-right font-bold"},Fn={class:"col-3 flex justify-content-end"};function Nn(o,t,n,e,g,C){const s=x("Message"),d=x("PlusMinusButton"),k=x("Button");return h(),y(Y,null,[e.showAlert?(h(),te(s,{key:0,severity:"warn",closable:!1},{default:D(()=>[U("Attenzione! Si sta andando in overbooking di "+w(e.numOverbooking)+" ",1),e.numOverbooking==1?(h(),y("span",vn,"posto")):(h(),y("span",hn,"posti"))]),_:1})):T("",!0),e.showAlert2?(h(),te(s,{key:1,severity:"warn",closable:!1},{default:D(()=>[U("Attenzione! Lo slot orario è già in overbooking di "+w(e.numOverbooking)+" ",1),e.numOverbooking==1?(h(),y("span",pn,"posto")):(h(),y("span",yn,"posti"))]),_:1})):T("",!0),(h(!0),y(Y,null,ue(n.tickets,(f,u)=>{var v,r,S;return h(),y("div",{key:f.id},[((v=f.course)==null?void 0:v.id)==((r=n.form.course)==null?void 0:r.id)?(h(),y("div",gn,[l("div",kn,[l("b",bn,w(f.name),1),l("div",xn,"€ "+w((S=f.price)==null?void 0:S.toFixed(2)),1)]),l("div",wn,[a(d,{onChangeCounter:t[0]||(t[0]=p=>e.onChangeCounter(p)),price:f.price,index:u,ticket:f},null,8,["price","index","ticket"])])])):T("",!0)])}),128)),n.tickets&&n.tickets.length==0?(h(),y("div",Cn,Sn)):T("",!0),Vn,l("div",On,[l("div",Tn,[l("div",{class:G(["pl-0",e.discount&&e.discount.total_amount?"col-2":"col-7"])},Mn,2),l("div",Pn,"€ "+w(e.total.toFixed(2)),1)]),l("div",Fn,[a(k,{label:"Prosegui",onClick:t[1]||(t[1]=f=>e.nextTab()),disabled:e.checkDisabled()},null,8,["disabled"])])])],64)}const Ln=H(fn,[["render",Nn]]);class Un{static async fetchAll(){return(await we("/countries")).data.countries}}const Bn=_e({id:"country",state:()=>({country:{},countries:[]}),getters:{allCountries:o=>o.countries},actions:{async fetchAllCountries(){await Un.fetchAll().then(o=>this.countries=o)}}});class jn{static async fetchAll(){return(await we("/provinces")).data.provinces}}const In=_e({id:"province",state:()=>({province:{},provinces:[]}),getters:{allProvinces:o=>o.provinces,getCurrentProvince:o=>o.province},actions:{async fetchAllProvinces(){await jn.fetchAll().then(o=>this.provinces=o)}}}),zn={computed:{Code(){return Code}},props:["location_permalink"],setup(o,t){J(()=>{V(),j()});const n=fe(),e=Bn(),g=Q(),C=In(),s=b({}),d=b(),k=b(),f=M(()=>e.allCountries),u=M(()=>n.allOpenTickets),v=M(()=>g.paymentStatus),r=M(()=>g.paymentModeList),S=M(()=>C.allProvinces),p=M(()=>{const m=g.getPaymentMethods;return Object.entries(m).map(([N,L])=>({id:N,label:L}))}),V=async function(){await e.fetchAllCountries().then(()=>{s.value.country_id=88,s.value.status={id:"payed",name:"Pagato"}})},j=async function(){await C.fetchAllProvinces()};return{form:s,countries:f,paymentList:v,paymentModeList:r,errorMessage:d,errorMessageVoucher:k,open_tickets:u,provinces:S,dynamicPaymentMethods:p,fetchAllOpenTickets:async function(m){const N={code:m.query.toUpperCase(),location_permalink:o.location_permalink};await n.fetchAllOpenTickets(N)},onChangeStatus:function(){s.value.status.id&&(s.value.status.id=="free"||s.value.status.id=="to_pay")&&(s.value.payment_method=null)},onConfirm:function(){if(s.value.status&&s.value.status.id=="payed"){if(!s.value.payment_method){d.value="Seleziona un metodo di pagamento";return}if(s.value.open_ticket_codes){for(const m of s.value.open_ticket_codes)if(m.expired){k.value="Uno o più codici biglietto risultano scaduti";return}}}t.emit("nextTab",s.value)}}}},En={key:0,class:"formgrid grid"},Rn={class:"field col-6"},qn=l("label",{for:"user_name"},"Nome",-1),Hn={class:"field col-6"},Jn=l("label",{for:"user_surname"},"Cognome",-1),Wn={class:"field col-6"},Kn=l("label",{for:"user_email"},"Email",-1),Gn={class:"field col-6"},Qn=l("label",{for:"user_phone"},"Telefono",-1),$n={class:"field col-6"},Xn=l("label",{for:"country_id"},"Nazione",-1),Yn={class:"field col-6"},Zn=l("label",{for:"province"},"Provincia",-1),el={class:"field col-6"},tl=l("label",{for:"status"},"Stato pagamento",-1),ol={class:"field col-6"},nl={for:"payment_method"},ll={key:0},sl={class:"p-float-label"},al={class:"p-error",id:"dd-error"},il={key:0,class:"field col-6 flex flex-column"},rl=l("label",{for:"user_zip"},"Codice biglietto",-1),cl={key:0,class:"pi pi-exclamation-triangle",style:{color:"#ff6767"}},dl={class:"p-error",id:"dd-error"},ul={class:"field col-12"},ml={class:"field flex flex-column"},_l=l("label",{for:"notes"},"Note",-1),fl={class:"col-12 flex justify-content-end"};function vl(o,t,n,e,g,C){const s=x("InputText"),d=x("Dropdown"),k=x("AutoComplete"),f=x("Textarea"),u=x("Button"),v=pe("tooltip");return e.form?(h(),y("div",En,[l("div",Rn,[qn,a(s,{type:"text",modelValue:e.form.user_name,"onUpdate:modelValue":t[0]||(t[0]=r=>e.form.user_name=r),class:"w-full"},null,8,["modelValue"])]),l("div",Hn,[Jn,a(s,{type:"text",modelValue:e.form.user_surname,"onUpdate:modelValue":t[1]||(t[1]=r=>e.form.user_surname=r),class:"w-full"},null,8,["modelValue"])]),l("div",Wn,[Kn,a(s,{type:"text",modelValue:e.form.user_email,"onUpdate:modelValue":t[2]||(t[2]=r=>e.form.user_email=r),class:"w-full"},null,8,["modelValue"])]),l("div",Gn,[Qn,a(s,{type:"text",modelValue:e.form.user_phone,"onUpdate:modelValue":t[3]||(t[3]=r=>e.form.user_phone=r),class:"w-full"},null,8,["modelValue"])]),l("div",$n,[Xn,a(d,{modelValue:e.form.country_id,"onUpdate:modelValue":t[4]||(t[4]=r=>e.form.country_id=r),options:e.countries,optionLabel:"name",optionValue:"id",class:"w-full"},null,8,["modelValue","options"])]),l("div",Yn,[Zn,a(d,{modelValue:e.form.user_zip,"onUpdate:modelValue":t[5]||(t[5]=r=>e.form.user_zip=r),options:e.provinces,optionLabel:"name",optionValue:"name",class:"w-full"},null,8,["modelValue","options"])]),l("div",el,[tl,a(d,{modelValue:e.form.status,"onUpdate:modelValue":t[6]||(t[6]=r=>e.form.status=r),options:e.paymentList,optionLabel:"name",class:"w-full",onChange:t[7]||(t[7]=r=>e.onChangeStatus())},null,8,["modelValue","options"])]),l("div",ol,[l("label",nl,[U("Modalità pagamento"),e.form.status&&e.form.status.id=="payed"?(h(),y("span",ll,"*")):T("",!0)]),l("span",sl,[a(d,{modelValue:e.form.payment_method,"onUpdate:modelValue":t[8]||(t[8]=r=>e.form.payment_method=r),options:e.dynamicPaymentMethods,optionLabel:"label",class:G(["w-full",{"p-invalid":e.errorMessage}]),disabled:e.form.status&&e.form.status.id!="payed",onChange:t[9]||(t[9]=r=>e.errorMessage=null)},null,8,["modelValue","options","disabled","class"])]),l("small",al,w(e.errorMessage||" "),1)]),e.form.payment_method&&e.form.payment_method.id=="voucher"?(h(),y("div",il,[rl,a(k,{modelValue:e.form.open_ticket_codes,"onUpdate:modelValue":t[10]||(t[10]=r=>e.form.open_ticket_codes=r),suggestions:e.open_tickets,class:G(["uppercase w-full",{"p-invalid":e.errorMessageVoucher}]),onComplete:t[11]||(t[11]=r=>e.fetchAllOpenTickets(r)),emptySearchMessage:"Nessun risultato",emptySelectionMessage:"Nessun risultato",optionLabel:"code",optionValue:"code",multiple:"",onChange:t[12]||(t[12]=r=>e.errorMessageVoucher=null)},{option:D(({option:r})=>[l("span",{class:"flex flex-row justify-content-between",style:xe({color:r.expired?"#ff6767":null})},[U(w(r.code)+" ",1),r.expired?oe((h(),y("i",cl,null,512)),[[v,"Scaduto"]]):T("",!0)],4)]),_:1},8,["modelValue","suggestions","class"]),l("small",dl,w(e.errorMessageVoucher||" "),1)])):T("",!0),l("div",ul,[l("div",ml,[_l,a(f,{modelValue:e.form.notes,"onUpdate:modelValue":t[13]||(t[13]=r=>e.form.notes=r),rows:"5",cols:"30"},null,8,["modelValue"])])]),l("div",fl,[a(u,{label:"Conferma",onClick:t[14]||(t[14]=r=>e.onConfirm())})])])):T("",!0)}const hl=H(zn,[["render",vl]]);var pl=`
@layer primevue {
    .p-contextmenu ul {
        margin: 0;
        padding: 0;
        list-style: none;
    }

    .p-contextmenu .p-submenu-list {
        position: absolute;
        min-width: 100%;
        z-index: 1;
    }

    .p-contextmenu .p-menuitem-link {
        cursor: pointer;
        display: flex;
        align-items: center;
        text-decoration: none;
        overflow: hidden;
        position: relative;
    }

    .p-contextmenu .p-menuitem-text {
        line-height: 1;
    }

    .p-contextmenu .p-menuitem {
        position: relative;
    }

    .p-contextmenu .p-menuitem-link .p-submenu-icon {
        margin-left: auto;
    }

    .p-contextmenu-enter-from {
        opacity: 0;
    }

    .p-contextmenu-enter-active {
        transition: opacity 250ms;
    }
}
`,yl={root:function(t){var n=t.instance;return["p-contextmenu p-component",{"p-input-filled":n.$primevue.config.inputStyle==="filled","p-ripple-disabled":n.$primevue.config.ripple===!1}]},menu:"p-contextmenu-root-list",menuitem:function(t){var n=t.instance,e=t.processedItem;return["p-menuitem",{"p-menuitem-active p-highlight":n.isItemActive(e),"p-focus":n.isItemFocused(e),"p-disabled":n.isItemDisabled(e)}]},content:"p-menuitem-content",action:function(t){var n=t.props,e=t.isActive,g=t.isExactActive;return["p-menuitem-link",{"router-link-active":e,"router-link-active-exact":n.exact&&g}]},icon:"p-menuitem-icon",label:"p-menuitem-text",submenuIcon:"p-submenu-icon",submenu:"p-submenu-list",separator:"p-menuitem-separator"};Qe.extend({name:"contextmenu",css:pl,classes:yl});const gl={props:["form"],setup(o,t){J(()=>{V()});const n=b(0),e=b([]),g=b(!1),C=b(!0),s=b(),d=b([]),{showLoader:k,hideLoader:f}=le(),u=fe(),v=Q(),r=K(),S=M(()=>u.allTickets),p=M(()=>v.getCurrentOrder),V=async function(){const A={location_permalink:o.form.location_permalink,api_version:"v2",date:F(o.form.date),course_id:o.form.course.id};await u.fetchAllTickets(A).then(()=>{}).catch(z=>{B(r,z)})},j=function(A){n.value+=1,s.value=A.discount_code,e.value=Object.assign([],A.partial_total),C.value=!1},F=function(A){return me(A).includes("Invalid")?De(A):me(A)},i=function(A){c(A)},c=async function(A){var ie,re,ce;const z=[{start_at:o.form.hour,tickets:[]}];e.value.forEach(q=>{q.quantity!=0&&z[0].tickets.push({id:q.ticket.id,quantity:q.quantity})});let E=[];A.open_ticket_codes&&A.open_ticket_codes.forEach(q=>{E.push(q.code)});const ae={location_permalink:o.form.location_permalink,country_id:A.country_id,status:A.status.id,user_email:A.user_email,user_name:A.user_name,user_phone:A.user_phone,user_surname:A.user_surname,user_zip:A.user_zip,api_version:"v2",date:o.form.date?F(o.form.date):"",notes:A.notes,time_slots:z,payment_method:(ie=A.payment_method)==null?void 0:ie.id,course_id:(ce=(re=o.form)==null?void 0:re.course)==null?void 0:ce.id,open_ticket_codes:E};s.value&&(ae.discount_code=s.value),await v.createOrder(ae).then(()=>{n.value+=1,C.value=!0,g.value=!0}).catch(q=>{B(r,q)})},m=function(){he(p==null?void 0:p.value,o.form.location_permalink,r),t.emit("closeDialog",!0)},N=function(A){C.value=A},L=function(){he(p==null?void 0:p.value,o.form.location_permalink,r),$()},$=async function(){let A=[];if(!p.value&&!o.form.location_permalink)return;for(let E of p.value.tickets)A.push(E.order_item_id);const z={check_in:!0,order_item_ids:A,location_permalink:o.form.location_permalink};await v.checkInOrder(z).then(()=>{X(r,{message:"Check-in registrato correttamente",error:!1}),t.emit("closeDialog",!0)}).catch(E=>{B(r,E)})},se=function(){k();const A={location_permalink:o.form.location_permalink,order_id:p.value.id};v.sendEmail(A).then(()=>{X(r,{message:"Email inviata correttamente al cliente",error:!1}),f(),t.emit("closeDialog",!0)}).catch(z=>{f(),B(r,z)})};return Z(p,()=>{d.value=[],p.value.tickets.forEach(A=>{const z=d.value.find(E=>E.ticket_name===A.ticket_name);if(!z)A.quantity=1,d.value.push(A);else{let E=d.value.indexOf(z);d.value[E].quantity+=1}})}),{tickets:S,active:n,partialTotals:e,showOrderDetail:g,currentOrder:p,tmp_tickets:d,showSecondTab:C,formatExplicitDate:Ce,formatDate:ye,onNextTab:j,onConfirmPayment:i,printPDF:Ve,onPrintPDF:m,onDisableSecondoTab:N,printAndCheckIn:L,sendEmail:se}},components:{NewOrderTicketTab:Ln,NewOrderFormTab:hl}};const kl={key:0,class:"info-box"},bl={class:"font-medium"},xl=l("i",{class:"pi pi-map-marker mr-3 font-medium"},null,-1),wl={class:"font-medium"},Cl=l("i",{class:"pi pi-calendar mr-3 font-medium"},null,-1),Dl={key:0,class:"capitalize"},Sl={key:0,class:"flex pb-4"},Vl=l("i",{class:"pi pi-ticket mr-3 font-medium mt-1"},null,-1),Ol={class:"flex flex-column"},Tl={key:0,class:"pb-1 pr-1"},Al={key:1,class:"pb-1"},Ml={class:"py-5"},Pl={class:"m-0 text-center line-height-3"},Fl=l("br",null,null,-1),Nl={key:0,class:"col-offset-3 col-6 flex justify-content-center flex-column align-items-center mt-4 order-summary"},Ll=l("p",{class:"my-2"},[l("b",null,"Riepilogo ordine:")],-1),Ul={class:"flex flex-column col-12"},Bl={key:0,class:"pb-1",style:{"min-width":"8rem"}},jl={key:1,class:"pb-1"},Il={key:2},zl={class:"flex flex-column col-12"},El={key:0,class:"p-0 m-0 font-medium flex justify-content-between"},Rl=l("span",{class:"pb-1 pr-1"},"Totale ordine ",-1),ql={class:"pb-1"},Hl={class:"flex align-items-center justify-content-center mt-4"};function Jl(o,t,n,e,g,C){var v,r;const s=x("NewOrderTicketTab"),d=x("TabPanel"),k=x("NewOrderFormTab"),f=x("Button"),u=x("TabView");return h(),y(Y,null,[n.form?(h(),y("div",kl,[l("p",bl,[xl,U(w((v=n.form.course)==null?void 0:v.name),1)]),l("p",wl,[Cl,n.form.date?(h(),y("span",Dl,w(e.formatDate((r=n.form)==null?void 0:r.date)),1)):T("",!0),U(" - "+w(n.form.hour),1)]),e.partialTotals&&e.partialTotals.length>0?(h(),y("div",Sl,[Vl,l("div",Ol,[(h(!0),y(Y,null,ue(e.partialTotals,S=>{var p;return h(),y("p",{class:"p-0 m-0 font-medium flex justify-content-between",key:S},[S&&S.quantity!=0?(h(),y("span",Tl,w((p=S.ticket)==null?void 0:p.name),1)):T("",!0),S&&S.quantity!=0?(h(),y("span",Al," x "+w(S.quantity)+" "+w(S.price),1)):T("",!0)])}),128))])])):T("",!0)])):T("",!0),a(u,{activeIndex:e.active,"onUpdate:activeIndex":t[6]||(t[6]=S=>e.active=S)},{default:D(()=>[a(d,{header:"Seleziona i biglietti",disabled:e.showOrderDetail},{default:D(()=>[a(s,{tickets:e.tickets,form:n.form,onNextTab:t[0]||(t[0]=S=>e.onNextTab(S)),onDisableSecondoTab:t[1]||(t[1]=S=>e.onDisableSecondoTab(S))},null,8,["tickets","form"])]),_:1},8,["disabled"]),a(d,{header:"Inserisci i dati",disabled:e.showSecondTab},{default:D(()=>[a(k,{onNextTab:t[2]||(t[2]=S=>e.onConfirmPayment(S)),location_permalink:n.form.location_permalink},null,8,["location_permalink"])]),_:1},8,["disabled"]),e.showOrderDetail?(h(),te(d,{key:0,header:"Ordine completato"},{default:D(()=>{var S,p;return[l("div",Ml,[l("div",Pl,[U(" Ordine "),l("b",null,w(e.currentOrder.reservation_number),1),U(" registrato correttamente!"),Fl]),e.currentOrder?(h(),y("div",Nl,[Ll,l("div",Ul,[(h(!0),y(Y,null,ue(e.tmp_tickets,V=>(h(),y("p",{class:"p-0 m-0 font-medium flex justify-content-between flex-1",key:V},[V&&V.quantity!=0?(h(),y("span",Bl,w(V.ticket_name),1)):T("",!0),V&&V.quantity!=0?(h(),y("span",jl," x "+w(V.quantity),1)):T("",!0),V.ticket_price?(h(),y("span",Il," € "+w((+V.ticket_price).toFixed(2)),1)):T("",!0)]))),128))]),l("div",zl,[e.currentOrder.total?(h(),y("p",El,[Rl,l("span",ql,[l("b",null,"€ "+w((+((S=e.currentOrder)==null?void 0:S.total)).toFixed(2)),1)])])):T("",!0)])])):T("",!0),l("div",Hl,[a(f,{icon:"pi pi-envelope",class:"mr-3",rounted:"",outlined:"",label:"Invia biglietti",onClick:t[3]||(t[3]=V=>e.sendEmail()),disable:!((p=e.currentOrder)!=null&&p.user_email)},null,8,["disable"]),a(f,{icon:"pi pi-print",onClick:t[4]||(t[4]=V=>e.onPrintPDF()),class:"mr-3",rounted:"",outlined:"",label:"Stampa"}),a(f,{icon:"pi print-check-icon",onClick:t[5]||(t[5]=V=>e.printAndCheckIn()),class:"mr-3",rounted:"",outlined:"",label:"Stampa e Check-in"})])])]}),_:1})):T("",!0)]),_:1},8,["activeIndex"])],64)}const Wl=H(gl,[["render",Jl]]),Kl={props:["filters","date"],setup(o,t){J(()=>{C.value=Oe(8,20),n.value=Object.assign({},o.filters)});const n=b({}),e=Te(),g=K(),C=b(),s=b(!1),d=ge(),k=b(!1),f=M(()=>e.allCourses),u=M(()=>d.showNewOrderDialog),v=async function(){const V={location_permalink:o.filters.location_permalink,api_version:"v2"};await e.fetchAllCourses(V).catch(j=>{B(g,j)})},r=function(){d.setNewOrderDialogVisibility(!1),n.value.hour="",n.value.course=null,t.emit("onCloseDialog")},S=function(V){n.value.date=o.date,d.setNewOrderDialogVisibility(V)},p=function(){k.value=n.value.open_ticket};return Z(o.filters,()=>{if(v(),n.value=Object.assign({},o.filters),o.filters.course&&!o.filters.course.id){let V=f.value.find(j=>j.name===o.filters.course.name);V&&(n.value.course=V)}}),{courses:f,form:n,hours:C,disableForm:k,visible:s,onCloseDialog:r,updateDialog:S,onChecked:p,dialogVisible:u,dialogStore:d}},components:{NewOrderDialog:Wl}},Gl=l("h2",{class:"mt-1"},"Nuova prenotazione",-1),Ql={class:"formgrid grid px-0 align-items-center mt-4"},$l={key:0,class:"field flex flex-column w-full col-12"},Xl=l("label",{for:"typology"},"Scegli il percorso",-1),Yl={key:1,class:"field flex flex-column w-full col-12"},Zl=l("label",{for:"typology"},"Seleziona l'orario",-1),es={class:"flex justify-content-end align-items-center mt-2"},ts={class:"flex align-items-center justify-content-between w-full"},os=l("h2",null,"Nuova prenotazione",-1);function ns(o,t,n,e,g,C){const s=x("Dropdown"),d=x("Button"),k=x("NewOrderDialog"),f=x("Dialog"),u=x("Card");return h(),te(u,{class:"mt-4"},{content:D(()=>[Gl,l("div",Ql,[n.filters.location_permalink?(h(),y("div",$l,[Xl,a(s,{modelValue:e.form.course,"onUpdate:modelValue":t[0]||(t[0]=v=>e.form.course=v),options:e.courses,optionLabel:"name",disabled:e.disableForm,placeholder:""},null,8,["modelValue","options","disabled"])])):T("",!0),n.filters.location_permalink?(h(),y("div",Yl,[Zl,a(s,{modelValue:e.form.hour,"onUpdate:modelValue":t[1]||(t[1]=v=>e.form.hour=v),options:e.hours,disabled:e.disableForm,placeholder:""},null,8,["modelValue","options","disabled"])])):T("",!0)]),l("div",es,[a(d,{label:"Prenota",disabled:!e.form.course||!e.form.hour,onClick:t[2]||(t[2]=v=>e.updateDialog(!0))},null,8,["disabled"])]),a(f,{visible:e.dialogVisible,"onUpdate:visible":t[5]||(t[5]=v=>e.dialogVisible=v),modal:"",header:"Nuova prenotazione",style:{width:"60rem"},breakpoints:{"1199px":"75vw","575px":"90vw"},closable:!1,onHide:t[6]||(t[6]=v=>e.onCloseDialog())},{header:D(()=>[l("div",ts,[os,a(d,{icon:"pi pi-times",text:"",rounded:"",onClick:t[3]||(t[3]=v=>e.updateDialog(!1))})])]),default:D(()=>[a(k,{form:e.form,onCloseDialog:t[4]||(t[4]=v=>e.onCloseDialog())},null,8,["form"])]),_:1},8,["visible"])]),_:1})}const ls=H(Kl,[["render",ns]]),ss={props:["location_permalink"],setup(o,t){J(()=>{e.value.start_date=ee.local().startOf("day").toFormat("dd/MM/yyyy"),e.value.end_date=ee.local().endOf("day").toFormat("dd/MM/yyyy"),e.value.created_at="false",e.value.start_hour="00:00",e.value.end_hour="23:59"});const n=K(),e=b({}),g=ne(),{showLoader:C,hideLoader:s}=le(),d=function(){let u=ke(e.value.start_date)+" "+e.value.start_hour,v=ke(e.value.end_date)+" "+e.value.end_hour;const r={from:u,to:v,location_permalink:o.location_permalink,created_at:"false"};k(r)},k=async function(u){C(),await g.downloadReport(u).then(()=>{s(),t.emit("onSubmit")}).catch(v=>{s(),B(n,v)})};return{form:e,onSubmit:d,setDefaultIfBlank:function(){(!e.value.start_hour||e.value.start_hour=="")&&(e.value.start_hour="00:00"),(!e.value.end_hour||e.value.end_hour=="")&&(e.value.end_hour="23:59")}}},components:{Form:tt}},as={class:"formgrid grid mt-3"},is={class:"field col-6 flex flex-column"},rs=l("label",{from:"start_date"},"Dal",-1),cs=l("label",{from:"start_hour",class:"mt-3"},"Dalle",-1),ds={class:"field col-6 flex flex-column"},us=l("label",{from:"end_date"},"Al",-1),ms=l("label",{from:"end_hour",class:"mt-3"},"Alle",-1),_s={class:"flex align-items-center justify-content-end mt-6"};function fs(o,t,n,e,g,C){const s=x("Calendar"),d=x("InputMask"),k=x("Button"),f=x("Form");return h(),te(f,{onSubmit:e.onSubmit},{default:D(()=>[l("div",as,[l("div",is,[rs,a(s,{inputId:"start_date",modelValue:e.form.start_date,"onUpdate:modelValue":t[0]||(t[0]=u=>e.form.start_date=u),dateFormat:"dd/mm/yy",manualInput:!0},null,8,["modelValue"]),cs,a(d,{id:"start_hour",modelValue:e.form.start_hour,"onUpdate:modelValue":t[1]||(t[1]=u=>e.form.start_hour=u),mask:"99:99",placeholder:"HH:mm",onBlur:t[2]||(t[2]=u=>e.setDefaultIfBlank())},null,8,["modelValue"])]),l("div",ds,[us,a(s,{inputId:"end_date",modelValue:e.form.end_date,"onUpdate:modelValue":t[3]||(t[3]=u=>e.form.end_date=u),dateFormat:"dd/mm/yy",manualInput:!0},null,8,["modelValue"]),ms,a(d,{id:"end_hour",modelValue:e.form.end_hour,"onUpdate:modelValue":t[4]||(t[4]=u=>e.form.end_hour=u),mask:"99:99",placeholder:"HH:mm",onBlur:t[5]||(t[5]=u=>e.setDefaultIfBlank())},null,8,["modelValue"])])]),l("div",_s,[a(k,{label:"Annulla",text:"",onClick:t[6]||(t[6]=u=>o.$emit("onSubmit"))}),a(k,{label:"Scarica",type:"submit"})])]),_:1},8,["onSubmit"])}const vs=H(ss,[["render",fs]]),hs={setup(){const o=b({}),t=b({}),n=b(),e=b(!1),g=Q(),C=$e(),s=ne(),d=K(),k=ge(),f=M(()=>C.currentUser),u=M(()=>s.allLocations),v=M(()=>s.getCurrentLocation),r=M(()=>g.getPaymentMethods);J(()=>{v.value&&(o.value.location=v.value,t.value.location_permalink=v.value.permalink),p().then(()=>{S()})});const S=async function(){var L;let m={};const N=((L=v==null?void 0:v.value)==null?void 0:L.permalink)??null;N?m.location_permalink=N:m.location_permalink=u.value[0].permalink,await g.fetchPaymentMethods(m).then(()=>{}).catch($=>{B(d,$)})},p=async function(){await s.fetchAllLocations().then(()=>{v.value||(o.value.location=u.value[0],t.value.location_permalink=u.value[0].permalink,s.updateCurrenLocation(u.value[0]))}).catch(m=>{B(d,m)})};return{filters:o,orderTable:n,order_filters:t,visibleDialog:e,user:f,locations:u,newPaymentMethods:r,fetchAllLocations:p,formatDate:ye,onUpdateFilters:function(m){m.course?o.value.course={id:m.course}:o.value.course="",m.name?o.value.name=m.name:o.value.name="",m.hour&&(m.hour.start_at?o.value.hour=m.hour.start_at:o.value.hour=m.hour)},onUpdateNewOrderFilters:function(m){m.start_at&&(t.value.hour=m.start_at),m.course_name&&(t.value.course={name:m.course_name}),m.date&&(t.value.date=m.date),m.hour&&(t.value.hour=m.hour),m.max_seats?t.value.max_seats=m.max_seats:t.value.max_seats=null,k.setNewOrderDialogVisibility(!0)},onCloseDialog:function(){n.value.loadLazyData()},onChangeLocation:function(){t.value.location_permalink=o.value.location.permalink,s.updateCurrenLocation(o.value.location)},onCloseReportDialog:function(){e.value=!1}}},components:{CalendarFilter:Go,OrderTable:qo,OrderFilter:rn,NewOrderCard:ls,SalesReportsDialog:vs}};const ps={class:"flex justify-content-between align-items-center"},ys={class:"field flex flex-column mt-3"},gs={key:0,style:{color:"#495057"},class:"flex flex-column align-items-end"},ks=l("i",{class:"pi pi-calendar mr-2 text-xl"},null,-1),bs={class:"capitalize text-xl"},xs={class:"flex gap-4"},ws={key:0,class:"col-3 mt-3"},Cs={class:"col-9 mt-3"};function Ds(o,t,n,e,g,C){const s=x("Dropdown"),d=x("Button"),k=x("SalesReportsDialog"),f=x("Dialog"),u=x("CalendarFilter"),v=x("NewOrderCard"),r=x("OrderFilter"),S=x("OrderTable");return h(),y("div",null,[l("div",ps,[l("div",ys,[a(s,{modelValue:e.filters.location,"onUpdate:modelValue":t[0]||(t[0]=p=>e.filters.location=p),options:e.locations,optionLabel:"name",placeholder:"Filtra per location",class:"location",onChange:t[1]||(t[1]=p=>e.onChangeLocation())},null,8,["modelValue","options"])]),e.filters&&e.filters.date?(h(),y("div",gs,[l("div",null,[ks,l("span",bs,w(e.formatDate(e.filters.date)),1)]),a(d,{label:"Report visite",link:"",class:"m-0 p-0",onClick:t[2]||(t[2]=p=>e.visibleDialog=!0),icon:"pi pi-download"}),a(f,{visible:e.visibleDialog,"onUpdate:visible":t[4]||(t[4]=p=>e.visibleDialog=p),modal:"",header:"Report visite",style:{width:"35rem"}},{default:D(()=>[a(k,{onOnSubmit:t[3]||(t[3]=p=>e.onCloseReportDialog()),location_permalink:e.filters.location.permalink},null,8,["location_permalink"])]),_:1},8,["visible"])])):T("",!0)]),l("div",xs,[e.filters.location?(h(),y("div",ws,[a(u,{filters:e.filters},null,8,["filters"]),a(v,{date:e.filters.date,filters:e.order_filters,onOnCloseDialog:t[5]||(t[5]=p=>e.onCloseDialog())},null,8,["date","filters"])])):T("",!0),l("div",Cs,[a(r,{filters:e.filters,onOnSubmit:t[6]||(t[6]=p=>e.onUpdateFilters(p))},null,8,["filters"]),e.filters.date?(h(),te(S,{key:0,filters:e.filters,ref:"orderTable",class:"mt-4",onUpdateFilters:t[7]||(t[7]=p=>e.onUpdateNewOrderFilters(p))},null,8,["filters"])):T("",!0)])])])}const As=H(hs,[["render",Ds]]);export{As as default};
