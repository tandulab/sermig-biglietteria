import{l as Se,m as xe,o as X,p as S,a as ee,c as P,_ as W,r as w,q as Ce,b as d,e as b,g as i,f as l,n as J,t as k,w as D,s as L,F as $,h as F,v as me,x as Re,B as Ue,C as fe,Z as Oe,D as ae,y as dt,O as ut,z as mt,A as ft,E as _t,G as pt,H as Q,I as ge,J as se,K as Ae,L as Pe,T as vt,M as ht,i as ie,N as be,P as yt,Q as Ne,R as gt,S as bt,u as kt}from"../index42173.js";import{u as oe,a as pe,f as Ie,b as Le,c as wt,d as xt,e as Te,g as ke,h as Be,i as Ct,D as re,j as je}from"./location42173.js";import{u as ve,s as te,e as I,p as ze,a as Dt,b as Ve,c as we,d as qe}from"./helpers42173.js";import{F as Ot}from"./vee-validate.esm42173.js";class Me{static async fetchAll(t){const n=t.location_permalink;return delete t.location_permalink,(await Se(`/ticket_office/${n}/search/tickets`,t)).data}static async fetchAllOpenTickets(t){const n=t.location_permalink;return delete t.location_permalink,(await Se(`/ticket_office/${n}/orders/search_codes`,t)).data}}const De=xe({id:"ticket",state:()=>({ticket:{},tickets:[],response_tickets:{},open_tickets_codes:{}}),getters:{allTickets:o=>o.response_tickets.available_ticket_types,allOpenTickets:o=>o.open_tickets_codes.open_tickets,responseTickets:o=>o.response_tickets,getTotalTickets:o=>o.response_tickets?o.response_tickets.total:0,getCurrentTicket:o=>o.ticket},actions:{async fetchAllTickets(o){await Me.fetchAll(o).then(t=>this.response_tickets=t)},async fetchAllOpenTickets(o){await Me.fetchAllOpenTickets(o).then(t=>this.open_tickets_codes=t)}}}),St={computed:{Code(){return Code}},props:["location_permalink","time_slot"],setup(o,t){X(()=>{n.value=Object.assign({},o.time_slot)});const n=S({}),e=De(),y=oe(),{showLoader:g,hideLoader:a}=ve(),u=ee(),x=S(),m=S(),r=P(()=>e.allOpenTickets),h=P(()=>y.paymentStatus),C=P(()=>y.paymentModeList),p=P(()=>{const s=y.getPaymentMethods;return Object.entries(s).map(([_,E])=>({id:_,label:E}))}),v=P(()=>y.getCurrentOrder),O=async function(s){const _={code:s.query.toUpperCase(),location_permalink:o.location_permalink};await e.fetchAllOpenTickets(_)},V=async function(){var _,E;const s={id:o.location_permalink,order_id:n.value.id,status:(_=n.value)==null?void 0:_.status,payment_method:n.value.payment_method,open_ticket_codes:[],api_version:"v2",notes:(E=n.value)==null?void 0:E.notes};if(n.value.status&&n.value.status=="payed"&&!n.value.payment_method){x.value="Seleziona un metodo di pagamento";return}for(const R of n.value.open_tickets_used)if(R.expired){m.value="Uno o più codici biglietto risultano scaduti";return}if(n.value.open_tickets_used&&n.value.open_tickets_used.length>0){let R=[];n.value.open_tickets_used.forEach(G=>{R.push(G.code)}),s.open_ticket_codes=R}j(s)},j=async function(s){g(),await y.updateOrder(s).then(()=>{a(),te(u,{message:"Stato aggiornato correttamente",error:!1}),t.emit("closeDialog",v.value)}).catch(_=>{a(),I(u,_)})};return{form:n,open_tickets:r,paymentList:h,paymentModeList:C,changeStatus:V,errorMessage:x,errorMessageVoucher:m,dynamicPaymentMethods:p,fetchAllOpenTickets:O,onChangeStatus:function(){(n.value.status=="free"||n.value.status=="to_pay")&&(n.value.payment_method=null)}}}},Vt={key:0,class:"formgrid grid flex-column mt-3"},Lt={class:"field col-12"},Tt=i("label",{for:"status"},"Stato pagamento",-1),At={class:"field col-12"},Pt=i("label",{for:"payment_method"},"Modalità pagamento",-1),jt={class:"p-error",id:"dd-error"},Mt={key:0,class:"field col-12 flex flex-column"},Ft=i("label",{for:"user_zip"},"Codice biglietto",-1),Et={key:0,class:"pi pi-exclamation-triangle",style:{color:"#ff6767"}},Rt={class:"p-error",id:"dd-error"},Ut={class:"flex align-items-center justify-content-end mt-3"};function Nt(o,t,n,e,y,g){const a=w("Dropdown"),u=w("AutoComplete"),x=w("Button"),m=Ce("tooltip");return d(),b($,null,[e.form?(d(),b("div",Vt,[i("div",Lt,[Tt,l(a,{modelValue:e.form.status,"onUpdate:modelValue":t[0]||(t[0]=r=>e.form.status=r),options:e.paymentList,optionLabel:"name",optionValue:"id",class:"w-full",onChange:t[1]||(t[1]=r=>e.onChangeStatus())},null,8,["modelValue","options"])]),i("div",At,[Pt,l(a,{modelValue:e.form.payment_method,"onUpdate:modelValue":t[2]||(t[2]=r=>e.form.payment_method=r),options:e.dynamicPaymentMethods,optionLabel:"label",optionValue:"id",class:J(["w-full",{"p-invalid":e.errorMessage}]),disabled:e.form.status!="payed",onChange:t[3]||(t[3]=r=>e.errorMessage=null)},null,8,["modelValue","options","disabled","class"]),i("small",jt,k(e.errorMessage||" "),1)]),e.form.payment_method=="voucher"&&e.form.status=="payed"?(d(),b("div",Mt,[Ft,l(u,{modelValue:e.form.open_tickets_used,"onUpdate:modelValue":t[4]||(t[4]=r=>e.form.open_tickets_used=r),suggestions:e.open_tickets,class:J(["uppercase w-full",{"p-invalid":e.errorMessageVoucher}]),onComplete:t[5]||(t[5]=r=>e.fetchAllOpenTickets(r)),emptySearchMessage:"Nessun risultato",emptySelectionMessage:"Nessun risultato",optionLabel:"code",optionValue:"code",multiple:"",onChange:t[6]||(t[6]=r=>e.errorMessageVoucher=null)},{option:D(({option:r})=>[i("span",{class:"flex flex-row justify-content-between",style:Re({color:r.expired?"#ff6767":null})},[F(k(r.code)+" ",1),r.expired?me((d(),b("i",Et,null,512)),[[m,"Scaduto"]]):L("",!0)],4)]),_:1},8,["modelValue","suggestions","class"]),i("small",Rt,k(e.errorMessageVoucher||" "),1)])):L("",!0)])):L("",!0),i("div",Ut,[l(x,{label:"Annulla",text:"",onClick:t[7]||(t[7]=r=>o.$emit("closeDialog",null))}),l(x,{label:"Conferma",onClick:t[8]||(t[8]=r=>e.changeStatus())})])],64)}const It=W(St,[["render",Nt]]);var Bt=`
@layer primevue {
    .p-confirm-popup {
        position: absolute;
        margin-top: 10px;
        top: 0;
        left: 0;
    }

    .p-confirm-popup-flipped {
        margin-top: 0;
        margin-bottom: 10px;
    }

    /* Animation */
    .p-confirm-popup-enter-from {
        opacity: 0;
        transform: scaleY(0.8);
    }

    .p-confirm-popup-leave-to {
        opacity: 0;
    }

    .p-confirm-popup-enter-active {
        transition: transform 0.12s cubic-bezier(0, 0, 0.2, 1), opacity 0.12s cubic-bezier(0, 0, 0.2, 1);
    }

    .p-confirm-popup-leave-active {
        transition: opacity 0.1s linear;
    }

    .p-confirm-popup:after,
    .p-confirm-popup:before {
        bottom: 100%;
        left: calc(var(--overlayArrowLeft, 0) + 1.25rem);
        content: ' ';
        height: 0;
        width: 0;
        position: absolute;
        pointer-events: none;
    }

    .p-confirm-popup:after {
        border-width: 8px;
        margin-left: -8px;
    }

    .p-confirm-popup:before {
        border-width: 10px;
        margin-left: -10px;
    }

    .p-confirm-popup-flipped:after,
    .p-confirm-popup-flipped:before {
        bottom: auto;
        top: 100%;
    }

    .p-confirm-popup.p-confirm-popup-flipped:after {
        border-bottom-color: transparent;
    }

    .p-confirm-popup.p-confirm-popup-flipped:before {
        border-bottom-color: transparent;
    }

    .p-confirm-popup .p-confirm-popup-content {
        display: flex;
        align-items: center;
    }
}
`,zt={root:function(t){var n=t.instance;return["p-confirm-popup p-component",{"p-input-filled":n.$primevue.config.inputStyle==="filled","p-ripple-disabled":n.$primevue.config.ripple===!1}]},content:"p-confirm-popup-content",icon:function(t){var n=t.instance;return["p-confirm-popup-icon",n.confirmation?n.confirmation.icon:null]},message:"p-confirm-popup-message",footer:"p-confirm-popup-footer",rejectButton:function(t){var n=t.instance;return["p-confirm-popup-reject",n.confirmation&&!n.confirmation.rejectClass?"p-button-text":null]},acceptButton:"p-confirm-popup-accept"},qt=Ue.extend({name:"confirmpopup",css:Bt,classes:zt}),Ht={name:"BaseConfirmPopup",extends:pt,props:{group:String},style:qt,provide:function(){return{$parentInstance:this}}},He={name:"ConfirmPopup",extends:Ht,inheritAttrs:!1,data:function(){return{visible:!1,confirmation:null,autoFocusAccept:null,autoFocusReject:null}},target:null,outsideClickListener:null,scrollHandler:null,resizeListener:null,container:null,confirmListener:null,closeListener:null,mounted:function(){var t=this;this.confirmListener=function(n){n&&n.group===t.group&&(t.confirmation=n,t.target=n.target,t.confirmation.onShow&&t.confirmation.onShow(),t.visible=!0)},this.closeListener=function(){t.visible=!1,t.confirmation=null},fe.on("confirm",this.confirmListener),fe.on("close",this.closeListener)},beforeUnmount:function(){fe.off("confirm",this.confirmListener),fe.off("close",this.closeListener),this.unbindOutsideClickListener(),this.scrollHandler&&(this.scrollHandler.destroy(),this.scrollHandler=null),this.unbindResizeListener(),this.container&&(Oe.clear(this.container),this.container=null),this.target=null,this.confirmation=null},methods:{accept:function(){this.confirmation.accept&&this.confirmation.accept(),this.visible=!1},reject:function(){this.confirmation.reject&&this.confirmation.reject(),this.visible=!1},onHide:function(){this.confirmation.onHide&&this.confirmation.onHide(),this.visible=!1},onAcceptKeydown:function(t){(t.code==="Space"||t.code==="Enter")&&(this.accept(),ae.focus(this.target),t.preventDefault())},onRejectKeydown:function(t){(t.code==="Space"||t.code==="Enter")&&(this.reject(),ae.focus(this.target),t.preventDefault())},onEnter:function(t){this.autoFocusAccept=this.confirmation.defaultFocus===void 0||this.confirmation.defaultFocus==="accept",this.autoFocusReject=this.confirmation.defaultFocus==="reject",this.bindOutsideClickListener(),this.bindScrollListener(),this.bindResizeListener(),Oe.set("overlay",t,this.$primevue.config.zIndex.overlay)},onAfterEnter:function(){this.focus()},onLeave:function(){this.autoFocusAccept=null,this.autoFocusReject=null,this.unbindOutsideClickListener(),this.unbindScrollListener(),this.unbindResizeListener()},onAfterLeave:function(t){Oe.clear(t)},alignOverlay:function(){ae.absolutePosition(this.container,this.target);var t=ae.getOffset(this.container),n=ae.getOffset(this.target),e=0;t.left<n.left&&(e=n.left-t.left),this.container.style.setProperty("--overlayArrowLeft","".concat(e,"px")),t.top<n.top&&(this.container.setAttribute("data-p-confirm-popup-flipped","true"),!this.isUnstyled&&ae.addClass(this.container,"p-confirm-popup-flipped"))},bindOutsideClickListener:function(){var t=this;this.outsideClickListener||(this.outsideClickListener=function(n){t.visible&&t.container&&!t.container.contains(n.target)&&!t.isTargetClicked(n)?(t.confirmation.onHide&&t.confirmation.onHide(),t.visible=!1):t.alignOverlay()},document.addEventListener("click",this.outsideClickListener))},unbindOutsideClickListener:function(){this.outsideClickListener&&(document.removeEventListener("click",this.outsideClickListener),this.outsideClickListener=null)},bindScrollListener:function(){var t=this;this.scrollHandler||(this.scrollHandler=new dt(this.target,function(){t.visible&&(t.visible=!1)})),this.scrollHandler.bindScrollListener()},unbindScrollListener:function(){this.scrollHandler&&this.scrollHandler.unbindScrollListener()},bindResizeListener:function(){var t=this;this.resizeListener||(this.resizeListener=function(){t.visible&&!ae.isTouchDevice()&&(t.visible=!1)},window.addEventListener("resize",this.resizeListener))},unbindResizeListener:function(){this.resizeListener&&(window.removeEventListener("resize",this.resizeListener),this.resizeListener=null)},focus:function(){var t=this.container.querySelector("[autofocus]");t&&t.focus({preventScroll:!0})},isTargetClicked:function(t){return this.target&&(this.target===t.target||this.target.contains(t.target))},containerRef:function(t){this.container=t},onOverlayClick:function(t){ut.emit("overlay-click",{originalEvent:t,target:this.target})},onOverlayKeydown:function(t){t.code==="Escape"&&(fe.emit("close",this.closeListener),ae.focus(this.target))},getCXOptions:function(t,n){return{contenxt:{icon:t,iconClass:n.class}}}},computed:{message:function(){return this.confirmation?this.confirmation.message:null},acceptLabel:function(){return this.confirmation?this.confirmation.acceptLabel||this.$primevue.config.locale.accept:null},rejectLabel:function(){return this.confirmation?this.confirmation.rejectLabel||this.$primevue.config.locale.reject:null},acceptIcon:function(){return this.confirmation?this.confirmation.acceptIcon:null},rejectIcon:function(){return this.confirmation?this.confirmation.rejectIcon:null}},components:{CPButton:mt,Portal:ft},directives:{focustrap:_t}};function _e(o){"@babel/helpers - typeof";return _e=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_e(o)}function Fe(o,t){var n=Object.keys(o);if(Object.getOwnPropertySymbols){var e=Object.getOwnPropertySymbols(o);t&&(e=e.filter(function(y){return Object.getOwnPropertyDescriptor(o,y).enumerable})),n.push.apply(n,e)}return n}function Ee(o){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?Fe(Object(n),!0).forEach(function(e){Kt(o,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(n)):Fe(Object(n)).forEach(function(e){Object.defineProperty(o,e,Object.getOwnPropertyDescriptor(n,e))})}return o}function Kt(o,t,n){return t=Jt(t),t in o?Object.defineProperty(o,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):o[t]=n,o}function Jt(o){var t=Gt(o,"string");return _e(t)==="symbol"?t:String(t)}function Gt(o,t){if(_e(o)!=="object"||o===null)return o;var n=o[Symbol.toPrimitive];if(n!==void 0){var e=n.call(o,t||"default");if(_e(e)!=="object")return e;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(o)}var Wt=["aria-modal"];function Qt(o,t,n,e,y,g){var a=w("CPButton"),u=w("Portal"),x=Ce("focustrap");return d(),Q(u,null,{default:D(function(){return[l(vt,se({name:"p-confirm-popup",onEnter:g.onEnter,onAfterEnter:g.onAfterEnter,onLeave:g.onLeave,onAfterLeave:g.onAfterLeave},o.ptm("transition")),{default:D(function(){return[y.visible?me((d(),b("div",se({key:0,ref:g.containerRef,role:"alertdialog",class:o.cx("root"),"aria-modal":y.visible,onClick:t[2]||(t[2]=function(){return g.onOverlayClick&&g.onOverlayClick.apply(g,arguments)}),onKeydown:t[3]||(t[3]=function(){return g.onOverlayKeydown&&g.onOverlayKeydown.apply(g,arguments)})},Ee(Ee({},o.$attrs),o.ptm("root"))),[o.$slots.container?ge(o.$slots,"container",{key:0,message:y.confirmation,onAccept:g.accept,onReject:g.reject}):(d(),b($,{key:1},[o.$slots.message?(d(),Q(Ae(o.$slots.message),{key:1,message:y.confirmation},null,8,["message"])):(d(),b("div",se({key:0,class:o.cx("content")},o.ptm("content")),[ge(o.$slots,"icon",{},function(){return[o.$slots.icon?(d(),Q(Ae(o.$slots.icon),{key:0,class:J(o.cx("icon"))},null,8,["class"])):y.confirmation.icon?(d(),b("span",se({key:1,class:o.cx("icon")},o.ptm("icon")),null,16)):L("",!0)]}),i("span",se({class:o.cx("message")},o.ptm("message")),k(y.confirmation.message),17)],16)),i("div",se({class:o.cx("footer")},o.ptm("footer")),[l(a,{label:g.rejectLabel,onClick:t[0]||(t[0]=function(m){return g.reject()}),onKeydown:g.onRejectKeydown,autofocus:y.autoFocusReject,class:J([o.cx("rejectButton"),y.confirmation.rejectClass]),unstyled:o.unstyled,pt:o.ptm("rejectButton"),"data-pc-name":"rejectbutton"},Pe({_:2},[g.rejectIcon||o.$slots.rejecticon?{name:"icon",fn:D(function(m){return[ge(o.$slots,"rejecticon",{},function(){return[i("span",se({class:[g.rejectIcon,m.class]},o.ptm("rejectButton").icon,{"data-pc-name":"rejectbuttonicon"}),null,16)]})]}),key:"0"}:void 0]),1032,["label","onKeydown","autofocus","class","unstyled","pt"]),l(a,{label:g.acceptLabel,onClick:t[1]||(t[1]=function(m){return g.accept()}),onKeydown:g.onAcceptKeydown,autofocus:y.autoFocusAccept,class:J([o.cx("acceptButton"),y.confirmation.acceptClass]),unstyled:o.unstyled,pt:o.ptm("acceptButton"),"data-pc-name":"acceptbutton"},Pe({_:2},[g.acceptIcon||o.$slots.accepticon?{name:"icon",fn:D(function(m){return[ge(o.$slots,"accepticon",{},function(){return[i("span",se({class:[g.acceptIcon,m.class]},o.ptm("acceptButton").icon,{"data-pc-name":"acceptbuttonicon"}),null,16)]})]}),key:"0"}:void 0]),1032,["label","onKeydown","autofocus","class","unstyled","pt"])],16)],64))],16,Wt)),[[x]]):L("",!0)]}),_:3},16,["onEnter","onAfterEnter","onLeave","onAfterLeave"])]}),_:3})}He.render=Qt;const Xt={props:["order"],setup(o,{emit:t}){X(()=>{_.value&&s.value&&_.value.forEach(U=>{U.permalink===s.value&&(a.value=U.name)})});const n=S(0),e=S([]),y=S(!1),g=S(!0),a=S(),u=ht(),x=S([]),m=S({}),r=S(null),h=S(!1),C=S({...o.order});ie(()=>o.order,U=>{Object.assign(C,U)});const p=De(),v=oe(),O=ee(),V=pe(),j=P(()=>p.allTickets),c=P(()=>v.getCurrentOrder),s=P(()=>V.getCurrentLocation),_=P(()=>V.allLocations),E=P(()=>{const U=o.order.payment_method,N=v.getPaymentMethods;return U?N[U]:"-"}),R=P(()=>{const U=v.getPaymentMethods;return Object.entries(U).map(([N,q])=>({id:N,label:q}))}),G=P(()=>v.paymentMethodAccountList),ce=[{label:"Acconto",value:"deposit"},{label:"Saldo",value:"balance"}],A=U=>U==="deposit"?"Acconto":U==="balance"?"Saldo":"-",B=(U,N)=>{r.value=U,u.require({target:N.currentTarget,message:"Sei sicuro di voler eliminare questo acconto?",icon:"pi pi-info-circle",rejectClass:"p-button-secondary p-button-outlined p-button-sm",acceptClass:"p-button-danger p-button-sm",rejectLabel:"Annulla",acceptLabel:"Elimina",accept:async()=>{var q;await v.deletePayment({location:((q=s.value)==null?void 0:q.permalink)??"",id:o.order.id,payment_id:r.value.id}),await le(),te(O,{message:"Acconto eliminato con successo",error:!1})}})},z=function(){let U={amount:"",payment_method:"",typology:"",id:"-1"};C.value.payments.push(U),x.value.push(U)},de=async function(U){var N,q;h.value=!0;try{let{newData:ne}=U;const he={amount:ne.amount,payment_method:ne.payment_method,typology:ne.typology};ne.id!=-1?await v.updatePayment({location:((N=s.value)==null?void 0:N.permalink)??"",id:o.order.id,payment_id:ne.id,payment:he}):await v.createPayment({location:((q=s.value)==null?void 0:q.permalink)??"",id:o.order.id,payment:he}),await le()}catch(ne){I(O,ne)}finally{h.value=!1}},ue=function(U,N){m.value.payments.splice(N,1)},le=async function(){var U;try{const N=await v.getPayment({location:((U=s.value)==null?void 0:U.permalink)??"",id:o.order.id});C.value.payments.splice(0,C.value.payments.length,...N.payments),C.value.paid_amount=N.paid_amount,C.value.remaining_amount=N.remaining_amount}catch{C.value.remaining_amount="0.0",C.value.paid_amount="0.0",C.value.payments=[]}};return{tickets:j,active:n,partialTotals:e,showOrderDetail:y,currentOrder:c,showSecondTab:g,currentLocation:s,selectedLocation:a,editingRows:x,localOrder:C,loadingPayments:h,formatExplicitDate:Ie,formatDate:Le,confirm1:B,addAmount:z,onRowEditSave:de,deleteSlot:ue,dynamicPaymentMethods:R,typologyOptions:ce,getPayments:le,paymentMethodAccountList:G,prettyPaymentStatus:ze,formatPrettyDate:wt,formatDataAndHourFromUnixTimestamps:xt,prettyPaymentMethod:Dt,methodLabel:E,prettyTypology:A}},components:{ConfirmPopup:He}};const Zt={class:"mt-3 line-height-3"},Yt={class:"flex gap-3"},$t=i("i",{class:"pi pi-user mt-1"},null,-1),eo={class:"m-0 mb-1"},to={class:"m-0 mb-1"},oo={class:"m-0 mb-1"},no={class:"m-0 mb-1"},io={key:0},lo={class:"flex gap-3 mt-4"},ao=i("i",{class:"pi pi-map-marker mt-1"},null,-1),so={class:"m-0 mb-1"},ro={class:"m-0 mb-1"},co={key:0,class:"m-0 mb-1"},uo={class:"flex gap-3 mt-4"},mo=i("i",{class:"pi pi-shopping-cart mt-1"},null,-1),fo={class:"m-0 mb-1"},_o={class:"m-0 mb-1"},po={class:"m-0 mb-1"},vo={key:0,class:"m-0 mb-1"},ho={key:1,class:"m-0 mb-1"},yo={key:2,class:"m-0 mb-1"},go={class:"m-0 mb-1"},bo={class:"m-0 mb-1"},ko={key:0},wo={key:1},xo={class:"m-0 mb-1"},Co={key:0},Do={key:1},Oo={class:"m-0 mb-1"},So={key:0},Vo={key:1},Lo={class:"ml-5"},To={class:"field flex justify-content-between align-items-end mt-4 mb-3"},Ao=i("label",null,"Pagamenti",-1),Po={key:1,class:"flex gap-3 mt-4"},jo=i("i",{class:"pi pi-comment mt-1"},null,-1);function Mo(o,t,n,e,y,g){const a=w("Badge"),u=w("Button"),x=w("InputNumber"),m=w("Column"),r=w("Dropdown"),h=w("DataTable"),C=w("ConfirmPopup");return d(),b("div",Zt,[i("div",Yt,[$t,i("div",null,[i("p",eo,k(n.order.user_name)+" "+k(n.order.user_surname||"-"),1),i("p",to,k(n.order.user_email),1),i("p",oo,k(n.order.user_phone),1),i("p",no,[F(k(n.order.country)+" ",1),n.order.user_zip?(d(),b("span",io," - "+k(n.order.user_zip),1)):L("",!0)])])]),i("div",lo,[ao,i("div",null,[i("p",so,k(e.selectedLocation),1),i("p",ro,k(n.order.course_name),1),n.order.date?(d(),b("p",co,k(e.formatPrettyDate(n.order.date))+" "+k(n.order.start_at),1)):L("",!0)])]),i("div",uo,[mo,i("div",null,[i("p",fo,k(n.order.reservation_number),1),i("p",_o,k(e.formatDataAndHourFromUnixTimestamps(n.order.created_at)),1),i("p",po,k(n.order.created_by),1),n.order.status?(d(),b("p",vo,[l(a,{value:e.prettyPaymentStatus(n.order.status),class:J([n.order.status,"px-3 border-round-lg"])},null,8,["value","class"])])):L("",!0),n.order.status=="payed"?(d(),b("p",ho,k(e.methodLabel),1)):L("",!0),n.order.open_tickets_used&&n.order.status=="payed"?(d(),b("p",yo,[(d(!0),b($,null,be(n.order.open_tickets_used,p=>(d(),b("span",{key:p},[l(a,{value:p.code,class:"mr-2 voucher"},null,8,["value"])]))),128))])):L("",!0),i("p",go,"Codice sconto utilizzato: "+k(e.localOrder.discount_code||"-"),1),i("p",bo,[F(" Totale ordine: "),e.localOrder.total?(d(),b("span",ko,"€ "+k((+e.localOrder.total).toFixed(2)),1)):(d(),b("span",wo,"-"))]),e.localOrder.multi_payment&&e.localOrder.paid_amount!="0.0"?(d(),b($,{key:3},[i("p",xo,[F(" Acconto versato: "),e.localOrder.paid_amount?(d(),b("span",Co,"€ "+k((+e.localOrder.paid_amount).toFixed(2)),1)):(d(),b("span",Do,"-"))]),i("p",Oo,[F(" Saldo rimanente: "),e.localOrder.remaining_amount?(d(),b("span",So,"€ "+k((+e.localOrder.remaining_amount).toFixed(2)),1)):(d(),b("span",Vo,"-"))])],64)):!e.localOrder.payments||e.localOrder.payments.length===0?(d(),Q(u,{key:4,label:"Acconto / Saldo",icon:"pi pi-plus",rounded:"",outlined:"",onClick:t[0]||(t[0]=p=>e.addAmount()),class:"mt-2"})):L("",!0)])]),e.localOrder.payments&&e.localOrder.payments.length?(d(),b($,{key:0},[i("div",Lo,[i("div",To,[Ao,l(u,{label:"Acconto / Saldo",icon:"pi pi-plus",rounded:"",outlined:"",onClick:t[1]||(t[1]=p=>e.addAmount())})]),l(h,{value:e.localOrder.payments,dataKey:"id",size:"small",editingRows:e.editingRows,"onUpdate:editingRows":t[2]||(t[2]=p=>e.editingRows=p),editMode:"row",onRowEditSave:e.onRowEditSave,loading:e.loadingPayments},{default:D(()=>[l(m,{field:"amount",header:"Importo"},{editor:D(({data:p,field:v})=>[l(x,{modelValue:p[v],"onUpdate:modelValue":O=>p[v]=O,inputId:"currency-germany",mode:"currency",currency:"EUR",locale:"it-IT",class:"w-full"},null,8,["modelValue","onUpdate:modelValue"])]),body:D(p=>[F(k(p.data.amount?Number(p.data.amount).toFixed(2):"0.00")+" € ",1)]),_:1}),l(m,{field:"paid_at",header:"Data pagamento"},{body:D(p=>[F(k(p.data.paid_at),1)]),editor:D(({data:p,field:v})=>[F(k(p[v]),1)]),_:1}),l(m,{field:"payment_method",header:"Metodo"},{editor:D(({data:p,field:v})=>[l(r,{modelValue:p[v],"onUpdate:modelValue":O=>p[v]=O,options:e.paymentMethodAccountList,optionLabel:"label",optionValue:"id",class:"w-full",placeholder:"Seleziona metodo..."},null,8,["modelValue","onUpdate:modelValue","options"])]),body:D(p=>[F(k(e.prettyPaymentMethod(p.data.payment_method)),1)]),_:1}),l(m,{field:"typology",header:"Tipologia"},{editor:D(({data:p,field:v})=>[l(r,{modelValue:p[v],"onUpdate:modelValue":O=>p[v]=O,options:e.typologyOptions,optionLabel:"label",optionValue:"value",class:"w-full",placeholder:"Seleziona tipologia"},null,8,["modelValue","onUpdate:modelValue","options"])]),body:D(p=>[F(k(e.prettyTypology(p.data.typology)),1)]),_:1}),l(m,{rowEditor:!0,style:{width:"8rem"},bodyStyle:"text-align:right"}),l(m,{header:""},{body:D(p=>[p.data.id!=="-1"?(d(),Q(u,{key:0,icon:"pi pi-trash",class:"p-button-text p-button-sm p-button-danger",onClick:v=>e.confirm1(p.data,v)},null,8,["onClick"])):L("",!0)]),_:1})]),_:1},8,["value","editingRows","onRowEditSave","loading"])]),l(C)],64)):L("",!0),n.order.notes?(d(),b("div",Po,[jo,i("div",null,k(n.order.notes),1)])):L("",!0)])}const Fo=W(Xt,[["render",Mo]]),Eo={props:["order","location_permalink"],setup(o,t){X(()=>{o.order&&o.order.notes&&(n.value=o.order.notes)});const n=S(),{showLoader:e,hideLoader:y}=ve(),g=ee(),a=oe(),u=P(()=>a.getCurrentOrder);return{notes:n,updateOrder:async function(){const m={id:o.location_permalink,order_id:o.order.id,notes:n.value,api_version:"v2"};e(),await a.updateOrder(m).then(()=>{y(),te(g,{message:"Nota aggiornata correttamente",error:!1}),t.emit("closeDialog",u.value)}).catch(r=>{y(),I(g,r)})}}}},Ro={class:"pt-5 px-2"},Uo={class:"flex align-items-center justify-content-end mt-3"};function No(o,t,n,e,y,g){const a=w("Textarea"),u=w("Button");return d(),b("div",Ro,[l(a,{modelValue:e.notes,"onUpdate:modelValue":t[0]||(t[0]=x=>e.notes=x),rows:"8",cols:"30",class:"w-full"},null,8,["modelValue"]),i("div",Uo,[l(u,{label:"Annulla",text:"",onClick:t[1]||(t[1]=x=>o.$emit("closeDialog",null))}),l(u,{label:"Conferma",onClick:t[2]||(t[2]=x=>e.updateOrder())})])])}const Io=W(Eo,[["render",No]]),Bo={props:["filters"],setup(o,t){X(()=>{c.value=!0,s.value={first:0,rows:p.value.rows,sortField:null,sortOrder:null},s.value.page=0,o.filters.location&&z()});const n=oe(),e=Te(),y=P(()=>n.responseOrders),g=P(()=>n.status),a=yt(),u=P(()=>a.submitDialog),x=P(()=>n.paymentStatus),m=P(()=>n.getDeleteResponse),{showLoader:r,hideLoader:h}=ve(),C=ee(),p=S(),v=S(),O=S(),V=S(),j=S(),c=S(!0),s=S(),_=S(0),E=S([]),R=S([]),G=S(!1),ce=S(!1),A=S(),B=S(!1);function z(){c.value=!0;let f=new Map;for(const T in o.filters)T=="date"?ke(o.filters.date)=="Invalid DateTime"?f.set("date",Be(o.filters.date)):f.set("date",ke(o.filters.date)):o.filters.location&&f.set("location_permalink",o.filters.location.permalink),T=="course"&&o.filters.course.id!="-1"&&f.set("course",o.filters.course.id),T=="hour"&&o.filters.hour!="Tutti gli orari"&&f.set("hour",o.filters.hour),T=="name"&&f.set("name",o.filters.name);setTimeout(()=>{de(f)},Math.random()*1e3+250)}const de=async function(f){await n.fetchAllOrders(f).then(()=>{c.value=!1}).catch(T=>{c.value=!1,I(C,T)})},ue=f=>{O.value.toggle(f),A.value.toggle(f)},le=(f,T)=>f>f+T?"red":"green",U=function(f,T){T&&(O.value.note=T,O.value.toggle(f))},N=function(f){f.order&&y.value.time_slots&&y.value.time_slots.forEach((T,M)=>{T.orders.forEach((H,K)=>{H.id==f.order.id&&(y.value.time_slots[M].orders[K]=f.order,f.check_in_done!=null&&(y.value.time_slots[M].check_in_done+=f.check_in_done))})})},q=async function(f,T){let M=[],H=!1;R.value.forEach(Y=>{if(Y.id==f.id){H=!0;return}});for(let Y of f.tickets)M.push(Y.order_item_id);const K={check_in:T,order_item_ids:M,location_permalink:o.filters.location};await n.checkInOrder(K).then(()=>{N(m.value),te(C,{message:"Check-in registrato correttamente",error:!1}),H&&ye(R.value,m.value.order)}).catch(Y=>{I(C,Y)})},ne=async function(f,T){let M=[],H=!1;R.value.forEach(Y=>{if(Y.id==f.id){H=!0;return}});for(let Y of f.tickets)M.push(Y.order_item_id);const K={order_item_ids:M,no_show:T,location_permalink:o.filters.location.permalink};await n.noShowOrder(K).then(()=>{N(m.value),te(C,{message:"No-show registrato correttamente",error:!1}),H&&ye(R.value,m.value.order)}).catch(Y=>{I(C,Y)})},he=async function(f,T,M){const H={id:f,check_in:T,location_permalink:o.filters.location.permalink};await n.checkInTicket(H).then(()=>{te(C,{message:"Check-in registrato correttamente",error:!1}),N(m.value),ye(R.value,m.value.order)}).catch(K=>{I(C,K)})},Je=async function(f,T,M){const H={id:f,no_show:T,location_permalink:o.filters.location.permalink};await n.noShowTicket(H).then(()=>{te(C,{message:"No-show registrato correttamente",error:!1}),N(m.value),ye(R.value,m.value.order)}).catch(K=>{I(C,K)})},ye=function(f,T){let M=Ge(R.value,m.value.order.id);M!=-1&&R.value.splice(M,1),R.value.push(m.value.order)},Ge=function(f,T){for(let M=0;M<f.length;M++)if(f[M].id===T)return M;return-1},We=function(f){const T={course_name:f.course_name,start_at:f.start_at,date:o.filters.date,hour:f.start_at,max_seats:f.is_free_slot?null:f.remaing_seats+""};t.emit("updateFilters",T)},Qe=function(f){G.value=!0,V.value=f},Xe=function(f){N({order:f}),G.value=!1,B.value=!1},Ze=function(f){return f!=null&&f.created_by&&(f==null?void 0:f.created_by)=="WEB"?"WEB":"KALATA"},Ye=function(f,T){let M=0;if(f&&f.tickets){f.tickets.forEach(K=>{T?K.no_show&&(M+=1):K.check_in&&(M+=1)});let H=f.tickets.length;if(M!=H&&M!=0)return M+"/"+H}},$e=function(f,T){A.value.data=T,A.value.toggle(f)},et=function(f,T){j.value=T.id;let M="Sei sicuro di voler eliminare questa prenotazione?";M+='<br><br> <i>N.B. Eventuali voucher presenti nella prenotazione vanno liberati manualmente dalla sezione "Data aperta"</i>',a.setDialog("Elimina prenotazione","Elimina","Annulla",M),a.setBtnSubmit(!1),a.setDynamicDialogVisibility(!0)},tt=function(){if(r(),j.value){const f={id:j.value,location_permalink:o.filters.location.permalink};n.deleteOrder(f).then(()=>{h(),te(C,{message:"La prenotazione è stata eliminata correttamente",error:!1}),y.value.time_slots&&y.value.time_slots.forEach((T,M)=>{T.orders.forEach((H,K)=>{H.id==j.value&&(y.value.time_slots[M].orders.splice(K,1),m.value,y.value.time_slots[M].check_in_done+=m.value.check_in_done,y.value.time_slots[M].confirmed_seats+=m.value.confirmed_seats,y.value.time_slots[M].remaing_seats-=m.value.confirmed_seats)})})}).catch(T=>{h(),I(C,T)})}},ot=function(f){E.value=f.data?[f.data]:[]},nt=function(f){R.value=f.data?[f.data]:[]},it=function(f){ce.value=!0,v.value=f},lt=function(f){B.value=!0,v.value=f},at=function(f){const T=new Map;T.set("id",f.id),T.set("location_permalink",o.filters.location.permalink),r(),n.downloadTicket(T).then(()=>{h()}).catch(M=>{h(),I(C,M)})},st=function(f,T){r(),we(f,T.location.permalink).then(()=>{h()}).catch(()=>{h()})},rt=function(f,T){r(),Ve(f,T.location.permalink).then(()=>{h()}).catch(()=>{h()})},ct=async()=>{await z(),v.value&&v.value.id&&(await n.fetchOrderDetail(v.value.id),v.value={...n.getCurrentOrder})};return ie(u,f=>{f&&tt()}),ie(o.filters,()=>{o.filters.location&&z()}),{dt:p,responseOrders:y,loading:c,totalRecords:_,lazyParams:s,currentOrder:v,status:g,expandedRows:E,expandedRows1:R,op:O,dialogStore:e,paymentList:x,visibleDialog:G,currentTimeSlot:V,visibleMenu:A,visibleDetailDialog:ce,visibleNotesDialog:B,toast:C,loadLazyData:z,toggle:ue,getProgressClass:le,showNotes:U,checkAll:q,noShowAll:ne,openDialog:We,checkInSingleTicket:he,noShowSingleTicket:Je,prettyPaymentStatus:ze,openPaymentStatusDialog:Qe,onClosePaymentStatusDialog:Xe,getRowClass:Ze,printPDF:Ve,showLabelCheckbox:Ye,confirmDeleteOrder:et,showMenu:$e,openOrderDetailDialog:it,openNotesDialog:lt,downloadPDF:at,handleRowToggle:ot,handleRowToggle1:nt,openPDFTab:st,openPDFTicketTab:rt,onRefreshOrder:ct,formatDataFromUnixTimestamps:Ct,printOrderPDF:we}},components:{PaymentStatusDialog:It,OrderDetailDialog:Fo,NotesDialog:Io}};const zo={class:"order-table"},qo={class:""},Ho={style:{width:"15rem"}},Ko={class:"m-0 text-right",style:{"font-size":"12px"}},Jo={key:0,class:"pi pi-exclamation-triangle cursor-pointer",style:{color:"var(--orange-400)"}},Go={style:{width:"15rem"}},Wo={class:"m-0 text-right",style:{"font-size":"12px"}},Qo={key:0},Xo={key:0},Zo=i("div",{class:"flex justify-content-center w-full"},"Check-in",-1),Yo={class:"flex justify-content-center"},$o={class:"flex flex-column",style:{"margin-top":"8px"}},en={class:"text-sm",style:{"min-height":"15px"}},tn=i("div",{class:"flex justify-content-center w-full"},"No-show",-1),on={class:"flex justify-content-center"},nn={class:"flex flex-column",style:{"margin-top":"8px"}},ln={class:"text-sm",style:{"min-height":"15px"}},an=["onClick"],sn={style:{"max-width":"50rem"},class:"p-3"},rn={class:"overlay-menu"},cn=["onClick"],dn=i("i",{class:"pi pi-eye mr-3"},null,-1),un=["onClick"],mn=i("i",{class:"pi pi-shopping-cart mr-3"},null,-1),fn=["onClick"],_n=i("i",{class:"pi pi-print mr-3"},null,-1),pn=["onClick"],vn=i("i",{class:"pi pi-download mr-3"},null,-1),hn=["onClick"],yn=i("i",{class:"pi pi-comment mr-3"},null,-1),gn=["disabled","onClick"],bn=i("i",{class:"pi pi-pencil mr-3"},null,-1),kn=["disabled","onClick"],wn=i("i",{class:"pi pi-trash mr-3"},null,-1),xn={key:0},Cn={key:1},Dn=i("div",{class:"flex justify-content-center w-full"},"Check-in",-1),On={class:"flex justify-content-center"},Sn=i("div",{class:"flex justify-content-center w-full"},"No-show",-1),Vn={class:"flex justify-content-center"},Ln=i("div",{class:"flex justify-content-center w-full"},null,-1),Tn={class:"flex justify-content-center"},An={key:0,class:"flex mx-4"},Pn=i("div",null,[i("div",{class:"p-0 m-0 flex align-items-center"},[i("p",{style:{width:"2rem",height:"5px"},class:"mr-2 web my-0"}),i("span",{class:"text-sm"},"WEB")]),i("div",{class:"p-0 m-0 flex align-items-center justify-content-between"},[i("p",{style:{width:"2rem",height:"5px"},class:"mr-2 kalata"}),i("span",{class:"text-sm"},"SUPERGA")])],-1),jn=[Pn];function Mn(o,t,n,e,y,g){const a=w("Column"),u=w("ProgressBar"),x=w("Button"),m=w("Badge"),r=w("Checkbox"),h=w("OverlayPanel"),C=w("DataTable"),p=w("PaymentStatusDialog"),v=w("Dialog"),O=w("OrderDetailDialog"),V=w("NotesDialog"),j=Ce("tooltip");return d(),b("div",zo,[l(C,{value:e.responseOrders.time_slots,totalRecords:e.responseOrders.total,lazy:!0,paginator:!1,ref:"dt",loading:e.loading,stripedRows:"",expandedRows:e.expandedRows,"onUpdate:expandedRows":t[1]||(t[1]=c=>e.expandedRows=c),onRowExpand:e.handleRowToggle},{empty:D(()=>[F(" Nessuna prenotazione trovata. ")]),expansion:D(c=>[l(C,{value:c.data.orders,class:"m-4 mx-4 table-order-detail",expandedRows:e.expandedRows1,"onUpdate:expandedRows":t[0]||(t[0]=s=>e.expandedRows1=s),rowClass:e.getRowClass,onRowExpand:e.handleRowToggle1},{empty:D(()=>[F(" Nessuna prenotazione trovata. ")]),expansion:D(s=>[l(C,{value:s.data.tickets,class:"m-4 mx-5"},{default:D(()=>[l(a,{header:"Codice biglietto",field:"code"}),l(a,{header:"Tipo biglietto",field:"type"},{body:D(({data:_})=>[l(m,{value:_.ticket_name,class:J([_.ticket_name,"px-3 border-round-lg"])},null,8,["value","class"])]),_:1}),l(a,{header:"Prezzo"},{body:D(({data:_})=>[_.ticket_price?(d(),b("span",xn," € "+k((+_.ticket_price).toFixed(2)),1)):(d(),b("span",Cn,"-"))]),_:1}),l(a,null,{header:D(()=>[Dn]),body:D(({data:_})=>[i("div",On,[l(r,{modelValue:_.check_in,"onUpdate:modelValue":E=>_.check_in=E,binary:!0,onChange:E=>e.checkInSingleTicket(_.id,_.check_in,s.data),class:"check_in"},null,8,["modelValue","onUpdate:modelValue","onChange"])])]),_:2},1024),l(a,null,{header:D(()=>[Sn]),body:D(({data:_})=>[i("div",Vn,[l(r,{modelValue:_.no_show,"onUpdate:modelValue":E=>_.no_show=E,binary:!0,onChange:E=>e.noShowSingleTicket(_.id,_.no_show,s.data),class:"no_show"},null,8,["modelValue","onUpdate:modelValue","onChange"])])]),_:2},1024),l(a,{field:"tickets_url"},{header:D(()=>[Ln]),body:D(({data:_})=>[i("div",Tn,[me(l(x,{link:"",icon:"pi pi-print",href:_.tickets_url,target:"_blank",style:{color:"var(--surface-400)"},text:"",rounded:"",onClick:E=>e.openPDFTicketTab(_.id,n.filters)},null,8,["href","onClick"]),[[j,"Stampa",void 0,{top:!0}]])])]),_:1})]),_:2},1032,["value"])]),default:D(()=>[l(a,{header:"Codice",field:"reservation_number"}),l(a,{header:"Acquirente"},{body:D(({data:s})=>[F(k(s.user_name)+" "+k(s.user_surname)+" ",1),!s.user_name&&!s.user_surname?(d(),b("span",Qo,"-")):L("",!0)]),_:1}),l(a,{header:"Pagamento"},{body:D(({data:s})=>[s.status?(d(),b("span",Xo,[l(m,{value:e.prettyPaymentStatus(s.status),class:J([s.status,"px-3 border-round-lg"])},null,8,["value","class"])])):L("",!0)]),_:1}),l(a,{header:"Q.ta",field:"tickets_number"}),l(a,null,{header:D(()=>[Zo]),body:D(({data:s})=>[i("div",Yo,[i("div",$o,[l(r,{modelValue:s.check_in,"onUpdate:modelValue":_=>s.check_in=_,binary:!0,onChange:_=>e.checkAll(s,s.check_in),class:"check_in"},null,8,["modelValue","onUpdate:modelValue","onChange"]),i("span",en,k(e.showLabelCheckbox(s,!1)),1)])])]),_:1}),l(a,null,{header:D(()=>[tn]),body:D(({data:s})=>[i("div",on,[i("div",nn,[l(r,{modelValue:s.no_show,"onUpdate:modelValue":_=>s.no_show=_,binary:!0,onChange:_=>e.noShowAll(s,s.no_show),class:"no_show"},null,8,["modelValue","onUpdate:modelValue","onChange"]),i("span",ln,k(e.showLabelCheckbox(s,!0)),1)])])]),_:1}),l(a,{header:"Note"},{body:D(({data:s})=>[i("div",{class:"notes cursor-pointer",onClick:_=>e.showNotes(_,s.notes)},k(s.notes||"-"),9,an),l(h,{ref:"op"},{default:D(()=>[i("div",sn,k(e.op.note),1)]),_:1},512)]),_:1}),l(a,{header:"",style:{"padding-right":"0",width:"6rem"}},{body:D(({data:s})=>[l(x,{type:"button","aria-haspopup":"true","aria-controls":"overlay_menu",icon:"pi pi-ellipsis-v",text:"",rounded:"",onClick:_=>e.showMenu(_,s)},null,8,["onClick"]),l(h,{ref:"visibleMenu"},{default:D(()=>[i("ul",rn,[i("li",{onClick:_=>e.openOrderDetailDialog(e.visibleMenu.data)},[dn,F("Dettaglio ordine ")],8,cn),i("li",{onClick:_=>e.openOrderDetailDialog(e.visibleMenu.data)},[mn,F("Dettaglio pagamento ")],8,un),i("li",{onClick:_=>e.openPDFTab(e.visibleMenu.data,n.filters)},[_n,F("Stampa ")],8,fn),i("li",{onClick:_=>e.downloadPDF(e.visibleMenu.data)},[vn,F("Scarica PDF ")],8,pn),i("li",{onClick:_=>e.openNotesDialog(e.visibleMenu.data)},[yn,F("Modifica nota ")],8,hn),i("li",{disabled:!e.visibleMenu.data.can_change_status,onClick:_=>e.openPaymentStatusDialog(e.visibleMenu.data)},[bn,F("Cambia stato ")],8,gn),i("li",{disabled:!e.visibleMenu.data.can_cancel,onClick:_=>e.confirmDeleteOrder(_,e.visibleMenu.data)},[wn,F("Elimina ")],8,kn)])]),_:2},1536)]),_:1}),l(a,{expander:"",class:"pl-0 ml-0"})]),_:2},1032,["value","expandedRows","rowClass","onRowExpand"]),c.data.orders&&c.data.orders.length>0?(d(),b("div",An,jn)):L("",!0)]),default:D(()=>[l(a,{header:"Percorso",field:"course_name",filterMatchMode:"contains",ref:"course_name"},null,512),l(a,{header:"Orario",field:"start_at",filterMatchMode:"contains",ref:"start_at"},{body:D(({data:c})=>[i("div",qo,[i("span",{class:J(c.is_free_slot?"free":"")},k(c.start_at),3)])]),_:1},512),l(a,{header:"Posti prenotati",ref:"availabe_tickets",field:"availabe_tickets"},{body:D(({data:c})=>[i("div",Ho,[i("p",Ko,[F(k(c.confirmed_seats)+"/"+k(c.remaing_seats+c.confirmed_seats)+" ",1),c.confirmed_seats>c.remaing_seats+c.confirmed_seats?me((d(),b("i",Jo,null,512)),[[j,c.confirmed_seats-(c.remaing_seats+c.confirmed_seats)+" posti in overbooking",void 0,{top:!0}]]):L("",!0)]),l(u,{value:c.confirmed_seats*100/(c.remaing_seats+c.confirmed_seats),showValue:!1,style:{height:"10px"},class:J(["available-progress",e.getProgressClass(c.confirmed_seats,c.remaing_seats)])},null,8,["value","class"])])]),_:1},512),l(a,{header:"Check-in",ref:"confirmed_tickets",field:"confirmed_tickets"},{body:D(({data:c})=>[i("div",Go,[i("p",Wo,k(c.check_in_done)+"/"+k(c.confirmed_seats),1),l(u,{value:c.check_in_done*100/(c.remaing_seats+c.confirmed_seats),showValue:!1,style:{height:"10px"},class:"check-in-progress"},null,8,["value"])])]),_:1},512),l(a,null,{body:D(({data:c})=>[me(l(x,{type:"button","aria-haspopup":"true","aria-controls":"overlay_menu",class:"mr-0 text-primary",icon:"pi pi-calendar",text:"",rounded:"",onClick:s=>e.openDialog(c)},null,8,["onClick"]),[[j,"Prenota",void 0,{top:!0}]])]),_:1}),l(a,{expander:"",style:{width:"5rem"}})]),_:1},8,["value","totalRecords","loading","expandedRows","onRowExpand"]),l(v,{visible:e.visibleDialog,"onUpdate:visible":t[3]||(t[3]=c=>e.visibleDialog=c),modal:"",header:"Stato pagamento",style:{width:"35rem"}},{default:D(()=>[l(p,{location_permalink:n.filters.location.permalink,time_slot:e.currentTimeSlot,onCloseDialog:t[2]||(t[2]=c=>e.onClosePaymentStatusDialog(c))},null,8,["location_permalink","time_slot"])]),_:1},8,["visible"]),l(v,{visible:e.visibleDetailDialog,"onUpdate:visible":t[4]||(t[4]=c=>e.visibleDetailDialog=c),modal:"",header:"Dettaglio ordine",style:{width:"70rem"},onAfterHide:e.loadLazyData},{default:D(()=>[l(O,{order:e.currentOrder},null,8,["order"])]),_:1},8,["visible","onAfterHide"]),l(v,{visible:e.visibleNotesDialog,"onUpdate:visible":t[6]||(t[6]=c=>e.visibleNotesDialog=c),modal:"",header:"Modifica nota",style:{width:"35rem"}},{default:D(()=>[l(V,{order:e.currentOrder,location_permalink:n.filters.location.permalink,onCloseDialog:t[5]||(t[5]=c=>e.onClosePaymentStatusDialog(c))},null,8,["order","location_permalink"])]),_:1},8,["visible"])])}const Fn=W(Bo,[["render",Mn]]),En={props:["filters"],setup(o,t){X(()=>{C(),n.value=o.filters,n.value.date=new Date,O()});const n=S({}),e=pe(),y=oe(),g=ee(),a=S([]),u=S(),x=re.now().plus({years:1}),m=P(()=>e.allLocations),r=P(()=>y.getCalendar),h=async function(c){await y.fetchCalendar(c).then(()=>{}).catch(s=>{I(g,s)})},C=async function(){await e.fetchAllLocations().then(()=>{}).catch(c=>{I(g,c)})},p=function(){if(o.filters.location){const c=m.value.find(s=>s.permalink===o.filters.location);a.value=c.courses}},v=function(c){let s={};s.month=re.fromJSDate(new Date(c)).month,s.year=re.fromJSDate(new Date(c)).year,s.location_permalink=o.filters.location.permalink?o.filters.location.permalink:o.filters.location,u.value={month:s.month,year:s.year},h(s)},O=function(){let c=re.now(),s={location_permalink:"",month:"",year:""};s.location_permalink=o.filters.location.permalink?o.filters.location.permalink:o.filters.location,s.month=c.month+"",s.year=c.year+"",h(s)},V=function(c){if(r.value.web_dates&&r.value.web_dates.length!=0){let s=c.month+1;s=s<10?"0"+s:s;let _=c.day<10?"0"+c.day:c.day,E=c.year+"-"+s+"-"+_;return r.value.web_dates.find(R=>R==E)}},j=function(c){let s={location_permalink:o.filters.location.permalink?o.filters.location.permalink:o.filters.location,month:c.month,year:c.year};h(s)};return ie(o.filters,()=>{if(u.value){let c={location_permalink:o.filters.location.permalink?o.filters.location.permalink:o.filters.location,month:u.value.month,year:u.value.year};h(c)}else O()}),{form:n,courses:a,maxAllowedDate:x,locations:m,calendar:r,getCourses:p,onDateChange:v,getDayFromDate:V,onMonthChange:j}}};const Rn={class:"flex calendar-filter"},Un={key:0,class:"special-day"};function Nn(o,t,n,e,y,g){const a=w("Calendar");return d(),b("div",Rn,[l(a,{modelValue:e.form.date,"onUpdate:modelValue":t[0]||(t[0]=u=>e.form.date=u),inline:"",onDateSelect:t[1]||(t[1]=u=>e.onDateChange(u)),onMonthChange:t[2]||(t[2]=u=>e.onMonthChange(u)),maxDate:e.maxAllowedDate.toJSDate()},{date:D(u=>[e.getDayFromDate(u.date)?(d(),b("div",Un,[i("span",null,k(u.date.day),1)])):(d(),b($,{key:1},[F(k(u.date.day),1)],64))]),_:1},8,["modelValue","maxDate"])])}const In=W(En,[["render",Nn]]);class Bn{static async fetchAll(t){const n=t.location_permalink;return delete t.location_permalink,(await Se(`/ticket_office/${n}/search/courses`,t)).data}}const Ke=xe({id:"course",state:()=>({course:{},courses:[],response_courses:{}}),getters:{allCourses:o=>o.response_courses.tickets,responseCourses:o=>o.response_courses,getTotalCourses:o=>o.response_courses?o.response_courses.total:0,getCurrentCourse:o=>o.course},actions:{async fetchAllCourses(o){await Bn.fetchAll(o).then(t=>this.response_courses=t)}}}),zn={props:["filters"],setup(o,t){X(()=>{n.value=Object.assign({},o.filters),n.value.date=re.now().toFormat("dd/MM/yyyy"),a.value=qe(8,20),a.value.unshift("Tutti gli orari"),n.value.hour="Tutti gli orari"});const n=S({}),e=S([]),y=pe(),g=ee(),a=S([]),u=oe(),x=Ke(),m=P(()=>y.allLocations),r=P(()=>u.responseOrders),h=P(()=>x.allCourses),C=function(){n.value.name=null,n.value.course=e.value[0].name,n.value.hour=a.value[0],t.emit("onSubmit",n.value)},p=async function(){const v={location_permalink:n.value.location.permalink,api_version:"v2"};await x.fetchAllCourses(v).then(()=>{}).catch(O=>{I(g,O)})};return ie(m,()=>{o.filters.location&&m.value&&(n.value=Object.assign({},o.filters),n.value.hour||(n.value.hour="Tutti gli orari"),p())}),ie(o.filters,()=>{o.filters.location&&m.value&&n.value.location&&n.value.location!=o.filters.location&&(n.value=Object.assign({},o.filters),n.value.hour||(n.value.hour="Tutti gli orari"))}),ie(h,()=>{var v;e.value=Object.assign([],h.value),e.value&&((v=e.value[0])==null?void 0:v.id)!="-1"&&e.value.unshift({id:"-1",name:"Tutti i percorsi"}),n.value.course=e.value[0].name}),{form:n,courses:e,hours:a,locations:m,responseOrders:r,resetField:C}}},qn={class:"formgrid grid px-0 align-items-center"},Hn={key:0,class:"field col-4 flex flex-column"},Kn=i("label",{for:"typology"},"Filtra per percorso",-1),Jn={key:1,class:"field col-3 flex flex-column"},Gn=i("label",{for:"typology"},"Filtra per orario (dalle)",-1),Wn=i("div",{class:"col-12"},null,-1),Qn={class:"field col-4 flex flex-column"},Xn=i("label",{for:"typology"},"Filtra per acquirente",-1),Zn={class:"flex col-12 justify-content-end pt-1"};function Yn(o,t,n,e,y,g){const a=w("Dropdown"),u=w("InputText"),x=w("Button"),m=w("AccordionTab"),r=w("Accordion");return d(),Q(r,{activeIndex:0},{default:D(()=>[l(m,{header:"FILTRI"},{default:D(()=>[i("div",qn,[e.form.location&&e.courses?(d(),b("div",Hn,[Kn,l(a,{modelValue:e.form.course,"onUpdate:modelValue":t[0]||(t[0]=h=>e.form.course=h),options:e.courses,optionLabel:"name",optionValue:"name",placeholder:""},null,8,["modelValue","options"])])):L("",!0),e.responseOrders?(d(),b("div",Jn,[Gn,l(a,{modelValue:e.form.hour,"onUpdate:modelValue":t[1]||(t[1]=h=>e.form.hour=h),options:e.hours,placeholder:""},null,8,["modelValue","options"])])):L("",!0),Wn,i("div",Qn,[Xn,l(u,{modelValue:e.form.name,"onUpdate:modelValue":t[2]||(t[2]=h=>e.form.name=h),placeholder:""},null,8,["modelValue"])])]),i("div",Zn,[l(x,{label:"Ricerca",class:"mr-2",onClick:t[3]||(t[3]=h=>o.$emit("onSubmit",e.form))}),l(x,{label:"Annulla",class:"p-button-outlined",onClick:t[4]||(t[4]=h=>e.resetField())})])]),_:1})]),_:1})}const $n=W(zn,[["render",Yn]]),ei={props:["form","price","index","ticket"],setup(o,t){const n=S(0),e=function(){n.value++,g()},y=function(){n.value>0&&n.value--,g()},g=function(){n.value==null&&(n.value=0);const a={counter:n.value,price:o.price,index:o.index,ticket:o.ticket};t.emit("changeCounter",a)};return{counter:n,decrement:y,increment:e,emitEvent:g}}};const ti={class:"btn-plus-min flex align-items-center"},oi={class:"counter"};function ni(o,t,n,e,y,g){const a=w("Button"),u=w("InputNumber");return d(),b("div",ti,[l(a,{icon:"pi pi-minus",rounded:"",outlined:"",severity:"secondary",onClick:e.decrement,disabled:e.counter===0},null,8,["onClick","disabled"]),i("div",oi,[l(u,{modelValue:e.counter,"onUpdate:modelValue":[t[0]||(t[0]=x=>e.counter=x),t[1]||(t[1]=x=>e.emitEvent())],min:0},null,8,["modelValue"])]),l(a,{icon:"pi pi-plus",rounded:"",outlined:"",severity:"secondary",onClick:e.increment},null,8,["onClick"])])}const ii=W(ei,[["render",ni]]),li={props:["tickets","form"],setup(o,t){X(()=>{y.value=!1,a.discount={},g.value=null,o.form.max_seats&&o.form.max_seats<0?(m.value=!0,r.value=-o.form.max_seats):m.value=!1});const n=S(0),e=S([]),y=S(!1),g=S(),a=oe(),u=ee(),x=S(!1),m=S(!1),r=S(),h=P(()=>a.getDiscount),C=function(j){e.value[j.index]={partial_total:j.price*j.counter,ticket:j.ticket,quantity:j.counter},n.value=0;let c=0;e.value.forEach(s=>{n.value+=s.partial_total,c+=s.quantity}),m.value||(o.form.max_seats&&c>+o.form.max_seats?(r.value=c-+o.form.max_seats,x.value=!0):(r.value=null,x.value=!1)),g.value&&v()},p=function(){v()},v=async function(){let j=[];e.value.forEach(s=>{j.push({id:s.ticket.id,quantity:s.quantity})});const c={discount_code:g.value,location_permalink:o.form.location_permalink,tickets:j};await a.cost(c).then(()=>{}).catch(s=>{I(u,s)})};return{total:n,partialTotals:e,showDiscount:y,discountCode:g,discount:h,showAlert:x,showAlert2:m,numOverbooking:r,onChangeCounter:C,applyDiscount:p,checkDisabled:function(){let j=!1;(!e.value||e.value.length==0)&&(j=!0);let c=0;return e.value.forEach(s=>{c+=s.quantity}),c==0&&(j=!0),t.emit("disableSecondoTab",!0),j},nextTab:function(){const j={discount_code:g.value,partial_total:e.value};t.emit("nextTab",j)}}},components:{PlusMinusButton:ii}};const ai={key:0},si={key:1},ri={key:0},ci={key:1},di={key:0,class:"flex justify-content-between align-items-center"},ui={class:"flex align-items-center col-9"},mi={class:"col-7 pl-0"},fi={class:"text-right col-2"},_i={class:"col-3 flex justify-content-end"},pi={key:2,class:"mt-3 mb-5"},vi=i("i",null,"Nessuna tipologia di biglietto trovata.",-1),hi=[vi],yi=i("hr",{class:"mt-3"},null,-1),gi={class:"flex align-items-center justify-content-between py-0"},bi={class:"col-9 flex"},ki=i("b",null,"Totale",-1),wi=[ki],xi={class:"col-2 text-right font-bold"},Ci={class:"col-3 flex justify-content-end"};function Di(o,t,n,e,y,g){const a=w("Message"),u=w("PlusMinusButton"),x=w("Button");return d(),b($,null,[e.showAlert?(d(),Q(a,{key:0,severity:"warn",closable:!1},{default:D(()=>[F("Attenzione! Si sta andando in overbooking di "+k(e.numOverbooking)+" ",1),e.numOverbooking==1?(d(),b("span",ai,"posto")):(d(),b("span",si,"posti"))]),_:1})):L("",!0),e.showAlert2?(d(),Q(a,{key:1,severity:"warn",closable:!1},{default:D(()=>[F("Attenzione! Lo slot orario è già in overbooking di "+k(e.numOverbooking)+" ",1),e.numOverbooking==1?(d(),b("span",ri,"posto")):(d(),b("span",ci,"posti"))]),_:1})):L("",!0),(d(!0),b($,null,be(n.tickets,(m,r)=>{var h,C,p;return d(),b("div",{key:m.id},[((h=m.course)==null?void 0:h.id)==((C=n.form.course)==null?void 0:C.id)?(d(),b("div",di,[i("div",ui,[i("b",mi,k(m.name),1),i("div",fi,"€ "+k((p=m.price)==null?void 0:p.toFixed(2)),1)]),i("div",_i,[l(u,{onChangeCounter:t[0]||(t[0]=v=>e.onChangeCounter(v)),price:m.price,index:r,ticket:m},null,8,["price","index","ticket"])])])):L("",!0)])}),128)),n.tickets&&n.tickets.length==0?(d(),b("div",pi,hi)):L("",!0),yi,i("div",gi,[i("div",bi,[i("div",{class:J(["pl-0",e.discount&&e.discount.total_amount?"col-2":"col-7"])},wi,2),i("div",xi,"€ "+k(e.total.toFixed(2)),1)]),i("div",Ci,[l(x,{label:"Prosegui",onClick:t[1]||(t[1]=m=>e.nextTab()),disabled:e.checkDisabled()},null,8,["disabled"])])])],64)}const Oi=W(li,[["render",Di]]);class Si{static async fetchAll(){return(await Ne("/countries")).data.countries}}const Vi=xe({id:"country",state:()=>({country:{},countries:[]}),getters:{allCountries:o=>o.countries},actions:{async fetchAllCountries(){await Si.fetchAll().then(o=>this.countries=o)}}});class Li{static async fetchAll(){return(await Ne("/provinces")).data.provinces}}const Ti=xe({id:"province",state:()=>({province:{},provinces:[]}),getters:{allProvinces:o=>o.provinces,getCurrentProvince:o=>o.province},actions:{async fetchAllProvinces(){await Li.fetchAll().then(o=>this.provinces=o)}}}),Ai={computed:{Code(){return Code}},props:["location_permalink"],setup(o,t){X(()=>{V(),j()});const n=De(),e=Vi(),y=oe(),g=Ti(),a=S({}),u=S(),x=S(),m=P(()=>e.allCountries),r=P(()=>n.allOpenTickets),h=P(()=>y.paymentStatus),C=P(()=>y.paymentModeList),p=P(()=>g.allProvinces),v=P(()=>{const E=y.getPaymentMethods;return Object.entries(E).map(([R,G])=>({id:R,label:G}))}),O=P(()=>y.paymentMethodAccountList),V=async function(){await e.fetchAllCountries().then(()=>{a.value.country_id=88,a.value.status={id:"payed",name:"Pagato"}})},j=async function(){await g.fetchAllProvinces()};return{form:a,countries:m,paymentList:h,paymentModeList:C,errorMessage:u,errorMessageVoucher:x,open_tickets:r,provinces:p,dynamicPaymentMethods:v,paymentMethodAccountList:O,fetchAllOpenTickets:async function(E){const R={code:E.query.toUpperCase(),location_permalink:o.location_permalink};await n.fetchAllOpenTickets(R)},onChangeStatus:function(){a.value.status.id&&(a.value.status.id=="free"||a.value.status.id=="to_pay")&&(a.value.payment_method=null)},onConfirm:function(){if(a.value.status&&a.value.status.id=="payed"){if(!a.value.payment_method){u.value="Seleziona un metodo di pagamento";return}if(a.value.open_ticket_codes){for(const E of a.value.open_ticket_codes)if(E.expired){x.value="Uno o più codici biglietto risultano scaduti";return}}}t.emit("nextTab",a.value)}}}};const Z=o=>(gt("data-v-8bc7d287"),o=o(),bt(),o),Pi={key:0,class:"formgrid grid"},ji={class:"field col-6"},Mi=Z(()=>i("label",{for:"user_name"},"Nome",-1)),Fi={class:"field col-6"},Ei=Z(()=>i("label",{for:"user_surname"},"Cognome",-1)),Ri={class:"field col-6"},Ui=Z(()=>i("label",{for:"user_email"},"Email",-1)),Ni={class:"field col-6"},Ii=Z(()=>i("label",{for:"user_phone"},"Telefono",-1)),Bi={class:"field col-6"},zi=Z(()=>i("label",{for:"country_id"},"Nazione",-1)),qi={class:"field col-6"},Hi=Z(()=>i("label",{for:"province"},"Provincia",-1)),Ki={class:"field col-6"},Ji=Z(()=>i("label",{for:"status"},"Stato pagamento",-1)),Gi={class:"field col-6"},Wi={for:"payment_method"},Qi={key:0},Xi={class:"p-float-label mb-0"},Zi={class:"p-error",id:"dd-error"},Yi={key:0,class:"field col-6 flex flex-column"},$i=Z(()=>i("label",{for:"user_zip"},"Codice biglietto",-1)),el={key:0,class:"pi pi-exclamation-triangle",style:{color:"#ff6767"}},tl={class:"p-error",id:"dd-error"},ol={key:1,class:"field col-6"},nl=Z(()=>i("label",{for:"payment_method",class:"text-sm ml-2"},"Acconto",-1)),il={key:2,class:"col-12 pl-0 flex"},ll={class:"field col-6"},al=Z(()=>i("label",{for:"deposit"},"Importo acconto*",-1)),sl={class:"field col-6"},rl=Z(()=>i("label",{for:"payment_method_deposit"},"Modalità pagamento*",-1)),cl={class:"p-float-label mb-0"},dl={class:"p-error",id:"dd-error"},ul={class:"field col-12"},ml={class:"field flex flex-column"},fl=Z(()=>i("label",{for:"notes"},"Note",-1)),_l={class:"col-12 flex justify-content-end"};function pl(o,t,n,e,y,g){var v,O;const a=w("InputText"),u=w("Dropdown"),x=w("AutoComplete"),m=w("Checkbox"),r=w("InputNumber"),h=w("Textarea"),C=w("Button"),p=Ce("tooltip");return e.form?(d(),b("div",Pi,[i("div",ji,[Mi,l(a,{type:"text",modelValue:e.form.user_name,"onUpdate:modelValue":t[0]||(t[0]=V=>e.form.user_name=V),class:"w-full"},null,8,["modelValue"])]),i("div",Fi,[Ei,l(a,{type:"text",modelValue:e.form.user_surname,"onUpdate:modelValue":t[1]||(t[1]=V=>e.form.user_surname=V),class:"w-full"},null,8,["modelValue"])]),i("div",Ri,[Ui,l(a,{type:"text",modelValue:e.form.user_email,"onUpdate:modelValue":t[2]||(t[2]=V=>e.form.user_email=V),class:"w-full"},null,8,["modelValue"])]),i("div",Ni,[Ii,l(a,{type:"text",modelValue:e.form.user_phone,"onUpdate:modelValue":t[3]||(t[3]=V=>e.form.user_phone=V),class:"w-full"},null,8,["modelValue"])]),i("div",Bi,[zi,l(u,{modelValue:e.form.country_id,"onUpdate:modelValue":t[4]||(t[4]=V=>e.form.country_id=V),options:e.countries,optionLabel:"name",optionValue:"id",class:"w-full"},null,8,["modelValue","options"])]),i("div",qi,[Hi,l(u,{modelValue:e.form.user_zip,"onUpdate:modelValue":t[5]||(t[5]=V=>e.form.user_zip=V),options:e.provinces,optionLabel:"name",optionValue:"name",class:"w-full"},null,8,["modelValue","options"])]),i("div",Ki,[Ji,l(u,{modelValue:e.form.status,"onUpdate:modelValue":t[6]||(t[6]=V=>e.form.status=V),options:e.paymentList,optionLabel:"name",class:"w-full mb-0",onChange:t[7]||(t[7]=V=>e.onChangeStatus())},null,8,["modelValue","options"])]),i("div",Gi,[i("label",Wi,[F("Modalità pagamento"),e.form.status&&e.form.status.id=="payed"?(d(),b("span",Qi,"*")):L("",!0)]),i("span",Xi,[l(u,{modelValue:e.form.payment_method,"onUpdate:modelValue":t[8]||(t[8]=V=>e.form.payment_method=V),options:e.dynamicPaymentMethods,optionLabel:"label",class:J(["w-full",{"p-invalid":e.errorMessage}]),disabled:e.form.status&&e.form.status.id!="payed",onChange:t[9]||(t[9]=V=>e.errorMessage=null)},null,8,["modelValue","options","disabled","class"])]),i("small",Zi,k(e.errorMessage||" "),1)]),e.form.payment_method&&e.form.payment_method.id=="voucher"?(d(),b("div",Yi,[$i,l(x,{modelValue:e.form.open_ticket_codes,"onUpdate:modelValue":t[10]||(t[10]=V=>e.form.open_ticket_codes=V),suggestions:e.open_tickets,class:J(["uppercase w-full",{"p-invalid":e.errorMessageVoucher}]),onComplete:t[11]||(t[11]=V=>e.fetchAllOpenTickets(V)),emptySearchMessage:"Nessun risultato",emptySelectionMessage:"Nessun risultato",optionLabel:"code",optionValue:"code",multiple:"",onChange:t[12]||(t[12]=V=>e.errorMessageVoucher=null)},{option:D(({option:V})=>[i("span",{class:"flex flex-row justify-content-between",style:Re({color:V.expired?"#ff6767":null})},[F(k(V.code)+" ",1),V.expired?me((d(),b("i",el,null,512)),[[p,"Scaduto"]]):L("",!0)],4)]),_:1},8,["modelValue","suggestions","class"]),i("small",tl,k(e.errorMessageVoucher||" "),1)])):L("",!0),((O=(v=e.form)==null?void 0:v.status)==null?void 0:O.id)=="to_pay"?(d(),b("div",ol,[l(m,{modelValue:e.form.multi_payment,"onUpdate:modelValue":t[13]||(t[13]=V=>e.form.multi_payment=V),binary:!0,class:"deposit"},null,8,["modelValue"]),nl])):L("",!0),e.form.multi_payment?(d(),b("div",il,[i("div",ll,[al,l(r,{modelValue:e.form.amount,"onUpdate:modelValue":t[14]||(t[14]=V=>e.form.amount=V),inputId:"currency-germany",mode:"currency",currency:"EUR",locale:"it-IT",class:"w-full"},null,8,["modelValue"])]),i("div",sl,[rl,i("span",cl,[l(u,{modelValue:e.form.payment_method_deposit,"onUpdate:modelValue":t[15]||(t[15]=V=>e.form.payment_method_deposit=V),options:e.paymentMethodAccountList,optionLabel:"label",class:J(["w-full",{"p-invalid":e.errorMessage}]),onChange:t[16]||(t[16]=V=>e.errorMessage=null)},null,8,["modelValue","options","class"])]),i("small",dl,k(e.errorMessage||" "),1)])])):L("",!0),i("div",ul,[i("div",ml,[fl,l(h,{modelValue:e.form.notes,"onUpdate:modelValue":t[17]||(t[17]=V=>e.form.notes=V),rows:"5",cols:"30"},null,8,["modelValue"])])]),i("div",_l,[l(C,{label:"Conferma",onClick:t[18]||(t[18]=V=>e.onConfirm())})])])):L("",!0)}const vl=W(Ai,[["render",pl],["__scopeId","data-v-8bc7d287"]]);var hl=`
@layer primevue {
    .p-contextmenu ul {
        margin: 0;
        padding: 0;
        list-style: none;
    }

    .p-contextmenu .p-submenu-list {
        position: absolute;
        min-width: 100%;
        z-index: 1;
    }

    .p-contextmenu .p-menuitem-link {
        cursor: pointer;
        display: flex;
        align-items: center;
        text-decoration: none;
        overflow: hidden;
        position: relative;
    }

    .p-contextmenu .p-menuitem-text {
        line-height: 1;
    }

    .p-contextmenu .p-menuitem {
        position: relative;
    }

    .p-contextmenu .p-menuitem-link .p-submenu-icon {
        margin-left: auto;
    }

    .p-contextmenu-enter-from {
        opacity: 0;
    }

    .p-contextmenu-enter-active {
        transition: opacity 250ms;
    }
}
`,yl={root:function(t){var n=t.instance;return["p-contextmenu p-component",{"p-input-filled":n.$primevue.config.inputStyle==="filled","p-ripple-disabled":n.$primevue.config.ripple===!1}]},menu:"p-contextmenu-root-list",menuitem:function(t){var n=t.instance,e=t.processedItem;return["p-menuitem",{"p-menuitem-active p-highlight":n.isItemActive(e),"p-focus":n.isItemFocused(e),"p-disabled":n.isItemDisabled(e)}]},content:"p-menuitem-content",action:function(t){var n=t.props,e=t.isActive,y=t.isExactActive;return["p-menuitem-link",{"router-link-active":e,"router-link-active-exact":n.exact&&y}]},icon:"p-menuitem-icon",label:"p-menuitem-text",submenuIcon:"p-submenu-icon",submenu:"p-submenu-list",separator:"p-menuitem-separator"};Ue.extend({name:"contextmenu",css:hl,classes:yl});const gl={props:["form"],setup(o,t){X(()=>{O()});const n=S(0),e=S([]),y=S(!1),g=S(!0),a=S(),u=S([]),{showLoader:x,hideLoader:m}=ve(),r=De(),h=oe(),C=ee(),p=P(()=>r.allTickets),v=P(()=>h.getCurrentOrder),O=async function(){const A={location_permalink:o.form.location_permalink,api_version:"v2",date:j(o.form.date),course_id:o.form.course.id};await r.fetchAllTickets(A).then(()=>{}).catch(B=>{I(C,B)})},V=function(A){n.value+=1,a.value=A.discount_code,e.value=Object.assign([],A.partial_total),g.value=!1},j=function(A){return ke(A).includes("Invalid")?Be(A):ke(A)},c=function(A){s(A)},s=async function(A){var ue,le,U,N;const B=[{start_at:o.form.hour,tickets:[]}];e.value.forEach(q=>{q.quantity!=0&&B[0].tickets.push({id:q.ticket.id,quantity:q.quantity})});let z=[];A.open_ticket_codes&&A.open_ticket_codes.forEach(q=>{z.push(q.code)});const de={location_permalink:o.form.location_permalink,country_id:A.country_id,status:A.status.id,user_email:A.user_email,user_name:A.user_name,user_phone:A.user_phone,user_surname:A.user_surname,user_zip:A.user_zip,api_version:"v2",date:o.form.date?j(o.form.date):"",notes:A.notes,time_slots:B,payment_method:(ue=A.payment_method)==null?void 0:ue.id,course_id:(U=(le=o.form)==null?void 0:le.course)==null?void 0:U.id,open_ticket_codes:z,multi_payment:A.multi_payment,payments:[{amount:A.amount,typology:"deposit",payment_method:(N=A.payment_method_deposit)==null?void 0:N.id}]};a.value&&(de.discount_code=a.value),await h.createOrder(de).then(()=>{n.value+=1,g.value=!0,y.value=!0}).catch(q=>{I(C,q)})},_=function(){we(v==null?void 0:v.value,o.form.location_permalink),t.emit("closeDialog",!0)},E=function(A){g.value=A},R=function(){we(v==null?void 0:v.value,o.form.location_permalink),G()},G=async function(){let A=[];if(!v.value&&!o.form.location_permalink)return;for(let z of v.value.tickets)A.push(z.order_item_id);const B={check_in:!0,order_item_ids:A,location_permalink:o.form.location_permalink};await h.checkInOrder(B).then(()=>{te(C,{message:"Check-in registrato correttamente",error:!1}),t.emit("closeDialog",!0)}).catch(z=>{I(C,z)})},ce=function(){x();const A={location_permalink:o.form.location_permalink,order_id:v.value.id};h.sendEmail(A).then(()=>{te(C,{message:"Email inviata correttamente al cliente",error:!1}),m(),t.emit("closeDialog",!0)}).catch(B=>{m(),I(C,B)})};return ie(v,()=>{u.value=[],v.value.tickets.forEach(A=>{const B=u.value.find(z=>z.ticket_name===A.ticket_name);if(!B)A.quantity=1,u.value.push(A);else{let z=u.value.indexOf(B);u.value[z].quantity+=1}})}),{tickets:p,active:n,partialTotals:e,showOrderDetail:y,currentOrder:v,tmp_tickets:u,showSecondTab:g,formatExplicitDate:Ie,formatDate:Le,onNextTab:V,onConfirmPayment:c,printPDF:Ve,onPrintPDF:_,onDisableSecondoTab:E,printAndCheckIn:R,sendEmail:ce}},components:{NewOrderTicketTab:Oi,NewOrderFormTab:vl}};const bl={key:0,class:"info-box"},kl={class:"font-medium"},wl=i("i",{class:"pi pi-map-marker mr-3 font-medium"},null,-1),xl={class:"font-medium"},Cl=i("i",{class:"pi pi-calendar mr-3 font-medium"},null,-1),Dl={key:0,class:"capitalize"},Ol={key:0,class:"flex pb-4"},Sl=i("i",{class:"pi pi-ticket mr-3 font-medium mt-1"},null,-1),Vl={class:"flex flex-column"},Ll={key:0,class:"pb-1 pr-1"},Tl={key:1,class:"pb-1"},Al={class:"py-5"},Pl={class:"m-0 text-center line-height-3"},jl=i("br",null,null,-1),Ml={key:0,class:"col-offset-3 col-6 flex justify-content-center flex-column align-items-center mt-4 order-summary"},Fl=i("p",{class:"my-2"},[i("b",null,"Riepilogo ordine:")],-1),El={class:"flex flex-column col-12"},Rl={key:0,class:"pb-1",style:{"min-width":"8rem"}},Ul={key:1,class:"pb-1"},Nl={key:2},Il={class:"flex flex-column col-12"},Bl={key:0,class:"p-0 m-0 font-medium flex justify-content-between"},zl=i("span",{class:"pb-1 pr-1"},"Totale ordine ",-1),ql={class:"pb-1"},Hl={class:"flex align-items-center justify-content-center mt-4"};function Kl(o,t,n,e,y,g){var h,C;const a=w("NewOrderTicketTab"),u=w("TabPanel"),x=w("NewOrderFormTab"),m=w("Button"),r=w("TabView");return d(),b($,null,[n.form?(d(),b("div",bl,[i("p",kl,[wl,F(k((h=n.form.course)==null?void 0:h.name),1)]),i("p",xl,[Cl,n.form.date?(d(),b("span",Dl,k(e.formatDate((C=n.form)==null?void 0:C.date)),1)):L("",!0),F(" - "+k(n.form.hour),1)]),e.partialTotals&&e.partialTotals.length>0?(d(),b("div",Ol,[Sl,i("div",Vl,[(d(!0),b($,null,be(e.partialTotals,p=>{var v;return d(),b("p",{class:"p-0 m-0 font-medium flex justify-content-between",key:p},[p&&p.quantity!=0?(d(),b("span",Ll,k((v=p.ticket)==null?void 0:v.name),1)):L("",!0),p&&p.quantity!=0?(d(),b("span",Tl," x "+k(p.quantity)+" "+k(p.price),1)):L("",!0)])}),128))])])):L("",!0)])):L("",!0),l(r,{activeIndex:e.active,"onUpdate:activeIndex":t[6]||(t[6]=p=>e.active=p)},{default:D(()=>[l(u,{header:"Seleziona i biglietti",disabled:e.showOrderDetail},{default:D(()=>[l(a,{tickets:e.tickets,form:n.form,onNextTab:t[0]||(t[0]=p=>e.onNextTab(p)),onDisableSecondoTab:t[1]||(t[1]=p=>e.onDisableSecondoTab(p))},null,8,["tickets","form"])]),_:1},8,["disabled"]),l(u,{header:"Inserisci i dati",disabled:e.showSecondTab},{default:D(()=>[l(x,{onNextTab:t[2]||(t[2]=p=>e.onConfirmPayment(p)),location_permalink:n.form.location_permalink},null,8,["location_permalink"])]),_:1},8,["disabled"]),e.showOrderDetail?(d(),Q(u,{key:0,header:"Ordine completato"},{default:D(()=>{var p,v;return[i("div",Al,[i("div",Pl,[F(" Ordine "),i("b",null,k(e.currentOrder.reservation_number),1),F(" registrato correttamente!"),jl]),e.currentOrder?(d(),b("div",Ml,[Fl,i("div",El,[(d(!0),b($,null,be(e.tmp_tickets,O=>(d(),b("p",{class:"p-0 m-0 font-medium flex justify-content-between flex-1",key:O},[O&&O.quantity!=0?(d(),b("span",Rl,k(O.ticket_name),1)):L("",!0),O&&O.quantity!=0?(d(),b("span",Ul," x "+k(O.quantity),1)):L("",!0),O.ticket_price?(d(),b("span",Nl," € "+k((+O.ticket_price).toFixed(2)),1)):L("",!0)]))),128))]),i("div",Il,[e.currentOrder.total?(d(),b("p",Bl,[zl,i("span",ql,[i("b",null,"€ "+k((+((p=e.currentOrder)==null?void 0:p.total)).toFixed(2)),1)])])):L("",!0)])])):L("",!0),i("div",Hl,[l(m,{icon:"pi pi-envelope",class:"mr-3",rounted:"",outlined:"",label:"Invia biglietti",onClick:t[3]||(t[3]=O=>e.sendEmail()),disable:!((v=e.currentOrder)!=null&&v.user_email)},null,8,["disable"]),l(m,{icon:"pi pi-print",onClick:t[4]||(t[4]=O=>e.onPrintPDF()),class:"mr-3",rounted:"",outlined:"",label:"Stampa"}),l(m,{icon:"pi print-check-icon",onClick:t[5]||(t[5]=O=>e.printAndCheckIn()),class:"mr-3",rounted:"",outlined:"",label:"Stampa e Check-in"})])])]}),_:1})):L("",!0)]),_:1},8,["activeIndex"])],64)}const Jl=W(gl,[["render",Kl]]),Gl={props:["filters","date"],setup(o,t){X(()=>{g.value=qe(8,21),n.value=Object.assign({},o.filters)});const n=S({}),e=Ke(),y=ee(),g=S(),a=S(!1),u=Te(),x=S(!1),m=P(()=>e.allCourses),r=P(()=>u.showNewOrderDialog),h=async function(){const O={location_permalink:o.filters.location_permalink,api_version:"v2"};await e.fetchAllCourses(O).catch(V=>{I(y,V)})},C=function(){u.setNewOrderDialogVisibility(!1),n.value.hour="",n.value.course=null,t.emit("onCloseDialog")},p=function(O){n.value.date=o.date,u.setNewOrderDialogVisibility(O)},v=function(){x.value=n.value.open_ticket};return ie(o.filters,()=>{if(h(),n.value=Object.assign({},o.filters),o.filters.course&&!o.filters.course.id){let O=m.value.find(V=>V.name===o.filters.course.name);O&&(n.value.course=O)}}),{courses:m,form:n,hours:g,disableForm:x,visible:a,onCloseDialog:C,updateDialog:p,onChecked:v,dialogVisible:r,dialogStore:u}},components:{NewOrderDialog:Jl}},Wl=i("h2",{class:"mt-1"},"Nuova prenotazione",-1),Ql={class:"formgrid grid px-0 align-items-center mt-4"},Xl={key:0,class:"field flex flex-column w-full col-12"},Zl=i("label",{for:"typology"},"Scegli il percorso",-1),Yl={key:1,class:"field flex flex-column w-full col-12"},$l=i("label",{for:"typology"},"Seleziona l'orario",-1),ea={class:"flex justify-content-end align-items-center mt-2"},ta={class:"flex align-items-center justify-content-between w-full"},oa=i("h2",null,"Nuova prenotazione",-1);function na(o,t,n,e,y,g){const a=w("Dropdown"),u=w("Button"),x=w("NewOrderDialog"),m=w("Dialog"),r=w("Card");return d(),Q(r,{class:"mt-4"},{content:D(()=>[Wl,i("div",Ql,[n.filters.location_permalink?(d(),b("div",Xl,[Zl,l(a,{modelValue:e.form.course,"onUpdate:modelValue":t[0]||(t[0]=h=>e.form.course=h),options:e.courses,optionLabel:"name",disabled:e.disableForm,placeholder:""},null,8,["modelValue","options","disabled"])])):L("",!0),n.filters.location_permalink?(d(),b("div",Yl,[$l,l(a,{modelValue:e.form.hour,"onUpdate:modelValue":t[1]||(t[1]=h=>e.form.hour=h),options:e.hours,disabled:e.disableForm,placeholder:""},null,8,["modelValue","options","disabled"])])):L("",!0)]),i("div",ea,[l(u,{label:"Prenota",disabled:!e.form.course||!e.form.hour,onClick:t[2]||(t[2]=h=>e.updateDialog(!0))},null,8,["disabled"])]),l(m,{visible:e.dialogVisible,"onUpdate:visible":t[5]||(t[5]=h=>e.dialogVisible=h),modal:"",header:"Nuova prenotazione",style:{width:"60rem"},breakpoints:{"1199px":"75vw","575px":"90vw"},closable:!1,onHide:t[6]||(t[6]=h=>e.onCloseDialog())},{header:D(()=>[i("div",ta,[oa,l(u,{icon:"pi pi-times",text:"",rounded:"",onClick:t[3]||(t[3]=h=>e.updateDialog(!1))})])]),default:D(()=>[l(x,{form:e.form,onCloseDialog:t[4]||(t[4]=h=>e.onCloseDialog())},null,8,["form"])]),_:1},8,["visible"])]),_:1})}const ia=W(Gl,[["render",na]]),la={props:["location_permalink"],setup(o,t){X(()=>{e.value.start_date=re.local().startOf("day").toFormat("dd/MM/yyyy"),e.value.end_date=re.local().endOf("day").toFormat("dd/MM/yyyy"),e.value.created_at="false",e.value.start_hour="00:00",e.value.end_hour="23:59"});const n=ee(),e=S({}),y=pe(),{showLoader:g,hideLoader:a}=ve(),u=function(){let r=je(e.value.start_date)+" "+e.value.start_hour,h=je(e.value.end_date)+" "+e.value.end_hour;const C={from:r,to:h,location_permalink:o.location_permalink,created_at:"false"};x(C)},x=async function(r){g(),await y.downloadReport(r).then(()=>{a(),t.emit("onSubmit")}).catch(h=>{a(),I(n,h)})};return{form:e,onSubmit:u,setDefaultIfBlank:function(){(!e.value.start_hour||e.value.start_hour=="")&&(e.value.start_hour="00:00"),(!e.value.end_hour||e.value.end_hour=="")&&(e.value.end_hour="23:59")}}},components:{Form:Ot}},aa={class:"formgrid grid mt-3"},sa={class:"field col-6 flex flex-column"},ra=i("label",{from:"start_date"},"Dal",-1),ca=i("label",{from:"start_hour",class:"mt-3"},"Dalle",-1),da={class:"field col-6 flex flex-column"},ua=i("label",{from:"end_date"},"Al",-1),ma=i("label",{from:"end_hour",class:"mt-3"},"Alle",-1),fa={class:"flex align-items-center justify-content-end mt-6"};function _a(o,t,n,e,y,g){const a=w("Calendar"),u=w("InputMask"),x=w("Button"),m=w("Form");return d(),Q(m,{onSubmit:e.onSubmit},{default:D(()=>[i("div",aa,[i("div",sa,[ra,l(a,{inputId:"start_date",modelValue:e.form.start_date,"onUpdate:modelValue":t[0]||(t[0]=r=>e.form.start_date=r),dateFormat:"dd/mm/yy",manualInput:!0},null,8,["modelValue"]),ca,l(u,{id:"start_hour",modelValue:e.form.start_hour,"onUpdate:modelValue":t[1]||(t[1]=r=>e.form.start_hour=r),mask:"99:99",placeholder:"HH:mm",onBlur:t[2]||(t[2]=r=>e.setDefaultIfBlank())},null,8,["modelValue"])]),i("div",da,[ua,l(a,{inputId:"end_date",modelValue:e.form.end_date,"onUpdate:modelValue":t[3]||(t[3]=r=>e.form.end_date=r),dateFormat:"dd/mm/yy",manualInput:!0},null,8,["modelValue"]),ma,l(u,{id:"end_hour",modelValue:e.form.end_hour,"onUpdate:modelValue":t[4]||(t[4]=r=>e.form.end_hour=r),mask:"99:99",placeholder:"HH:mm",onBlur:t[5]||(t[5]=r=>e.setDefaultIfBlank())},null,8,["modelValue"])])]),i("div",fa,[l(x,{label:"Annulla",text:"",onClick:t[6]||(t[6]=r=>o.$emit("onSubmit"))}),l(x,{label:"Scarica",type:"submit"})])]),_:1},8,["onSubmit"])}const pa=W(la,[["render",_a]]),va={setup(){const o=S({}),t=S({}),n=S(),e=S(!1),y=oe(),g=kt(),a=pe(),u=ee(),x=Te(),m=P(()=>g.currentUser),r=P(()=>a.allLocations),h=P(()=>a.getCurrentLocation),C=P(()=>y.getPaymentMethods);X(()=>{h.value&&(o.value.location=h.value,t.value.location_permalink=h.value.permalink),v().then(()=>{p()})});const p=async function(){var R;let _={};const E=((R=h==null?void 0:h.value)==null?void 0:R.permalink)??null;E?_.location_permalink=E:_.location_permalink=r.value[0].permalink,await y.fetchPaymentMethods(_).then(()=>{}).catch(G=>{I(u,G)})},v=async function(){await a.fetchAllLocations().then(()=>{h.value||(o.value.location=r.value[0],t.value.location_permalink=r.value[0].permalink,a.updateCurrenLocation(r.value[0]))}).catch(_=>{I(u,_)})};return{filters:o,orderTable:n,order_filters:t,visibleDialog:e,user:m,locations:r,newPaymentMethods:C,fetchAllLocations:v,formatDate:Le,onUpdateFilters:function(_){_.course?o.value.course={id:_.course}:o.value.course="",_.name?o.value.name=_.name:o.value.name="",_.hour&&(_.hour.start_at?o.value.hour=_.hour.start_at:o.value.hour=_.hour)},onUpdateNewOrderFilters:function(_){_.start_at&&(t.value.hour=_.start_at),_.course_name&&(t.value.course={name:_.course_name}),_.date&&(t.value.date=_.date),_.hour&&(t.value.hour=_.hour),_.max_seats?t.value.max_seats=_.max_seats:t.value.max_seats=null,x.setNewOrderDialogVisibility(!0)},onCloseDialog:function(){n.value.loadLazyData()},onChangeLocation:function(){t.value.location_permalink=o.value.location.permalink,a.updateCurrenLocation(o.value.location)},onCloseReportDialog:function(){e.value=!1}}},components:{CalendarFilter:In,OrderTable:Fn,OrderFilter:$n,NewOrderCard:ia,SalesReportsDialog:pa}};const ha={class:"flex justify-content-between align-items-center"},ya={class:"field flex flex-column mt-3"},ga={class:"text-xl font-medium pl-3 py-0"},ba={key:0,style:{color:"#495057"},class:"flex flex-column align-items-end"},ka=i("i",{class:"pi pi-calendar mr-2 text-xl"},null,-1),wa={class:"capitalize text-xl"},xa={class:"flex gap-4"},Ca={key:0,class:"col-3 mt-3"},Da={class:"col-9 mt-3"};function Oa(o,t,n,e,y,g){var p,v;const a=w("Button"),u=w("SalesReportsDialog"),x=w("Dialog"),m=w("CalendarFilter"),r=w("NewOrderCard"),h=w("OrderFilter"),C=w("OrderTable");return d(),b("div",null,[i("div",ha,[i("div",ya,[i("p",ga,k((v=(p=e.filters)==null?void 0:p.location)==null?void 0:v.name),1)]),e.filters&&e.filters.date?(d(),b("div",ba,[i("div",null,[ka,i("span",wa,k(e.formatDate(e.filters.date)),1)]),l(a,{label:"Report visite",link:"",class:"m-0 p-0",onClick:t[0]||(t[0]=O=>e.visibleDialog=!0),icon:"pi pi-download"}),l(x,{visible:e.visibleDialog,"onUpdate:visible":t[2]||(t[2]=O=>e.visibleDialog=O),modal:"",header:"Report visite",style:{width:"35rem"}},{default:D(()=>[l(u,{onOnSubmit:t[1]||(t[1]=O=>e.onCloseReportDialog()),location_permalink:e.filters.location.permalink},null,8,["location_permalink"])]),_:1},8,["visible"])])):L("",!0)]),i("div",xa,[e.filters.location?(d(),b("div",Ca,[l(m,{filters:e.filters},null,8,["filters"]),l(r,{date:e.filters.date,filters:e.order_filters,onOnCloseDialog:t[3]||(t[3]=O=>e.onCloseDialog())},null,8,["date","filters"])])):L("",!0),i("div",Da,[l(h,{filters:e.filters,onOnSubmit:t[4]||(t[4]=O=>e.onUpdateFilters(O))},null,8,["filters"]),e.filters.date?(d(),Q(C,{key:0,filters:e.filters,ref:"orderTable",class:"mt-4",onUpdateFilters:t[5]||(t[5]=O=>e.onUpdateNewOrderFilters(O))},null,8,["filters"])):L("",!0)])])])}const Aa=W(va,[["render",Oa]]);export{Aa as default};
