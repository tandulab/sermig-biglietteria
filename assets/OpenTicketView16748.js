import{o as L,c as T,a as $,p as x,i as j,_ as S,r as h,q,b as v,e as b,f as a,w as m,h as U,t as F,g as s,F as C,N as D,n as E,v as H,s as z,H as W,u as G}from"../index16748.js";import{u as J,e as K,i as Q,a as X,b as Y}from"./location16748.js";import{u as Z,e as O,s as ee}from"./helpers16748.js";const te={props:["filters"],setup(o,t){L(()=>{n.value=!0,k.value={first:0,rows:p.value.rows,sortField:null,sortOrder:null},k.value.page=0,o.filters.location&&w()});const d=J(),e=K(),g=T(()=>d.responseOrders),y=T(()=>d.status),{showLoader:l,hideLoader:_}=Z(),f=$(),p=x(),c=x(),i=x(),n=x(!0),k=x(),A=x(0);function w(){n.value=!0;let r=new Map;for(const u in o.filters)o.filters[u]&&(u=="location"&&o.filters.location.permalink?r.set("location_permalink",o.filters.location.permalink.trim()):r.set(u,o.filters[u].trim()));r.set("page",k.value.page+1),r.set("per_page",k.value.rows),setTimeout(()=>{N(r)},Math.random()*1e3+250)}const N=async function(r){await d.fetchOrderWithOpenTicket(r).then(()=>{n.value=!1}).catch(u=>{n.value=!1,O(f,u)})},B=async function(r){n.value=!0;const u={ticket_id:r.id,location:o.filters.location.permalink,used:r.used};await d.useOpenTicket(u).then(()=>{n.value=!1,ee(f,{message:"Stato aggiornato correttamente",error:!1}),w()}).catch(V=>{n.value=!1,O(f,V)})},P=r=>{i.value.toggle(r)},R=function(r){const u={course_name:r.course_name,start_at:r.start_at};t.emit("updateFilters",u),e.setNewOrderDialogVisibility(!0)},I=function(r){const u=new Map;u.set("id",r.id),u.set("location_permalink",o.filters.location.permalink),l(),d.downloadTicket(u).then(()=>{_()}).catch(V=>{_(),O(f,V)})},M=r=>{k.value=r,w()};return j(o.filters,()=>{w()}),{dt:p,responseOrders:g,loading:n,totalRecords:A,lazyParams:k,currentOrder:c,status:y,op:i,dialogStore:e,loadLazyData:w,onChangeUsedStatus:B,toggle:P,openDialog:R,downloadPDF:I,onPage:M,formatDataFromUnixTimestamps:Q}}};const oe={class:"order-table"},ne=s("div",{class:"w-full text-center"},"Numero ticket",-1),le={class:"flex flex-column align-items-center"},ae=s("div",{class:"w-full text-center"},"Scaduto",-1),se={key:0,class:"pi pi-exclamation-triangle cursor-pointer",style:{color:"#ff6767"}},re=s("div",{class:"w-full text-center"},"Utilizzato",-1),ie=s("div",{class:"w-full text-center"},"PDF",-1),ce={class:"flex flex-column align-items-center"};function de(o,t,d,e,g,y){const l=h("Column"),_=h("Checkbox"),f=h("Button"),p=h("DataTable"),c=q("tooltip");return v(),b("div",oe,[a(p,{value:e.responseOrders.orders,totalRecords:e.responseOrders.total,lazy:!0,paginator:!0,ref:"dt",rows:30,loading:e.loading,stripedRows:"",onPage:t[0]||(t[0]=i=>e.onPage(i))},{empty:m(()=>[U(" Nessuna prenotazione trovata. ")]),default:m(()=>[a(l,{header:"Codice ordine",field:"reservation_number",ref:"reservation_number"},null,512),a(l,{header:"Email",field:"email",ref:"email"},null,512),a(l,{header:"Data acquisto",field:"created_at",ref:"created_at"},{body:m(({data:i})=>[U(F(e.formatDataFromUnixTimestamps(i.created_at)),1)]),_:1},512),a(l,null,{header:m(()=>[ne]),body:m(({data:i})=>[s("div",le,F(i.tickets_number),1)]),_:1}),a(l,{header:"Codice ticket"},{body:m(({data:i})=>[(v(!0),b(C,null,D(i.codes,n=>(v(),b("div",{key:n.code,class:E(["py-1",n.used?"used":""])},F(n.code),3))),128))]),_:1}),a(l,null,{header:m(()=>[ae]),body:m(({data:i})=>[(v(!0),b(C,null,D(i.codes,n=>(v(),b("div",{key:n.code,class:"py-1 flex flex-column align-items-center"},[n.expired?H((v(),b("i",se,null,512)),[[c,"Scaduto"]]):z("",!0)]))),128))]),_:1}),a(l,null,{header:m(()=>[re]),body:m(({data:i})=>[(v(!0),b(C,null,D(i.codes,n=>(v(),b("div",{key:n.code,class:"py-1 flex flex-column align-items-center"},[a(_,{disabled:n.expired,modelValue:n.used,"onUpdate:modelValue":k=>n.used=k,binary:!0,onChange:k=>e.onChangeUsedStatus(n),class:"check_in"},null,8,["disabled","modelValue","onUpdate:modelValue","onChange"])]))),128))]),_:1}),a(l,null,{header:m(()=>[ie]),body:m(({data:i})=>[s("div",ce,[a(f,{type:"button","aria-haspopup":"true","aria-controls":"overlay_menu",icon:"pi pi-download",text:"",rounded:"",onClick:n=>e.downloadPDF(i)},null,8,["onClick"])])]),_:1})]),_:1},8,["value","totalRecords","loading"])])}const ue=S(te,[["render",de]]),me={setup(o,t){const d=x({});return{form:d,resetField:function(){d.value.reservation_number=null,d.value.ticket_code=null,d.value.email=null,t.emit("onSubmit",d.value)}}}},_e={class:"formgrid grid px-0 align-items-center"},fe={class:"field col-3 flex flex-column"},pe=s("label",{for:"typology"},"Filtra per codice prenotazione",-1),ve={class:"field col-3 flex flex-column"},he=s("label",{for:"typology"},"Filtra per codice ticket",-1),be={class:"field col-3 flex flex-column"},ke=s("label",{for:"typology"},"Filtra per email",-1),xe={class:"flex col-12 justify-content-end mt-1"};function ge(o,t,d,e,g,y){const l=h("InputText"),_=h("Button"),f=h("AccordionTab"),p=h("Accordion");return v(),W(p,{activeIndex:0},{default:m(()=>[a(f,{header:"FILTRI"},{default:m(()=>[s("div",_e,[s("div",fe,[pe,a(l,{modelValue:e.form.reservation_number,"onUpdate:modelValue":t[0]||(t[0]=c=>e.form.reservation_number=c),placeholder:""},null,8,["modelValue"])]),s("div",ve,[he,a(l,{modelValue:e.form.ticket_code,"onUpdate:modelValue":t[1]||(t[1]=c=>e.form.ticket_code=c),placeholder:""},null,8,["modelValue"])]),s("div",be,[ke,a(l,{modelValue:e.form.email,"onUpdate:modelValue":t[2]||(t[2]=c=>e.form.email=c),placeholder:""},null,8,["modelValue"])])]),s("div",xe,[a(_,{label:"Ricerca",class:"mr-2",onClick:t[3]||(t[3]=c=>o.$emit("onSubmit",e.form))}),a(_,{label:"Annulla",class:"p-button-outlined",onClick:t[4]||(t[4]=c=>e.resetField())})])]),_:1})]),_:1})}const ye=S(me,[["render",ge]]),we={setup(){L(()=>{_.value&&(o.value.location=_.value),f()});const o=x({}),t=x(),d=G(),e=X(),g=$(),y=T(()=>d.currentUser),l=T(()=>e.allLocations),_=T(()=>e.getCurrentLocation),f=async function(){await e.fetchAllLocations().then(()=>{_.value||(o.value.location=l.value[0],e.updateCurrenLocation(l.value[0]))}).catch(c=>{O(g,c)})};return{filters:o,orderTable:t,user:y,locations:l,fetchAllLocations:f,formatDate:Y,onUpdateFilters:function(c){let i=o.value.location.permalink;o.value.reservation_number=c.reservation_number,o.value.location.permalink=i,o.value.ticket_code=c.ticket_code,o.value.email=c.email}}},components:{OpenTicketTable:ue,OpenTicketFilter:ye}};const Te={class:"flex justify-content-between align-items-center"},Fe={class:"field flex flex-column mt-3"},Oe={key:0,style:{color:"#495057"}},Ve=s("i",{class:"pi pi-calendar mr-2 text-xl"},null,-1),Ce={class:"capitalize text-xl"},De={class:"flex gap-4"},Se={class:"col-12 mt-3"};function Ue(o,t,d,e,g,y){const l=h("Dropdown"),_=h("OpenTicketFilter"),f=h("OpenTicketTable");return v(),b("div",null,[s("div",Te,[s("div",Fe,[a(l,{modelValue:e.filters.location,"onUpdate:modelValue":t[0]||(t[0]=p=>e.filters.location=p),options:e.locations,optionLabel:"name",placeholder:"Filtra per location",class:"location"},null,8,["modelValue","options"])]),e.filters&&e.filters.date?(v(),b("div",Oe,[Ve,s("span",Ce,F(e.formatDate(e.filters.date)),1)])):z("",!0)]),s("div",De,[s("div",Se,[a(_,{onOnSubmit:t[1]||(t[1]=p=>e.onUpdateFilters(p))}),a(f,{filters:e.filters,ref:"orderTable",class:"mt-4"},null,8,["filters"])])])])}const Ae=S(we,[["render",Ue]]);export{Ae as default};
