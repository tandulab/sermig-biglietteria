import{l as he,m as fe,o as $,p as x,a as W,c as M,_ as H,r as w,q as ye,b as h,e as p,g as s,f as a,n as G,t as b,w as T,s as O,F as Y,h as U,v as oe,x as we,y as ue,z as Qe,i as Z,A as te,B as Ce,C as Xe,u as Ye}from"../index76404.js";import{u as K,a as ne,f as De,b as ge,c as Ze,d as et,e as ke,g as me,h as Se,i as tt,D as ee,j as be}from"./location76404.js";import{u as se,s as X,e as B,p as Te,a as ot,b as pe,c as _e,d as Ve}from"./helpers76404.js";import{F as nt}from"./vee-validate.esm76404.js";class xe{static async fetchAll(t){const n=t.location_permalink;return delete t.location_permalink,(await he(`/ticket_office/${n}/search/tickets`,t)).data}static async fetchAllOpenTickets(t){const n=t.location_permalink;return delete t.location_permalink,(await he(`/ticket_office/${n}/orders/search_codes`,t)).data}}const ve=fe({id:"ticket",state:()=>({ticket:{},tickets:[],response_tickets:{},open_tickets_codes:{}}),getters:{allTickets:o=>o.response_tickets.available_ticket_types,allOpenTickets:o=>o.open_tickets_codes.open_tickets,responseTickets:o=>o.response_tickets,getTotalTickets:o=>o.response_tickets?o.response_tickets.total:0,getCurrentTicket:o=>o.ticket},actions:{async fetchAllTickets(o){await xe.fetchAll(o).then(t=>this.response_tickets=t)},async fetchAllOpenTickets(o){await xe.fetchAllOpenTickets(o).then(t=>this.open_tickets_codes=t)}}}),st={computed:{Code(){return Code}},props:["location_permalink","time_slot"],setup(o,t){$(()=>{n.value=Object.assign({},o.time_slot)});const n=x({}),e=ve(),y=K(),{showLoader:C,hideLoader:l}=se(),d=W(),g=x(),v=x(),i=M(()=>e.allOpenTickets),f=M(()=>y.paymentStatus),_=M(()=>y.paymentModeList),S=M(()=>{const c=y.getPaymentMethods;return Object.entries(c).map(([u,N])=>({id:u,label:N}))}),k=M(()=>y.getCurrentOrder),D=async function(c){const u={code:c.query.toUpperCase(),location_permalink:o.location_permalink};await e.fetchAllOpenTickets(u)},j=async function(){var u,N;const c={id:o.location_permalink,order_id:n.value.id,status:(u=n.value)==null?void 0:u.status,payment_method:n.value.payment_method,open_ticket_codes:[],api_version:"v2",notes:(N=n.value)==null?void 0:N.notes};if(n.value.status&&n.value.status=="payed"&&!n.value.payment_method){g.value="Seleziona un metodo di pagamento";return}for(const L of n.value.open_tickets_used)if(L.expired){v.value="Uno o più codici biglietto risultano scaduti";return}if(n.value.open_tickets_used&&n.value.open_tickets_used.length>0){let L=[];n.value.open_tickets_used.forEach(Q=>{L.push(Q.code)}),c.open_ticket_codes=L}F(c)},F=async function(c){C(),await y.updateOrder(c).then(()=>{l(),X(d,{message:"Stato aggiornato correttamente",error:!1}),t.emit("closeDialog",k.value)}).catch(u=>{l(),B(d,u)})};return{form:n,open_tickets:i,paymentList:f,paymentModeList:_,changeStatus:j,errorMessage:g,errorMessageVoucher:v,dynamicPaymentMethods:S,fetchAllOpenTickets:D,onChangeStatus:function(){(n.value.status=="free"||n.value.status=="to_pay")&&(n.value.payment_method=null)}}}},lt={key:0,class:"formgrid grid flex-column mt-3"},at={class:"field col-12"},it=s("label",{for:"status"},"Stato pagamento",-1),rt={class:"field col-12"},ct=s("label",{for:"payment_method"},"Modalità pagamento",-1),dt={class:"p-error",id:"dd-error"},ut={key:0,class:"field col-12 flex flex-column"},mt=s("label",{for:"user_zip"},"Codice biglietto",-1),_t={key:0,class:"pi pi-exclamation-triangle",style:{color:"#ff6767"}},ft={class:"p-error",id:"dd-error"},vt={class:"flex align-items-center justify-content-end mt-3"};function ht(o,t,n,e,y,C){const l=w("Dropdown"),d=w("AutoComplete"),g=w("Button"),v=ye("tooltip");return h(),p(Y,null,[e.form?(h(),p("div",lt,[s("div",at,[it,a(l,{modelValue:e.form.status,"onUpdate:modelValue":t[0]||(t[0]=i=>e.form.status=i),options:e.paymentList,optionLabel:"name",optionValue:"id",class:"w-full",onChange:t[1]||(t[1]=i=>e.onChangeStatus())},null,8,["modelValue","options"])]),s("div",rt,[ct,a(l,{modelValue:e.form.payment_method,"onUpdate:modelValue":t[2]||(t[2]=i=>e.form.payment_method=i),options:e.dynamicPaymentMethods,optionLabel:"label",optionValue:"id",class:G(["w-full",{"p-invalid":e.errorMessage}]),disabled:e.form.status!="payed",onChange:t[3]||(t[3]=i=>e.errorMessage=null)},null,8,["modelValue","options","disabled","class"]),s("small",dt,b(e.errorMessage||" "),1)]),e.form.payment_method=="voucher"&&e.form.status=="payed"?(h(),p("div",ut,[mt,a(d,{modelValue:e.form.open_tickets_used,"onUpdate:modelValue":t[4]||(t[4]=i=>e.form.open_tickets_used=i),suggestions:e.open_tickets,class:G(["uppercase w-full",{"p-invalid":e.errorMessageVoucher}]),onComplete:t[5]||(t[5]=i=>e.fetchAllOpenTickets(i)),emptySearchMessage:"Nessun risultato",emptySelectionMessage:"Nessun risultato",optionLabel:"code",optionValue:"code",multiple:"",onChange:t[6]||(t[6]=i=>e.errorMessageVoucher=null)},{option:T(({option:i})=>[s("span",{class:"flex flex-row justify-content-between",style:we({color:i.expired?"#ff6767":null})},[U(b(i.code)+" ",1),i.expired?oe((h(),p("i",_t,null,512)),[[v,"Scaduto"]]):O("",!0)],4)]),_:1},8,["modelValue","suggestions","class"]),s("small",ft,b(e.errorMessageVoucher||" "),1)])):O("",!0)])):O("",!0),s("div",vt,[a(g,{label:"Annulla",text:"",onClick:t[7]||(t[7]=i=>o.$emit("closeDialog",null))}),a(g,{label:"Conferma",onClick:t[8]||(t[8]=i=>e.changeStatus())})])],64)}const pt=H(st,[["render",ht]]),yt={props:["order"],setup(o){$(()=>{_.value&&f.value&&_.value.forEach(k=>{k.permalink===f.value&&(C.value=k.name)})});const t=x(0),n=x([]),e=x(!1),y=x(!0),C=x(),l=ve(),d=K();W();const g=ne(),v=M(()=>l.allTickets),i=M(()=>d.getCurrentOrder),f=M(()=>g.getCurrentLocation),_=M(()=>g.allLocations),S=M(()=>{const k=o.order.payment_method,D=d.getPaymentMethods;return k?D[k]:"-"});return{tickets:v,active:t,partialTotals:n,showOrderDetail:e,currentOrder:i,showSecondTab:y,currentLocation:f,selectedLocation:C,formatExplicitDate:De,formatDate:ge,prettyPaymentStatus:Te,formatPrettyDate:Ze,formatDataAndHourFromUnixTimestamps:et,prettyPaymentMethod:ot,methodLabel:S}},components:{}};const gt={class:"mt-3 line-height-3"},kt={class:"flex gap-3"},bt=s("i",{class:"pi pi-user mt-1"},null,-1),xt={class:"m-0 mb-1"},wt={class:"m-0 mb-1"},Ct={class:"m-0 mb-1"},Dt={class:"m-0 mb-1"},St={key:0},Tt={class:"flex gap-3 mt-4"},Vt=s("i",{class:"pi pi-map-marker mt-1"},null,-1),Ot={class:"m-0 mb-1"},At={class:"m-0 mb-1"},Mt={key:0,class:"m-0 mb-1"},Pt={class:"flex gap-3 mt-4"},Ft=s("i",{class:"pi pi-shopping-cart mt-1"},null,-1),Nt={class:"m-0 mb-1"},Lt={class:"m-0 mb-1"},Ut={class:"m-0 mb-1"},Bt={key:0,class:"m-0 mb-1"},jt={key:1,class:"m-0 mb-1"},Et={key:2,class:"m-0 mb-1"},It={class:"m-0 mb-1"},Rt={class:"m-0 mb-1"},zt={key:0},qt={key:1},Ht={key:0,class:"flex gap-3 mt-4"},$t=s("i",{class:"pi pi-comment mt-1"},null,-1);function Jt(o,t,n,e,y,C){const l=w("Badge");return h(),p("div",gt,[s("div",kt,[bt,s("div",null,[s("p",xt,b(n.order.user_name)+" "+b(n.order.user_surname||"-"),1),s("p",wt,b(n.order.user_email),1),s("p",Ct,b(n.order.user_phone),1),s("p",Dt,[U(b(n.order.country)+" ",1),n.order.user_zip?(h(),p("span",St," - "+b(n.order.user_zip),1)):O("",!0)])])]),s("div",Tt,[Vt,s("div",null,[s("p",Ot,b(e.selectedLocation),1),s("p",At,b(n.order.course_name),1),n.order.date?(h(),p("p",Mt,b(e.formatPrettyDate(n.order.date))+" "+b(n.order.start_at),1)):O("",!0)])]),s("div",Pt,[Ft,s("div",null,[s("p",Nt,b(n.order.reservation_number),1),s("p",Lt,b(e.formatDataAndHourFromUnixTimestamps(n.order.created_at)),1),s("p",Ut,b(n.order.created_by),1),n.order.status?(h(),p("p",Bt,[a(l,{value:e.prettyPaymentStatus(n.order.status),class:G([n.order.status,"px-3 border-round-lg"])},null,8,["value","class"])])):O("",!0),n.order.status=="payed"?(h(),p("p",jt,b(e.methodLabel),1)):O("",!0),n.order.open_tickets_used&&n.order.status=="payed"?(h(),p("p",Et,[(h(!0),p(Y,null,ue(n.order.open_tickets_used,d=>(h(),p("span",{key:d},[a(l,{value:d.code,class:"mr-2 voucher"},null,8,["value"])]))),128))])):O("",!0),s("p",It,"Codice sconto utilizzato: "+b(n.order.discount_code||"-"),1),s("p",Rt,[U(" Totale ordine: "),n.order.total?(h(),p("span",zt,"€ "+b((+n.order.total).toFixed(2)),1)):(h(),p("span",qt,"-"))])])]),n.order.notes?(h(),p("div",Ht,[$t,s("div",null,b(n.order.notes),1)])):O("",!0)])}const Wt=H(yt,[["render",Jt]]),Gt={props:["order","location_permalink"],setup(o,t){$(()=>{o.order&&o.order.notes&&(n.value=o.order.notes)});const n=x(),{showLoader:e,hideLoader:y}=se(),C=W(),l=K(),d=M(()=>l.getCurrentOrder);return{notes:n,updateOrder:async function(){const v={id:o.location_permalink,order_id:o.order.id,notes:n.value,api_version:"v2"};e(),await l.updateOrder(v).then(()=>{y(),X(C,{message:"Nota aggiornata correttamente",error:!1}),t.emit("closeDialog",d.value)}).catch(i=>{y(),B(C,i)})}}}},Kt={class:"pt-5 px-2"},Qt={class:"flex align-items-center justify-content-end mt-3"};function Xt(o,t,n,e,y,C){const l=w("Textarea"),d=w("Button");return h(),p("div",Kt,[a(l,{modelValue:e.notes,"onUpdate:modelValue":t[0]||(t[0]=g=>e.notes=g),rows:"8",cols:"30",class:"w-full"},null,8,["modelValue"]),s("div",Qt,[a(d,{label:"Annulla",text:"",onClick:t[1]||(t[1]=g=>o.$emit("closeDialog",null))}),a(d,{label:"Conferma",onClick:t[2]||(t[2]=g=>e.updateOrder())})])])}const Yt=H(Gt,[["render",Xt]]),Zt={props:["filters"],setup(o,t){$(()=>{r.value=!0,c.value={first:0,rows:S.value.rows,sortField:null,sortOrder:null},c.value.page=0,o.filters.location&&R()});const n=K(),e=ke(),y=M(()=>n.responseOrders),C=M(()=>n.status),l=Qe(),d=M(()=>l.submitDialog),g=M(()=>n.paymentStatus),v=M(()=>n.getDeleteResponse),{showLoader:i,hideLoader:f}=se(),_=W(),S=x(),k=x(),D=x(),j=x(),F=x(),r=x(!0),c=x(),u=x(0),N=x([]),L=x([]),Q=x(!1),le=x(!1),A=x(),I=x(!1);function R(){r.value=!0;let m=new Map;for(const V in o.filters)V=="date"?me(o.filters.date)=="Invalid DateTime"?m.set("date",Se(o.filters.date)):m.set("date",me(o.filters.date)):o.filters.location&&m.set("location_permalink",o.filters.location.permalink),V=="course"&&o.filters.course.id!="-1"&&m.set("course",o.filters.course.id),V=="hour"&&o.filters.hour!="Tutti gli orari"&&m.set("hour",o.filters.hour),V=="name"&&m.set("name",o.filters.name);setTimeout(()=>{ae(m)},Math.random()*1e3+250)}const ae=async function(m){await n.fetchAllOrders(m).then(()=>{r.value=!1}).catch(V=>{r.value=!1,B(_,V)})},ie=m=>{D.value.toggle(m),A.value.toggle(m)},re=(m,V)=>m>m+V?"red":"green",ce=function(m,V){V&&(D.value.note=V,D.value.toggle(m))},q=function(m){m.order&&y.value.time_slots&&y.value.time_slots.forEach((V,P)=>{V.orders.forEach((E,z)=>{E.id==m.order.id&&(y.value.time_slots[P].orders[z]=m.order,m.check_in_done!=null&&(y.value.time_slots[P].check_in_done+=m.check_in_done))})})},Ae=async function(m,V){let P=[],E=!1;L.value.forEach(J=>{if(J.id==m.id){E=!0;return}});for(let J of m.tickets)P.push(J.order_item_id);const z={check_in:V,order_item_ids:P,location_permalink:o.filters.location};await n.checkInOrder(z).then(()=>{q(v.value),X(_,{message:"Check-in registrato correttamente",error:!1}),E&&de(L.value,v.value.order)}).catch(J=>{B(_,J)})},Me=async function(m,V){let P=[],E=!1;L.value.forEach(J=>{if(J.id==m.id){E=!0;return}});for(let J of m.tickets)P.push(J.order_item_id);const z={order_item_ids:P,no_show:V,location_permalink:o.filters.location.permalink};await n.noShowOrder(z).then(()=>{q(v.value),X(_,{message:"No-show registrato correttamente",error:!1}),E&&de(L.value,v.value.order)}).catch(J=>{B(_,J)})},Pe=async function(m,V,P){const E={id:m,check_in:V,location_permalink:o.filters.location.permalink};await n.checkInTicket(E).then(()=>{X(_,{message:"Check-in registrato correttamente",error:!1}),q(v.value),de(L.value,v.value.order)}).catch(z=>{B(_,z)})},Fe=async function(m,V,P){const E={id:m,no_show:V,location_permalink:o.filters.location.permalink};await n.noShowTicket(E).then(()=>{X(_,{message:"No-show registrato correttamente",error:!1}),q(v.value),de(L.value,v.value.order)}).catch(z=>{B(_,z)})},de=function(m,V){let P=Ne(L.value,v.value.order.id);P!=-1&&L.value.splice(P,1),L.value.push(v.value.order)},Ne=function(m,V){for(let P=0;P<m.length;P++)if(m[P].id===V)return P;return-1},Le=function(m){const V={course_name:m.course_name,start_at:m.start_at,date:o.filters.date,hour:m.start_at,max_seats:m.is_free_slot?null:m.remaing_seats+""};t.emit("updateFilters",V)},Ue=function(m){Q.value=!0,j.value=m},Be=function(m){q({order:m}),Q.value=!1,I.value=!1},je=function(m){return m!=null&&m.created_by&&(m==null?void 0:m.created_by)=="WEB"?"WEB":"KALATA"},Ee=function(m,V){let P=0;if(m&&m.tickets){m.tickets.forEach(z=>{V?z.no_show&&(P+=1):z.check_in&&(P+=1)});let E=m.tickets.length;if(P!=E&&P!=0)return P+"/"+E}},Ie=function(m,V){A.value.data=V,A.value.toggle(m)},Re=function(m,V){F.value=V.id;let P="Sei sicuro di voler eliminare questa prenotazione?";P+='<br><br> <i>N.B. Eventuali voucher presenti nella prenotazione vanno liberati manualmente dalla sezione "Data aperta"</i>',l.setDialog("Elimina prenotazione","Elimina","Annulla",P),l.setBtnSubmit(!1),l.setDynamicDialogVisibility(!0)},ze=function(){if(i(),F.value){const m={id:F.value,location_permalink:o.filters.location.permalink};n.deleteOrder(m).then(()=>{f(),X(_,{message:"La prenotazione è stata eliminata correttamente",error:!1}),y.value.time_slots&&y.value.time_slots.forEach((V,P)=>{V.orders.forEach((E,z)=>{E.id==F.value&&(y.value.time_slots[P].orders.splice(z,1),v.value,y.value.time_slots[P].check_in_done+=v.value.check_in_done,y.value.time_slots[P].confirmed_seats+=v.value.confirmed_seats,y.value.time_slots[P].remaing_seats-=v.value.confirmed_seats)})})}).catch(V=>{f(),B(_,V)})}},qe=function(m){N.value=m.data?[m.data]:[]},He=function(m){L.value=m.data?[m.data]:[]},$e=function(m){le.value=!0,k.value=m},Je=function(m){I.value=!0,k.value=m},We=function(m){const V=new Map;V.set("id",m.id),V.set("location_permalink",o.filters.location.permalink),i(),n.downloadTicket(V).then(()=>{f()}).catch(P=>{f(),B(_,P)})},Ge=function(m,V){i(),_e(m,V.location.permalink).then(()=>{f()}).catch(()=>{f()})},Ke=function(m,V){i(),pe(m,V.location.permalink).then(()=>{f()}).catch(()=>{f()})};return Z(d,m=>{m&&ze()}),Z(o.filters,()=>{o.filters.location&&R()}),{dt:S,responseOrders:y,loading:r,totalRecords:u,lazyParams:c,currentOrder:k,status:C,expandedRows:N,expandedRows1:L,op:D,dialogStore:e,paymentList:g,visibleDialog:Q,currentTimeSlot:j,visibleMenu:A,visibleDetailDialog:le,visibleNotesDialog:I,toast:_,loadLazyData:R,toggle:ie,getProgressClass:re,showNotes:ce,checkAll:Ae,noShowAll:Me,openDialog:Le,checkInSingleTicket:Pe,noShowSingleTicket:Fe,prettyPaymentStatus:Te,openPaymentStatusDialog:Ue,onClosePaymentStatusDialog:Be,getRowClass:je,printPDF:pe,showLabelCheckbox:Ee,confirmDeleteOrder:Re,showMenu:Ie,openOrderDetailDialog:$e,openNotesDialog:Je,downloadPDF:We,handleRowToggle:qe,handleRowToggle1:He,openPDFTab:Ge,openPDFTicketTab:Ke,formatDataFromUnixTimestamps:tt,printOrderPDF:_e}},components:{PaymentStatusDialog:pt,OrderDetailDialog:Wt,NotesDialog:Yt}};const eo={class:"order-table"},to={class:""},oo={style:{width:"15rem"}},no={class:"m-0 text-right",style:{"font-size":"12px"}},so={key:0,class:"pi pi-exclamation-triangle cursor-pointer",style:{color:"var(--orange-400)"}},lo={style:{width:"15rem"}},ao={class:"m-0 text-right",style:{"font-size":"12px"}},io={key:0},ro={key:0},co=s("div",{class:"flex justify-content-center w-full"},"Check-in",-1),uo={class:"flex justify-content-center"},mo={class:"flex flex-column",style:{"margin-top":"8px"}},_o={class:"text-sm",style:{"min-height":"15px"}},fo=s("div",{class:"flex justify-content-center w-full"},"No-show",-1),vo={class:"flex justify-content-center"},ho={class:"flex flex-column",style:{"margin-top":"8px"}},po={class:"text-sm",style:{"min-height":"15px"}},yo=["onClick"],go={style:{"max-width":"50rem"},class:"p-3"},ko={class:"overlay-menu"},bo=["onClick"],xo=s("i",{class:"pi pi-eye mr-3"},null,-1),wo=["onClick"],Co=s("i",{class:"pi pi-print mr-3"},null,-1),Do=["onClick"],So=s("i",{class:"pi pi-download mr-3"},null,-1),To=["onClick"],Vo=s("i",{class:"pi pi-comment mr-3"},null,-1),Oo=["disabled","onClick"],Ao=s("i",{class:"pi pi-pencil mr-3"},null,-1),Mo=["disabled","onClick"],Po=s("i",{class:"pi pi-trash mr-3"},null,-1),Fo={key:0},No={key:1},Lo=s("div",{class:"flex justify-content-center w-full"},"Check-in",-1),Uo={class:"flex justify-content-center"},Bo=s("div",{class:"flex justify-content-center w-full"},"No-show",-1),jo={class:"flex justify-content-center"},Eo=s("div",{class:"flex justify-content-center w-full"},null,-1),Io={class:"flex justify-content-center"},Ro={key:0,class:"flex mx-4"},zo=s("div",null,[s("div",{class:"p-0 m-0 flex align-items-center"},[s("p",{style:{width:"2rem",height:"5px"},class:"mr-2 web my-0"}),s("span",{class:"text-sm"},"WEB")]),s("div",{class:"p-0 m-0 flex align-items-center justify-content-between"},[s("p",{style:{width:"2rem",height:"5px"},class:"mr-2 kalata"}),s("span",{class:"text-sm"},"SUPERGA")])],-1),qo=[zo];function Ho(o,t,n,e,y,C){const l=w("Column"),d=w("ProgressBar"),g=w("Button"),v=w("Badge"),i=w("Checkbox"),f=w("OverlayPanel"),_=w("DataTable"),S=w("PaymentStatusDialog"),k=w("Dialog"),D=w("OrderDetailDialog"),j=w("NotesDialog"),F=ye("tooltip");return h(),p("div",eo,[a(_,{value:e.responseOrders.time_slots,totalRecords:e.responseOrders.total,lazy:!0,paginator:!1,ref:"dt",loading:e.loading,stripedRows:"",expandedRows:e.expandedRows,"onUpdate:expandedRows":t[1]||(t[1]=r=>e.expandedRows=r),onRowExpand:e.handleRowToggle},{empty:T(()=>[U(" Nessuna prenotazione trovata. ")]),expansion:T(r=>[a(_,{value:r.data.orders,class:"m-4 mx-4 table-order-detail",expandedRows:e.expandedRows1,"onUpdate:expandedRows":t[0]||(t[0]=c=>e.expandedRows1=c),rowClass:e.getRowClass,onRowExpand:e.handleRowToggle1},{empty:T(()=>[U(" Nessuna prenotazione trovata. ")]),expansion:T(c=>[a(_,{value:c.data.tickets,class:"m-4 mx-5"},{default:T(()=>[a(l,{header:"Codice biglietto",field:"code"}),a(l,{header:"Tipo biglietto",field:"type"},{body:T(({data:u})=>[a(v,{value:u.ticket_name,class:G([u.ticket_name,"px-3 border-round-lg"])},null,8,["value","class"])]),_:1}),a(l,{header:"Prezzo"},{body:T(({data:u})=>[u.ticket_price?(h(),p("span",Fo," € "+b((+u.ticket_price).toFixed(2)),1)):(h(),p("span",No,"-"))]),_:1}),a(l,null,{header:T(()=>[Lo]),body:T(({data:u})=>[s("div",Uo,[a(i,{modelValue:u.check_in,"onUpdate:modelValue":N=>u.check_in=N,binary:!0,onChange:N=>e.checkInSingleTicket(u.id,u.check_in,c.data),class:"check_in"},null,8,["modelValue","onUpdate:modelValue","onChange"])])]),_:2},1024),a(l,null,{header:T(()=>[Bo]),body:T(({data:u})=>[s("div",jo,[a(i,{modelValue:u.no_show,"onUpdate:modelValue":N=>u.no_show=N,binary:!0,onChange:N=>e.noShowSingleTicket(u.id,u.no_show,c.data),class:"no_show"},null,8,["modelValue","onUpdate:modelValue","onChange"])])]),_:2},1024),a(l,{field:"tickets_url"},{header:T(()=>[Eo]),body:T(({data:u})=>[s("div",Io,[oe(a(g,{link:"",icon:"pi pi-print",href:u.tickets_url,target:"_blank",style:{color:"var(--surface-400)"},text:"",rounded:"",onClick:N=>e.openPDFTicketTab(u.id,n.filters)},null,8,["href","onClick"]),[[F,"Stampa",void 0,{top:!0}]])])]),_:1})]),_:2},1032,["value"])]),default:T(()=>[a(l,{header:"Codice",field:"reservation_number"}),a(l,{header:"Acquirente"},{body:T(({data:c})=>[U(b(c.user_name)+" "+b(c.user_surname)+" ",1),!c.user_name&&!c.user_surname?(h(),p("span",io,"-")):O("",!0)]),_:1}),a(l,{header:"Pagamento"},{body:T(({data:c})=>[c.status?(h(),p("span",ro,[a(v,{value:e.prettyPaymentStatus(c.status),class:G([c.status,"px-3 border-round-lg"])},null,8,["value","class"])])):O("",!0)]),_:1}),a(l,{header:"Q.ta",field:"tickets_number"}),a(l,null,{header:T(()=>[co]),body:T(({data:c})=>[s("div",uo,[s("div",mo,[a(i,{modelValue:c.check_in,"onUpdate:modelValue":u=>c.check_in=u,binary:!0,onChange:u=>e.checkAll(c,c.check_in),class:"check_in"},null,8,["modelValue","onUpdate:modelValue","onChange"]),s("span",_o,b(e.showLabelCheckbox(c,!1)),1)])])]),_:1}),a(l,null,{header:T(()=>[fo]),body:T(({data:c})=>[s("div",vo,[s("div",ho,[a(i,{modelValue:c.no_show,"onUpdate:modelValue":u=>c.no_show=u,binary:!0,onChange:u=>e.noShowAll(c,c.no_show),class:"no_show"},null,8,["modelValue","onUpdate:modelValue","onChange"]),s("span",po,b(e.showLabelCheckbox(c,!0)),1)])])]),_:1}),a(l,{header:"Note"},{body:T(({data:c})=>[s("div",{class:"notes cursor-pointer",onClick:u=>e.showNotes(u,c.notes)},b(c.notes||"-"),9,yo),a(f,{ref:"op"},{default:T(()=>[s("div",go,b(e.op.note),1)]),_:1},512)]),_:1}),a(l,{header:"",style:{"padding-right":"0",width:"6rem"}},{body:T(({data:c})=>[a(g,{type:"button","aria-haspopup":"true","aria-controls":"overlay_menu",icon:"pi pi-ellipsis-v",text:"",rounded:"",onClick:u=>e.showMenu(u,c)},null,8,["onClick"]),a(f,{ref:"visibleMenu"},{default:T(()=>[s("ul",ko,[s("li",{onClick:u=>e.openOrderDetailDialog(e.visibleMenu.data)},[xo,U("Dettaglio ordine ")],8,bo),s("li",{onClick:u=>e.openPDFTab(e.visibleMenu.data,n.filters)},[Co,U("Stampa ")],8,wo),s("li",{onClick:u=>e.downloadPDF(e.visibleMenu.data)},[So,U("Scarica PDF ")],8,Do),s("li",{onClick:u=>e.openNotesDialog(e.visibleMenu.data)},[Vo,U("Modifica nota ")],8,To),s("li",{disabled:!e.visibleMenu.data.can_change_status,onClick:u=>e.openPaymentStatusDialog(e.visibleMenu.data)},[Ao,U("Cambia stato ")],8,Oo),s("li",{disabled:!e.visibleMenu.data.can_cancel,onClick:u=>e.confirmDeleteOrder(u,e.visibleMenu.data)},[Po,U("Elimina ")],8,Mo)])]),_:2},1536)]),_:1}),a(l,{expander:"",class:"pl-0 ml-0"})]),_:2},1032,["value","expandedRows","rowClass","onRowExpand"]),r.data.orders&&r.data.orders.length>0?(h(),p("div",Ro,qo)):O("",!0)]),default:T(()=>[a(l,{header:"Percorso",field:"course_name",filterMatchMode:"contains",ref:"course_name"},null,512),a(l,{header:"Orario",field:"start_at",filterMatchMode:"contains",ref:"start_at"},{body:T(({data:r})=>[s("div",to,[s("span",{class:G(r.is_free_slot?"free":"")},b(r.start_at),3)])]),_:1},512),a(l,{header:"Posti prenotati",ref:"availabe_tickets",field:"availabe_tickets"},{body:T(({data:r})=>[s("div",oo,[s("p",no,[U(b(r.confirmed_seats)+"/"+b(r.remaing_seats+r.confirmed_seats)+" ",1),r.confirmed_seats>r.remaing_seats+r.confirmed_seats?oe((h(),p("i",so,null,512)),[[F,r.confirmed_seats-(r.remaing_seats+r.confirmed_seats)+" posti in overbooking",void 0,{top:!0}]]):O("",!0)]),a(d,{value:r.confirmed_seats*100/(r.remaing_seats+r.confirmed_seats),showValue:!1,style:{height:"10px"},class:G(["available-progress",e.getProgressClass(r.confirmed_seats,r.remaing_seats)])},null,8,["value","class"])])]),_:1},512),a(l,{header:"Check-in",ref:"confirmed_tickets",field:"confirmed_tickets"},{body:T(({data:r})=>[s("div",lo,[s("p",ao,b(r.check_in_done)+"/"+b(r.confirmed_seats),1),a(d,{value:r.check_in_done*100/(r.remaing_seats+r.confirmed_seats),showValue:!1,style:{height:"10px"},class:"check-in-progress"},null,8,["value"])])]),_:1},512),a(l,null,{body:T(({data:r})=>[oe(a(g,{type:"button","aria-haspopup":"true","aria-controls":"overlay_menu",class:"mr-0 text-primary",icon:"pi pi-calendar",text:"",rounded:"",onClick:c=>e.openDialog(r)},null,8,["onClick"]),[[F,"Prenota",void 0,{top:!0}]])]),_:1}),a(l,{expander:"",style:{width:"5rem"}})]),_:1},8,["value","totalRecords","loading","expandedRows","onRowExpand"]),a(k,{visible:e.visibleDialog,"onUpdate:visible":t[3]||(t[3]=r=>e.visibleDialog=r),modal:"",header:"Stato pagamento",style:{width:"35rem"}},{default:T(()=>[a(S,{location_permalink:n.filters.location.permalink,time_slot:e.currentTimeSlot,onCloseDialog:t[2]||(t[2]=r=>e.onClosePaymentStatusDialog(r))},null,8,["location_permalink","time_slot"])]),_:1},8,["visible"]),a(k,{visible:e.visibleDetailDialog,"onUpdate:visible":t[4]||(t[4]=r=>e.visibleDetailDialog=r),modal:"",header:"Dettaglio ordine",style:{width:"35rem"}},{default:T(()=>[a(D,{order:e.currentOrder},null,8,["order"])]),_:1},8,["visible"]),a(k,{visible:e.visibleNotesDialog,"onUpdate:visible":t[6]||(t[6]=r=>e.visibleNotesDialog=r),modal:"",header:"Modifica nota",style:{width:"35rem"}},{default:T(()=>[a(j,{order:e.currentOrder,location_permalink:n.filters.location.permalink,onCloseDialog:t[5]||(t[5]=r=>e.onClosePaymentStatusDialog(r))},null,8,["order","location_permalink"])]),_:1},8,["visible"])])}const $o=H(Zt,[["render",Ho]]),Jo={props:["filters"],setup(o,t){$(()=>{_(),n.value=o.filters,n.value.date=new Date,D()});const n=x({}),e=ne(),y=K(),C=W(),l=x([]),d=x(),g=ee.now().plus({years:1}),v=M(()=>e.allLocations),i=M(()=>y.getCalendar),f=async function(r){await y.fetchCalendar(r).then(()=>{}).catch(c=>{B(C,c)})},_=async function(){await e.fetchAllLocations().then(()=>{}).catch(r=>{B(C,r)})},S=function(){if(o.filters.location){const r=v.value.find(c=>c.permalink===o.filters.location);l.value=r.courses}},k=function(r){let c={};c.month=ee.fromJSDate(new Date(r)).month,c.year=ee.fromJSDate(new Date(r)).year,c.location_permalink=o.filters.location.permalink?o.filters.location.permalink:o.filters.location,d.value={month:c.month,year:c.year},f(c)},D=function(){let r=ee.now(),c={location_permalink:"",month:"",year:""};c.location_permalink=o.filters.location.permalink?o.filters.location.permalink:o.filters.location,c.month=r.month+"",c.year=r.year+"",f(c)},j=function(r){if(i.value.web_dates&&i.value.web_dates.length!=0){let c=r.month+1;c=c<10?"0"+c:c;let u=r.day<10?"0"+r.day:r.day,N=r.year+"-"+c+"-"+u;return i.value.web_dates.find(L=>L==N)}},F=function(r){let c={location_permalink:o.filters.location.permalink?o.filters.location.permalink:o.filters.location,month:r.month,year:r.year};f(c)};return Z(o.filters,()=>{if(d.value){let r={location_permalink:o.filters.location.permalink?o.filters.location.permalink:o.filters.location,month:d.value.month,year:d.value.year};f(r)}else D()}),{form:n,courses:l,maxAllowedDate:g,locations:v,calendar:i,getCourses:S,onDateChange:k,getDayFromDate:j,onMonthChange:F}}};const Wo={class:"flex calendar-filter"},Go={key:0,class:"special-day"};function Ko(o,t,n,e,y,C){const l=w("Calendar");return h(),p("div",Wo,[a(l,{modelValue:e.form.date,"onUpdate:modelValue":t[0]||(t[0]=d=>e.form.date=d),inline:"",onDateSelect:t[1]||(t[1]=d=>e.onDateChange(d)),onMonthChange:t[2]||(t[2]=d=>e.onMonthChange(d)),maxDate:e.maxAllowedDate.toJSDate()},{date:T(d=>[e.getDayFromDate(d.date)?(h(),p("div",Go,[s("span",null,b(d.date.day),1)])):(h(),p(Y,{key:1},[U(b(d.date.day),1)],64))]),_:1},8,["modelValue","maxDate"])])}const Qo=H(Jo,[["render",Ko]]);class Xo{static async fetchAll(t){const n=t.location_permalink;return delete t.location_permalink,(await he(`/ticket_office/${n}/search/courses`,t)).data}}const Oe=fe({id:"course",state:()=>({course:{},courses:[],response_courses:{}}),getters:{allCourses:o=>o.response_courses.tickets,responseCourses:o=>o.response_courses,getTotalCourses:o=>o.response_courses?o.response_courses.total:0,getCurrentCourse:o=>o.course},actions:{async fetchAllCourses(o){await Xo.fetchAll(o).then(t=>this.response_courses=t)}}}),Yo={props:["filters"],setup(o,t){$(()=>{n.value=Object.assign({},o.filters),n.value.date=ee.now().toFormat("dd/MM/yyyy"),l.value=Ve(8,20),l.value.unshift("Tutti gli orari"),n.value.hour="Tutti gli orari"});const n=x({}),e=x([]),y=ne(),C=W(),l=x([]),d=K(),g=Oe(),v=M(()=>y.allLocations),i=M(()=>d.responseOrders),f=M(()=>g.allCourses),_=function(){n.value.name=null,n.value.course=e.value[0].name,n.value.hour=l.value[0],t.emit("onSubmit",n.value)},S=async function(){const k={location_permalink:n.value.location.permalink,api_version:"v2"};await g.fetchAllCourses(k).then(()=>{}).catch(D=>{B(C,D)})};return Z(v,()=>{o.filters.location&&v.value&&(n.value=Object.assign({},o.filters),n.value.hour||(n.value.hour="Tutti gli orari"),S())}),Z(o.filters,()=>{o.filters.location&&v.value&&n.value.location&&n.value.location!=o.filters.location&&(n.value=Object.assign({},o.filters),n.value.hour||(n.value.hour="Tutti gli orari"))}),Z(f,()=>{var k;e.value=Object.assign([],f.value),e.value&&((k=e.value[0])==null?void 0:k.id)!="-1"&&e.value.unshift({id:"-1",name:"Tutti i percorsi"}),n.value.course=e.value[0].name}),{form:n,courses:e,hours:l,locations:v,responseOrders:i,resetField:_}}},Zo={class:"formgrid grid px-0 align-items-center"},en={key:0,class:"field col-4 flex flex-column"},tn=s("label",{for:"typology"},"Filtra per percorso",-1),on={key:1,class:"field col-3 flex flex-column"},nn=s("label",{for:"typology"},"Filtra per orario (dalle)",-1),sn=s("div",{class:"col-12"},null,-1),ln={class:"field col-4 flex flex-column"},an=s("label",{for:"typology"},"Filtra per acquirente",-1),rn={class:"flex col-12 justify-content-end pt-1"};function cn(o,t,n,e,y,C){const l=w("Dropdown"),d=w("InputText"),g=w("Button"),v=w("AccordionTab"),i=w("Accordion");return h(),te(i,{activeIndex:0},{default:T(()=>[a(v,{header:"FILTRI"},{default:T(()=>[s("div",Zo,[e.form.location&&e.courses?(h(),p("div",en,[tn,a(l,{modelValue:e.form.course,"onUpdate:modelValue":t[0]||(t[0]=f=>e.form.course=f),options:e.courses,optionLabel:"name",optionValue:"name",placeholder:""},null,8,["modelValue","options"])])):O("",!0),e.responseOrders?(h(),p("div",on,[nn,a(l,{modelValue:e.form.hour,"onUpdate:modelValue":t[1]||(t[1]=f=>e.form.hour=f),options:e.hours,placeholder:""},null,8,["modelValue","options"])])):O("",!0),sn,s("div",ln,[an,a(d,{modelValue:e.form.name,"onUpdate:modelValue":t[2]||(t[2]=f=>e.form.name=f),placeholder:""},null,8,["modelValue"])])]),s("div",rn,[a(g,{label:"Ricerca",class:"mr-2",onClick:t[3]||(t[3]=f=>o.$emit("onSubmit",e.form))}),a(g,{label:"Annulla",class:"p-button-outlined",onClick:t[4]||(t[4]=f=>e.resetField())})])]),_:1})]),_:1})}const dn=H(Yo,[["render",cn]]),un={props:["form","price","index","ticket"],setup(o,t){const n=x(0),e=function(){n.value++,C()},y=function(){n.value>0&&n.value--,C()},C=function(){n.value==null&&(n.value=0);const l={counter:n.value,price:o.price,index:o.index,ticket:o.ticket};t.emit("changeCounter",l)};return{counter:n,decrement:y,increment:e,emitEvent:C}}};const mn={class:"btn-plus-min flex align-items-center"},_n={class:"counter"};function fn(o,t,n,e,y,C){const l=w("Button"),d=w("InputNumber");return h(),p("div",mn,[a(l,{icon:"pi pi-minus",rounded:"",outlined:"",severity:"secondary",onClick:e.decrement,disabled:e.counter===0},null,8,["onClick","disabled"]),s("div",_n,[a(d,{modelValue:e.counter,"onUpdate:modelValue":[t[0]||(t[0]=g=>e.counter=g),t[1]||(t[1]=g=>e.emitEvent())],min:0},null,8,["modelValue"])]),a(l,{icon:"pi pi-plus",rounded:"",outlined:"",severity:"secondary",onClick:e.increment},null,8,["onClick"])])}const vn=H(un,[["render",fn]]),hn={props:["tickets","form"],setup(o,t){$(()=>{y.value=!1,l.discount={},C.value=null,o.form.max_seats&&o.form.max_seats<0?(v.value=!0,i.value=-o.form.max_seats):v.value=!1});const n=x(0),e=x([]),y=x(!1),C=x(),l=K(),d=W(),g=x(!1),v=x(!1),i=x(),f=M(()=>l.getDiscount),_=function(F){e.value[F.index]={partial_total:F.price*F.counter,ticket:F.ticket,quantity:F.counter},n.value=0;let r=0;e.value.forEach(c=>{n.value+=c.partial_total,r+=c.quantity}),v.value||(o.form.max_seats&&r>+o.form.max_seats?(i.value=r-+o.form.max_seats,g.value=!0):(i.value=null,g.value=!1)),C.value&&k()},S=function(){k()},k=async function(){let F=[];e.value.forEach(c=>{F.push({id:c.ticket.id,quantity:c.quantity})});const r={discount_code:C.value,location_permalink:o.form.location_permalink,tickets:F};await l.cost(r).then(()=>{}).catch(c=>{B(d,c)})};return{total:n,partialTotals:e,showDiscount:y,discountCode:C,discount:f,showAlert:g,showAlert2:v,numOverbooking:i,onChangeCounter:_,applyDiscount:S,checkDisabled:function(){let F=!1;(!e.value||e.value.length==0)&&(F=!0);let r=0;return e.value.forEach(c=>{r+=c.quantity}),r==0&&(F=!0),t.emit("disableSecondoTab",!0),F},nextTab:function(){const F={discount_code:C.value,partial_total:e.value};t.emit("nextTab",F)}}},components:{PlusMinusButton:vn}};const pn={key:0},yn={key:1},gn={key:0},kn={key:1},bn={key:0,class:"flex justify-content-between align-items-center"},xn={class:"flex align-items-center col-9"},wn={class:"col-7 pl-0"},Cn={class:"text-right col-2"},Dn={class:"col-3 flex justify-content-end"},Sn={key:2,class:"mt-3 mb-5"},Tn=s("i",null,"Nessuna tipologia di biglietto trovata.",-1),Vn=[Tn],On=s("hr",{class:"mt-3"},null,-1),An={class:"flex align-items-center justify-content-between py-0"},Mn={class:"col-9 flex"},Pn=s("b",null,"Totale",-1),Fn=[Pn],Nn={class:"col-2 text-right font-bold"},Ln={class:"col-3 flex justify-content-end"};function Un(o,t,n,e,y,C){const l=w("Message"),d=w("PlusMinusButton"),g=w("Button");return h(),p(Y,null,[e.showAlert?(h(),te(l,{key:0,severity:"warn",closable:!1},{default:T(()=>[U("Attenzione! Si sta andando in overbooking di "+b(e.numOverbooking)+" ",1),e.numOverbooking==1?(h(),p("span",pn,"posto")):(h(),p("span",yn,"posti"))]),_:1})):O("",!0),e.showAlert2?(h(),te(l,{key:1,severity:"warn",closable:!1},{default:T(()=>[U("Attenzione! Lo slot orario è già in overbooking di "+b(e.numOverbooking)+" ",1),e.numOverbooking==1?(h(),p("span",gn,"posto")):(h(),p("span",kn,"posti"))]),_:1})):O("",!0),(h(!0),p(Y,null,ue(n.tickets,(v,i)=>{var f,_,S;return h(),p("div",{key:v.id},[((f=v.course)==null?void 0:f.id)==((_=n.form.course)==null?void 0:_.id)?(h(),p("div",bn,[s("div",xn,[s("b",wn,b(v.name),1),s("div",Cn,"€ "+b((S=v.price)==null?void 0:S.toFixed(2)),1)]),s("div",Dn,[a(d,{onChangeCounter:t[0]||(t[0]=k=>e.onChangeCounter(k)),price:v.price,index:i,ticket:v},null,8,["price","index","ticket"])])])):O("",!0)])}),128)),n.tickets&&n.tickets.length==0?(h(),p("div",Sn,Vn)):O("",!0),On,s("div",An,[s("div",Mn,[s("div",{class:G(["pl-0",e.discount&&e.discount.total_amount?"col-2":"col-7"])},Fn,2),s("div",Nn,"€ "+b(e.total.toFixed(2)),1)]),s("div",Ln,[a(g,{label:"Prosegui",onClick:t[1]||(t[1]=v=>e.nextTab()),disabled:e.checkDisabled()},null,8,["disabled"])])])],64)}const Bn=H(hn,[["render",Un]]);class jn{static async fetchAll(){return(await Ce("/countries")).data.countries}}const En=fe({id:"country",state:()=>({country:{},countries:[]}),getters:{allCountries:o=>o.countries},actions:{async fetchAllCountries(){await jn.fetchAll().then(o=>this.countries=o)}}});class In{static async fetchAll(){return(await Ce("/provinces")).data.provinces}}const Rn=fe({id:"province",state:()=>({province:{},provinces:[]}),getters:{allProvinces:o=>o.provinces,getCurrentProvince:o=>o.province},actions:{async fetchAllProvinces(){await In.fetchAll().then(o=>this.provinces=o)}}}),zn={computed:{Code(){return Code}},props:["location_permalink"],setup(o,t){$(()=>{D(),j()});const n=ve(),e=En(),y=K(),C=Rn(),l=x({}),d=x(),g=x(),v=M(()=>e.allCountries),i=M(()=>n.allOpenTickets),f=M(()=>y.paymentStatus),_=M(()=>y.paymentModeList),S=M(()=>C.allProvinces),k=M(()=>{const u=y.getPaymentMethods;return Object.entries(u).map(([N,L])=>({id:N,label:L}))}),D=async function(){await e.fetchAllCountries().then(()=>{l.value.country_id=88,l.value.status={id:"payed",name:"Pagato"}})},j=async function(){await C.fetchAllProvinces()};return{form:l,countries:v,paymentList:f,paymentModeList:_,errorMessage:d,errorMessageVoucher:g,open_tickets:i,provinces:S,dynamicPaymentMethods:k,fetchAllOpenTickets:async function(u){const N={code:u.query.toUpperCase(),location_permalink:o.location_permalink};await n.fetchAllOpenTickets(N)},onChangeStatus:function(){l.value.status.id&&(l.value.status.id=="free"||l.value.status.id=="to_pay")&&(l.value.payment_method=null)},onConfirm:function(){if(l.value.status&&l.value.status.id=="payed"){if(!l.value.payment_method){d.value="Seleziona un metodo di pagamento";return}if(l.value.open_ticket_codes){for(const u of l.value.open_ticket_codes)if(u.expired){g.value="Uno o più codici biglietto risultano scaduti";return}}}t.emit("nextTab",l.value)}}}},qn={key:0,class:"formgrid grid"},Hn={class:"field col-6"},$n=s("label",{for:"user_name"},"Nome",-1),Jn={class:"field col-6"},Wn=s("label",{for:"user_surname"},"Cognome",-1),Gn={class:"field col-6"},Kn=s("label",{for:"user_email"},"Email",-1),Qn={class:"field col-6"},Xn=s("label",{for:"user_phone"},"Telefono",-1),Yn={class:"field col-6"},Zn=s("label",{for:"country_id"},"Nazione",-1),es={class:"field col-6"},ts=s("label",{for:"province"},"Provincia",-1),os={class:"field col-6"},ns=s("label",{for:"status"},"Stato pagamento",-1),ss={class:"field col-6"},ls={for:"payment_method"},as={key:0},is={class:"p-float-label"},rs={class:"p-error",id:"dd-error"},cs={key:0,class:"field col-6 flex flex-column"},ds=s("label",{for:"user_zip"},"Codice biglietto",-1),us={key:0,class:"pi pi-exclamation-triangle",style:{color:"#ff6767"}},ms={class:"p-error",id:"dd-error"},_s={class:"field col-12"},fs={class:"field flex flex-column"},vs=s("label",{for:"notes"},"Note",-1),hs={class:"col-12 flex justify-content-end"};function ps(o,t,n,e,y,C){const l=w("InputText"),d=w("Dropdown"),g=w("AutoComplete"),v=w("Textarea"),i=w("Button"),f=ye("tooltip");return e.form?(h(),p("div",qn,[s("div",Hn,[$n,a(l,{type:"text",modelValue:e.form.user_name,"onUpdate:modelValue":t[0]||(t[0]=_=>e.form.user_name=_),class:"w-full"},null,8,["modelValue"])]),s("div",Jn,[Wn,a(l,{type:"text",modelValue:e.form.user_surname,"onUpdate:modelValue":t[1]||(t[1]=_=>e.form.user_surname=_),class:"w-full"},null,8,["modelValue"])]),s("div",Gn,[Kn,a(l,{type:"text",modelValue:e.form.user_email,"onUpdate:modelValue":t[2]||(t[2]=_=>e.form.user_email=_),class:"w-full"},null,8,["modelValue"])]),s("div",Qn,[Xn,a(l,{type:"text",modelValue:e.form.user_phone,"onUpdate:modelValue":t[3]||(t[3]=_=>e.form.user_phone=_),class:"w-full"},null,8,["modelValue"])]),s("div",Yn,[Zn,a(d,{modelValue:e.form.country_id,"onUpdate:modelValue":t[4]||(t[4]=_=>e.form.country_id=_),options:e.countries,optionLabel:"name",optionValue:"id",class:"w-full"},null,8,["modelValue","options"])]),s("div",es,[ts,a(d,{modelValue:e.form.user_zip,"onUpdate:modelValue":t[5]||(t[5]=_=>e.form.user_zip=_),options:e.provinces,optionLabel:"name",optionValue:"name",class:"w-full"},null,8,["modelValue","options"])]),s("div",os,[ns,a(d,{modelValue:e.form.status,"onUpdate:modelValue":t[6]||(t[6]=_=>e.form.status=_),options:e.paymentList,optionLabel:"name",class:"w-full",onChange:t[7]||(t[7]=_=>e.onChangeStatus())},null,8,["modelValue","options"])]),s("div",ss,[s("label",ls,[U("Modalità pagamento"),e.form.status&&e.form.status.id=="payed"?(h(),p("span",as,"*")):O("",!0)]),s("span",is,[a(d,{modelValue:e.form.payment_method,"onUpdate:modelValue":t[8]||(t[8]=_=>e.form.payment_method=_),options:e.dynamicPaymentMethods,optionLabel:"label",class:G(["w-full",{"p-invalid":e.errorMessage}]),disabled:e.form.status&&e.form.status.id!="payed",onChange:t[9]||(t[9]=_=>e.errorMessage=null)},null,8,["modelValue","options","disabled","class"])]),s("small",rs,b(e.errorMessage||" "),1)]),e.form.payment_method&&e.form.payment_method.id=="voucher"?(h(),p("div",cs,[ds,a(g,{modelValue:e.form.open_ticket_codes,"onUpdate:modelValue":t[10]||(t[10]=_=>e.form.open_ticket_codes=_),suggestions:e.open_tickets,class:G(["uppercase w-full",{"p-invalid":e.errorMessageVoucher}]),onComplete:t[11]||(t[11]=_=>e.fetchAllOpenTickets(_)),emptySearchMessage:"Nessun risultato",emptySelectionMessage:"Nessun risultato",optionLabel:"code",optionValue:"code",multiple:"",onChange:t[12]||(t[12]=_=>e.errorMessageVoucher=null)},{option:T(({option:_})=>[s("span",{class:"flex flex-row justify-content-between",style:we({color:_.expired?"#ff6767":null})},[U(b(_.code)+" ",1),_.expired?oe((h(),p("i",us,null,512)),[[f,"Scaduto"]]):O("",!0)],4)]),_:1},8,["modelValue","suggestions","class"]),s("small",ms,b(e.errorMessageVoucher||" "),1)])):O("",!0),s("div",_s,[s("div",fs,[vs,a(v,{modelValue:e.form.notes,"onUpdate:modelValue":t[13]||(t[13]=_=>e.form.notes=_),rows:"5",cols:"30"},null,8,["modelValue"])])]),s("div",hs,[a(i,{label:"Conferma",onClick:t[14]||(t[14]=_=>e.onConfirm())})])])):O("",!0)}const ys=H(zn,[["render",ps]]);var gs=`
@layer primevue {
    .p-contextmenu ul {
        margin: 0;
        padding: 0;
        list-style: none;
    }

    .p-contextmenu .p-submenu-list {
        position: absolute;
        min-width: 100%;
        z-index: 1;
    }

    .p-contextmenu .p-menuitem-link {
        cursor: pointer;
        display: flex;
        align-items: center;
        text-decoration: none;
        overflow: hidden;
        position: relative;
    }

    .p-contextmenu .p-menuitem-text {
        line-height: 1;
    }

    .p-contextmenu .p-menuitem {
        position: relative;
    }

    .p-contextmenu .p-menuitem-link .p-submenu-icon {
        margin-left: auto;
    }

    .p-contextmenu-enter-from {
        opacity: 0;
    }

    .p-contextmenu-enter-active {
        transition: opacity 250ms;
    }
}
`,ks={root:function(t){var n=t.instance;return["p-contextmenu p-component",{"p-input-filled":n.$primevue.config.inputStyle==="filled","p-ripple-disabled":n.$primevue.config.ripple===!1}]},menu:"p-contextmenu-root-list",menuitem:function(t){var n=t.instance,e=t.processedItem;return["p-menuitem",{"p-menuitem-active p-highlight":n.isItemActive(e),"p-focus":n.isItemFocused(e),"p-disabled":n.isItemDisabled(e)}]},content:"p-menuitem-content",action:function(t){var n=t.props,e=t.isActive,y=t.isExactActive;return["p-menuitem-link",{"router-link-active":e,"router-link-active-exact":n.exact&&y}]},icon:"p-menuitem-icon",label:"p-menuitem-text",submenuIcon:"p-submenu-icon",submenu:"p-submenu-list",separator:"p-menuitem-separator"};Xe.extend({name:"contextmenu",css:gs,classes:ks});const bs={props:["form"],setup(o,t){$(()=>{D()});const n=x(0),e=x([]),y=x(!1),C=x(!0),l=x(),d=x([]),{showLoader:g,hideLoader:v}=se(),i=ve(),f=K(),_=W(),S=M(()=>i.allTickets),k=M(()=>f.getCurrentOrder),D=async function(){const A={location_permalink:o.form.location_permalink,api_version:"v2",date:F(o.form.date),course_id:o.form.course.id};await i.fetchAllTickets(A).then(()=>{}).catch(I=>{B(_,I)})},j=function(A){n.value+=1,l.value=A.discount_code,e.value=Object.assign([],A.partial_total),C.value=!1},F=function(A){return me(A).includes("Invalid")?Se(A):me(A)},r=function(A){c(A)},c=async function(A){var ie,re,ce;const I=[{start_at:o.form.hour,tickets:[]}];e.value.forEach(q=>{q.quantity!=0&&I[0].tickets.push({id:q.ticket.id,quantity:q.quantity})});let R=[];A.open_ticket_codes&&A.open_ticket_codes.forEach(q=>{R.push(q.code)});const ae={location_permalink:o.form.location_permalink,country_id:A.country_id,status:A.status.id,user_email:A.user_email,user_name:A.user_name,user_phone:A.user_phone,user_surname:A.user_surname,user_zip:A.user_zip,api_version:"v2",date:o.form.date?F(o.form.date):"",notes:A.notes,time_slots:I,payment_method:(ie=A.payment_method)==null?void 0:ie.id,course_id:(ce=(re=o.form)==null?void 0:re.course)==null?void 0:ce.id,open_ticket_codes:R};l.value&&(ae.discount_code=l.value),await f.createOrder(ae).then(()=>{n.value+=1,C.value=!0,y.value=!0}).catch(q=>{B(_,q)})},u=function(){_e(k==null?void 0:k.value,o.form.location_permalink),t.emit("closeDialog",!0)},N=function(A){C.value=A},L=function(){_e(k==null?void 0:k.value,o.form.location_permalink),Q()},Q=async function(){let A=[];if(!k.value&&!o.form.location_permalink)return;for(let R of k.value.tickets)A.push(R.order_item_id);const I={check_in:!0,order_item_ids:A,location_permalink:o.form.location_permalink};await f.checkInOrder(I).then(()=>{X(_,{message:"Check-in registrato correttamente",error:!1}),t.emit("closeDialog",!0)}).catch(R=>{B(_,R)})},le=function(){g();const A={location_permalink:o.form.location_permalink,order_id:k.value.id};f.sendEmail(A).then(()=>{X(_,{message:"Email inviata correttamente al cliente",error:!1}),v(),t.emit("closeDialog",!0)}).catch(I=>{v(),B(_,I)})};return Z(k,()=>{d.value=[],k.value.tickets.forEach(A=>{const I=d.value.find(R=>R.ticket_name===A.ticket_name);if(!I)A.quantity=1,d.value.push(A);else{let R=d.value.indexOf(I);d.value[R].quantity+=1}})}),{tickets:S,active:n,partialTotals:e,showOrderDetail:y,currentOrder:k,tmp_tickets:d,showSecondTab:C,formatExplicitDate:De,formatDate:ge,onNextTab:j,onConfirmPayment:r,printPDF:pe,onPrintPDF:u,onDisableSecondoTab:N,printAndCheckIn:L,sendEmail:le}},components:{NewOrderTicketTab:Bn,NewOrderFormTab:ys}};const xs={key:0,class:"info-box"},ws={class:"font-medium"},Cs=s("i",{class:"pi pi-map-marker mr-3 font-medium"},null,-1),Ds={class:"font-medium"},Ss=s("i",{class:"pi pi-calendar mr-3 font-medium"},null,-1),Ts={key:0,class:"capitalize"},Vs={key:0,class:"flex pb-4"},Os=s("i",{class:"pi pi-ticket mr-3 font-medium mt-1"},null,-1),As={class:"flex flex-column"},Ms={key:0,class:"pb-1 pr-1"},Ps={key:1,class:"pb-1"},Fs={class:"py-5"},Ns={class:"m-0 text-center line-height-3"},Ls=s("br",null,null,-1),Us={key:0,class:"col-offset-3 col-6 flex justify-content-center flex-column align-items-center mt-4 order-summary"},Bs=s("p",{class:"my-2"},[s("b",null,"Riepilogo ordine:")],-1),js={class:"flex flex-column col-12"},Es={key:0,class:"pb-1",style:{"min-width":"8rem"}},Is={key:1,class:"pb-1"},Rs={key:2},zs={class:"flex flex-column col-12"},qs={key:0,class:"p-0 m-0 font-medium flex justify-content-between"},Hs=s("span",{class:"pb-1 pr-1"},"Totale ordine ",-1),$s={class:"pb-1"},Js={class:"flex align-items-center justify-content-center mt-4"};function Ws(o,t,n,e,y,C){var f,_;const l=w("NewOrderTicketTab"),d=w("TabPanel"),g=w("NewOrderFormTab"),v=w("Button"),i=w("TabView");return h(),p(Y,null,[n.form?(h(),p("div",xs,[s("p",ws,[Cs,U(b((f=n.form.course)==null?void 0:f.name),1)]),s("p",Ds,[Ss,n.form.date?(h(),p("span",Ts,b(e.formatDate((_=n.form)==null?void 0:_.date)),1)):O("",!0),U(" - "+b(n.form.hour),1)]),e.partialTotals&&e.partialTotals.length>0?(h(),p("div",Vs,[Os,s("div",As,[(h(!0),p(Y,null,ue(e.partialTotals,S=>{var k;return h(),p("p",{class:"p-0 m-0 font-medium flex justify-content-between",key:S},[S&&S.quantity!=0?(h(),p("span",Ms,b((k=S.ticket)==null?void 0:k.name),1)):O("",!0),S&&S.quantity!=0?(h(),p("span",Ps," x "+b(S.quantity)+" "+b(S.price),1)):O("",!0)])}),128))])])):O("",!0)])):O("",!0),a(i,{activeIndex:e.active,"onUpdate:activeIndex":t[6]||(t[6]=S=>e.active=S)},{default:T(()=>[a(d,{header:"Seleziona i biglietti",disabled:e.showOrderDetail},{default:T(()=>[a(l,{tickets:e.tickets,form:n.form,onNextTab:t[0]||(t[0]=S=>e.onNextTab(S)),onDisableSecondoTab:t[1]||(t[1]=S=>e.onDisableSecondoTab(S))},null,8,["tickets","form"])]),_:1},8,["disabled"]),a(d,{header:"Inserisci i dati",disabled:e.showSecondTab},{default:T(()=>[a(g,{onNextTab:t[2]||(t[2]=S=>e.onConfirmPayment(S)),location_permalink:n.form.location_permalink},null,8,["location_permalink"])]),_:1},8,["disabled"]),e.showOrderDetail?(h(),te(d,{key:0,header:"Ordine completato"},{default:T(()=>{var S,k;return[s("div",Fs,[s("div",Ns,[U(" Ordine "),s("b",null,b(e.currentOrder.reservation_number),1),U(" registrato correttamente!"),Ls]),e.currentOrder?(h(),p("div",Us,[Bs,s("div",js,[(h(!0),p(Y,null,ue(e.tmp_tickets,D=>(h(),p("p",{class:"p-0 m-0 font-medium flex justify-content-between flex-1",key:D},[D&&D.quantity!=0?(h(),p("span",Es,b(D.ticket_name),1)):O("",!0),D&&D.quantity!=0?(h(),p("span",Is," x "+b(D.quantity),1)):O("",!0),D.ticket_price?(h(),p("span",Rs," € "+b((+D.ticket_price).toFixed(2)),1)):O("",!0)]))),128))]),s("div",zs,[e.currentOrder.total?(h(),p("p",qs,[Hs,s("span",$s,[s("b",null,"€ "+b((+((S=e.currentOrder)==null?void 0:S.total)).toFixed(2)),1)])])):O("",!0)])])):O("",!0),s("div",Js,[a(v,{icon:"pi pi-envelope",class:"mr-3",rounted:"",outlined:"",label:"Invia biglietti",onClick:t[3]||(t[3]=D=>e.sendEmail()),disable:!((k=e.currentOrder)!=null&&k.user_email)},null,8,["disable"]),a(v,{icon:"pi pi-print",onClick:t[4]||(t[4]=D=>e.onPrintPDF()),class:"mr-3",rounted:"",outlined:"",label:"Stampa"}),a(v,{icon:"pi print-check-icon",onClick:t[5]||(t[5]=D=>e.printAndCheckIn()),class:"mr-3",rounted:"",outlined:"",label:"Stampa e Check-in"})])])]}),_:1})):O("",!0)]),_:1},8,["activeIndex"])],64)}const Gs=H(bs,[["render",Ws]]),Ks={props:["filters","date"],setup(o,t){$(()=>{C.value=Ve(8,21),n.value=Object.assign({},o.filters)});const n=x({}),e=Oe(),y=W(),C=x(),l=x(!1),d=ke(),g=x(!1),v=M(()=>e.allCourses),i=M(()=>d.showNewOrderDialog),f=async function(){const D={location_permalink:o.filters.location_permalink,api_version:"v2"};await e.fetchAllCourses(D).catch(j=>{B(y,j)})},_=function(){d.setNewOrderDialogVisibility(!1),n.value.hour="",n.value.course=null,t.emit("onCloseDialog")},S=function(D){n.value.date=o.date,d.setNewOrderDialogVisibility(D)},k=function(){g.value=n.value.open_ticket};return Z(o.filters,()=>{if(f(),n.value=Object.assign({},o.filters),o.filters.course&&!o.filters.course.id){let D=v.value.find(j=>j.name===o.filters.course.name);D&&(n.value.course=D)}}),{courses:v,form:n,hours:C,disableForm:g,visible:l,onCloseDialog:_,updateDialog:S,onChecked:k,dialogVisible:i,dialogStore:d}},components:{NewOrderDialog:Gs}},Qs=s("h2",{class:"mt-1"},"Nuova prenotazione",-1),Xs={class:"formgrid grid px-0 align-items-center mt-4"},Ys={key:0,class:"field flex flex-column w-full col-12"},Zs=s("label",{for:"typology"},"Scegli il percorso",-1),el={key:1,class:"field flex flex-column w-full col-12"},tl=s("label",{for:"typology"},"Seleziona l'orario",-1),ol={class:"flex justify-content-end align-items-center mt-2"},nl={class:"flex align-items-center justify-content-between w-full"},sl=s("h2",null,"Nuova prenotazione",-1);function ll(o,t,n,e,y,C){const l=w("Dropdown"),d=w("Button"),g=w("NewOrderDialog"),v=w("Dialog"),i=w("Card");return h(),te(i,{class:"mt-4"},{content:T(()=>[Qs,s("div",Xs,[n.filters.location_permalink?(h(),p("div",Ys,[Zs,a(l,{modelValue:e.form.course,"onUpdate:modelValue":t[0]||(t[0]=f=>e.form.course=f),options:e.courses,optionLabel:"name",disabled:e.disableForm,placeholder:""},null,8,["modelValue","options","disabled"])])):O("",!0),n.filters.location_permalink?(h(),p("div",el,[tl,a(l,{modelValue:e.form.hour,"onUpdate:modelValue":t[1]||(t[1]=f=>e.form.hour=f),options:e.hours,disabled:e.disableForm,placeholder:""},null,8,["modelValue","options","disabled"])])):O("",!0)]),s("div",ol,[a(d,{label:"Prenota",disabled:!e.form.course||!e.form.hour,onClick:t[2]||(t[2]=f=>e.updateDialog(!0))},null,8,["disabled"])]),a(v,{visible:e.dialogVisible,"onUpdate:visible":t[5]||(t[5]=f=>e.dialogVisible=f),modal:"",header:"Nuova prenotazione",style:{width:"60rem"},breakpoints:{"1199px":"75vw","575px":"90vw"},closable:!1,onHide:t[6]||(t[6]=f=>e.onCloseDialog())},{header:T(()=>[s("div",nl,[sl,a(d,{icon:"pi pi-times",text:"",rounded:"",onClick:t[3]||(t[3]=f=>e.updateDialog(!1))})])]),default:T(()=>[a(g,{form:e.form,onCloseDialog:t[4]||(t[4]=f=>e.onCloseDialog())},null,8,["form"])]),_:1},8,["visible"])]),_:1})}const al=H(Ks,[["render",ll]]),il={props:["location_permalink"],setup(o,t){$(()=>{e.value.start_date=ee.local().startOf("day").toFormat("dd/MM/yyyy"),e.value.end_date=ee.local().endOf("day").toFormat("dd/MM/yyyy"),e.value.created_at="false",e.value.start_hour="00:00",e.value.end_hour="23:59"});const n=W(),e=x({}),y=ne(),{showLoader:C,hideLoader:l}=se(),d=function(){let i=be(e.value.start_date)+" "+e.value.start_hour,f=be(e.value.end_date)+" "+e.value.end_hour;const _={from:i,to:f,location_permalink:o.location_permalink,created_at:"false"};g(_)},g=async function(i){C(),await y.downloadReport(i).then(()=>{l(),t.emit("onSubmit")}).catch(f=>{l(),B(n,f)})};return{form:e,onSubmit:d,setDefaultIfBlank:function(){(!e.value.start_hour||e.value.start_hour=="")&&(e.value.start_hour="00:00"),(!e.value.end_hour||e.value.end_hour=="")&&(e.value.end_hour="23:59")}}},components:{Form:nt}},rl={class:"formgrid grid mt-3"},cl={class:"field col-6 flex flex-column"},dl=s("label",{from:"start_date"},"Dal",-1),ul=s("label",{from:"start_hour",class:"mt-3"},"Dalle",-1),ml={class:"field col-6 flex flex-column"},_l=s("label",{from:"end_date"},"Al",-1),fl=s("label",{from:"end_hour",class:"mt-3"},"Alle",-1),vl={class:"flex align-items-center justify-content-end mt-6"};function hl(o,t,n,e,y,C){const l=w("Calendar"),d=w("InputMask"),g=w("Button"),v=w("Form");return h(),te(v,{onSubmit:e.onSubmit},{default:T(()=>[s("div",rl,[s("div",cl,[dl,a(l,{inputId:"start_date",modelValue:e.form.start_date,"onUpdate:modelValue":t[0]||(t[0]=i=>e.form.start_date=i),dateFormat:"dd/mm/yy",manualInput:!0},null,8,["modelValue"]),ul,a(d,{id:"start_hour",modelValue:e.form.start_hour,"onUpdate:modelValue":t[1]||(t[1]=i=>e.form.start_hour=i),mask:"99:99",placeholder:"HH:mm",onBlur:t[2]||(t[2]=i=>e.setDefaultIfBlank())},null,8,["modelValue"])]),s("div",ml,[_l,a(l,{inputId:"end_date",modelValue:e.form.end_date,"onUpdate:modelValue":t[3]||(t[3]=i=>e.form.end_date=i),dateFormat:"dd/mm/yy",manualInput:!0},null,8,["modelValue"]),fl,a(d,{id:"end_hour",modelValue:e.form.end_hour,"onUpdate:modelValue":t[4]||(t[4]=i=>e.form.end_hour=i),mask:"99:99",placeholder:"HH:mm",onBlur:t[5]||(t[5]=i=>e.setDefaultIfBlank())},null,8,["modelValue"])])]),s("div",vl,[a(g,{label:"Annulla",text:"",onClick:t[6]||(t[6]=i=>o.$emit("onSubmit"))}),a(g,{label:"Scarica",type:"submit"})])]),_:1},8,["onSubmit"])}const pl=H(il,[["render",hl]]),yl={setup(){const o=x({}),t=x({}),n=x(),e=x(!1),y=K(),C=Ye(),l=ne(),d=W(),g=ke(),v=M(()=>C.currentUser),i=M(()=>l.allLocations),f=M(()=>l.getCurrentLocation),_=M(()=>y.getPaymentMethods);$(()=>{f.value&&(o.value.location=f.value,t.value.location_permalink=f.value.permalink),k().then(()=>{S()})});const S=async function(){var L;let u={};const N=((L=f==null?void 0:f.value)==null?void 0:L.permalink)??null;N?u.location_permalink=N:u.location_permalink=i.value[0].permalink,await y.fetchPaymentMethods(u).then(()=>{}).catch(Q=>{B(d,Q)})},k=async function(){await l.fetchAllLocations().then(()=>{f.value||(o.value.location=i.value[0],t.value.location_permalink=i.value[0].permalink,l.updateCurrenLocation(i.value[0]))}).catch(u=>{B(d,u)})};return{filters:o,orderTable:n,order_filters:t,visibleDialog:e,user:v,locations:i,newPaymentMethods:_,fetchAllLocations:k,formatDate:ge,onUpdateFilters:function(u){u.course?o.value.course={id:u.course}:o.value.course="",u.name?o.value.name=u.name:o.value.name="",u.hour&&(u.hour.start_at?o.value.hour=u.hour.start_at:o.value.hour=u.hour)},onUpdateNewOrderFilters:function(u){u.start_at&&(t.value.hour=u.start_at),u.course_name&&(t.value.course={name:u.course_name}),u.date&&(t.value.date=u.date),u.hour&&(t.value.hour=u.hour),u.max_seats?t.value.max_seats=u.max_seats:t.value.max_seats=null,g.setNewOrderDialogVisibility(!0)},onCloseDialog:function(){n.value.loadLazyData()},onChangeLocation:function(){t.value.location_permalink=o.value.location.permalink,l.updateCurrenLocation(o.value.location)},onCloseReportDialog:function(){e.value=!1}}},components:{CalendarFilter:Qo,OrderTable:$o,OrderFilter:dn,NewOrderCard:al,SalesReportsDialog:pl}};const gl={class:"flex justify-content-between align-items-center"},kl={class:"field flex flex-column mt-3"},bl={class:"text-xl font-medium pl-3 py-0"},xl={key:0,style:{color:"#495057"},class:"flex flex-column align-items-end"},wl=s("i",{class:"pi pi-calendar mr-2 text-xl"},null,-1),Cl={class:"capitalize text-xl"},Dl={class:"flex gap-4"},Sl={key:0,class:"col-3 mt-3"},Tl={class:"col-9 mt-3"};function Vl(o,t,n,e,y,C){var S,k;const l=w("Button"),d=w("SalesReportsDialog"),g=w("Dialog"),v=w("CalendarFilter"),i=w("NewOrderCard"),f=w("OrderFilter"),_=w("OrderTable");return h(),p("div",null,[s("div",gl,[s("div",kl,[s("p",bl,b((k=(S=e.filters)==null?void 0:S.location)==null?void 0:k.name),1)]),e.filters&&e.filters.date?(h(),p("div",xl,[s("div",null,[wl,s("span",Cl,b(e.formatDate(e.filters.date)),1)]),a(l,{label:"Report visite",link:"",class:"m-0 p-0",onClick:t[0]||(t[0]=D=>e.visibleDialog=!0),icon:"pi pi-download"}),a(g,{visible:e.visibleDialog,"onUpdate:visible":t[2]||(t[2]=D=>e.visibleDialog=D),modal:"",header:"Report visite",style:{width:"35rem"}},{default:T(()=>[a(d,{onOnSubmit:t[1]||(t[1]=D=>e.onCloseReportDialog()),location_permalink:e.filters.location.permalink},null,8,["location_permalink"])]),_:1},8,["visible"])])):O("",!0)]),s("div",Dl,[e.filters.location?(h(),p("div",Sl,[a(v,{filters:e.filters},null,8,["filters"]),a(i,{date:e.filters.date,filters:e.order_filters,onOnCloseDialog:t[3]||(t[3]=D=>e.onCloseDialog())},null,8,["date","filters"])])):O("",!0),s("div",Tl,[a(f,{filters:e.filters,onOnSubmit:t[4]||(t[4]=D=>e.onUpdateFilters(D))},null,8,["filters"]),e.filters.date?(h(),te(_,{key:0,filters:e.filters,ref:"orderTable",class:"mt-4",onUpdateFilters:t[5]||(t[5]=D=>e.onUpdateNewOrderFilters(D))},null,8,["filters"])):O("",!0)])])])}const Fl=H(yl,[["render",Vl]]);export{Fl as default};
